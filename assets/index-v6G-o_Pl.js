(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(a){if(a.ep)return;a.ep=!0;const i=n(a);fetch(a.href,i)}})();function WS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var tm={exports:{}},xl={};var Yv;function RE(){if(Yv)return xl;Yv=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(r,a,i){var c=null;if(i!==void 0&&(c=""+i),a.key!==void 0&&(c=""+a.key),"key"in a){i={};for(var u in a)u!=="key"&&(i[u]=a[u])}else i=a;return a=i.ref,{$$typeof:t,type:r,key:c,ref:a!==void 0?a:null,props:i}}return xl.Fragment=e,xl.jsx=n,xl.jsxs=n,xl}var Jv;function AE(){return Jv||(Jv=1,tm.exports=RE()),tm.exports}var l=AE(),nm={exports:{}},Me={};var Qv;function _E(){if(Qv)return Me;Qv=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),i=Symbol.for("react.consumer"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),h=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),g=Symbol.for("react.activity"),x=Symbol.iterator;function v(T){return T===null||typeof T!="object"?null:(T=x&&T[x]||T["@@iterator"],typeof T=="function"?T:null)}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N=Object.assign,S={};function j(T,z,H){this.props=T,this.context=z,this.refs=S,this.updater=H||w}j.prototype.isReactComponent={},j.prototype.setState=function(T,z){if(typeof T!="object"&&typeof T!="function"&&T!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,T,z,"setState")},j.prototype.forceUpdate=function(T){this.updater.enqueueForceUpdate(this,T,"forceUpdate")};function A(){}A.prototype=j.prototype;function $(T,z,H){this.props=T,this.context=z,this.refs=S,this.updater=H||w}var L=$.prototype=new A;L.constructor=$,N(L,j.prototype),L.isPureReactComponent=!0;var R=Array.isArray;function M(){}var D={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function W(T,z,H){var Q=H.ref;return{$$typeof:t,type:T,key:z,ref:Q!==void 0?Q:null,props:H}}function ue(T,z){return W(T.type,z,T.props)}function he(T){return typeof T=="object"&&T!==null&&T.$$typeof===t}function J(T){var z={"=":"=0",":":"=2"};return"$"+T.replace(/[=:]/g,function(H){return z[H]})}var _=/\/+/g;function V(T,z){return typeof T=="object"&&T!==null&&T.key!=null?J(""+T.key):z.toString(36)}function F(T){switch(T.status){case"fulfilled":return T.value;case"rejected":throw T.reason;default:switch(typeof T.status=="string"?T.then(M,M):(T.status="pending",T.then(function(z){T.status==="pending"&&(T.status="fulfilled",T.value=z)},function(z){T.status==="pending"&&(T.status="rejected",T.reason=z)})),T.status){case"fulfilled":return T.value;case"rejected":throw T.reason}}throw T}function O(T,z,H,Q,de){var fe=typeof T;(fe==="undefined"||fe==="boolean")&&(T=null);var ae=!1;if(T===null)ae=!0;else switch(fe){case"bigint":case"string":case"number":ae=!0;break;case"object":switch(T.$$typeof){case t:case e:ae=!0;break;case m:return ae=T._init,O(ae(T._payload),z,H,Q,de)}}if(ae)return de=de(T),ae=Q===""?"."+V(T,0):Q,R(de)?(H="",ae!=null&&(H=ae.replace(_,"$&/")+"/"),O(de,z,H,"",function(tt){return tt})):de!=null&&(he(de)&&(de=ue(de,H+(de.key==null||T&&T.key===de.key?"":(""+de.key).replace(_,"$&/")+"/")+ae)),z.push(de)),1;ae=0;var we=Q===""?".":Q+":";if(R(T))for(var me=0;me<T.length;me++)Q=T[me],fe=we+V(Q,me),ae+=O(Q,z,H,fe,de);else if(me=v(T),typeof me=="function")for(T=me.call(T),me=0;!(Q=T.next()).done;)Q=Q.value,fe=we+V(Q,me++),ae+=O(Q,z,H,fe,de);else if(fe==="object"){if(typeof T.then=="function")return O(F(T),z,H,Q,de);throw z=String(T),Error("Objects are not valid as a React child (found: "+(z==="[object Object]"?"object with keys {"+Object.keys(T).join(", ")+"}":z)+"). If you meant to render a collection of children, use an array instead.")}return ae}function K(T,z,H){if(T==null)return T;var Q=[],de=0;return O(T,Q,"","",function(fe){return z.call(H,fe,de++)}),Q}function Z(T){if(T._status===-1){var z=T._result;z=z(),z.then(function(H){(T._status===0||T._status===-1)&&(T._status=1,T._result=H)},function(H){(T._status===0||T._status===-1)&&(T._status=2,T._result=H)}),T._status===-1&&(T._status=0,T._result=z)}if(T._status===1)return T._result.default;throw T._result}var X=typeof reportError=="function"?reportError:function(T){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof T=="object"&&T!==null&&typeof T.message=="string"?String(T.message):String(T),error:T});if(!window.dispatchEvent(z))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",T);return}console.error(T)},te={map:K,forEach:function(T,z,H){K(T,function(){z.apply(this,arguments)},H)},count:function(T){var z=0;return K(T,function(){z++}),z},toArray:function(T){return K(T,function(z){return z})||[]},only:function(T){if(!he(T))throw Error("React.Children.only expected to receive a single React element child.");return T}};return Me.Activity=g,Me.Children=te,Me.Component=j,Me.Fragment=n,Me.Profiler=a,Me.PureComponent=$,Me.StrictMode=r,Me.Suspense=h,Me.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=D,Me.__COMPILER_RUNTIME={__proto__:null,c:function(T){return D.H.useMemoCache(T)}},Me.cache=function(T){return function(){return T.apply(null,arguments)}},Me.cacheSignal=function(){return null},Me.cloneElement=function(T,z,H){if(T==null)throw Error("The argument must be a React element, but you passed "+T+".");var Q=N({},T.props),de=T.key;if(z!=null)for(fe in z.key!==void 0&&(de=""+z.key),z)!I.call(z,fe)||fe==="key"||fe==="__self"||fe==="__source"||fe==="ref"&&z.ref===void 0||(Q[fe]=z[fe]);var fe=arguments.length-2;if(fe===1)Q.children=H;else if(1<fe){for(var ae=Array(fe),we=0;we<fe;we++)ae[we]=arguments[we+2];Q.children=ae}return W(T.type,de,Q)},Me.createContext=function(T){return T={$$typeof:c,_currentValue:T,_currentValue2:T,_threadCount:0,Provider:null,Consumer:null},T.Provider=T,T.Consumer={$$typeof:i,_context:T},T},Me.createElement=function(T,z,H){var Q,de={},fe=null;if(z!=null)for(Q in z.key!==void 0&&(fe=""+z.key),z)I.call(z,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(de[Q]=z[Q]);var ae=arguments.length-2;if(ae===1)de.children=H;else if(1<ae){for(var we=Array(ae),me=0;me<ae;me++)we[me]=arguments[me+2];de.children=we}if(T&&T.defaultProps)for(Q in ae=T.defaultProps,ae)de[Q]===void 0&&(de[Q]=ae[Q]);return W(T,fe,de)},Me.createRef=function(){return{current:null}},Me.forwardRef=function(T){return{$$typeof:u,render:T}},Me.isValidElement=he,Me.lazy=function(T){return{$$typeof:m,_payload:{_status:-1,_result:T},_init:Z}},Me.memo=function(T,z){return{$$typeof:p,type:T,compare:z===void 0?null:z}},Me.startTransition=function(T){var z=D.T,H={};D.T=H;try{var Q=T(),de=D.S;de!==null&&de(H,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(M,X)}catch(fe){X(fe)}finally{z!==null&&H.types!==null&&(z.types=H.types),D.T=z}},Me.unstable_useCacheRefresh=function(){return D.H.useCacheRefresh()},Me.use=function(T){return D.H.use(T)},Me.useActionState=function(T,z,H){return D.H.useActionState(T,z,H)},Me.useCallback=function(T,z){return D.H.useCallback(T,z)},Me.useContext=function(T){return D.H.useContext(T)},Me.useDebugValue=function(){},Me.useDeferredValue=function(T,z){return D.H.useDeferredValue(T,z)},Me.useEffect=function(T,z){return D.H.useEffect(T,z)},Me.useEffectEvent=function(T){return D.H.useEffectEvent(T)},Me.useId=function(){return D.H.useId()},Me.useImperativeHandle=function(T,z,H){return D.H.useImperativeHandle(T,z,H)},Me.useInsertionEffect=function(T,z){return D.H.useInsertionEffect(T,z)},Me.useLayoutEffect=function(T,z){return D.H.useLayoutEffect(T,z)},Me.useMemo=function(T,z){return D.H.useMemo(T,z)},Me.useOptimistic=function(T,z){return D.H.useOptimistic(T,z)},Me.useReducer=function(T,z,H){return D.H.useReducer(T,z,H)},Me.useRef=function(T){return D.H.useRef(T)},Me.useState=function(T){return D.H.useState(T)},Me.useSyncExternalStore=function(T,z,H){return D.H.useSyncExternalStore(T,z,H)},Me.useTransition=function(){return D.H.useTransition()},Me.version="19.2.3",Me}var Xv;function yc(){return Xv||(Xv=1,nm.exports=_E()),nm.exports}var E=yc();const Ha=WS(E);var rm={exports:{}},bl={},sm={exports:{}},am={};var Zv;function ME(){return Zv||(Zv=1,(function(t){function e(O,K){var Z=O.length;O.push(K);e:for(;0<Z;){var X=Z-1>>>1,te=O[X];if(0<a(te,K))O[X]=K,O[Z]=te,Z=X;else break e}}function n(O){return O.length===0?null:O[0]}function r(O){if(O.length===0)return null;var K=O[0],Z=O.pop();if(Z!==K){O[0]=Z;e:for(var X=0,te=O.length,T=te>>>1;X<T;){var z=2*(X+1)-1,H=O[z],Q=z+1,de=O[Q];if(0>a(H,Z))Q<te&&0>a(de,H)?(O[X]=de,O[Q]=Z,X=Q):(O[X]=H,O[z]=Z,X=z);else if(Q<te&&0>a(de,Z))O[X]=de,O[Q]=Z,X=Q;else break e}}return K}function a(O,K){var Z=O.sortIndex-K.sortIndex;return Z!==0?Z:O.id-K.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var c=Date,u=c.now();t.unstable_now=function(){return c.now()-u}}var h=[],p=[],m=1,g=null,x=3,v=!1,w=!1,N=!1,S=!1,j=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;function L(O){for(var K=n(p);K!==null;){if(K.callback===null)r(p);else if(K.startTime<=O)r(p),K.sortIndex=K.expirationTime,e(h,K);else break;K=n(p)}}function R(O){if(N=!1,L(O),!w)if(n(h)!==null)w=!0,M||(M=!0,J());else{var K=n(p);K!==null&&F(R,K.startTime-O)}}var M=!1,D=-1,I=5,W=-1;function ue(){return S?!0:!(t.unstable_now()-W<I)}function he(){if(S=!1,M){var O=t.unstable_now();W=O;var K=!0;try{e:{w=!1,N&&(N=!1,A(D),D=-1),v=!0;var Z=x;try{t:{for(L(O),g=n(h);g!==null&&!(g.expirationTime>O&&ue());){var X=g.callback;if(typeof X=="function"){g.callback=null,x=g.priorityLevel;var te=X(g.expirationTime<=O);if(O=t.unstable_now(),typeof te=="function"){g.callback=te,L(O),K=!0;break t}g===n(h)&&r(h),L(O)}else r(h);g=n(h)}if(g!==null)K=!0;else{var T=n(p);T!==null&&F(R,T.startTime-O),K=!1}}break e}finally{g=null,x=Z,v=!1}K=void 0}}finally{K?J():M=!1}}}var J;if(typeof $=="function")J=function(){$(he)};else if(typeof MessageChannel<"u"){var _=new MessageChannel,V=_.port2;_.port1.onmessage=he,J=function(){V.postMessage(null)}}else J=function(){j(he,0)};function F(O,K){D=j(function(){O(t.unstable_now())},K)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(O){O.callback=null},t.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<O?Math.floor(1e3/O):5},t.unstable_getCurrentPriorityLevel=function(){return x},t.unstable_next=function(O){switch(x){case 1:case 2:case 3:var K=3;break;default:K=x}var Z=x;x=K;try{return O()}finally{x=Z}},t.unstable_requestPaint=function(){S=!0},t.unstable_runWithPriority=function(O,K){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var Z=x;x=O;try{return K()}finally{x=Z}},t.unstable_scheduleCallback=function(O,K,Z){var X=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?X+Z:X):Z=X,O){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=Z+te,O={id:m++,callback:K,priorityLevel:O,startTime:Z,expirationTime:te,sortIndex:-1},Z>X?(O.sortIndex=Z,e(p,O),n(h)===null&&O===n(p)&&(N?(A(D),D=-1):N=!0,F(R,Z-X))):(O.sortIndex=te,e(h,O),w||v||(w=!0,M||(M=!0,J()))),O},t.unstable_shouldYield=ue,t.unstable_wrapCallback=function(O){var K=x;return function(){var Z=x;x=K;try{return O.apply(this,arguments)}finally{x=Z}}}})(am)),am}var ew;function OE(){return ew||(ew=1,sm.exports=ME()),sm.exports}var im={exports:{}},nn={};var tw;function DE(){if(tw)return nn;tw=1;var t=yc();function e(h){var p="https://react.dev/errors/"+h;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)p+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+h+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var r={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},a=Symbol.for("react.portal");function i(h,p,m){var g=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:g==null?null:""+g,children:h,containerInfo:p,implementation:m}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(h,p){if(h==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return nn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,nn.createPortal=function(h,p){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return i(h,p,null,m)},nn.flushSync=function(h){var p=c.T,m=r.p;try{if(c.T=null,r.p=2,h)return h()}finally{c.T=p,r.p=m,r.d.f()}},nn.preconnect=function(h,p){typeof h=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,r.d.C(h,p))},nn.prefetchDNS=function(h){typeof h=="string"&&r.d.D(h)},nn.preinit=function(h,p){if(typeof h=="string"&&p&&typeof p.as=="string"){var m=p.as,g=u(m,p.crossOrigin),x=typeof p.integrity=="string"?p.integrity:void 0,v=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;m==="style"?r.d.S(h,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:g,integrity:x,fetchPriority:v}):m==="script"&&r.d.X(h,{crossOrigin:g,integrity:x,fetchPriority:v,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},nn.preinitModule=function(h,p){if(typeof h=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var m=u(p.as,p.crossOrigin);r.d.M(h,{crossOrigin:m,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&r.d.M(h)},nn.preload=function(h,p){if(typeof h=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var m=p.as,g=u(m,p.crossOrigin);r.d.L(h,m,{crossOrigin:g,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},nn.preloadModule=function(h,p){if(typeof h=="string")if(p){var m=u(p.as,p.crossOrigin);r.d.m(h,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:m,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else r.d.m(h)},nn.requestFormReset=function(h){r.d.r(h)},nn.unstable_batchedUpdates=function(h,p){return h(p)},nn.useFormState=function(h,p,m){return c.H.useFormState(h,p,m)},nn.useFormStatus=function(){return c.H.useHostTransitionStatus()},nn.version="19.2.3",nn}var nw;function KS(){if(nw)return im.exports;nw=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),im.exports=DE(),im.exports}var rw;function LE(){if(rw)return bl;rw=1;var t=OE(),e=yc(),n=KS();function r(s){var o="https://react.dev/errors/"+s;if(1<arguments.length){o+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+s+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function i(s){var o=s,d=s;if(s.alternate)for(;o.return;)o=o.return;else{s=o;do o=s,(o.flags&4098)!==0&&(d=o.return),s=o.return;while(s)}return o.tag===3?d:null}function c(s){if(s.tag===13){var o=s.memoizedState;if(o===null&&(s=s.alternate,s!==null&&(o=s.memoizedState)),o!==null)return o.dehydrated}return null}function u(s){if(s.tag===31){var o=s.memoizedState;if(o===null&&(s=s.alternate,s!==null&&(o=s.memoizedState)),o!==null)return o.dehydrated}return null}function h(s){if(i(s)!==s)throw Error(r(188))}function p(s){var o=s.alternate;if(!o){if(o=i(s),o===null)throw Error(r(188));return o!==s?null:s}for(var d=s,f=o;;){var y=d.return;if(y===null)break;var b=y.alternate;if(b===null){if(f=y.return,f!==null){d=f;continue}break}if(y.child===b.child){for(b=y.child;b;){if(b===d)return h(y),s;if(b===f)return h(y),o;b=b.sibling}throw Error(r(188))}if(d.return!==f.return)d=y,f=b;else{for(var k=!1,C=y.child;C;){if(C===d){k=!0,d=y,f=b;break}if(C===f){k=!0,f=y,d=b;break}C=C.sibling}if(!k){for(C=b.child;C;){if(C===d){k=!0,d=b,f=y;break}if(C===f){k=!0,f=b,d=y;break}C=C.sibling}if(!k)throw Error(r(189))}}if(d.alternate!==f)throw Error(r(190))}if(d.tag!==3)throw Error(r(188));return d.stateNode.current===d?s:o}function m(s){var o=s.tag;if(o===5||o===26||o===27||o===6)return s;for(s=s.child;s!==null;){if(o=m(s),o!==null)return o;s=s.sibling}return null}var g=Object.assign,x=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),w=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),A=Symbol.for("react.consumer"),$=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),R=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),D=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),W=Symbol.for("react.activity"),ue=Symbol.for("react.memo_cache_sentinel"),he=Symbol.iterator;function J(s){return s===null||typeof s!="object"?null:(s=he&&s[he]||s["@@iterator"],typeof s=="function"?s:null)}var _=Symbol.for("react.client.reference");function V(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===_?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case N:return"Fragment";case j:return"Profiler";case S:return"StrictMode";case R:return"Suspense";case M:return"SuspenseList";case W:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case w:return"Portal";case $:return s.displayName||"Context";case A:return(s._context.displayName||"Context")+".Consumer";case L:var o=s.render;return s=s.displayName,s||(s=o.displayName||o.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case D:return o=s.displayName||null,o!==null?o:V(s.type)||"Memo";case I:o=s._payload,s=s._init;try{return V(s(o))}catch{}}return null}var F=Array.isArray,O=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,K=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Z={pending:!1,data:null,method:null,action:null},X=[],te=-1;function T(s){return{current:s}}function z(s){0>te||(s.current=X[te],X[te]=null,te--)}function H(s,o){te++,X[te]=s.current,s.current=o}var Q=T(null),de=T(null),fe=T(null),ae=T(null);function we(s,o){switch(H(fe,o),H(de,s),H(Q,null),o.nodeType){case 9:case 11:s=(s=o.documentElement)&&(s=s.namespaceURI)?xv(s):0;break;default:if(s=o.tagName,o=o.namespaceURI)o=xv(o),s=bv(o,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}z(Q),H(Q,s)}function me(){z(Q),z(de),z(fe)}function tt(s){s.memoizedState!==null&&H(ae,s);var o=Q.current,d=bv(o,s.type);o!==d&&(H(de,s),H(Q,d))}function mt(s){de.current===s&&(z(Q),z(de)),ae.current===s&&(z(ae),pl._currentValue=Z)}var gt,Ky;function sa(s){if(gt===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);gt=o&&o[1]||"",Ky=-1<d.stack.indexOf(`
    at`)?" (<anonymous>)":-1<d.stack.indexOf("@")?"@unknown:0:0":""}return`
`+gt+s+Ky}var Bh=!1;function Ih(s,o){if(!s||Bh)return"";Bh=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(o){var se=function(){throw Error()};if(Object.defineProperty(se.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(se,[])}catch(ee){var Y=ee}Reflect.construct(s,[],se)}else{try{se.call()}catch(ee){Y=ee}s.call(se.prototype)}}else{try{throw Error()}catch(ee){Y=ee}(se=s())&&typeof se.catch=="function"&&se.catch(function(){})}}catch(ee){if(ee&&Y&&typeof ee.stack=="string")return[ee.stack,Y.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var y=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");y&&y.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var b=f.DetermineComponentFrameRoot(),k=b[0],C=b[1];if(k&&C){var B=k.split(`
`),q=C.split(`
`);for(y=f=0;f<B.length&&!B[f].includes("DetermineComponentFrameRoot");)f++;for(;y<q.length&&!q[y].includes("DetermineComponentFrameRoot");)y++;if(f===B.length||y===q.length)for(f=B.length-1,y=q.length-1;1<=f&&0<=y&&B[f]!==q[y];)y--;for(;1<=f&&0<=y;f--,y--)if(B[f]!==q[y]){if(f!==1||y!==1)do if(f--,y--,0>y||B[f]!==q[y]){var ne=`
`+B[f].replace(" at new "," at ");return s.displayName&&ne.includes("<anonymous>")&&(ne=ne.replace("<anonymous>",s.displayName)),ne}while(1<=f&&0<=y);break}}}finally{Bh=!1,Error.prepareStackTrace=d}return(d=s?s.displayName||s.name:"")?sa(d):""}function iC(s,o){switch(s.tag){case 26:case 27:case 5:return sa(s.type);case 16:return sa("Lazy");case 13:return s.child!==o&&o!==null?sa("Suspense Fallback"):sa("Suspense");case 19:return sa("SuspenseList");case 0:case 15:return Ih(s.type,!1);case 11:return Ih(s.type.render,!1);case 1:return Ih(s.type,!0);case 31:return sa("Activity");default:return""}}function Yy(s){try{var o="",d=null;do o+=iC(s,d),d=s,s=s.return;while(s);return o}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var Ph=Object.prototype.hasOwnProperty,zh=t.unstable_scheduleCallback,Uh=t.unstable_cancelCallback,oC=t.unstable_shouldYield,lC=t.unstable_requestPaint,kn=t.unstable_now,cC=t.unstable_getCurrentPriorityLevel,Jy=t.unstable_ImmediatePriority,Qy=t.unstable_UserBlockingPriority,Tc=t.unstable_NormalPriority,dC=t.unstable_LowPriority,Xy=t.unstable_IdlePriority,uC=t.log,hC=t.unstable_setDisableYieldValue,Co=null,jn=null;function ls(s){if(typeof uC=="function"&&hC(s),jn&&typeof jn.setStrictMode=="function")try{jn.setStrictMode(Co,s)}catch{}}var Cn=Math.clz32?Math.clz32:mC,fC=Math.log,pC=Math.LN2;function mC(s){return s>>>=0,s===0?32:31-(fC(s)/pC|0)|0}var Ec=256,Rc=262144,Ac=4194304;function aa(s){var o=s&42;if(o!==0)return o;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function _c(s,o,d){var f=s.pendingLanes;if(f===0)return 0;var y=0,b=s.suspendedLanes,k=s.pingedLanes;s=s.warmLanes;var C=f&134217727;return C!==0?(f=C&~b,f!==0?y=aa(f):(k&=C,k!==0?y=aa(k):d||(d=C&~s,d!==0&&(y=aa(d))))):(C=f&~b,C!==0?y=aa(C):k!==0?y=aa(k):d||(d=f&~s,d!==0&&(y=aa(d)))),y===0?0:o!==0&&o!==y&&(o&b)===0&&(b=y&-y,d=o&-o,b>=d||b===32&&(d&4194048)!==0)?o:y}function To(s,o){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&o)===0}function gC(s,o){switch(s){case 1:case 2:case 4:case 8:case 64:return o+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Zy(){var s=Ac;return Ac<<=1,(Ac&62914560)===0&&(Ac=4194304),s}function Hh(s){for(var o=[],d=0;31>d;d++)o.push(s);return o}function Eo(s,o){s.pendingLanes|=o,o!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function yC(s,o,d,f,y,b){var k=s.pendingLanes;s.pendingLanes=d,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=d,s.entangledLanes&=d,s.errorRecoveryDisabledLanes&=d,s.shellSuspendCounter=0;var C=s.entanglements,B=s.expirationTimes,q=s.hiddenUpdates;for(d=k&~d;0<d;){var ne=31-Cn(d),se=1<<ne;C[ne]=0,B[ne]=-1;var Y=q[ne];if(Y!==null)for(q[ne]=null,ne=0;ne<Y.length;ne++){var ee=Y[ne];ee!==null&&(ee.lane&=-536870913)}d&=~se}f!==0&&ex(s,f,0),b!==0&&y===0&&s.tag!==0&&(s.suspendedLanes|=b&~(k&~o))}function ex(s,o,d){s.pendingLanes|=o,s.suspendedLanes&=~o;var f=31-Cn(o);s.entangledLanes|=o,s.entanglements[f]=s.entanglements[f]|1073741824|d&261930}function tx(s,o){var d=s.entangledLanes|=o;for(s=s.entanglements;d;){var f=31-Cn(d),y=1<<f;y&o|s[f]&o&&(s[f]|=o),d&=~y}}function nx(s,o){var d=o&-o;return d=(d&42)!==0?1:Vh(d),(d&(s.suspendedLanes|o))!==0?0:d}function Vh(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Fh(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function rx(){var s=K.p;return s!==0?s:(s=window.event,s===void 0?32:Hv(s.type))}function sx(s,o){var d=K.p;try{return K.p=s,o()}finally{K.p=d}}var cs=Math.random().toString(36).slice(2),qt="__reactFiber$"+cs,mn="__reactProps$"+cs,ti="__reactContainer$"+cs,Gh="__reactEvents$"+cs,xC="__reactListeners$"+cs,bC="__reactHandles$"+cs,ax="__reactResources$"+cs,Ro="__reactMarker$"+cs;function qh(s){delete s[qt],delete s[mn],delete s[Gh],delete s[xC],delete s[bC]}function ni(s){var o=s[qt];if(o)return o;for(var d=s.parentNode;d;){if(o=d[ti]||d[qt]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(s=Cv(s);s!==null;){if(d=s[qt])return d;s=Cv(s)}return o}s=d,d=s.parentNode}return null}function ri(s){if(s=s[qt]||s[ti]){var o=s.tag;if(o===5||o===6||o===13||o===31||o===26||o===27||o===3)return s}return null}function Ao(s){var o=s.tag;if(o===5||o===26||o===27||o===6)return s.stateNode;throw Error(r(33))}function si(s){var o=s[ax];return o||(o=s[ax]={hoistableStyles:new Map,hoistableScripts:new Map}),o}function zt(s){s[Ro]=!0}var ix=new Set,ox={};function ia(s,o){ai(s,o),ai(s+"Capture",o)}function ai(s,o){for(ox[s]=o,s=0;s<o.length;s++)ix.add(o[s])}var vC=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),lx={},cx={};function wC(s){return Ph.call(cx,s)?!0:Ph.call(lx,s)?!1:vC.test(s)?cx[s]=!0:(lx[s]=!0,!1)}function Mc(s,o,d){if(wC(o))if(d===null)s.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":s.removeAttribute(o);return;case"boolean":var f=o.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){s.removeAttribute(o);return}}s.setAttribute(o,""+d)}}function Oc(s,o,d){if(d===null)s.removeAttribute(o);else{switch(typeof d){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(o);return}s.setAttribute(o,""+d)}}function Rr(s,o,d,f){if(f===null)s.removeAttribute(d);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(d);return}s.setAttributeNS(o,d,""+f)}}function Hn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function dx(s){var o=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function SC(s,o,d){var f=Object.getOwnPropertyDescriptor(s.constructor.prototype,o);if(!s.hasOwnProperty(o)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var y=f.get,b=f.set;return Object.defineProperty(s,o,{configurable:!0,get:function(){return y.call(this)},set:function(k){d=""+k,b.call(this,k)}}),Object.defineProperty(s,o,{enumerable:f.enumerable}),{getValue:function(){return d},setValue:function(k){d=""+k},stopTracking:function(){s._valueTracker=null,delete s[o]}}}}function Wh(s){if(!s._valueTracker){var o=dx(s)?"checked":"value";s._valueTracker=SC(s,o,""+s[o])}}function ux(s){if(!s)return!1;var o=s._valueTracker;if(!o)return!0;var d=o.getValue(),f="";return s&&(f=dx(s)?s.checked?"true":"false":s.value),s=f,s!==d?(o.setValue(s),!0):!1}function Dc(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var NC=/[\n"\\]/g;function Vn(s){return s.replace(NC,function(o){return"\\"+o.charCodeAt(0).toString(16)+" "})}function Kh(s,o,d,f,y,b,k,C){s.name="",k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?s.type=k:s.removeAttribute("type"),o!=null?k==="number"?(o===0&&s.value===""||s.value!=o)&&(s.value=""+Hn(o)):s.value!==""+Hn(o)&&(s.value=""+Hn(o)):k!=="submit"&&k!=="reset"||s.removeAttribute("value"),o!=null?Yh(s,k,Hn(o)):d!=null?Yh(s,k,Hn(d)):f!=null&&s.removeAttribute("value"),y==null&&b!=null&&(s.defaultChecked=!!b),y!=null&&(s.checked=y&&typeof y!="function"&&typeof y!="symbol"),C!=null&&typeof C!="function"&&typeof C!="symbol"&&typeof C!="boolean"?s.name=""+Hn(C):s.removeAttribute("name")}function hx(s,o,d,f,y,b,k,C){if(b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(s.type=b),o!=null||d!=null){if(!(b!=="submit"&&b!=="reset"||o!=null)){Wh(s);return}d=d!=null?""+Hn(d):"",o=o!=null?""+Hn(o):d,C||o===s.value||(s.value=o),s.defaultValue=o}f=f??y,f=typeof f!="function"&&typeof f!="symbol"&&!!f,s.checked=C?s.checked:!!f,s.defaultChecked=!!f,k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"&&(s.name=k),Wh(s)}function Yh(s,o,d){o==="number"&&Dc(s.ownerDocument)===s||s.defaultValue===""+d||(s.defaultValue=""+d)}function ii(s,o,d,f){if(s=s.options,o){o={};for(var y=0;y<d.length;y++)o["$"+d[y]]=!0;for(d=0;d<s.length;d++)y=o.hasOwnProperty("$"+s[d].value),s[d].selected!==y&&(s[d].selected=y),y&&f&&(s[d].defaultSelected=!0)}else{for(d=""+Hn(d),o=null,y=0;y<s.length;y++){if(s[y].value===d){s[y].selected=!0,f&&(s[y].defaultSelected=!0);return}o!==null||s[y].disabled||(o=s[y])}o!==null&&(o.selected=!0)}}function fx(s,o,d){if(o!=null&&(o=""+Hn(o),o!==s.value&&(s.value=o),d==null)){s.defaultValue!==o&&(s.defaultValue=o);return}s.defaultValue=d!=null?""+Hn(d):""}function px(s,o,d,f){if(o==null){if(f!=null){if(d!=null)throw Error(r(92));if(F(f)){if(1<f.length)throw Error(r(93));f=f[0]}d=f}d==null&&(d=""),o=d}d=Hn(o),s.defaultValue=d,f=s.textContent,f===d&&f!==""&&f!==null&&(s.value=f),Wh(s)}function oi(s,o){if(o){var d=s.firstChild;if(d&&d===s.lastChild&&d.nodeType===3){d.nodeValue=o;return}}s.textContent=o}var kC=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function mx(s,o,d){var f=o.indexOf("--")===0;d==null||typeof d=="boolean"||d===""?f?s.setProperty(o,""):o==="float"?s.cssFloat="":s[o]="":f?s.setProperty(o,d):typeof d!="number"||d===0||kC.has(o)?o==="float"?s.cssFloat=d:s[o]=(""+d).trim():s[o]=d+"px"}function gx(s,o,d){if(o!=null&&typeof o!="object")throw Error(r(62));if(s=s.style,d!=null){for(var f in d)!d.hasOwnProperty(f)||o!=null&&o.hasOwnProperty(f)||(f.indexOf("--")===0?s.setProperty(f,""):f==="float"?s.cssFloat="":s[f]="");for(var y in o)f=o[y],o.hasOwnProperty(y)&&d[y]!==f&&mx(s,y,f)}else for(var b in o)o.hasOwnProperty(b)&&mx(s,b,o[b])}function Jh(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jC=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),CC=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Lc(s){return CC.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Ar(){}var Qh=null;function Xh(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var li=null,ci=null;function yx(s){var o=ri(s);if(o&&(s=o.stateNode)){var d=s[mn]||null;e:switch(s=o.stateNode,o.type){case"input":if(Kh(s,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name),o=d.name,d.type==="radio"&&o!=null){for(d=s;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll('input[name="'+Vn(""+o)+'"][type="radio"]'),o=0;o<d.length;o++){var f=d[o];if(f!==s&&f.form===s.form){var y=f[mn]||null;if(!y)throw Error(r(90));Kh(f,y.value,y.defaultValue,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name)}}for(o=0;o<d.length;o++)f=d[o],f.form===s.form&&ux(f)}break e;case"textarea":fx(s,d.value,d.defaultValue);break e;case"select":o=d.value,o!=null&&ii(s,!!d.multiple,o,!1)}}}var Zh=!1;function xx(s,o,d){if(Zh)return s(o,d);Zh=!0;try{var f=s(o);return f}finally{if(Zh=!1,(li!==null||ci!==null)&&(Sd(),li&&(o=li,s=ci,ci=li=null,yx(o),s)))for(o=0;o<s.length;o++)yx(s[o])}}function _o(s,o){var d=s.stateNode;if(d===null)return null;var f=d[mn]||null;if(f===null)return null;d=f[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(s=s.type,f=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!f;break e;default:s=!1}if(s)return null;if(d&&typeof d!="function")throw Error(r(231,o,typeof d));return d}var _r=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ef=!1;if(_r)try{var Mo={};Object.defineProperty(Mo,"passive",{get:function(){ef=!0}}),window.addEventListener("test",Mo,Mo),window.removeEventListener("test",Mo,Mo)}catch{ef=!1}var ds=null,tf=null,$c=null;function bx(){if($c)return $c;var s,o=tf,d=o.length,f,y="value"in ds?ds.value:ds.textContent,b=y.length;for(s=0;s<d&&o[s]===y[s];s++);var k=d-s;for(f=1;f<=k&&o[d-f]===y[b-f];f++);return $c=y.slice(s,1<f?1-f:void 0)}function Bc(s){var o=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&o===13&&(s=13)):s=o,s===10&&(s=13),32<=s||s===13?s:0}function Ic(){return!0}function vx(){return!1}function gn(s){function o(d,f,y,b,k){this._reactName=d,this._targetInst=y,this.type=f,this.nativeEvent=b,this.target=k,this.currentTarget=null;for(var C in s)s.hasOwnProperty(C)&&(d=s[C],this[C]=d?d(b):b[C]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?Ic:vx,this.isPropagationStopped=vx,this}return g(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Ic)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Ic)},persist:function(){},isPersistent:Ic}),o}var oa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Pc=gn(oa),Oo=g({},oa,{view:0,detail:0}),TC=gn(Oo),nf,rf,Do,zc=g({},Oo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:af,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Do&&(Do&&s.type==="mousemove"?(nf=s.screenX-Do.screenX,rf=s.screenY-Do.screenY):rf=nf=0,Do=s),nf)},movementY:function(s){return"movementY"in s?s.movementY:rf}}),wx=gn(zc),EC=g({},zc,{dataTransfer:0}),RC=gn(EC),AC=g({},Oo,{relatedTarget:0}),sf=gn(AC),_C=g({},oa,{animationName:0,elapsedTime:0,pseudoElement:0}),MC=gn(_C),OC=g({},oa,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),DC=gn(OC),LC=g({},oa,{data:0}),Sx=gn(LC),$C={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},BC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},IC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function PC(s){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(s):(s=IC[s])?!!o[s]:!1}function af(){return PC}var zC=g({},Oo,{key:function(s){if(s.key){var o=$C[s.key]||s.key;if(o!=="Unidentified")return o}return s.type==="keypress"?(s=Bc(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?BC[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:af,charCode:function(s){return s.type==="keypress"?Bc(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Bc(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),UC=gn(zC),HC=g({},zc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Nx=gn(HC),VC=g({},Oo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:af}),FC=gn(VC),GC=g({},oa,{propertyName:0,elapsedTime:0,pseudoElement:0}),qC=gn(GC),WC=g({},zc,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),KC=gn(WC),YC=g({},oa,{newState:0,oldState:0}),JC=gn(YC),QC=[9,13,27,32],of=_r&&"CompositionEvent"in window,Lo=null;_r&&"documentMode"in document&&(Lo=document.documentMode);var XC=_r&&"TextEvent"in window&&!Lo,kx=_r&&(!of||Lo&&8<Lo&&11>=Lo),jx=" ",Cx=!1;function Tx(s,o){switch(s){case"keyup":return QC.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ex(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var di=!1;function ZC(s,o){switch(s){case"compositionend":return Ex(o);case"keypress":return o.which!==32?null:(Cx=!0,jx);case"textInput":return s=o.data,s===jx&&Cx?null:s;default:return null}}function eT(s,o){if(di)return s==="compositionend"||!of&&Tx(s,o)?(s=bx(),$c=tf=ds=null,di=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return kx&&o.locale!=="ko"?null:o.data;default:return null}}var tT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Rx(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o==="input"?!!tT[s.type]:o==="textarea"}function Ax(s,o,d,f){li?ci?ci.push(f):ci=[f]:li=f,o=Rd(o,"onChange"),0<o.length&&(d=new Pc("onChange","change",null,d,f),s.push({event:d,listeners:o}))}var $o=null,Bo=null;function nT(s){hv(s,0)}function Uc(s){var o=Ao(s);if(ux(o))return s}function _x(s,o){if(s==="change")return o}var Mx=!1;if(_r){var lf;if(_r){var cf="oninput"in document;if(!cf){var Ox=document.createElement("div");Ox.setAttribute("oninput","return;"),cf=typeof Ox.oninput=="function"}lf=cf}else lf=!1;Mx=lf&&(!document.documentMode||9<document.documentMode)}function Dx(){$o&&($o.detachEvent("onpropertychange",Lx),Bo=$o=null)}function Lx(s){if(s.propertyName==="value"&&Uc(Bo)){var o=[];Ax(o,Bo,s,Xh(s)),xx(nT,o)}}function rT(s,o,d){s==="focusin"?(Dx(),$o=o,Bo=d,$o.attachEvent("onpropertychange",Lx)):s==="focusout"&&Dx()}function sT(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Uc(Bo)}function aT(s,o){if(s==="click")return Uc(o)}function iT(s,o){if(s==="input"||s==="change")return Uc(o)}function oT(s,o){return s===o&&(s!==0||1/s===1/o)||s!==s&&o!==o}var Tn=typeof Object.is=="function"?Object.is:oT;function Io(s,o){if(Tn(s,o))return!0;if(typeof s!="object"||s===null||typeof o!="object"||o===null)return!1;var d=Object.keys(s),f=Object.keys(o);if(d.length!==f.length)return!1;for(f=0;f<d.length;f++){var y=d[f];if(!Ph.call(o,y)||!Tn(s[y],o[y]))return!1}return!0}function $x(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Bx(s,o){var d=$x(s);s=0;for(var f;d;){if(d.nodeType===3){if(f=s+d.textContent.length,s<=o&&f>=o)return{node:d,offset:o-s};s=f}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=$x(d)}}function Ix(s,o){return s&&o?s===o?!0:s&&s.nodeType===3?!1:o&&o.nodeType===3?Ix(s,o.parentNode):"contains"in s?s.contains(o):s.compareDocumentPosition?!!(s.compareDocumentPosition(o)&16):!1:!1}function Px(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var o=Dc(s.document);o instanceof s.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)s=o.contentWindow;else break;o=Dc(s.document)}return o}function df(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o&&(o==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||o==="textarea"||s.contentEditable==="true")}var lT=_r&&"documentMode"in document&&11>=document.documentMode,ui=null,uf=null,Po=null,hf=!1;function zx(s,o,d){var f=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;hf||ui==null||ui!==Dc(f)||(f=ui,"selectionStart"in f&&df(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Po&&Io(Po,f)||(Po=f,f=Rd(uf,"onSelect"),0<f.length&&(o=new Pc("onSelect","select",null,o,d),s.push({event:o,listeners:f}),o.target=ui)))}function la(s,o){var d={};return d[s.toLowerCase()]=o.toLowerCase(),d["Webkit"+s]="webkit"+o,d["Moz"+s]="moz"+o,d}var hi={animationend:la("Animation","AnimationEnd"),animationiteration:la("Animation","AnimationIteration"),animationstart:la("Animation","AnimationStart"),transitionrun:la("Transition","TransitionRun"),transitionstart:la("Transition","TransitionStart"),transitioncancel:la("Transition","TransitionCancel"),transitionend:la("Transition","TransitionEnd")},ff={},Ux={};_r&&(Ux=document.createElement("div").style,"AnimationEvent"in window||(delete hi.animationend.animation,delete hi.animationiteration.animation,delete hi.animationstart.animation),"TransitionEvent"in window||delete hi.transitionend.transition);function ca(s){if(ff[s])return ff[s];if(!hi[s])return s;var o=hi[s],d;for(d in o)if(o.hasOwnProperty(d)&&d in Ux)return ff[s]=o[d];return s}var Hx=ca("animationend"),Vx=ca("animationiteration"),Fx=ca("animationstart"),cT=ca("transitionrun"),dT=ca("transitionstart"),uT=ca("transitioncancel"),Gx=ca("transitionend"),qx=new Map,pf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");pf.push("scrollEnd");function or(s,o){qx.set(s,o),ia(o,[s])}var Hc=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var o=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(o))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Fn=[],fi=0,mf=0;function Vc(){for(var s=fi,o=mf=fi=0;o<s;){var d=Fn[o];Fn[o++]=null;var f=Fn[o];Fn[o++]=null;var y=Fn[o];Fn[o++]=null;var b=Fn[o];if(Fn[o++]=null,f!==null&&y!==null){var k=f.pending;k===null?y.next=y:(y.next=k.next,k.next=y),f.pending=y}b!==0&&Wx(d,y,b)}}function Fc(s,o,d,f){Fn[fi++]=s,Fn[fi++]=o,Fn[fi++]=d,Fn[fi++]=f,mf|=f,s.lanes|=f,s=s.alternate,s!==null&&(s.lanes|=f)}function gf(s,o,d,f){return Fc(s,o,d,f),Gc(s)}function da(s,o){return Fc(s,null,null,o),Gc(s)}function Wx(s,o,d){s.lanes|=d;var f=s.alternate;f!==null&&(f.lanes|=d);for(var y=!1,b=s.return;b!==null;)b.childLanes|=d,f=b.alternate,f!==null&&(f.childLanes|=d),b.tag===22&&(s=b.stateNode,s===null||s._visibility&1||(y=!0)),s=b,b=b.return;return s.tag===3?(b=s.stateNode,y&&o!==null&&(y=31-Cn(d),s=b.hiddenUpdates,f=s[y],f===null?s[y]=[o]:f.push(o),o.lane=d|536870912),b):null}function Gc(s){if(50<ol)throw ol=0,jp=null,Error(r(185));for(var o=s.return;o!==null;)s=o,o=s.return;return s.tag===3?s.stateNode:null}var pi={};function hT(s,o,d,f){this.tag=s,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function En(s,o,d,f){return new hT(s,o,d,f)}function yf(s){return s=s.prototype,!(!s||!s.isReactComponent)}function Mr(s,o){var d=s.alternate;return d===null?(d=En(s.tag,o,s.key,s.mode),d.elementType=s.elementType,d.type=s.type,d.stateNode=s.stateNode,d.alternate=s,s.alternate=d):(d.pendingProps=o,d.type=s.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=s.flags&65011712,d.childLanes=s.childLanes,d.lanes=s.lanes,d.child=s.child,d.memoizedProps=s.memoizedProps,d.memoizedState=s.memoizedState,d.updateQueue=s.updateQueue,o=s.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=s.sibling,d.index=s.index,d.ref=s.ref,d.refCleanup=s.refCleanup,d}function Kx(s,o){s.flags&=65011714;var d=s.alternate;return d===null?(s.childLanes=0,s.lanes=o,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=d.childLanes,s.lanes=d.lanes,s.child=d.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=d.memoizedProps,s.memoizedState=d.memoizedState,s.updateQueue=d.updateQueue,s.type=d.type,o=d.dependencies,s.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),s}function qc(s,o,d,f,y,b){var k=0;if(f=s,typeof s=="function")yf(s)&&(k=1);else if(typeof s=="string")k=yE(s,d,Q.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case W:return s=En(31,d,o,y),s.elementType=W,s.lanes=b,s;case N:return ua(d.children,y,b,o);case S:k=8,y|=24;break;case j:return s=En(12,d,o,y|2),s.elementType=j,s.lanes=b,s;case R:return s=En(13,d,o,y),s.elementType=R,s.lanes=b,s;case M:return s=En(19,d,o,y),s.elementType=M,s.lanes=b,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case $:k=10;break e;case A:k=9;break e;case L:k=11;break e;case D:k=14;break e;case I:k=16,f=null;break e}k=29,d=Error(r(130,s===null?"null":typeof s,"")),f=null}return o=En(k,d,o,y),o.elementType=s,o.type=f,o.lanes=b,o}function ua(s,o,d,f){return s=En(7,s,f,o),s.lanes=d,s}function xf(s,o,d){return s=En(6,s,null,o),s.lanes=d,s}function Yx(s){var o=En(18,null,null,0);return o.stateNode=s,o}function bf(s,o,d){return o=En(4,s.children!==null?s.children:[],s.key,o),o.lanes=d,o.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},o}var Jx=new WeakMap;function Gn(s,o){if(typeof s=="object"&&s!==null){var d=Jx.get(s);return d!==void 0?d:(o={value:s,source:o,stack:Yy(o)},Jx.set(s,o),o)}return{value:s,source:o,stack:Yy(o)}}var mi=[],gi=0,Wc=null,zo=0,qn=[],Wn=0,us=null,xr=1,br="";function Or(s,o){mi[gi++]=zo,mi[gi++]=Wc,Wc=s,zo=o}function Qx(s,o,d){qn[Wn++]=xr,qn[Wn++]=br,qn[Wn++]=us,us=s;var f=xr;s=br;var y=32-Cn(f)-1;f&=~(1<<y),d+=1;var b=32-Cn(o)+y;if(30<b){var k=y-y%5;b=(f&(1<<k)-1).toString(32),f>>=k,y-=k,xr=1<<32-Cn(o)+y|d<<y|f,br=b+s}else xr=1<<b|d<<y|f,br=s}function vf(s){s.return!==null&&(Or(s,1),Qx(s,1,0))}function wf(s){for(;s===Wc;)Wc=mi[--gi],mi[gi]=null,zo=mi[--gi],mi[gi]=null;for(;s===us;)us=qn[--Wn],qn[Wn]=null,br=qn[--Wn],qn[Wn]=null,xr=qn[--Wn],qn[Wn]=null}function Xx(s,o){qn[Wn++]=xr,qn[Wn++]=br,qn[Wn++]=us,xr=o.id,br=o.overflow,us=s}var Wt=null,it=null,Ve=!1,hs=null,Kn=!1,Sf=Error(r(519));function fs(s){var o=Error(r(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Uo(Gn(o,s)),Sf}function Zx(s){var o=s.stateNode,d=s.type,f=s.memoizedProps;switch(o[qt]=s,o[mn]=f,d){case"dialog":ze("cancel",o),ze("close",o);break;case"iframe":case"object":case"embed":ze("load",o);break;case"video":case"audio":for(d=0;d<cl.length;d++)ze(cl[d],o);break;case"source":ze("error",o);break;case"img":case"image":case"link":ze("error",o),ze("load",o);break;case"details":ze("toggle",o);break;case"input":ze("invalid",o),hx(o,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":ze("invalid",o);break;case"textarea":ze("invalid",o),px(o,f.value,f.defaultValue,f.children)}d=f.children,typeof d!="string"&&typeof d!="number"&&typeof d!="bigint"||o.textContent===""+d||f.suppressHydrationWarning===!0||gv(o.textContent,d)?(f.popover!=null&&(ze("beforetoggle",o),ze("toggle",o)),f.onScroll!=null&&ze("scroll",o),f.onScrollEnd!=null&&ze("scrollend",o),f.onClick!=null&&(o.onclick=Ar),o=!0):o=!1,o||fs(s,!0)}function eb(s){for(Wt=s.return;Wt;)switch(Wt.tag){case 5:case 31:case 13:Kn=!1;return;case 27:case 3:Kn=!0;return;default:Wt=Wt.return}}function yi(s){if(s!==Wt)return!1;if(!Ve)return eb(s),Ve=!0,!1;var o=s.tag,d;if((d=o!==3&&o!==27)&&((d=o===5)&&(d=s.type,d=!(d!=="form"&&d!=="button")||zp(s.type,s.memoizedProps)),d=!d),d&&it&&fs(s),eb(s),o===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));it=jv(s)}else if(o===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));it=jv(s)}else o===27?(o=it,Ts(s.type)?(s=Gp,Gp=null,it=s):it=o):it=Wt?Jn(s.stateNode.nextSibling):null;return!0}function ha(){it=Wt=null,Ve=!1}function Nf(){var s=hs;return s!==null&&(vn===null?vn=s:vn.push.apply(vn,s),hs=null),s}function Uo(s){hs===null?hs=[s]:hs.push(s)}var kf=T(null),fa=null,Dr=null;function ps(s,o,d){H(kf,o._currentValue),o._currentValue=d}function Lr(s){s._currentValue=kf.current,z(kf)}function jf(s,o,d){for(;s!==null;){var f=s.alternate;if((s.childLanes&o)!==o?(s.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),s===d)break;s=s.return}}function Cf(s,o,d,f){var y=s.child;for(y!==null&&(y.return=s);y!==null;){var b=y.dependencies;if(b!==null){var k=y.child;b=b.firstContext;e:for(;b!==null;){var C=b;b=y;for(var B=0;B<o.length;B++)if(C.context===o[B]){b.lanes|=d,C=b.alternate,C!==null&&(C.lanes|=d),jf(b.return,d,s),f||(k=null);break e}b=C.next}}else if(y.tag===18){if(k=y.return,k===null)throw Error(r(341));k.lanes|=d,b=k.alternate,b!==null&&(b.lanes|=d),jf(k,d,s),k=null}else k=y.child;if(k!==null)k.return=y;else for(k=y;k!==null;){if(k===s){k=null;break}if(y=k.sibling,y!==null){y.return=k.return,k=y;break}k=k.return}y=k}}function xi(s,o,d,f){s=null;for(var y=o,b=!1;y!==null;){if(!b){if((y.flags&524288)!==0)b=!0;else if((y.flags&262144)!==0)break}if(y.tag===10){var k=y.alternate;if(k===null)throw Error(r(387));if(k=k.memoizedProps,k!==null){var C=y.type;Tn(y.pendingProps.value,k.value)||(s!==null?s.push(C):s=[C])}}else if(y===ae.current){if(k=y.alternate,k===null)throw Error(r(387));k.memoizedState.memoizedState!==y.memoizedState.memoizedState&&(s!==null?s.push(pl):s=[pl])}y=y.return}s!==null&&Cf(o,s,d,f),o.flags|=262144}function Kc(s){for(s=s.firstContext;s!==null;){if(!Tn(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function pa(s){fa=s,Dr=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function Kt(s){return tb(fa,s)}function Yc(s,o){return fa===null&&pa(s),tb(s,o)}function tb(s,o){var d=o._currentValue;if(o={context:o,memoizedValue:d,next:null},Dr===null){if(s===null)throw Error(r(308));Dr=o,s.dependencies={lanes:0,firstContext:o},s.flags|=524288}else Dr=Dr.next=o;return d}var fT=typeof AbortController<"u"?AbortController:function(){var s=[],o=this.signal={aborted:!1,addEventListener:function(d,f){s.push(f)}};this.abort=function(){o.aborted=!0,s.forEach(function(d){return d()})}},pT=t.unstable_scheduleCallback,mT=t.unstable_NormalPriority,Tt={$$typeof:$,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Tf(){return{controller:new fT,data:new Map,refCount:0}}function Ho(s){s.refCount--,s.refCount===0&&pT(mT,function(){s.controller.abort()})}var Vo=null,Ef=0,bi=0,vi=null;function gT(s,o){if(Vo===null){var d=Vo=[];Ef=0,bi=_p(),vi={status:"pending",value:void 0,then:function(f){d.push(f)}}}return Ef++,o.then(nb,nb),o}function nb(){if(--Ef===0&&Vo!==null){vi!==null&&(vi.status="fulfilled");var s=Vo;Vo=null,bi=0,vi=null;for(var o=0;o<s.length;o++)(0,s[o])()}}function yT(s,o){var d=[],f={status:"pending",value:null,reason:null,then:function(y){d.push(y)}};return s.then(function(){f.status="fulfilled",f.value=o;for(var y=0;y<d.length;y++)(0,d[y])(o)},function(y){for(f.status="rejected",f.reason=y,y=0;y<d.length;y++)(0,d[y])(void 0)}),f}var rb=O.S;O.S=function(s,o){z0=kn(),typeof o=="object"&&o!==null&&typeof o.then=="function"&&gT(s,o),rb!==null&&rb(s,o)};var ma=T(null);function Rf(){var s=ma.current;return s!==null?s:nt.pooledCache}function Jc(s,o){o===null?H(ma,ma.current):H(ma,o.pool)}function sb(){var s=Rf();return s===null?null:{parent:Tt._currentValue,pool:s}}var wi=Error(r(460)),Af=Error(r(474)),Qc=Error(r(542)),Xc={then:function(){}};function ab(s){return s=s.status,s==="fulfilled"||s==="rejected"}function ib(s,o,d){switch(d=s[d],d===void 0?s.push(o):d!==o&&(o.then(Ar,Ar),o=d),o.status){case"fulfilled":return o.value;case"rejected":throw s=o.reason,lb(s),s;default:if(typeof o.status=="string")o.then(Ar,Ar);else{if(s=nt,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=o,s.status="pending",s.then(function(f){if(o.status==="pending"){var y=o;y.status="fulfilled",y.value=f}},function(f){if(o.status==="pending"){var y=o;y.status="rejected",y.reason=f}})}switch(o.status){case"fulfilled":return o.value;case"rejected":throw s=o.reason,lb(s),s}throw ya=o,wi}}function ga(s){try{var o=s._init;return o(s._payload)}catch(d){throw d!==null&&typeof d=="object"&&typeof d.then=="function"?(ya=d,wi):d}}var ya=null;function ob(){if(ya===null)throw Error(r(459));var s=ya;return ya=null,s}function lb(s){if(s===wi||s===Qc)throw Error(r(483))}var Si=null,Fo=0;function Zc(s){var o=Fo;return Fo+=1,Si===null&&(Si=[]),ib(Si,s,o)}function Go(s,o){o=o.props.ref,s.ref=o!==void 0?o:null}function ed(s,o){throw o.$$typeof===x?Error(r(525)):(s=Object.prototype.toString.call(o),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":s)))}function cb(s){function o(U,P){if(s){var G=U.deletions;G===null?(U.deletions=[P],U.flags|=16):G.push(P)}}function d(U,P){if(!s)return null;for(;P!==null;)o(U,P),P=P.sibling;return null}function f(U){for(var P=new Map;U!==null;)U.key!==null?P.set(U.key,U):P.set(U.index,U),U=U.sibling;return P}function y(U,P){return U=Mr(U,P),U.index=0,U.sibling=null,U}function b(U,P,G){return U.index=G,s?(G=U.alternate,G!==null?(G=G.index,G<P?(U.flags|=67108866,P):G):(U.flags|=67108866,P)):(U.flags|=1048576,P)}function k(U){return s&&U.alternate===null&&(U.flags|=67108866),U}function C(U,P,G,re){return P===null||P.tag!==6?(P=xf(G,U.mode,re),P.return=U,P):(P=y(P,G),P.return=U,P)}function B(U,P,G,re){var je=G.type;return je===N?ne(U,P,G.props.children,re,G.key):P!==null&&(P.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===I&&ga(je)===P.type)?(P=y(P,G.props),Go(P,G),P.return=U,P):(P=qc(G.type,G.key,G.props,null,U.mode,re),Go(P,G),P.return=U,P)}function q(U,P,G,re){return P===null||P.tag!==4||P.stateNode.containerInfo!==G.containerInfo||P.stateNode.implementation!==G.implementation?(P=bf(G,U.mode,re),P.return=U,P):(P=y(P,G.children||[]),P.return=U,P)}function ne(U,P,G,re,je){return P===null||P.tag!==7?(P=ua(G,U.mode,re,je),P.return=U,P):(P=y(P,G),P.return=U,P)}function se(U,P,G){if(typeof P=="string"&&P!==""||typeof P=="number"||typeof P=="bigint")return P=xf(""+P,U.mode,G),P.return=U,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case v:return G=qc(P.type,P.key,P.props,null,U.mode,G),Go(G,P),G.return=U,G;case w:return P=bf(P,U.mode,G),P.return=U,P;case I:return P=ga(P),se(U,P,G)}if(F(P)||J(P))return P=ua(P,U.mode,G,null),P.return=U,P;if(typeof P.then=="function")return se(U,Zc(P),G);if(P.$$typeof===$)return se(U,Yc(U,P),G);ed(U,P)}return null}function Y(U,P,G,re){var je=P!==null?P.key:null;if(typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint")return je!==null?null:C(U,P,""+G,re);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case v:return G.key===je?B(U,P,G,re):null;case w:return G.key===je?q(U,P,G,re):null;case I:return G=ga(G),Y(U,P,G,re)}if(F(G)||J(G))return je!==null?null:ne(U,P,G,re,null);if(typeof G.then=="function")return Y(U,P,Zc(G),re);if(G.$$typeof===$)return Y(U,P,Yc(U,G),re);ed(U,G)}return null}function ee(U,P,G,re,je){if(typeof re=="string"&&re!==""||typeof re=="number"||typeof re=="bigint")return U=U.get(G)||null,C(P,U,""+re,je);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case v:return U=U.get(re.key===null?G:re.key)||null,B(P,U,re,je);case w:return U=U.get(re.key===null?G:re.key)||null,q(P,U,re,je);case I:return re=ga(re),ee(U,P,G,re,je)}if(F(re)||J(re))return U=U.get(G)||null,ne(P,U,re,je,null);if(typeof re.then=="function")return ee(U,P,G,Zc(re),je);if(re.$$typeof===$)return ee(U,P,G,Yc(P,re),je);ed(P,re)}return null}function xe(U,P,G,re){for(var je=null,qe=null,Se=P,De=P=0,He=null;Se!==null&&De<G.length;De++){Se.index>De?(He=Se,Se=null):He=Se.sibling;var We=Y(U,Se,G[De],re);if(We===null){Se===null&&(Se=He);break}s&&Se&&We.alternate===null&&o(U,Se),P=b(We,P,De),qe===null?je=We:qe.sibling=We,qe=We,Se=He}if(De===G.length)return d(U,Se),Ve&&Or(U,De),je;if(Se===null){for(;De<G.length;De++)Se=se(U,G[De],re),Se!==null&&(P=b(Se,P,De),qe===null?je=Se:qe.sibling=Se,qe=Se);return Ve&&Or(U,De),je}for(Se=f(Se);De<G.length;De++)He=ee(Se,U,De,G[De],re),He!==null&&(s&&He.alternate!==null&&Se.delete(He.key===null?De:He.key),P=b(He,P,De),qe===null?je=He:qe.sibling=He,qe=He);return s&&Se.forEach(function(Ms){return o(U,Ms)}),Ve&&Or(U,De),je}function Ee(U,P,G,re){if(G==null)throw Error(r(151));for(var je=null,qe=null,Se=P,De=P=0,He=null,We=G.next();Se!==null&&!We.done;De++,We=G.next()){Se.index>De?(He=Se,Se=null):He=Se.sibling;var Ms=Y(U,Se,We.value,re);if(Ms===null){Se===null&&(Se=He);break}s&&Se&&Ms.alternate===null&&o(U,Se),P=b(Ms,P,De),qe===null?je=Ms:qe.sibling=Ms,qe=Ms,Se=He}if(We.done)return d(U,Se),Ve&&Or(U,De),je;if(Se===null){for(;!We.done;De++,We=G.next())We=se(U,We.value,re),We!==null&&(P=b(We,P,De),qe===null?je=We:qe.sibling=We,qe=We);return Ve&&Or(U,De),je}for(Se=f(Se);!We.done;De++,We=G.next())We=ee(Se,U,De,We.value,re),We!==null&&(s&&We.alternate!==null&&Se.delete(We.key===null?De:We.key),P=b(We,P,De),qe===null?je=We:qe.sibling=We,qe=We);return s&&Se.forEach(function(EE){return o(U,EE)}),Ve&&Or(U,De),je}function et(U,P,G,re){if(typeof G=="object"&&G!==null&&G.type===N&&G.key===null&&(G=G.props.children),typeof G=="object"&&G!==null){switch(G.$$typeof){case v:e:{for(var je=G.key;P!==null;){if(P.key===je){if(je=G.type,je===N){if(P.tag===7){d(U,P.sibling),re=y(P,G.props.children),re.return=U,U=re;break e}}else if(P.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===I&&ga(je)===P.type){d(U,P.sibling),re=y(P,G.props),Go(re,G),re.return=U,U=re;break e}d(U,P);break}else o(U,P);P=P.sibling}G.type===N?(re=ua(G.props.children,U.mode,re,G.key),re.return=U,U=re):(re=qc(G.type,G.key,G.props,null,U.mode,re),Go(re,G),re.return=U,U=re)}return k(U);case w:e:{for(je=G.key;P!==null;){if(P.key===je)if(P.tag===4&&P.stateNode.containerInfo===G.containerInfo&&P.stateNode.implementation===G.implementation){d(U,P.sibling),re=y(P,G.children||[]),re.return=U,U=re;break e}else{d(U,P);break}else o(U,P);P=P.sibling}re=bf(G,U.mode,re),re.return=U,U=re}return k(U);case I:return G=ga(G),et(U,P,G,re)}if(F(G))return xe(U,P,G,re);if(J(G)){if(je=J(G),typeof je!="function")throw Error(r(150));return G=je.call(G),Ee(U,P,G,re)}if(typeof G.then=="function")return et(U,P,Zc(G),re);if(G.$$typeof===$)return et(U,P,Yc(U,G),re);ed(U,G)}return typeof G=="string"&&G!==""||typeof G=="number"||typeof G=="bigint"?(G=""+G,P!==null&&P.tag===6?(d(U,P.sibling),re=y(P,G),re.return=U,U=re):(d(U,P),re=xf(G,U.mode,re),re.return=U,U=re),k(U)):d(U,P)}return function(U,P,G,re){try{Fo=0;var je=et(U,P,G,re);return Si=null,je}catch(Se){if(Se===wi||Se===Qc)throw Se;var qe=En(29,Se,null,U.mode);return qe.lanes=re,qe.return=U,qe}}}var xa=cb(!0),db=cb(!1),ms=!1;function _f(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Mf(s,o){s=s.updateQueue,o.updateQueue===s&&(o.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function gs(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function ys(s,o,d){var f=s.updateQueue;if(f===null)return null;if(f=f.shared,(Ke&2)!==0){var y=f.pending;return y===null?o.next=o:(o.next=y.next,y.next=o),f.pending=o,o=Gc(s),Wx(s,null,d),o}return Fc(s,f,o,d),Gc(s)}function qo(s,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194048)!==0)){var f=o.lanes;f&=s.pendingLanes,d|=f,o.lanes=d,tx(s,d)}}function Of(s,o){var d=s.updateQueue,f=s.alternate;if(f!==null&&(f=f.updateQueue,d===f)){var y=null,b=null;if(d=d.firstBaseUpdate,d!==null){do{var k={lane:d.lane,tag:d.tag,payload:d.payload,callback:null,next:null};b===null?y=b=k:b=b.next=k,d=d.next}while(d!==null);b===null?y=b=o:b=b.next=o}else y=b=o;d={baseState:f.baseState,firstBaseUpdate:y,lastBaseUpdate:b,shared:f.shared,callbacks:f.callbacks},s.updateQueue=d;return}s=d.lastBaseUpdate,s===null?d.firstBaseUpdate=o:s.next=o,d.lastBaseUpdate=o}var Df=!1;function Wo(){if(Df){var s=vi;if(s!==null)throw s}}function Ko(s,o,d,f){Df=!1;var y=s.updateQueue;ms=!1;var b=y.firstBaseUpdate,k=y.lastBaseUpdate,C=y.shared.pending;if(C!==null){y.shared.pending=null;var B=C,q=B.next;B.next=null,k===null?b=q:k.next=q,k=B;var ne=s.alternate;ne!==null&&(ne=ne.updateQueue,C=ne.lastBaseUpdate,C!==k&&(C===null?ne.firstBaseUpdate=q:C.next=q,ne.lastBaseUpdate=B))}if(b!==null){var se=y.baseState;k=0,ne=q=B=null,C=b;do{var Y=C.lane&-536870913,ee=Y!==C.lane;if(ee?(Ue&Y)===Y:(f&Y)===Y){Y!==0&&Y===bi&&(Df=!0),ne!==null&&(ne=ne.next={lane:0,tag:C.tag,payload:C.payload,callback:null,next:null});e:{var xe=s,Ee=C;Y=o;var et=d;switch(Ee.tag){case 1:if(xe=Ee.payload,typeof xe=="function"){se=xe.call(et,se,Y);break e}se=xe;break e;case 3:xe.flags=xe.flags&-65537|128;case 0:if(xe=Ee.payload,Y=typeof xe=="function"?xe.call(et,se,Y):xe,Y==null)break e;se=g({},se,Y);break e;case 2:ms=!0}}Y=C.callback,Y!==null&&(s.flags|=64,ee&&(s.flags|=8192),ee=y.callbacks,ee===null?y.callbacks=[Y]:ee.push(Y))}else ee={lane:Y,tag:C.tag,payload:C.payload,callback:C.callback,next:null},ne===null?(q=ne=ee,B=se):ne=ne.next=ee,k|=Y;if(C=C.next,C===null){if(C=y.shared.pending,C===null)break;ee=C,C=ee.next,ee.next=null,y.lastBaseUpdate=ee,y.shared.pending=null}}while(!0);ne===null&&(B=se),y.baseState=B,y.firstBaseUpdate=q,y.lastBaseUpdate=ne,b===null&&(y.shared.lanes=0),Ss|=k,s.lanes=k,s.memoizedState=se}}function ub(s,o){if(typeof s!="function")throw Error(r(191,s));s.call(o)}function hb(s,o){var d=s.callbacks;if(d!==null)for(s.callbacks=null,s=0;s<d.length;s++)ub(d[s],o)}var Ni=T(null),td=T(0);function fb(s,o){s=Fr,H(td,s),H(Ni,o),Fr=s|o.baseLanes}function Lf(){H(td,Fr),H(Ni,Ni.current)}function $f(){Fr=td.current,z(Ni),z(td)}var Rn=T(null),Yn=null;function xs(s){var o=s.alternate;H(Nt,Nt.current&1),H(Rn,s),Yn===null&&(o===null||Ni.current!==null||o.memoizedState!==null)&&(Yn=s)}function Bf(s){H(Nt,Nt.current),H(Rn,s),Yn===null&&(Yn=s)}function pb(s){s.tag===22?(H(Nt,Nt.current),H(Rn,s),Yn===null&&(Yn=s)):bs()}function bs(){H(Nt,Nt.current),H(Rn,Rn.current)}function An(s){z(Rn),Yn===s&&(Yn=null),z(Nt)}var Nt=T(0);function nd(s){for(var o=s;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||Vp(d)||Fp(d)))return o}else if(o.tag===19&&(o.memoizedProps.revealOrder==="forwards"||o.memoizedProps.revealOrder==="backwards"||o.memoizedProps.revealOrder==="unstable_legacy-backwards"||o.memoizedProps.revealOrder==="together")){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var $r=0,Oe=null,Xe=null,Et=null,rd=!1,ki=!1,ba=!1,sd=0,Yo=0,ji=null,xT=0;function yt(){throw Error(r(321))}function If(s,o){if(o===null)return!1;for(var d=0;d<o.length&&d<s.length;d++)if(!Tn(s[d],o[d]))return!1;return!0}function Pf(s,o,d,f,y,b){return $r=b,Oe=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,O.H=s===null||s.memoizedState===null?Qb:ep,ba=!1,b=d(f,y),ba=!1,ki&&(b=gb(o,d,f,y)),mb(s),b}function mb(s){O.H=Xo;var o=Xe!==null&&Xe.next!==null;if($r=0,Et=Xe=Oe=null,rd=!1,Yo=0,ji=null,o)throw Error(r(300));s===null||Rt||(s=s.dependencies,s!==null&&Kc(s)&&(Rt=!0))}function gb(s,o,d,f){Oe=s;var y=0;do{if(ki&&(ji=null),Yo=0,ki=!1,25<=y)throw Error(r(301));if(y+=1,Et=Xe=null,s.updateQueue!=null){var b=s.updateQueue;b.lastEffect=null,b.events=null,b.stores=null,b.memoCache!=null&&(b.memoCache.index=0)}O.H=Xb,b=o(d,f)}while(ki);return b}function bT(){var s=O.H,o=s.useState()[0];return o=typeof o.then=="function"?Jo(o):o,s=s.useState()[0],(Xe!==null?Xe.memoizedState:null)!==s&&(Oe.flags|=1024),o}function zf(){var s=sd!==0;return sd=0,s}function Uf(s,o,d){o.updateQueue=s.updateQueue,o.flags&=-2053,s.lanes&=~d}function Hf(s){if(rd){for(s=s.memoizedState;s!==null;){var o=s.queue;o!==null&&(o.pending=null),s=s.next}rd=!1}$r=0,Et=Xe=Oe=null,ki=!1,Yo=sd=0,ji=null}function dn(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Et===null?Oe.memoizedState=Et=s:Et=Et.next=s,Et}function kt(){if(Xe===null){var s=Oe.alternate;s=s!==null?s.memoizedState:null}else s=Xe.next;var o=Et===null?Oe.memoizedState:Et.next;if(o!==null)Et=o,Xe=s;else{if(s===null)throw Oe.alternate===null?Error(r(467)):Error(r(310));Xe=s,s={memoizedState:Xe.memoizedState,baseState:Xe.baseState,baseQueue:Xe.baseQueue,queue:Xe.queue,next:null},Et===null?Oe.memoizedState=Et=s:Et=Et.next=s}return Et}function ad(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Jo(s){var o=Yo;return Yo+=1,ji===null&&(ji=[]),s=ib(ji,s,o),o=Oe,(Et===null?o.memoizedState:Et.next)===null&&(o=o.alternate,O.H=o===null||o.memoizedState===null?Qb:ep),s}function id(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Jo(s);if(s.$$typeof===$)return Kt(s)}throw Error(r(438,String(s)))}function Vf(s){var o=null,d=Oe.updateQueue;if(d!==null&&(o=d.memoCache),o==null){var f=Oe.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(o={data:f.data.map(function(y){return y.slice()}),index:0})))}if(o==null&&(o={data:[],index:0}),d===null&&(d=ad(),Oe.updateQueue=d),d.memoCache=o,d=o.data[o.index],d===void 0)for(d=o.data[o.index]=Array(s),f=0;f<s;f++)d[f]=ue;return o.index++,d}function Br(s,o){return typeof o=="function"?o(s):o}function od(s){var o=kt();return Ff(o,Xe,s)}function Ff(s,o,d){var f=s.queue;if(f===null)throw Error(r(311));f.lastRenderedReducer=d;var y=s.baseQueue,b=f.pending;if(b!==null){if(y!==null){var k=y.next;y.next=b.next,b.next=k}o.baseQueue=y=b,f.pending=null}if(b=s.baseState,y===null)s.memoizedState=b;else{o=y.next;var C=k=null,B=null,q=o,ne=!1;do{var se=q.lane&-536870913;if(se!==q.lane?(Ue&se)===se:($r&se)===se){var Y=q.revertLane;if(Y===0)B!==null&&(B=B.next={lane:0,revertLane:0,gesture:null,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),se===bi&&(ne=!0);else if(($r&Y)===Y){q=q.next,Y===bi&&(ne=!0);continue}else se={lane:0,revertLane:q.revertLane,gesture:null,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},B===null?(C=B=se,k=b):B=B.next=se,Oe.lanes|=Y,Ss|=Y;se=q.action,ba&&d(b,se),b=q.hasEagerState?q.eagerState:d(b,se)}else Y={lane:se,revertLane:q.revertLane,gesture:q.gesture,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null},B===null?(C=B=Y,k=b):B=B.next=Y,Oe.lanes|=se,Ss|=se;q=q.next}while(q!==null&&q!==o);if(B===null?k=b:B.next=C,!Tn(b,s.memoizedState)&&(Rt=!0,ne&&(d=vi,d!==null)))throw d;s.memoizedState=b,s.baseState=k,s.baseQueue=B,f.lastRenderedState=b}return y===null&&(f.lanes=0),[s.memoizedState,f.dispatch]}function Gf(s){var o=kt(),d=o.queue;if(d===null)throw Error(r(311));d.lastRenderedReducer=s;var f=d.dispatch,y=d.pending,b=o.memoizedState;if(y!==null){d.pending=null;var k=y=y.next;do b=s(b,k.action),k=k.next;while(k!==y);Tn(b,o.memoizedState)||(Rt=!0),o.memoizedState=b,o.baseQueue===null&&(o.baseState=b),d.lastRenderedState=b}return[b,f]}function yb(s,o,d){var f=Oe,y=kt(),b=Ve;if(b){if(d===void 0)throw Error(r(407));d=d()}else d=o();var k=!Tn((Xe||y).memoizedState,d);if(k&&(y.memoizedState=d,Rt=!0),y=y.queue,Kf(vb.bind(null,f,y,s),[s]),y.getSnapshot!==o||k||Et!==null&&Et.memoizedState.tag&1){if(f.flags|=2048,Ci(9,{destroy:void 0},bb.bind(null,f,y,d,o),null),nt===null)throw Error(r(349));b||($r&127)!==0||xb(f,o,d)}return d}function xb(s,o,d){s.flags|=16384,s={getSnapshot:o,value:d},o=Oe.updateQueue,o===null?(o=ad(),Oe.updateQueue=o,o.stores=[s]):(d=o.stores,d===null?o.stores=[s]:d.push(s))}function bb(s,o,d,f){o.value=d,o.getSnapshot=f,wb(o)&&Sb(s)}function vb(s,o,d){return d(function(){wb(o)&&Sb(s)})}function wb(s){var o=s.getSnapshot;s=s.value;try{var d=o();return!Tn(s,d)}catch{return!0}}function Sb(s){var o=da(s,2);o!==null&&wn(o,s,2)}function qf(s){var o=dn();if(typeof s=="function"){var d=s;if(s=d(),ba){ls(!0);try{d()}finally{ls(!1)}}}return o.memoizedState=o.baseState=s,o.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Br,lastRenderedState:s},o}function Nb(s,o,d,f){return s.baseState=d,Ff(s,Xe,typeof f=="function"?f:Br)}function vT(s,o,d,f,y){if(dd(s))throw Error(r(485));if(s=o.action,s!==null){var b={payload:y,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(k){b.listeners.push(k)}};O.T!==null?d(!0):b.isTransition=!1,f(b),d=o.pending,d===null?(b.next=o.pending=b,kb(o,b)):(b.next=d.next,o.pending=d.next=b)}}function kb(s,o){var d=o.action,f=o.payload,y=s.state;if(o.isTransition){var b=O.T,k={};O.T=k;try{var C=d(y,f),B=O.S;B!==null&&B(k,C),jb(s,o,C)}catch(q){Wf(s,o,q)}finally{b!==null&&k.types!==null&&(b.types=k.types),O.T=b}}else try{b=d(y,f),jb(s,o,b)}catch(q){Wf(s,o,q)}}function jb(s,o,d){d!==null&&typeof d=="object"&&typeof d.then=="function"?d.then(function(f){Cb(s,o,f)},function(f){return Wf(s,o,f)}):Cb(s,o,d)}function Cb(s,o,d){o.status="fulfilled",o.value=d,Tb(o),s.state=d,o=s.pending,o!==null&&(d=o.next,d===o?s.pending=null:(d=d.next,o.next=d,kb(s,d)))}function Wf(s,o,d){var f=s.pending;if(s.pending=null,f!==null){f=f.next;do o.status="rejected",o.reason=d,Tb(o),o=o.next;while(o!==f)}s.action=null}function Tb(s){s=s.listeners;for(var o=0;o<s.length;o++)(0,s[o])()}function Eb(s,o){return o}function Rb(s,o){if(Ve){var d=nt.formState;if(d!==null){e:{var f=Oe;if(Ve){if(it){t:{for(var y=it,b=Kn;y.nodeType!==8;){if(!b){y=null;break t}if(y=Jn(y.nextSibling),y===null){y=null;break t}}b=y.data,y=b==="F!"||b==="F"?y:null}if(y){it=Jn(y.nextSibling),f=y.data==="F!";break e}}fs(f)}f=!1}f&&(o=d[0])}}return d=dn(),d.memoizedState=d.baseState=o,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Eb,lastRenderedState:o},d.queue=f,d=Kb.bind(null,Oe,f),f.dispatch=d,f=qf(!1),b=Zf.bind(null,Oe,!1,f.queue),f=dn(),y={state:o,dispatch:null,action:s,pending:null},f.queue=y,d=vT.bind(null,Oe,y,b,d),y.dispatch=d,f.memoizedState=s,[o,d,!1]}function Ab(s){var o=kt();return _b(o,Xe,s)}function _b(s,o,d){if(o=Ff(s,o,Eb)[0],s=od(Br)[0],typeof o=="object"&&o!==null&&typeof o.then=="function")try{var f=Jo(o)}catch(k){throw k===wi?Qc:k}else f=o;o=kt();var y=o.queue,b=y.dispatch;return d!==o.memoizedState&&(Oe.flags|=2048,Ci(9,{destroy:void 0},wT.bind(null,y,d),null)),[f,b,s]}function wT(s,o){s.action=o}function Mb(s){var o=kt(),d=Xe;if(d!==null)return _b(o,d,s);kt(),o=o.memoizedState,d=kt();var f=d.queue.dispatch;return d.memoizedState=s,[o,f,!1]}function Ci(s,o,d,f){return s={tag:s,create:d,deps:f,inst:o,next:null},o=Oe.updateQueue,o===null&&(o=ad(),Oe.updateQueue=o),d=o.lastEffect,d===null?o.lastEffect=s.next=s:(f=d.next,d.next=s,s.next=f,o.lastEffect=s),s}function Ob(){return kt().memoizedState}function ld(s,o,d,f){var y=dn();Oe.flags|=s,y.memoizedState=Ci(1|o,{destroy:void 0},d,f===void 0?null:f)}function cd(s,o,d,f){var y=kt();f=f===void 0?null:f;var b=y.memoizedState.inst;Xe!==null&&f!==null&&If(f,Xe.memoizedState.deps)?y.memoizedState=Ci(o,b,d,f):(Oe.flags|=s,y.memoizedState=Ci(1|o,b,d,f))}function Db(s,o){ld(8390656,8,s,o)}function Kf(s,o){cd(2048,8,s,o)}function ST(s){Oe.flags|=4;var o=Oe.updateQueue;if(o===null)o=ad(),Oe.updateQueue=o,o.events=[s];else{var d=o.events;d===null?o.events=[s]:d.push(s)}}function Lb(s){var o=kt().memoizedState;return ST({ref:o,nextImpl:s}),function(){if((Ke&2)!==0)throw Error(r(440));return o.impl.apply(void 0,arguments)}}function $b(s,o){return cd(4,2,s,o)}function Bb(s,o){return cd(4,4,s,o)}function Ib(s,o){if(typeof o=="function"){s=s();var d=o(s);return function(){typeof d=="function"?d():o(null)}}if(o!=null)return s=s(),o.current=s,function(){o.current=null}}function Pb(s,o,d){d=d!=null?d.concat([s]):null,cd(4,4,Ib.bind(null,o,s),d)}function Yf(){}function zb(s,o){var d=kt();o=o===void 0?null:o;var f=d.memoizedState;return o!==null&&If(o,f[1])?f[0]:(d.memoizedState=[s,o],s)}function Ub(s,o){var d=kt();o=o===void 0?null:o;var f=d.memoizedState;if(o!==null&&If(o,f[1]))return f[0];if(f=s(),ba){ls(!0);try{s()}finally{ls(!1)}}return d.memoizedState=[f,o],f}function Jf(s,o,d){return d===void 0||($r&1073741824)!==0&&(Ue&261930)===0?s.memoizedState=o:(s.memoizedState=d,s=H0(),Oe.lanes|=s,Ss|=s,d)}function Hb(s,o,d,f){return Tn(d,o)?d:Ni.current!==null?(s=Jf(s,d,f),Tn(s,o)||(Rt=!0),s):($r&42)===0||($r&1073741824)!==0&&(Ue&261930)===0?(Rt=!0,s.memoizedState=d):(s=H0(),Oe.lanes|=s,Ss|=s,o)}function Vb(s,o,d,f,y){var b=K.p;K.p=b!==0&&8>b?b:8;var k=O.T,C={};O.T=C,Zf(s,!1,o,d);try{var B=y(),q=O.S;if(q!==null&&q(C,B),B!==null&&typeof B=="object"&&typeof B.then=="function"){var ne=yT(B,f);Qo(s,o,ne,On(s))}else Qo(s,o,f,On(s))}catch(se){Qo(s,o,{then:function(){},status:"rejected",reason:se},On())}finally{K.p=b,k!==null&&C.types!==null&&(k.types=C.types),O.T=k}}function NT(){}function Qf(s,o,d,f){if(s.tag!==5)throw Error(r(476));var y=Fb(s).queue;Vb(s,y,o,Z,d===null?NT:function(){return Gb(s),d(f)})}function Fb(s){var o=s.memoizedState;if(o!==null)return o;o={memoizedState:Z,baseState:Z,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Br,lastRenderedState:Z},next:null};var d={};return o.next={memoizedState:d,baseState:d,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Br,lastRenderedState:d},next:null},s.memoizedState=o,s=s.alternate,s!==null&&(s.memoizedState=o),o}function Gb(s){var o=Fb(s);o.next===null&&(o=s.alternate.memoizedState),Qo(s,o.next.queue,{},On())}function Xf(){return Kt(pl)}function qb(){return kt().memoizedState}function Wb(){return kt().memoizedState}function kT(s){for(var o=s.return;o!==null;){switch(o.tag){case 24:case 3:var d=On();s=gs(d);var f=ys(o,s,d);f!==null&&(wn(f,o,d),qo(f,o,d)),o={cache:Tf()},s.payload=o;return}o=o.return}}function jT(s,o,d){var f=On();d={lane:f,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null},dd(s)?Yb(o,d):(d=gf(s,o,d,f),d!==null&&(wn(d,s,f),Jb(d,o,f)))}function Kb(s,o,d){var f=On();Qo(s,o,d,f)}function Qo(s,o,d,f){var y={lane:f,revertLane:0,gesture:null,action:d,hasEagerState:!1,eagerState:null,next:null};if(dd(s))Yb(o,y);else{var b=s.alternate;if(s.lanes===0&&(b===null||b.lanes===0)&&(b=o.lastRenderedReducer,b!==null))try{var k=o.lastRenderedState,C=b(k,d);if(y.hasEagerState=!0,y.eagerState=C,Tn(C,k))return Fc(s,o,y,0),nt===null&&Vc(),!1}catch{}if(d=gf(s,o,y,f),d!==null)return wn(d,s,f),Jb(d,o,f),!0}return!1}function Zf(s,o,d,f){if(f={lane:2,revertLane:_p(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},dd(s)){if(o)throw Error(r(479))}else o=gf(s,d,f,2),o!==null&&wn(o,s,2)}function dd(s){var o=s.alternate;return s===Oe||o!==null&&o===Oe}function Yb(s,o){ki=rd=!0;var d=s.pending;d===null?o.next=o:(o.next=d.next,d.next=o),s.pending=o}function Jb(s,o,d){if((d&4194048)!==0){var f=o.lanes;f&=s.pendingLanes,d|=f,o.lanes=d,tx(s,d)}}var Xo={readContext:Kt,use:id,useCallback:yt,useContext:yt,useEffect:yt,useImperativeHandle:yt,useLayoutEffect:yt,useInsertionEffect:yt,useMemo:yt,useReducer:yt,useRef:yt,useState:yt,useDebugValue:yt,useDeferredValue:yt,useTransition:yt,useSyncExternalStore:yt,useId:yt,useHostTransitionStatus:yt,useFormState:yt,useActionState:yt,useOptimistic:yt,useMemoCache:yt,useCacheRefresh:yt};Xo.useEffectEvent=yt;var Qb={readContext:Kt,use:id,useCallback:function(s,o){return dn().memoizedState=[s,o===void 0?null:o],s},useContext:Kt,useEffect:Db,useImperativeHandle:function(s,o,d){d=d!=null?d.concat([s]):null,ld(4194308,4,Ib.bind(null,o,s),d)},useLayoutEffect:function(s,o){return ld(4194308,4,s,o)},useInsertionEffect:function(s,o){ld(4,2,s,o)},useMemo:function(s,o){var d=dn();o=o===void 0?null:o;var f=s();if(ba){ls(!0);try{s()}finally{ls(!1)}}return d.memoizedState=[f,o],f},useReducer:function(s,o,d){var f=dn();if(d!==void 0){var y=d(o);if(ba){ls(!0);try{d(o)}finally{ls(!1)}}}else y=o;return f.memoizedState=f.baseState=y,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:y},f.queue=s,s=s.dispatch=jT.bind(null,Oe,s),[f.memoizedState,s]},useRef:function(s){var o=dn();return s={current:s},o.memoizedState=s},useState:function(s){s=qf(s);var o=s.queue,d=Kb.bind(null,Oe,o);return o.dispatch=d,[s.memoizedState,d]},useDebugValue:Yf,useDeferredValue:function(s,o){var d=dn();return Jf(d,s,o)},useTransition:function(){var s=qf(!1);return s=Vb.bind(null,Oe,s.queue,!0,!1),dn().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,o,d){var f=Oe,y=dn();if(Ve){if(d===void 0)throw Error(r(407));d=d()}else{if(d=o(),nt===null)throw Error(r(349));(Ue&127)!==0||xb(f,o,d)}y.memoizedState=d;var b={value:d,getSnapshot:o};return y.queue=b,Db(vb.bind(null,f,b,s),[s]),f.flags|=2048,Ci(9,{destroy:void 0},bb.bind(null,f,b,d,o),null),d},useId:function(){var s=dn(),o=nt.identifierPrefix;if(Ve){var d=br,f=xr;d=(f&~(1<<32-Cn(f)-1)).toString(32)+d,o="_"+o+"R_"+d,d=sd++,0<d&&(o+="H"+d.toString(32)),o+="_"}else d=xT++,o="_"+o+"r_"+d.toString(32)+"_";return s.memoizedState=o},useHostTransitionStatus:Xf,useFormState:Rb,useActionState:Rb,useOptimistic:function(s){var o=dn();o.memoizedState=o.baseState=s;var d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return o.queue=d,o=Zf.bind(null,Oe,!0,d),d.dispatch=o,[s,o]},useMemoCache:Vf,useCacheRefresh:function(){return dn().memoizedState=kT.bind(null,Oe)},useEffectEvent:function(s){var o=dn(),d={impl:s};return o.memoizedState=d,function(){if((Ke&2)!==0)throw Error(r(440));return d.impl.apply(void 0,arguments)}}},ep={readContext:Kt,use:id,useCallback:zb,useContext:Kt,useEffect:Kf,useImperativeHandle:Pb,useInsertionEffect:$b,useLayoutEffect:Bb,useMemo:Ub,useReducer:od,useRef:Ob,useState:function(){return od(Br)},useDebugValue:Yf,useDeferredValue:function(s,o){var d=kt();return Hb(d,Xe.memoizedState,s,o)},useTransition:function(){var s=od(Br)[0],o=kt().memoizedState;return[typeof s=="boolean"?s:Jo(s),o]},useSyncExternalStore:yb,useId:qb,useHostTransitionStatus:Xf,useFormState:Ab,useActionState:Ab,useOptimistic:function(s,o){var d=kt();return Nb(d,Xe,s,o)},useMemoCache:Vf,useCacheRefresh:Wb};ep.useEffectEvent=Lb;var Xb={readContext:Kt,use:id,useCallback:zb,useContext:Kt,useEffect:Kf,useImperativeHandle:Pb,useInsertionEffect:$b,useLayoutEffect:Bb,useMemo:Ub,useReducer:Gf,useRef:Ob,useState:function(){return Gf(Br)},useDebugValue:Yf,useDeferredValue:function(s,o){var d=kt();return Xe===null?Jf(d,s,o):Hb(d,Xe.memoizedState,s,o)},useTransition:function(){var s=Gf(Br)[0],o=kt().memoizedState;return[typeof s=="boolean"?s:Jo(s),o]},useSyncExternalStore:yb,useId:qb,useHostTransitionStatus:Xf,useFormState:Mb,useActionState:Mb,useOptimistic:function(s,o){var d=kt();return Xe!==null?Nb(d,Xe,s,o):(d.baseState=s,[s,d.queue.dispatch])},useMemoCache:Vf,useCacheRefresh:Wb};Xb.useEffectEvent=Lb;function tp(s,o,d,f){o=s.memoizedState,d=d(f,o),d=d==null?o:g({},o,d),s.memoizedState=d,s.lanes===0&&(s.updateQueue.baseState=d)}var np={enqueueSetState:function(s,o,d){s=s._reactInternals;var f=On(),y=gs(f);y.payload=o,d!=null&&(y.callback=d),o=ys(s,y,f),o!==null&&(wn(o,s,f),qo(o,s,f))},enqueueReplaceState:function(s,o,d){s=s._reactInternals;var f=On(),y=gs(f);y.tag=1,y.payload=o,d!=null&&(y.callback=d),o=ys(s,y,f),o!==null&&(wn(o,s,f),qo(o,s,f))},enqueueForceUpdate:function(s,o){s=s._reactInternals;var d=On(),f=gs(d);f.tag=2,o!=null&&(f.callback=o),o=ys(s,f,d),o!==null&&(wn(o,s,d),qo(o,s,d))}};function Zb(s,o,d,f,y,b,k){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(f,b,k):o.prototype&&o.prototype.isPureReactComponent?!Io(d,f)||!Io(y,b):!0}function e0(s,o,d,f){s=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,f),o.state!==s&&np.enqueueReplaceState(o,o.state,null)}function va(s,o){var d=o;if("ref"in o){d={};for(var f in o)f!=="ref"&&(d[f]=o[f])}if(s=s.defaultProps){d===o&&(d=g({},d));for(var y in s)d[y]===void 0&&(d[y]=s[y])}return d}function t0(s){Hc(s)}function n0(s){console.error(s)}function r0(s){Hc(s)}function ud(s,o){try{var d=s.onUncaughtError;d(o.value,{componentStack:o.stack})}catch(f){setTimeout(function(){throw f})}}function s0(s,o,d){try{var f=s.onCaughtError;f(d.value,{componentStack:d.stack,errorBoundary:o.tag===1?o.stateNode:null})}catch(y){setTimeout(function(){throw y})}}function rp(s,o,d){return d=gs(d),d.tag=3,d.payload={element:null},d.callback=function(){ud(s,o)},d}function a0(s){return s=gs(s),s.tag=3,s}function i0(s,o,d,f){var y=d.type.getDerivedStateFromError;if(typeof y=="function"){var b=f.value;s.payload=function(){return y(b)},s.callback=function(){s0(o,d,f)}}var k=d.stateNode;k!==null&&typeof k.componentDidCatch=="function"&&(s.callback=function(){s0(o,d,f),typeof y!="function"&&(Ns===null?Ns=new Set([this]):Ns.add(this));var C=f.stack;this.componentDidCatch(f.value,{componentStack:C!==null?C:""})})}function CT(s,o,d,f,y){if(d.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(o=d.alternate,o!==null&&xi(o,d,y,!0),d=Rn.current,d!==null){switch(d.tag){case 31:case 13:return Yn===null?Nd():d.alternate===null&&xt===0&&(xt=3),d.flags&=-257,d.flags|=65536,d.lanes=y,f===Xc?d.flags|=16384:(o=d.updateQueue,o===null?d.updateQueue=new Set([f]):o.add(f),Ep(s,f,y)),!1;case 22:return d.flags|=65536,f===Xc?d.flags|=16384:(o=d.updateQueue,o===null?(o={transitions:null,markerInstances:null,retryQueue:new Set([f])},d.updateQueue=o):(d=o.retryQueue,d===null?o.retryQueue=new Set([f]):d.add(f)),Ep(s,f,y)),!1}throw Error(r(435,d.tag))}return Ep(s,f,y),Nd(),!1}if(Ve)return o=Rn.current,o!==null?((o.flags&65536)===0&&(o.flags|=256),o.flags|=65536,o.lanes=y,f!==Sf&&(s=Error(r(422),{cause:f}),Uo(Gn(s,d)))):(f!==Sf&&(o=Error(r(423),{cause:f}),Uo(Gn(o,d))),s=s.current.alternate,s.flags|=65536,y&=-y,s.lanes|=y,f=Gn(f,d),y=rp(s.stateNode,f,y),Of(s,y),xt!==4&&(xt=2)),!1;var b=Error(r(520),{cause:f});if(b=Gn(b,d),il===null?il=[b]:il.push(b),xt!==4&&(xt=2),o===null)return!0;f=Gn(f,d),d=o;do{switch(d.tag){case 3:return d.flags|=65536,s=y&-y,d.lanes|=s,s=rp(d.stateNode,f,s),Of(d,s),!1;case 1:if(o=d.type,b=d.stateNode,(d.flags&128)===0&&(typeof o.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Ns===null||!Ns.has(b))))return d.flags|=65536,y&=-y,d.lanes|=y,y=a0(y),i0(y,s,d,f),Of(d,y),!1}d=d.return}while(d!==null);return!1}var sp=Error(r(461)),Rt=!1;function Yt(s,o,d,f){o.child=s===null?db(o,null,d,f):xa(o,s.child,d,f)}function o0(s,o,d,f,y){d=d.render;var b=o.ref;if("ref"in f){var k={};for(var C in f)C!=="ref"&&(k[C]=f[C])}else k=f;return pa(o),f=Pf(s,o,d,k,b,y),C=zf(),s!==null&&!Rt?(Uf(s,o,y),Ir(s,o,y)):(Ve&&C&&vf(o),o.flags|=1,Yt(s,o,f,y),o.child)}function l0(s,o,d,f,y){if(s===null){var b=d.type;return typeof b=="function"&&!yf(b)&&b.defaultProps===void 0&&d.compare===null?(o.tag=15,o.type=b,c0(s,o,b,f,y)):(s=qc(d.type,null,f,o,o.mode,y),s.ref=o.ref,s.return=o,o.child=s)}if(b=s.child,!hp(s,y)){var k=b.memoizedProps;if(d=d.compare,d=d!==null?d:Io,d(k,f)&&s.ref===o.ref)return Ir(s,o,y)}return o.flags|=1,s=Mr(b,f),s.ref=o.ref,s.return=o,o.child=s}function c0(s,o,d,f,y){if(s!==null){var b=s.memoizedProps;if(Io(b,f)&&s.ref===o.ref)if(Rt=!1,o.pendingProps=f=b,hp(s,y))(s.flags&131072)!==0&&(Rt=!0);else return o.lanes=s.lanes,Ir(s,o,y)}return ap(s,o,d,f,y)}function d0(s,o,d,f){var y=f.children,b=s!==null?s.memoizedState:null;if(s===null&&o.stateNode===null&&(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((o.flags&128)!==0){if(b=b!==null?b.baseLanes|d:d,s!==null){for(f=o.child=s.child,y=0;f!==null;)y=y|f.lanes|f.childLanes,f=f.sibling;f=y&~b}else f=0,o.child=null;return u0(s,o,b,d,f)}if((d&536870912)!==0)o.memoizedState={baseLanes:0,cachePool:null},s!==null&&Jc(o,b!==null?b.cachePool:null),b!==null?fb(o,b):Lf(),pb(o);else return f=o.lanes=536870912,u0(s,o,b!==null?b.baseLanes|d:d,d,f)}else b!==null?(Jc(o,b.cachePool),fb(o,b),bs(),o.memoizedState=null):(s!==null&&Jc(o,null),Lf(),bs());return Yt(s,o,y,d),o.child}function Zo(s,o){return s!==null&&s.tag===22||o.stateNode!==null||(o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),o.sibling}function u0(s,o,d,f,y){var b=Rf();return b=b===null?null:{parent:Tt._currentValue,pool:b},o.memoizedState={baseLanes:d,cachePool:b},s!==null&&Jc(o,null),Lf(),pb(o),s!==null&&xi(s,o,f,!0),o.childLanes=y,null}function hd(s,o){return o=pd({mode:o.mode,children:o.children},s.mode),o.ref=s.ref,s.child=o,o.return=s,o}function h0(s,o,d){return xa(o,s.child,null,d),s=hd(o,o.pendingProps),s.flags|=2,An(o),o.memoizedState=null,s}function TT(s,o,d){var f=o.pendingProps,y=(o.flags&128)!==0;if(o.flags&=-129,s===null){if(Ve){if(f.mode==="hidden")return s=hd(o,f),o.lanes=536870912,Zo(null,s);if(Bf(o),(s=it)?(s=kv(s,Kn),s=s!==null&&s.data==="&"?s:null,s!==null&&(o.memoizedState={dehydrated:s,treeContext:us!==null?{id:xr,overflow:br}:null,retryLane:536870912,hydrationErrors:null},d=Yx(s),d.return=o,o.child=d,Wt=o,it=null)):s=null,s===null)throw fs(o);return o.lanes=536870912,null}return hd(o,f)}var b=s.memoizedState;if(b!==null){var k=b.dehydrated;if(Bf(o),y)if(o.flags&256)o.flags&=-257,o=h0(s,o,d);else if(o.memoizedState!==null)o.child=s.child,o.flags|=128,o=null;else throw Error(r(558));else if(Rt||xi(s,o,d,!1),y=(d&s.childLanes)!==0,Rt||y){if(f=nt,f!==null&&(k=nx(f,d),k!==0&&k!==b.retryLane))throw b.retryLane=k,da(s,k),wn(f,s,k),sp;Nd(),o=h0(s,o,d)}else s=b.treeContext,it=Jn(k.nextSibling),Wt=o,Ve=!0,hs=null,Kn=!1,s!==null&&Xx(o,s),o=hd(o,f),o.flags|=4096;return o}return s=Mr(s.child,{mode:f.mode,children:f.children}),s.ref=o.ref,o.child=s,s.return=o,s}function fd(s,o){var d=o.ref;if(d===null)s!==null&&s.ref!==null&&(o.flags|=4194816);else{if(typeof d!="function"&&typeof d!="object")throw Error(r(284));(s===null||s.ref!==d)&&(o.flags|=4194816)}}function ap(s,o,d,f,y){return pa(o),d=Pf(s,o,d,f,void 0,y),f=zf(),s!==null&&!Rt?(Uf(s,o,y),Ir(s,o,y)):(Ve&&f&&vf(o),o.flags|=1,Yt(s,o,d,y),o.child)}function f0(s,o,d,f,y,b){return pa(o),o.updateQueue=null,d=gb(o,f,d,y),mb(s),f=zf(),s!==null&&!Rt?(Uf(s,o,b),Ir(s,o,b)):(Ve&&f&&vf(o),o.flags|=1,Yt(s,o,d,b),o.child)}function p0(s,o,d,f,y){if(pa(o),o.stateNode===null){var b=pi,k=d.contextType;typeof k=="object"&&k!==null&&(b=Kt(k)),b=new d(f,b),o.memoizedState=b.state!==null&&b.state!==void 0?b.state:null,b.updater=np,o.stateNode=b,b._reactInternals=o,b=o.stateNode,b.props=f,b.state=o.memoizedState,b.refs={},_f(o),k=d.contextType,b.context=typeof k=="object"&&k!==null?Kt(k):pi,b.state=o.memoizedState,k=d.getDerivedStateFromProps,typeof k=="function"&&(tp(o,d,k,f),b.state=o.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof b.getSnapshotBeforeUpdate=="function"||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(k=b.state,typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount(),k!==b.state&&np.enqueueReplaceState(b,b.state,null),Ko(o,f,b,y),Wo(),b.state=o.memoizedState),typeof b.componentDidMount=="function"&&(o.flags|=4194308),f=!0}else if(s===null){b=o.stateNode;var C=o.memoizedProps,B=va(d,C);b.props=B;var q=b.context,ne=d.contextType;k=pi,typeof ne=="object"&&ne!==null&&(k=Kt(ne));var se=d.getDerivedStateFromProps;ne=typeof se=="function"||typeof b.getSnapshotBeforeUpdate=="function",C=o.pendingProps!==C,ne||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(C||q!==k)&&e0(o,b,f,k),ms=!1;var Y=o.memoizedState;b.state=Y,Ko(o,f,b,y),Wo(),q=o.memoizedState,C||Y!==q||ms?(typeof se=="function"&&(tp(o,d,se,f),q=o.memoizedState),(B=ms||Zb(o,d,B,f,Y,q,k))?(ne||typeof b.UNSAFE_componentWillMount!="function"&&typeof b.componentWillMount!="function"||(typeof b.componentWillMount=="function"&&b.componentWillMount(),typeof b.UNSAFE_componentWillMount=="function"&&b.UNSAFE_componentWillMount()),typeof b.componentDidMount=="function"&&(o.flags|=4194308)):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=q),b.props=f,b.state=q,b.context=k,f=B):(typeof b.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{b=o.stateNode,Mf(s,o),k=o.memoizedProps,ne=va(d,k),b.props=ne,se=o.pendingProps,Y=b.context,q=d.contextType,B=pi,typeof q=="object"&&q!==null&&(B=Kt(q)),C=d.getDerivedStateFromProps,(q=typeof C=="function"||typeof b.getSnapshotBeforeUpdate=="function")||typeof b.UNSAFE_componentWillReceiveProps!="function"&&typeof b.componentWillReceiveProps!="function"||(k!==se||Y!==B)&&e0(o,b,f,B),ms=!1,Y=o.memoizedState,b.state=Y,Ko(o,f,b,y),Wo();var ee=o.memoizedState;k!==se||Y!==ee||ms||s!==null&&s.dependencies!==null&&Kc(s.dependencies)?(typeof C=="function"&&(tp(o,d,C,f),ee=o.memoizedState),(ne=ms||Zb(o,d,ne,f,Y,ee,B)||s!==null&&s.dependencies!==null&&Kc(s.dependencies))?(q||typeof b.UNSAFE_componentWillUpdate!="function"&&typeof b.componentWillUpdate!="function"||(typeof b.componentWillUpdate=="function"&&b.componentWillUpdate(f,ee,B),typeof b.UNSAFE_componentWillUpdate=="function"&&b.UNSAFE_componentWillUpdate(f,ee,B)),typeof b.componentDidUpdate=="function"&&(o.flags|=4),typeof b.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof b.componentDidUpdate!="function"||k===s.memoizedProps&&Y===s.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||k===s.memoizedProps&&Y===s.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=ee),b.props=f,b.state=ee,b.context=B,f=ne):(typeof b.componentDidUpdate!="function"||k===s.memoizedProps&&Y===s.memoizedState||(o.flags|=4),typeof b.getSnapshotBeforeUpdate!="function"||k===s.memoizedProps&&Y===s.memoizedState||(o.flags|=1024),f=!1)}return b=f,fd(s,o),f=(o.flags&128)!==0,b||f?(b=o.stateNode,d=f&&typeof d.getDerivedStateFromError!="function"?null:b.render(),o.flags|=1,s!==null&&f?(o.child=xa(o,s.child,null,y),o.child=xa(o,null,d,y)):Yt(s,o,d,y),o.memoizedState=b.state,s=o.child):s=Ir(s,o,y),s}function m0(s,o,d,f){return ha(),o.flags|=256,Yt(s,o,d,f),o.child}var ip={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function op(s){return{baseLanes:s,cachePool:sb()}}function lp(s,o,d){return s=s!==null?s.childLanes&~d:0,o&&(s|=Mn),s}function g0(s,o,d){var f=o.pendingProps,y=!1,b=(o.flags&128)!==0,k;if((k=b)||(k=s!==null&&s.memoizedState===null?!1:(Nt.current&2)!==0),k&&(y=!0,o.flags&=-129),k=(o.flags&32)!==0,o.flags&=-33,s===null){if(Ve){if(y?xs(o):bs(),(s=it)?(s=kv(s,Kn),s=s!==null&&s.data!=="&"?s:null,s!==null&&(o.memoizedState={dehydrated:s,treeContext:us!==null?{id:xr,overflow:br}:null,retryLane:536870912,hydrationErrors:null},d=Yx(s),d.return=o,o.child=d,Wt=o,it=null)):s=null,s===null)throw fs(o);return Fp(s)?o.lanes=32:o.lanes=536870912,null}var C=f.children;return f=f.fallback,y?(bs(),y=o.mode,C=pd({mode:"hidden",children:C},y),f=ua(f,y,d,null),C.return=o,f.return=o,C.sibling=f,o.child=C,f=o.child,f.memoizedState=op(d),f.childLanes=lp(s,k,d),o.memoizedState=ip,Zo(null,f)):(xs(o),cp(o,C))}var B=s.memoizedState;if(B!==null&&(C=B.dehydrated,C!==null)){if(b)o.flags&256?(xs(o),o.flags&=-257,o=dp(s,o,d)):o.memoizedState!==null?(bs(),o.child=s.child,o.flags|=128,o=null):(bs(),C=f.fallback,y=o.mode,f=pd({mode:"visible",children:f.children},y),C=ua(C,y,d,null),C.flags|=2,f.return=o,C.return=o,f.sibling=C,o.child=f,xa(o,s.child,null,d),f=o.child,f.memoizedState=op(d),f.childLanes=lp(s,k,d),o.memoizedState=ip,o=Zo(null,f));else if(xs(o),Fp(C)){if(k=C.nextSibling&&C.nextSibling.dataset,k)var q=k.dgst;k=q,f=Error(r(419)),f.stack="",f.digest=k,Uo({value:f,source:null,stack:null}),o=dp(s,o,d)}else if(Rt||xi(s,o,d,!1),k=(d&s.childLanes)!==0,Rt||k){if(k=nt,k!==null&&(f=nx(k,d),f!==0&&f!==B.retryLane))throw B.retryLane=f,da(s,f),wn(k,s,f),sp;Vp(C)||Nd(),o=dp(s,o,d)}else Vp(C)?(o.flags|=192,o.child=s.child,o=null):(s=B.treeContext,it=Jn(C.nextSibling),Wt=o,Ve=!0,hs=null,Kn=!1,s!==null&&Xx(o,s),o=cp(o,f.children),o.flags|=4096);return o}return y?(bs(),C=f.fallback,y=o.mode,B=s.child,q=B.sibling,f=Mr(B,{mode:"hidden",children:f.children}),f.subtreeFlags=B.subtreeFlags&65011712,q!==null?C=Mr(q,C):(C=ua(C,y,d,null),C.flags|=2),C.return=o,f.return=o,f.sibling=C,o.child=f,Zo(null,f),f=o.child,C=s.child.memoizedState,C===null?C=op(d):(y=C.cachePool,y!==null?(B=Tt._currentValue,y=y.parent!==B?{parent:B,pool:B}:y):y=sb(),C={baseLanes:C.baseLanes|d,cachePool:y}),f.memoizedState=C,f.childLanes=lp(s,k,d),o.memoizedState=ip,Zo(s.child,f)):(xs(o),d=s.child,s=d.sibling,d=Mr(d,{mode:"visible",children:f.children}),d.return=o,d.sibling=null,s!==null&&(k=o.deletions,k===null?(o.deletions=[s],o.flags|=16):k.push(s)),o.child=d,o.memoizedState=null,d)}function cp(s,o){return o=pd({mode:"visible",children:o},s.mode),o.return=s,s.child=o}function pd(s,o){return s=En(22,s,null,o),s.lanes=0,s}function dp(s,o,d){return xa(o,s.child,null,d),s=cp(o,o.pendingProps.children),s.flags|=2,o.memoizedState=null,s}function y0(s,o,d){s.lanes|=o;var f=s.alternate;f!==null&&(f.lanes|=o),jf(s.return,o,d)}function up(s,o,d,f,y,b){var k=s.memoizedState;k===null?s.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:d,tailMode:y,treeForkCount:b}:(k.isBackwards=o,k.rendering=null,k.renderingStartTime=0,k.last=f,k.tail=d,k.tailMode=y,k.treeForkCount=b)}function x0(s,o,d){var f=o.pendingProps,y=f.revealOrder,b=f.tail;f=f.children;var k=Nt.current,C=(k&2)!==0;if(C?(k=k&1|2,o.flags|=128):k&=1,H(Nt,k),Yt(s,o,f,d),f=Ve?zo:0,!C&&s!==null&&(s.flags&128)!==0)e:for(s=o.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&y0(s,d,o);else if(s.tag===19)y0(s,d,o);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===o)break e;for(;s.sibling===null;){if(s.return===null||s.return===o)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(y){case"forwards":for(d=o.child,y=null;d!==null;)s=d.alternate,s!==null&&nd(s)===null&&(y=d),d=d.sibling;d=y,d===null?(y=o.child,o.child=null):(y=d.sibling,d.sibling=null),up(o,!1,y,d,b,f);break;case"backwards":case"unstable_legacy-backwards":for(d=null,y=o.child,o.child=null;y!==null;){if(s=y.alternate,s!==null&&nd(s)===null){o.child=y;break}s=y.sibling,y.sibling=d,d=y,y=s}up(o,!0,d,null,b,f);break;case"together":up(o,!1,null,null,void 0,f);break;default:o.memoizedState=null}return o.child}function Ir(s,o,d){if(s!==null&&(o.dependencies=s.dependencies),Ss|=o.lanes,(d&o.childLanes)===0)if(s!==null){if(xi(s,o,d,!1),(d&o.childLanes)===0)return null}else return null;if(s!==null&&o.child!==s.child)throw Error(r(153));if(o.child!==null){for(s=o.child,d=Mr(s,s.pendingProps),o.child=d,d.return=o;s.sibling!==null;)s=s.sibling,d=d.sibling=Mr(s,s.pendingProps),d.return=o;d.sibling=null}return o.child}function hp(s,o){return(s.lanes&o)!==0?!0:(s=s.dependencies,!!(s!==null&&Kc(s)))}function ET(s,o,d){switch(o.tag){case 3:we(o,o.stateNode.containerInfo),ps(o,Tt,s.memoizedState.cache),ha();break;case 27:case 5:tt(o);break;case 4:we(o,o.stateNode.containerInfo);break;case 10:ps(o,o.type,o.memoizedProps.value);break;case 31:if(o.memoizedState!==null)return o.flags|=128,Bf(o),null;break;case 13:var f=o.memoizedState;if(f!==null)return f.dehydrated!==null?(xs(o),o.flags|=128,null):(d&o.child.childLanes)!==0?g0(s,o,d):(xs(o),s=Ir(s,o,d),s!==null?s.sibling:null);xs(o);break;case 19:var y=(s.flags&128)!==0;if(f=(d&o.childLanes)!==0,f||(xi(s,o,d,!1),f=(d&o.childLanes)!==0),y){if(f)return x0(s,o,d);o.flags|=128}if(y=o.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),H(Nt,Nt.current),f)break;return null;case 22:return o.lanes=0,d0(s,o,d,o.pendingProps);case 24:ps(o,Tt,s.memoizedState.cache)}return Ir(s,o,d)}function b0(s,o,d){if(s!==null)if(s.memoizedProps!==o.pendingProps)Rt=!0;else{if(!hp(s,d)&&(o.flags&128)===0)return Rt=!1,ET(s,o,d);Rt=(s.flags&131072)!==0}else Rt=!1,Ve&&(o.flags&1048576)!==0&&Qx(o,zo,o.index);switch(o.lanes=0,o.tag){case 16:e:{var f=o.pendingProps;if(s=ga(o.elementType),o.type=s,typeof s=="function")yf(s)?(f=va(s,f),o.tag=1,o=p0(null,o,s,f,d)):(o.tag=0,o=ap(null,o,s,f,d));else{if(s!=null){var y=s.$$typeof;if(y===L){o.tag=11,o=o0(null,o,s,f,d);break e}else if(y===D){o.tag=14,o=l0(null,o,s,f,d);break e}}throw o=V(s)||s,Error(r(306,o,""))}}return o;case 0:return ap(s,o,o.type,o.pendingProps,d);case 1:return f=o.type,y=va(f,o.pendingProps),p0(s,o,f,y,d);case 3:e:{if(we(o,o.stateNode.containerInfo),s===null)throw Error(r(387));f=o.pendingProps;var b=o.memoizedState;y=b.element,Mf(s,o),Ko(o,f,null,d);var k=o.memoizedState;if(f=k.cache,ps(o,Tt,f),f!==b.cache&&Cf(o,[Tt],d,!0),Wo(),f=k.element,b.isDehydrated)if(b={element:f,isDehydrated:!1,cache:k.cache},o.updateQueue.baseState=b,o.memoizedState=b,o.flags&256){o=m0(s,o,f,d);break e}else if(f!==y){y=Gn(Error(r(424)),o),Uo(y),o=m0(s,o,f,d);break e}else for(s=o.stateNode.containerInfo,s.nodeType===9?s=s.body:s=s.nodeName==="HTML"?s.ownerDocument.body:s,it=Jn(s.firstChild),Wt=o,Ve=!0,hs=null,Kn=!0,d=db(o,null,f,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(ha(),f===y){o=Ir(s,o,d);break e}Yt(s,o,f,d)}o=o.child}return o;case 26:return fd(s,o),s===null?(d=Av(o.type,null,o.pendingProps,null))?o.memoizedState=d:Ve||(d=o.type,s=o.pendingProps,f=Ad(fe.current).createElement(d),f[qt]=o,f[mn]=s,Jt(f,d,s),zt(f),o.stateNode=f):o.memoizedState=Av(o.type,s.memoizedProps,o.pendingProps,s.memoizedState),null;case 27:return tt(o),s===null&&Ve&&(f=o.stateNode=Tv(o.type,o.pendingProps,fe.current),Wt=o,Kn=!0,y=it,Ts(o.type)?(Gp=y,it=Jn(f.firstChild)):it=y),Yt(s,o,o.pendingProps.children,d),fd(s,o),s===null&&(o.flags|=4194304),o.child;case 5:return s===null&&Ve&&((y=f=it)&&(f=sE(f,o.type,o.pendingProps,Kn),f!==null?(o.stateNode=f,Wt=o,it=Jn(f.firstChild),Kn=!1,y=!0):y=!1),y||fs(o)),tt(o),y=o.type,b=o.pendingProps,k=s!==null?s.memoizedProps:null,f=b.children,zp(y,b)?f=null:k!==null&&zp(y,k)&&(o.flags|=32),o.memoizedState!==null&&(y=Pf(s,o,bT,null,null,d),pl._currentValue=y),fd(s,o),Yt(s,o,f,d),o.child;case 6:return s===null&&Ve&&((s=d=it)&&(d=aE(d,o.pendingProps,Kn),d!==null?(o.stateNode=d,Wt=o,it=null,s=!0):s=!1),s||fs(o)),null;case 13:return g0(s,o,d);case 4:return we(o,o.stateNode.containerInfo),f=o.pendingProps,s===null?o.child=xa(o,null,f,d):Yt(s,o,f,d),o.child;case 11:return o0(s,o,o.type,o.pendingProps,d);case 7:return Yt(s,o,o.pendingProps,d),o.child;case 8:return Yt(s,o,o.pendingProps.children,d),o.child;case 12:return Yt(s,o,o.pendingProps.children,d),o.child;case 10:return f=o.pendingProps,ps(o,o.type,f.value),Yt(s,o,f.children,d),o.child;case 9:return y=o.type._context,f=o.pendingProps.children,pa(o),y=Kt(y),f=f(y),o.flags|=1,Yt(s,o,f,d),o.child;case 14:return l0(s,o,o.type,o.pendingProps,d);case 15:return c0(s,o,o.type,o.pendingProps,d);case 19:return x0(s,o,d);case 31:return TT(s,o,d);case 22:return d0(s,o,d,o.pendingProps);case 24:return pa(o),f=Kt(Tt),s===null?(y=Rf(),y===null&&(y=nt,b=Tf(),y.pooledCache=b,b.refCount++,b!==null&&(y.pooledCacheLanes|=d),y=b),o.memoizedState={parent:f,cache:y},_f(o),ps(o,Tt,y)):((s.lanes&d)!==0&&(Mf(s,o),Ko(o,null,null,d),Wo()),y=s.memoizedState,b=o.memoizedState,y.parent!==f?(y={parent:f,cache:f},o.memoizedState=y,o.lanes===0&&(o.memoizedState=o.updateQueue.baseState=y),ps(o,Tt,f)):(f=b.cache,ps(o,Tt,f),f!==y.cache&&Cf(o,[Tt],d,!0))),Yt(s,o,o.pendingProps.children,d),o.child;case 29:throw o.pendingProps}throw Error(r(156,o.tag))}function Pr(s){s.flags|=4}function fp(s,o,d,f,y){if((o=(s.mode&32)!==0)&&(o=!1),o){if(s.flags|=16777216,(y&335544128)===y)if(s.stateNode.complete)s.flags|=8192;else if(q0())s.flags|=8192;else throw ya=Xc,Af}else s.flags&=-16777217}function v0(s,o){if(o.type!=="stylesheet"||(o.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!Lv(o))if(q0())s.flags|=8192;else throw ya=Xc,Af}function md(s,o){o!==null&&(s.flags|=4),s.flags&16384&&(o=s.tag!==22?Zy():536870912,s.lanes|=o,Ai|=o)}function el(s,o){if(!Ve)switch(s.tailMode){case"hidden":o=s.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?s.tail=null:d.sibling=null;break;case"collapsed":d=s.tail;for(var f=null;d!==null;)d.alternate!==null&&(f=d),d=d.sibling;f===null?o||s.tail===null?s.tail=null:s.tail.sibling=null:f.sibling=null}}function ot(s){var o=s.alternate!==null&&s.alternate.child===s.child,d=0,f=0;if(o)for(var y=s.child;y!==null;)d|=y.lanes|y.childLanes,f|=y.subtreeFlags&65011712,f|=y.flags&65011712,y.return=s,y=y.sibling;else for(y=s.child;y!==null;)d|=y.lanes|y.childLanes,f|=y.subtreeFlags,f|=y.flags,y.return=s,y=y.sibling;return s.subtreeFlags|=f,s.childLanes=d,o}function RT(s,o,d){var f=o.pendingProps;switch(wf(o),o.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ot(o),null;case 1:return ot(o),null;case 3:return d=o.stateNode,f=null,s!==null&&(f=s.memoizedState.cache),o.memoizedState.cache!==f&&(o.flags|=2048),Lr(Tt),me(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(s===null||s.child===null)&&(yi(o)?Pr(o):s===null||s.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,Nf())),ot(o),null;case 26:var y=o.type,b=o.memoizedState;return s===null?(Pr(o),b!==null?(ot(o),v0(o,b)):(ot(o),fp(o,y,null,f,d))):b?b!==s.memoizedState?(Pr(o),ot(o),v0(o,b)):(ot(o),o.flags&=-16777217):(s=s.memoizedProps,s!==f&&Pr(o),ot(o),fp(o,y,s,f,d)),null;case 27:if(mt(o),d=fe.current,y=o.type,s!==null&&o.stateNode!=null)s.memoizedProps!==f&&Pr(o);else{if(!f){if(o.stateNode===null)throw Error(r(166));return ot(o),null}s=Q.current,yi(o)?Zx(o):(s=Tv(y,f,d),o.stateNode=s,Pr(o))}return ot(o),null;case 5:if(mt(o),y=o.type,s!==null&&o.stateNode!=null)s.memoizedProps!==f&&Pr(o);else{if(!f){if(o.stateNode===null)throw Error(r(166));return ot(o),null}if(b=Q.current,yi(o))Zx(o);else{var k=Ad(fe.current);switch(b){case 1:b=k.createElementNS("http://www.w3.org/2000/svg",y);break;case 2:b=k.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;default:switch(y){case"svg":b=k.createElementNS("http://www.w3.org/2000/svg",y);break;case"math":b=k.createElementNS("http://www.w3.org/1998/Math/MathML",y);break;case"script":b=k.createElement("div"),b.innerHTML="<script><\/script>",b=b.removeChild(b.firstChild);break;case"select":b=typeof f.is=="string"?k.createElement("select",{is:f.is}):k.createElement("select"),f.multiple?b.multiple=!0:f.size&&(b.size=f.size);break;default:b=typeof f.is=="string"?k.createElement(y,{is:f.is}):k.createElement(y)}}b[qt]=o,b[mn]=f;e:for(k=o.child;k!==null;){if(k.tag===5||k.tag===6)b.appendChild(k.stateNode);else if(k.tag!==4&&k.tag!==27&&k.child!==null){k.child.return=k,k=k.child;continue}if(k===o)break e;for(;k.sibling===null;){if(k.return===null||k.return===o)break e;k=k.return}k.sibling.return=k.return,k=k.sibling}o.stateNode=b;e:switch(Jt(b,y,f),y){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&Pr(o)}}return ot(o),fp(o,o.type,s===null?null:s.memoizedProps,o.pendingProps,d),null;case 6:if(s&&o.stateNode!=null)s.memoizedProps!==f&&Pr(o);else{if(typeof f!="string"&&o.stateNode===null)throw Error(r(166));if(s=fe.current,yi(o)){if(s=o.stateNode,d=o.memoizedProps,f=null,y=Wt,y!==null)switch(y.tag){case 27:case 5:f=y.memoizedProps}s[qt]=o,s=!!(s.nodeValue===d||f!==null&&f.suppressHydrationWarning===!0||gv(s.nodeValue,d)),s||fs(o,!0)}else s=Ad(s).createTextNode(f),s[qt]=o,o.stateNode=s}return ot(o),null;case 31:if(d=o.memoizedState,s===null||s.memoizedState!==null){if(f=yi(o),d!==null){if(s===null){if(!f)throw Error(r(318));if(s=o.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(557));s[qt]=o}else ha(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;ot(o),s=!1}else d=Nf(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=d),s=!0;if(!s)return o.flags&256?(An(o),o):(An(o),null);if((o.flags&128)!==0)throw Error(r(558))}return ot(o),null;case 13:if(f=o.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(y=yi(o),f!==null&&f.dehydrated!==null){if(s===null){if(!y)throw Error(r(318));if(y=o.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(r(317));y[qt]=o}else ha(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;ot(o),y=!1}else y=Nf(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=y),y=!0;if(!y)return o.flags&256?(An(o),o):(An(o),null)}return An(o),(o.flags&128)!==0?(o.lanes=d,o):(d=f!==null,s=s!==null&&s.memoizedState!==null,d&&(f=o.child,y=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(y=f.alternate.memoizedState.cachePool.pool),b=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(b=f.memoizedState.cachePool.pool),b!==y&&(f.flags|=2048)),d!==s&&d&&(o.child.flags|=8192),md(o,o.updateQueue),ot(o),null);case 4:return me(),s===null&&Lp(o.stateNode.containerInfo),ot(o),null;case 10:return Lr(o.type),ot(o),null;case 19:if(z(Nt),f=o.memoizedState,f===null)return ot(o),null;if(y=(o.flags&128)!==0,b=f.rendering,b===null)if(y)el(f,!1);else{if(xt!==0||s!==null&&(s.flags&128)!==0)for(s=o.child;s!==null;){if(b=nd(s),b!==null){for(o.flags|=128,el(f,!1),s=b.updateQueue,o.updateQueue=s,md(o,s),o.subtreeFlags=0,s=d,d=o.child;d!==null;)Kx(d,s),d=d.sibling;return H(Nt,Nt.current&1|2),Ve&&Or(o,f.treeForkCount),o.child}s=s.sibling}f.tail!==null&&kn()>vd&&(o.flags|=128,y=!0,el(f,!1),o.lanes=4194304)}else{if(!y)if(s=nd(b),s!==null){if(o.flags|=128,y=!0,s=s.updateQueue,o.updateQueue=s,md(o,s),el(f,!0),f.tail===null&&f.tailMode==="hidden"&&!b.alternate&&!Ve)return ot(o),null}else 2*kn()-f.renderingStartTime>vd&&d!==536870912&&(o.flags|=128,y=!0,el(f,!1),o.lanes=4194304);f.isBackwards?(b.sibling=o.child,o.child=b):(s=f.last,s!==null?s.sibling=b:o.child=b,f.last=b)}return f.tail!==null?(s=f.tail,f.rendering=s,f.tail=s.sibling,f.renderingStartTime=kn(),s.sibling=null,d=Nt.current,H(Nt,y?d&1|2:d&1),Ve&&Or(o,f.treeForkCount),s):(ot(o),null);case 22:case 23:return An(o),$f(),f=o.memoizedState!==null,s!==null?s.memoizedState!==null!==f&&(o.flags|=8192):f&&(o.flags|=8192),f?(d&536870912)!==0&&(o.flags&128)===0&&(ot(o),o.subtreeFlags&6&&(o.flags|=8192)):ot(o),d=o.updateQueue,d!==null&&md(o,d.retryQueue),d=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),f=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(f=o.memoizedState.cachePool.pool),f!==d&&(o.flags|=2048),s!==null&&z(ma),null;case 24:return d=null,s!==null&&(d=s.memoizedState.cache),o.memoizedState.cache!==d&&(o.flags|=2048),Lr(Tt),ot(o),null;case 25:return null;case 30:return null}throw Error(r(156,o.tag))}function AT(s,o){switch(wf(o),o.tag){case 1:return s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 3:return Lr(Tt),me(),s=o.flags,(s&65536)!==0&&(s&128)===0?(o.flags=s&-65537|128,o):null;case 26:case 27:case 5:return mt(o),null;case 31:if(o.memoizedState!==null){if(An(o),o.alternate===null)throw Error(r(340));ha()}return s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 13:if(An(o),s=o.memoizedState,s!==null&&s.dehydrated!==null){if(o.alternate===null)throw Error(r(340));ha()}return s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 19:return z(Nt),null;case 4:return me(),null;case 10:return Lr(o.type),null;case 22:case 23:return An(o),$f(),s!==null&&z(ma),s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 24:return Lr(Tt),null;case 25:return null;default:return null}}function w0(s,o){switch(wf(o),o.tag){case 3:Lr(Tt),me();break;case 26:case 27:case 5:mt(o);break;case 4:me();break;case 31:o.memoizedState!==null&&An(o);break;case 13:An(o);break;case 19:z(Nt);break;case 10:Lr(o.type);break;case 22:case 23:An(o),$f(),s!==null&&z(ma);break;case 24:Lr(Tt)}}function tl(s,o){try{var d=o.updateQueue,f=d!==null?d.lastEffect:null;if(f!==null){var y=f.next;d=y;do{if((d.tag&s)===s){f=void 0;var b=d.create,k=d.inst;f=b(),k.destroy=f}d=d.next}while(d!==y)}}catch(C){Je(o,o.return,C)}}function vs(s,o,d){try{var f=o.updateQueue,y=f!==null?f.lastEffect:null;if(y!==null){var b=y.next;f=b;do{if((f.tag&s)===s){var k=f.inst,C=k.destroy;if(C!==void 0){k.destroy=void 0,y=o;var B=d,q=C;try{q()}catch(ne){Je(y,B,ne)}}}f=f.next}while(f!==b)}}catch(ne){Je(o,o.return,ne)}}function S0(s){var o=s.updateQueue;if(o!==null){var d=s.stateNode;try{hb(o,d)}catch(f){Je(s,s.return,f)}}}function N0(s,o,d){d.props=va(s.type,s.memoizedProps),d.state=s.memoizedState;try{d.componentWillUnmount()}catch(f){Je(s,o,f)}}function nl(s,o){try{var d=s.ref;if(d!==null){switch(s.tag){case 26:case 27:case 5:var f=s.stateNode;break;case 30:f=s.stateNode;break;default:f=s.stateNode}typeof d=="function"?s.refCleanup=d(f):d.current=f}}catch(y){Je(s,o,y)}}function vr(s,o){var d=s.ref,f=s.refCleanup;if(d!==null)if(typeof f=="function")try{f()}catch(y){Je(s,o,y)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof d=="function")try{d(null)}catch(y){Je(s,o,y)}else d.current=null}function k0(s){var o=s.type,d=s.memoizedProps,f=s.stateNode;try{e:switch(o){case"button":case"input":case"select":case"textarea":d.autoFocus&&f.focus();break e;case"img":d.src?f.src=d.src:d.srcSet&&(f.srcset=d.srcSet)}}catch(y){Je(s,s.return,y)}}function pp(s,o,d){try{var f=s.stateNode;XT(f,s.type,d,o),f[mn]=o}catch(y){Je(s,s.return,y)}}function j0(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&Ts(s.type)||s.tag===4}function mp(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||j0(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&Ts(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function gp(s,o,d){var f=s.tag;if(f===5||f===6)s=s.stateNode,o?(d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d).insertBefore(s,o):(o=d.nodeType===9?d.body:d.nodeName==="HTML"?d.ownerDocument.body:d,o.appendChild(s),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=Ar));else if(f!==4&&(f===27&&Ts(s.type)&&(d=s.stateNode,o=null),s=s.child,s!==null))for(gp(s,o,d),s=s.sibling;s!==null;)gp(s,o,d),s=s.sibling}function gd(s,o,d){var f=s.tag;if(f===5||f===6)s=s.stateNode,o?d.insertBefore(s,o):d.appendChild(s);else if(f!==4&&(f===27&&Ts(s.type)&&(d=s.stateNode),s=s.child,s!==null))for(gd(s,o,d),s=s.sibling;s!==null;)gd(s,o,d),s=s.sibling}function C0(s){var o=s.stateNode,d=s.memoizedProps;try{for(var f=s.type,y=o.attributes;y.length;)o.removeAttributeNode(y[0]);Jt(o,f,d),o[qt]=s,o[mn]=d}catch(b){Je(s,s.return,b)}}var zr=!1,At=!1,yp=!1,T0=typeof WeakSet=="function"?WeakSet:Set,Ut=null;function _T(s,o){if(s=s.containerInfo,Ip=Bd,s=Px(s),df(s)){if("selectionStart"in s)var d={start:s.selectionStart,end:s.selectionEnd};else e:{d=(d=s.ownerDocument)&&d.defaultView||window;var f=d.getSelection&&d.getSelection();if(f&&f.rangeCount!==0){d=f.anchorNode;var y=f.anchorOffset,b=f.focusNode;f=f.focusOffset;try{d.nodeType,b.nodeType}catch{d=null;break e}var k=0,C=-1,B=-1,q=0,ne=0,se=s,Y=null;t:for(;;){for(var ee;se!==d||y!==0&&se.nodeType!==3||(C=k+y),se!==b||f!==0&&se.nodeType!==3||(B=k+f),se.nodeType===3&&(k+=se.nodeValue.length),(ee=se.firstChild)!==null;)Y=se,se=ee;for(;;){if(se===s)break t;if(Y===d&&++q===y&&(C=k),Y===b&&++ne===f&&(B=k),(ee=se.nextSibling)!==null)break;se=Y,Y=se.parentNode}se=ee}d=C===-1||B===-1?null:{start:C,end:B}}else d=null}d=d||{start:0,end:0}}else d=null;for(Pp={focusedElem:s,selectionRange:d},Bd=!1,Ut=o;Ut!==null;)if(o=Ut,s=o.child,(o.subtreeFlags&1028)!==0&&s!==null)s.return=o,Ut=s;else for(;Ut!==null;){switch(o=Ut,b=o.alternate,s=o.flags,o.tag){case 0:if((s&4)!==0&&(s=o.updateQueue,s=s!==null?s.events:null,s!==null))for(d=0;d<s.length;d++)y=s[d],y.ref.impl=y.nextImpl;break;case 11:case 15:break;case 1:if((s&1024)!==0&&b!==null){s=void 0,d=o,y=b.memoizedProps,b=b.memoizedState,f=d.stateNode;try{var xe=va(d.type,y);s=f.getSnapshotBeforeUpdate(xe,b),f.__reactInternalSnapshotBeforeUpdate=s}catch(Ee){Je(d,d.return,Ee)}}break;case 3:if((s&1024)!==0){if(s=o.stateNode.containerInfo,d=s.nodeType,d===9)Hp(s);else if(d===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":Hp(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=o.sibling,s!==null){s.return=o.return,Ut=s;break}Ut=o.return}}function E0(s,o,d){var f=d.flags;switch(d.tag){case 0:case 11:case 15:Hr(s,d),f&4&&tl(5,d);break;case 1:if(Hr(s,d),f&4)if(s=d.stateNode,o===null)try{s.componentDidMount()}catch(k){Je(d,d.return,k)}else{var y=va(d.type,o.memoizedProps);o=o.memoizedState;try{s.componentDidUpdate(y,o,s.__reactInternalSnapshotBeforeUpdate)}catch(k){Je(d,d.return,k)}}f&64&&S0(d),f&512&&nl(d,d.return);break;case 3:if(Hr(s,d),f&64&&(s=d.updateQueue,s!==null)){if(o=null,d.child!==null)switch(d.child.tag){case 27:case 5:o=d.child.stateNode;break;case 1:o=d.child.stateNode}try{hb(s,o)}catch(k){Je(d,d.return,k)}}break;case 27:o===null&&f&4&&C0(d);case 26:case 5:Hr(s,d),o===null&&f&4&&k0(d),f&512&&nl(d,d.return);break;case 12:Hr(s,d);break;case 31:Hr(s,d),f&4&&_0(s,d);break;case 13:Hr(s,d),f&4&&M0(s,d),f&64&&(s=d.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(d=zT.bind(null,d),iE(s,d))));break;case 22:if(f=d.memoizedState!==null||zr,!f){o=o!==null&&o.memoizedState!==null||At,y=zr;var b=At;zr=f,(At=o)&&!b?Vr(s,d,(d.subtreeFlags&8772)!==0):Hr(s,d),zr=y,At=b}break;case 30:break;default:Hr(s,d)}}function R0(s){var o=s.alternate;o!==null&&(s.alternate=null,R0(o)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(o=s.stateNode,o!==null&&qh(o)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var ct=null,yn=!1;function Ur(s,o,d){for(d=d.child;d!==null;)A0(s,o,d),d=d.sibling}function A0(s,o,d){if(jn&&typeof jn.onCommitFiberUnmount=="function")try{jn.onCommitFiberUnmount(Co,d)}catch{}switch(d.tag){case 26:At||vr(d,o),Ur(s,o,d),d.memoizedState?d.memoizedState.count--:d.stateNode&&(d=d.stateNode,d.parentNode.removeChild(d));break;case 27:At||vr(d,o);var f=ct,y=yn;Ts(d.type)&&(ct=d.stateNode,yn=!1),Ur(s,o,d),ul(d.stateNode),ct=f,yn=y;break;case 5:At||vr(d,o);case 6:if(f=ct,y=yn,ct=null,Ur(s,o,d),ct=f,yn=y,ct!==null)if(yn)try{(ct.nodeType===9?ct.body:ct.nodeName==="HTML"?ct.ownerDocument.body:ct).removeChild(d.stateNode)}catch(b){Je(d,o,b)}else try{ct.removeChild(d.stateNode)}catch(b){Je(d,o,b)}break;case 18:ct!==null&&(yn?(s=ct,Sv(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,d.stateNode),Ii(s)):Sv(ct,d.stateNode));break;case 4:f=ct,y=yn,ct=d.stateNode.containerInfo,yn=!0,Ur(s,o,d),ct=f,yn=y;break;case 0:case 11:case 14:case 15:vs(2,d,o),At||vs(4,d,o),Ur(s,o,d);break;case 1:At||(vr(d,o),f=d.stateNode,typeof f.componentWillUnmount=="function"&&N0(d,o,f)),Ur(s,o,d);break;case 21:Ur(s,o,d);break;case 22:At=(f=At)||d.memoizedState!==null,Ur(s,o,d),At=f;break;default:Ur(s,o,d)}}function _0(s,o){if(o.memoizedState===null&&(s=o.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Ii(s)}catch(d){Je(o,o.return,d)}}}function M0(s,o){if(o.memoizedState===null&&(s=o.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Ii(s)}catch(d){Je(o,o.return,d)}}function MT(s){switch(s.tag){case 31:case 13:case 19:var o=s.stateNode;return o===null&&(o=s.stateNode=new T0),o;case 22:return s=s.stateNode,o=s._retryCache,o===null&&(o=s._retryCache=new T0),o;default:throw Error(r(435,s.tag))}}function yd(s,o){var d=MT(s);o.forEach(function(f){if(!d.has(f)){d.add(f);var y=UT.bind(null,s,f);f.then(y,y)}})}function xn(s,o){var d=o.deletions;if(d!==null)for(var f=0;f<d.length;f++){var y=d[f],b=s,k=o,C=k;e:for(;C!==null;){switch(C.tag){case 27:if(Ts(C.type)){ct=C.stateNode,yn=!1;break e}break;case 5:ct=C.stateNode,yn=!1;break e;case 3:case 4:ct=C.stateNode.containerInfo,yn=!0;break e}C=C.return}if(ct===null)throw Error(r(160));A0(b,k,y),ct=null,yn=!1,b=y.alternate,b!==null&&(b.return=null),y.return=null}if(o.subtreeFlags&13886)for(o=o.child;o!==null;)O0(o,s),o=o.sibling}var lr=null;function O0(s,o){var d=s.alternate,f=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:xn(o,s),bn(s),f&4&&(vs(3,s,s.return),tl(3,s),vs(5,s,s.return));break;case 1:xn(o,s),bn(s),f&512&&(At||d===null||vr(d,d.return)),f&64&&zr&&(s=s.updateQueue,s!==null&&(f=s.callbacks,f!==null&&(d=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=d===null?f:d.concat(f))));break;case 26:var y=lr;if(xn(o,s),bn(s),f&512&&(At||d===null||vr(d,d.return)),f&4){var b=d!==null?d.memoizedState:null;if(f=s.memoizedState,d===null)if(f===null)if(s.stateNode===null){e:{f=s.type,d=s.memoizedProps,y=y.ownerDocument||y;t:switch(f){case"title":b=y.getElementsByTagName("title")[0],(!b||b[Ro]||b[qt]||b.namespaceURI==="http://www.w3.org/2000/svg"||b.hasAttribute("itemprop"))&&(b=y.createElement(f),y.head.insertBefore(b,y.querySelector("head > title"))),Jt(b,f,d),b[qt]=s,zt(b),f=b;break e;case"link":var k=Ov("link","href",y).get(f+(d.href||""));if(k){for(var C=0;C<k.length;C++)if(b=k[C],b.getAttribute("href")===(d.href==null||d.href===""?null:d.href)&&b.getAttribute("rel")===(d.rel==null?null:d.rel)&&b.getAttribute("title")===(d.title==null?null:d.title)&&b.getAttribute("crossorigin")===(d.crossOrigin==null?null:d.crossOrigin)){k.splice(C,1);break t}}b=y.createElement(f),Jt(b,f,d),y.head.appendChild(b);break;case"meta":if(k=Ov("meta","content",y).get(f+(d.content||""))){for(C=0;C<k.length;C++)if(b=k[C],b.getAttribute("content")===(d.content==null?null:""+d.content)&&b.getAttribute("name")===(d.name==null?null:d.name)&&b.getAttribute("property")===(d.property==null?null:d.property)&&b.getAttribute("http-equiv")===(d.httpEquiv==null?null:d.httpEquiv)&&b.getAttribute("charset")===(d.charSet==null?null:d.charSet)){k.splice(C,1);break t}}b=y.createElement(f),Jt(b,f,d),y.head.appendChild(b);break;default:throw Error(r(468,f))}b[qt]=s,zt(b),f=b}s.stateNode=f}else Dv(y,s.type,s.stateNode);else s.stateNode=Mv(y,f,s.memoizedProps);else b!==f?(b===null?d.stateNode!==null&&(d=d.stateNode,d.parentNode.removeChild(d)):b.count--,f===null?Dv(y,s.type,s.stateNode):Mv(y,f,s.memoizedProps)):f===null&&s.stateNode!==null&&pp(s,s.memoizedProps,d.memoizedProps)}break;case 27:xn(o,s),bn(s),f&512&&(At||d===null||vr(d,d.return)),d!==null&&f&4&&pp(s,s.memoizedProps,d.memoizedProps);break;case 5:if(xn(o,s),bn(s),f&512&&(At||d===null||vr(d,d.return)),s.flags&32){y=s.stateNode;try{oi(y,"")}catch(xe){Je(s,s.return,xe)}}f&4&&s.stateNode!=null&&(y=s.memoizedProps,pp(s,y,d!==null?d.memoizedProps:y)),f&1024&&(yp=!0);break;case 6:if(xn(o,s),bn(s),f&4){if(s.stateNode===null)throw Error(r(162));f=s.memoizedProps,d=s.stateNode;try{d.nodeValue=f}catch(xe){Je(s,s.return,xe)}}break;case 3:if(Od=null,y=lr,lr=_d(o.containerInfo),xn(o,s),lr=y,bn(s),f&4&&d!==null&&d.memoizedState.isDehydrated)try{Ii(o.containerInfo)}catch(xe){Je(s,s.return,xe)}yp&&(yp=!1,D0(s));break;case 4:f=lr,lr=_d(s.stateNode.containerInfo),xn(o,s),bn(s),lr=f;break;case 12:xn(o,s),bn(s);break;case 31:xn(o,s),bn(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,yd(s,f)));break;case 13:xn(o,s),bn(s),s.child.flags&8192&&s.memoizedState!==null!=(d!==null&&d.memoizedState!==null)&&(bd=kn()),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,yd(s,f)));break;case 22:y=s.memoizedState!==null;var B=d!==null&&d.memoizedState!==null,q=zr,ne=At;if(zr=q||y,At=ne||B,xn(o,s),At=ne,zr=q,bn(s),f&8192)e:for(o=s.stateNode,o._visibility=y?o._visibility&-2:o._visibility|1,y&&(d===null||B||zr||At||wa(s)),d=null,o=s;;){if(o.tag===5||o.tag===26){if(d===null){B=d=o;try{if(b=B.stateNode,y)k=b.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none";else{C=B.stateNode;var se=B.memoizedProps.style,Y=se!=null&&se.hasOwnProperty("display")?se.display:null;C.style.display=Y==null||typeof Y=="boolean"?"":(""+Y).trim()}}catch(xe){Je(B,B.return,xe)}}}else if(o.tag===6){if(d===null){B=o;try{B.stateNode.nodeValue=y?"":B.memoizedProps}catch(xe){Je(B,B.return,xe)}}}else if(o.tag===18){if(d===null){B=o;try{var ee=B.stateNode;y?Nv(ee,!0):Nv(B.stateNode,!1)}catch(xe){Je(B,B.return,xe)}}}else if((o.tag!==22&&o.tag!==23||o.memoizedState===null||o===s)&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break e;for(;o.sibling===null;){if(o.return===null||o.return===s)break e;d===o&&(d=null),o=o.return}d===o&&(d=null),o.sibling.return=o.return,o=o.sibling}f&4&&(f=s.updateQueue,f!==null&&(d=f.retryQueue,d!==null&&(f.retryQueue=null,yd(s,d))));break;case 19:xn(o,s),bn(s),f&4&&(f=s.updateQueue,f!==null&&(s.updateQueue=null,yd(s,f)));break;case 30:break;case 21:break;default:xn(o,s),bn(s)}}function bn(s){var o=s.flags;if(o&2){try{for(var d,f=s.return;f!==null;){if(j0(f)){d=f;break}f=f.return}if(d==null)throw Error(r(160));switch(d.tag){case 27:var y=d.stateNode,b=mp(s);gd(s,b,y);break;case 5:var k=d.stateNode;d.flags&32&&(oi(k,""),d.flags&=-33);var C=mp(s);gd(s,C,k);break;case 3:case 4:var B=d.stateNode.containerInfo,q=mp(s);gp(s,q,B);break;default:throw Error(r(161))}}catch(ne){Je(s,s.return,ne)}s.flags&=-3}o&4096&&(s.flags&=-4097)}function D0(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var o=s;D0(o),o.tag===5&&o.flags&1024&&o.stateNode.reset(),s=s.sibling}}function Hr(s,o){if(o.subtreeFlags&8772)for(o=o.child;o!==null;)E0(s,o.alternate,o),o=o.sibling}function wa(s){for(s=s.child;s!==null;){var o=s;switch(o.tag){case 0:case 11:case 14:case 15:vs(4,o,o.return),wa(o);break;case 1:vr(o,o.return);var d=o.stateNode;typeof d.componentWillUnmount=="function"&&N0(o,o.return,d),wa(o);break;case 27:ul(o.stateNode);case 26:case 5:vr(o,o.return),wa(o);break;case 22:o.memoizedState===null&&wa(o);break;case 30:wa(o);break;default:wa(o)}s=s.sibling}}function Vr(s,o,d){for(d=d&&(o.subtreeFlags&8772)!==0,o=o.child;o!==null;){var f=o.alternate,y=s,b=o,k=b.flags;switch(b.tag){case 0:case 11:case 15:Vr(y,b,d),tl(4,b);break;case 1:if(Vr(y,b,d),f=b,y=f.stateNode,typeof y.componentDidMount=="function")try{y.componentDidMount()}catch(q){Je(f,f.return,q)}if(f=b,y=f.updateQueue,y!==null){var C=f.stateNode;try{var B=y.shared.hiddenCallbacks;if(B!==null)for(y.shared.hiddenCallbacks=null,y=0;y<B.length;y++)ub(B[y],C)}catch(q){Je(f,f.return,q)}}d&&k&64&&S0(b),nl(b,b.return);break;case 27:C0(b);case 26:case 5:Vr(y,b,d),d&&f===null&&k&4&&k0(b),nl(b,b.return);break;case 12:Vr(y,b,d);break;case 31:Vr(y,b,d),d&&k&4&&_0(y,b);break;case 13:Vr(y,b,d),d&&k&4&&M0(y,b);break;case 22:b.memoizedState===null&&Vr(y,b,d),nl(b,b.return);break;case 30:break;default:Vr(y,b,d)}o=o.sibling}}function xp(s,o){var d=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(d=s.memoizedState.cachePool.pool),s=null,o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(s=o.memoizedState.cachePool.pool),s!==d&&(s!=null&&s.refCount++,d!=null&&Ho(d))}function bp(s,o){s=null,o.alternate!==null&&(s=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==s&&(o.refCount++,s!=null&&Ho(s))}function cr(s,o,d,f){if(o.subtreeFlags&10256)for(o=o.child;o!==null;)L0(s,o,d,f),o=o.sibling}function L0(s,o,d,f){var y=o.flags;switch(o.tag){case 0:case 11:case 15:cr(s,o,d,f),y&2048&&tl(9,o);break;case 1:cr(s,o,d,f);break;case 3:cr(s,o,d,f),y&2048&&(s=null,o.alternate!==null&&(s=o.alternate.memoizedState.cache),o=o.memoizedState.cache,o!==s&&(o.refCount++,s!=null&&Ho(s)));break;case 12:if(y&2048){cr(s,o,d,f),s=o.stateNode;try{var b=o.memoizedProps,k=b.id,C=b.onPostCommit;typeof C=="function"&&C(k,o.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(B){Je(o,o.return,B)}}else cr(s,o,d,f);break;case 31:cr(s,o,d,f);break;case 13:cr(s,o,d,f);break;case 23:break;case 22:b=o.stateNode,k=o.alternate,o.memoizedState!==null?b._visibility&2?cr(s,o,d,f):rl(s,o):b._visibility&2?cr(s,o,d,f):(b._visibility|=2,Ti(s,o,d,f,(o.subtreeFlags&10256)!==0||!1)),y&2048&&xp(k,o);break;case 24:cr(s,o,d,f),y&2048&&bp(o.alternate,o);break;default:cr(s,o,d,f)}}function Ti(s,o,d,f,y){for(y=y&&((o.subtreeFlags&10256)!==0||!1),o=o.child;o!==null;){var b=s,k=o,C=d,B=f,q=k.flags;switch(k.tag){case 0:case 11:case 15:Ti(b,k,C,B,y),tl(8,k);break;case 23:break;case 22:var ne=k.stateNode;k.memoizedState!==null?ne._visibility&2?Ti(b,k,C,B,y):rl(b,k):(ne._visibility|=2,Ti(b,k,C,B,y)),y&&q&2048&&xp(k.alternate,k);break;case 24:Ti(b,k,C,B,y),y&&q&2048&&bp(k.alternate,k);break;default:Ti(b,k,C,B,y)}o=o.sibling}}function rl(s,o){if(o.subtreeFlags&10256)for(o=o.child;o!==null;){var d=s,f=o,y=f.flags;switch(f.tag){case 22:rl(d,f),y&2048&&xp(f.alternate,f);break;case 24:rl(d,f),y&2048&&bp(f.alternate,f);break;default:rl(d,f)}o=o.sibling}}var sl=8192;function Ei(s,o,d){if(s.subtreeFlags&sl)for(s=s.child;s!==null;)$0(s,o,d),s=s.sibling}function $0(s,o,d){switch(s.tag){case 26:Ei(s,o,d),s.flags&sl&&s.memoizedState!==null&&xE(d,lr,s.memoizedState,s.memoizedProps);break;case 5:Ei(s,o,d);break;case 3:case 4:var f=lr;lr=_d(s.stateNode.containerInfo),Ei(s,o,d),lr=f;break;case 22:s.memoizedState===null&&(f=s.alternate,f!==null&&f.memoizedState!==null?(f=sl,sl=16777216,Ei(s,o,d),sl=f):Ei(s,o,d));break;default:Ei(s,o,d)}}function B0(s){var o=s.alternate;if(o!==null&&(s=o.child,s!==null)){o.child=null;do o=s.sibling,s.sibling=null,s=o;while(s!==null)}}function al(s){var o=s.deletions;if((s.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var f=o[d];Ut=f,P0(f,s)}B0(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)I0(s),s=s.sibling}function I0(s){switch(s.tag){case 0:case 11:case 15:al(s),s.flags&2048&&vs(9,s,s.return);break;case 3:al(s);break;case 12:al(s);break;case 22:var o=s.stateNode;s.memoizedState!==null&&o._visibility&2&&(s.return===null||s.return.tag!==13)?(o._visibility&=-3,xd(s)):al(s);break;default:al(s)}}function xd(s){var o=s.deletions;if((s.flags&16)!==0){if(o!==null)for(var d=0;d<o.length;d++){var f=o[d];Ut=f,P0(f,s)}B0(s)}for(s=s.child;s!==null;){switch(o=s,o.tag){case 0:case 11:case 15:vs(8,o,o.return),xd(o);break;case 22:d=o.stateNode,d._visibility&2&&(d._visibility&=-3,xd(o));break;default:xd(o)}s=s.sibling}}function P0(s,o){for(;Ut!==null;){var d=Ut;switch(d.tag){case 0:case 11:case 15:vs(8,d,o);break;case 23:case 22:if(d.memoizedState!==null&&d.memoizedState.cachePool!==null){var f=d.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:Ho(d.memoizedState.cache)}if(f=d.child,f!==null)f.return=d,Ut=f;else e:for(d=s;Ut!==null;){f=Ut;var y=f.sibling,b=f.return;if(R0(f),f===d){Ut=null;break e}if(y!==null){y.return=b,Ut=y;break e}Ut=b}}}var OT={getCacheForType:function(s){var o=Kt(Tt),d=o.data.get(s);return d===void 0&&(d=s(),o.data.set(s,d)),d},cacheSignal:function(){return Kt(Tt).controller.signal}},DT=typeof WeakMap=="function"?WeakMap:Map,Ke=0,nt=null,Pe=null,Ue=0,Ye=0,_n=null,ws=!1,Ri=!1,vp=!1,Fr=0,xt=0,Ss=0,Sa=0,wp=0,Mn=0,Ai=0,il=null,vn=null,Sp=!1,bd=0,z0=0,vd=1/0,wd=null,Ns=null,Lt=0,ks=null,_i=null,Gr=0,Np=0,kp=null,U0=null,ol=0,jp=null;function On(){return(Ke&2)!==0&&Ue!==0?Ue&-Ue:O.T!==null?_p():rx()}function H0(){if(Mn===0)if((Ue&536870912)===0||Ve){var s=Rc;Rc<<=1,(Rc&3932160)===0&&(Rc=262144),Mn=s}else Mn=536870912;return s=Rn.current,s!==null&&(s.flags|=32),Mn}function wn(s,o,d){(s===nt&&(Ye===2||Ye===9)||s.cancelPendingCommit!==null)&&(Mi(s,0),js(s,Ue,Mn,!1)),Eo(s,d),((Ke&2)===0||s!==nt)&&(s===nt&&((Ke&2)===0&&(Sa|=d),xt===4&&js(s,Ue,Mn,!1)),wr(s))}function V0(s,o,d){if((Ke&6)!==0)throw Error(r(327));var f=!d&&(o&127)===0&&(o&s.expiredLanes)===0||To(s,o),y=f?BT(s,o):Tp(s,o,!0),b=f;do{if(y===0){Ri&&!f&&js(s,o,0,!1);break}else{if(d=s.current.alternate,b&&!LT(d)){y=Tp(s,o,!1),b=!1;continue}if(y===2){if(b=o,s.errorRecoveryDisabledLanes&b)var k=0;else k=s.pendingLanes&-536870913,k=k!==0?k:k&536870912?536870912:0;if(k!==0){o=k;e:{var C=s;y=il;var B=C.current.memoizedState.isDehydrated;if(B&&(Mi(C,k).flags|=256),k=Tp(C,k,!1),k!==2){if(vp&&!B){C.errorRecoveryDisabledLanes|=b,Sa|=b,y=4;break e}b=vn,vn=y,b!==null&&(vn===null?vn=b:vn.push.apply(vn,b))}y=k}if(b=!1,y!==2)continue}}if(y===1){Mi(s,0),js(s,o,0,!0);break}e:{switch(f=s,b=y,b){case 0:case 1:throw Error(r(345));case 4:if((o&4194048)!==o)break;case 6:js(f,o,Mn,!ws);break e;case 2:vn=null;break;case 3:case 5:break;default:throw Error(r(329))}if((o&62914560)===o&&(y=bd+300-kn(),10<y)){if(js(f,o,Mn,!ws),_c(f,0,!0)!==0)break e;Gr=o,f.timeoutHandle=vv(F0.bind(null,f,d,vn,wd,Sp,o,Mn,Sa,Ai,ws,b,"Throttled",-0,0),y);break e}F0(f,d,vn,wd,Sp,o,Mn,Sa,Ai,ws,b,null,-0,0)}}break}while(!0);wr(s)}function F0(s,o,d,f,y,b,k,C,B,q,ne,se,Y,ee){if(s.timeoutHandle=-1,se=o.subtreeFlags,se&8192||(se&16785408)===16785408){se={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ar},$0(o,b,se);var xe=(b&62914560)===b?bd-kn():(b&4194048)===b?z0-kn():0;if(xe=bE(se,xe),xe!==null){Gr=b,s.cancelPendingCommit=xe(X0.bind(null,s,o,b,d,f,y,k,C,B,ne,se,null,Y,ee)),js(s,b,k,!q);return}}X0(s,o,b,d,f,y,k,C,B)}function LT(s){for(var o=s;;){var d=o.tag;if((d===0||d===11||d===15)&&o.flags&16384&&(d=o.updateQueue,d!==null&&(d=d.stores,d!==null)))for(var f=0;f<d.length;f++){var y=d[f],b=y.getSnapshot;y=y.value;try{if(!Tn(b(),y))return!1}catch{return!1}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function js(s,o,d,f){o&=~wp,o&=~Sa,s.suspendedLanes|=o,s.pingedLanes&=~o,f&&(s.warmLanes|=o),f=s.expirationTimes;for(var y=o;0<y;){var b=31-Cn(y),k=1<<b;f[b]=-1,y&=~k}d!==0&&ex(s,d,o)}function Sd(){return(Ke&6)===0?(ll(0),!1):!0}function Cp(){if(Pe!==null){if(Ye===0)var s=Pe.return;else s=Pe,Dr=fa=null,Hf(s),Si=null,Fo=0,s=Pe;for(;s!==null;)w0(s.alternate,s),s=s.return;Pe=null}}function Mi(s,o){var d=s.timeoutHandle;d!==-1&&(s.timeoutHandle=-1,tE(d)),d=s.cancelPendingCommit,d!==null&&(s.cancelPendingCommit=null,d()),Gr=0,Cp(),nt=s,Pe=d=Mr(s.current,null),Ue=o,Ye=0,_n=null,ws=!1,Ri=To(s,o),vp=!1,Ai=Mn=wp=Sa=Ss=xt=0,vn=il=null,Sp=!1,(o&8)!==0&&(o|=o&32);var f=s.entangledLanes;if(f!==0)for(s=s.entanglements,f&=o;0<f;){var y=31-Cn(f),b=1<<y;o|=s[y],f&=~b}return Fr=o,Vc(),d}function G0(s,o){Oe=null,O.H=Xo,o===wi||o===Qc?(o=ob(),Ye=3):o===Af?(o=ob(),Ye=4):Ye=o===sp?8:o!==null&&typeof o=="object"&&typeof o.then=="function"?6:1,_n=o,Pe===null&&(xt=1,ud(s,Gn(o,s.current)))}function q0(){var s=Rn.current;return s===null?!0:(Ue&4194048)===Ue?Yn===null:(Ue&62914560)===Ue||(Ue&536870912)!==0?s===Yn:!1}function W0(){var s=O.H;return O.H=Xo,s===null?Xo:s}function K0(){var s=O.A;return O.A=OT,s}function Nd(){xt=4,ws||(Ue&4194048)!==Ue&&Rn.current!==null||(Ri=!0),(Ss&134217727)===0&&(Sa&134217727)===0||nt===null||js(nt,Ue,Mn,!1)}function Tp(s,o,d){var f=Ke;Ke|=2;var y=W0(),b=K0();(nt!==s||Ue!==o)&&(wd=null,Mi(s,o)),o=!1;var k=xt;e:do try{if(Ye!==0&&Pe!==null){var C=Pe,B=_n;switch(Ye){case 8:Cp(),k=6;break e;case 3:case 2:case 9:case 6:Rn.current===null&&(o=!0);var q=Ye;if(Ye=0,_n=null,Oi(s,C,B,q),d&&Ri){k=0;break e}break;default:q=Ye,Ye=0,_n=null,Oi(s,C,B,q)}}$T(),k=xt;break}catch(ne){G0(s,ne)}while(!0);return o&&s.shellSuspendCounter++,Dr=fa=null,Ke=f,O.H=y,O.A=b,Pe===null&&(nt=null,Ue=0,Vc()),k}function $T(){for(;Pe!==null;)Y0(Pe)}function BT(s,o){var d=Ke;Ke|=2;var f=W0(),y=K0();nt!==s||Ue!==o?(wd=null,vd=kn()+500,Mi(s,o)):Ri=To(s,o);e:do try{if(Ye!==0&&Pe!==null){o=Pe;var b=_n;t:switch(Ye){case 1:Ye=0,_n=null,Oi(s,o,b,1);break;case 2:case 9:if(ab(b)){Ye=0,_n=null,J0(o);break}o=function(){Ye!==2&&Ye!==9||nt!==s||(Ye=7),wr(s)},b.then(o,o);break e;case 3:Ye=7;break e;case 4:Ye=5;break e;case 7:ab(b)?(Ye=0,_n=null,J0(o)):(Ye=0,_n=null,Oi(s,o,b,7));break;case 5:var k=null;switch(Pe.tag){case 26:k=Pe.memoizedState;case 5:case 27:var C=Pe;if(k?Lv(k):C.stateNode.complete){Ye=0,_n=null;var B=C.sibling;if(B!==null)Pe=B;else{var q=C.return;q!==null?(Pe=q,kd(q)):Pe=null}break t}}Ye=0,_n=null,Oi(s,o,b,5);break;case 6:Ye=0,_n=null,Oi(s,o,b,6);break;case 8:Cp(),xt=6;break e;default:throw Error(r(462))}}IT();break}catch(ne){G0(s,ne)}while(!0);return Dr=fa=null,O.H=f,O.A=y,Ke=d,Pe!==null?0:(nt=null,Ue=0,Vc(),xt)}function IT(){for(;Pe!==null&&!oC();)Y0(Pe)}function Y0(s){var o=b0(s.alternate,s,Fr);s.memoizedProps=s.pendingProps,o===null?kd(s):Pe=o}function J0(s){var o=s,d=o.alternate;switch(o.tag){case 15:case 0:o=f0(d,o,o.pendingProps,o.type,void 0,Ue);break;case 11:o=f0(d,o,o.pendingProps,o.type.render,o.ref,Ue);break;case 5:Hf(o);default:w0(d,o),o=Pe=Kx(o,Fr),o=b0(d,o,Fr)}s.memoizedProps=s.pendingProps,o===null?kd(s):Pe=o}function Oi(s,o,d,f){Dr=fa=null,Hf(o),Si=null,Fo=0;var y=o.return;try{if(CT(s,y,o,d,Ue)){xt=1,ud(s,Gn(d,s.current)),Pe=null;return}}catch(b){if(y!==null)throw Pe=y,b;xt=1,ud(s,Gn(d,s.current)),Pe=null;return}o.flags&32768?(Ve||f===1?s=!0:Ri||(Ue&536870912)!==0?s=!1:(ws=s=!0,(f===2||f===9||f===3||f===6)&&(f=Rn.current,f!==null&&f.tag===13&&(f.flags|=16384))),Q0(o,s)):kd(o)}function kd(s){var o=s;do{if((o.flags&32768)!==0){Q0(o,ws);return}s=o.return;var d=RT(o.alternate,o,Fr);if(d!==null){Pe=d;return}if(o=o.sibling,o!==null){Pe=o;return}Pe=o=s}while(o!==null);xt===0&&(xt=5)}function Q0(s,o){do{var d=AT(s.alternate,s);if(d!==null){d.flags&=32767,Pe=d;return}if(d=s.return,d!==null&&(d.flags|=32768,d.subtreeFlags=0,d.deletions=null),!o&&(s=s.sibling,s!==null)){Pe=s;return}Pe=s=d}while(s!==null);xt=6,Pe=null}function X0(s,o,d,f,y,b,k,C,B){s.cancelPendingCommit=null;do jd();while(Lt!==0);if((Ke&6)!==0)throw Error(r(327));if(o!==null){if(o===s.current)throw Error(r(177));if(b=o.lanes|o.childLanes,b|=mf,yC(s,d,b,k,C,B),s===nt&&(Pe=nt=null,Ue=0),_i=o,ks=s,Gr=d,Np=b,kp=y,U0=f,(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,HT(Tc,function(){return rv(),null})):(s.callbackNode=null,s.callbackPriority=0),f=(o.flags&13878)!==0,(o.subtreeFlags&13878)!==0||f){f=O.T,O.T=null,y=K.p,K.p=2,k=Ke,Ke|=4;try{_T(s,o,d)}finally{Ke=k,K.p=y,O.T=f}}Lt=1,Z0(),ev(),tv()}}function Z0(){if(Lt===1){Lt=0;var s=ks,o=_i,d=(o.flags&13878)!==0;if((o.subtreeFlags&13878)!==0||d){d=O.T,O.T=null;var f=K.p;K.p=2;var y=Ke;Ke|=4;try{O0(o,s);var b=Pp,k=Px(s.containerInfo),C=b.focusedElem,B=b.selectionRange;if(k!==C&&C&&C.ownerDocument&&Ix(C.ownerDocument.documentElement,C)){if(B!==null&&df(C)){var q=B.start,ne=B.end;if(ne===void 0&&(ne=q),"selectionStart"in C)C.selectionStart=q,C.selectionEnd=Math.min(ne,C.value.length);else{var se=C.ownerDocument||document,Y=se&&se.defaultView||window;if(Y.getSelection){var ee=Y.getSelection(),xe=C.textContent.length,Ee=Math.min(B.start,xe),et=B.end===void 0?Ee:Math.min(B.end,xe);!ee.extend&&Ee>et&&(k=et,et=Ee,Ee=k);var U=Bx(C,Ee),P=Bx(C,et);if(U&&P&&(ee.rangeCount!==1||ee.anchorNode!==U.node||ee.anchorOffset!==U.offset||ee.focusNode!==P.node||ee.focusOffset!==P.offset)){var G=se.createRange();G.setStart(U.node,U.offset),ee.removeAllRanges(),Ee>et?(ee.addRange(G),ee.extend(P.node,P.offset)):(G.setEnd(P.node,P.offset),ee.addRange(G))}}}}for(se=[],ee=C;ee=ee.parentNode;)ee.nodeType===1&&se.push({element:ee,left:ee.scrollLeft,top:ee.scrollTop});for(typeof C.focus=="function"&&C.focus(),C=0;C<se.length;C++){var re=se[C];re.element.scrollLeft=re.left,re.element.scrollTop=re.top}}Bd=!!Ip,Pp=Ip=null}finally{Ke=y,K.p=f,O.T=d}}s.current=o,Lt=2}}function ev(){if(Lt===2){Lt=0;var s=ks,o=_i,d=(o.flags&8772)!==0;if((o.subtreeFlags&8772)!==0||d){d=O.T,O.T=null;var f=K.p;K.p=2;var y=Ke;Ke|=4;try{E0(s,o.alternate,o)}finally{Ke=y,K.p=f,O.T=d}}Lt=3}}function tv(){if(Lt===4||Lt===3){Lt=0,lC();var s=ks,o=_i,d=Gr,f=U0;(o.subtreeFlags&10256)!==0||(o.flags&10256)!==0?Lt=5:(Lt=0,_i=ks=null,nv(s,s.pendingLanes));var y=s.pendingLanes;if(y===0&&(Ns=null),Fh(d),o=o.stateNode,jn&&typeof jn.onCommitFiberRoot=="function")try{jn.onCommitFiberRoot(Co,o,void 0,(o.current.flags&128)===128)}catch{}if(f!==null){o=O.T,y=K.p,K.p=2,O.T=null;try{for(var b=s.onRecoverableError,k=0;k<f.length;k++){var C=f[k];b(C.value,{componentStack:C.stack})}}finally{O.T=o,K.p=y}}(Gr&3)!==0&&jd(),wr(s),y=s.pendingLanes,(d&261930)!==0&&(y&42)!==0?s===jp?ol++:(ol=0,jp=s):ol=0,ll(0)}}function nv(s,o){(s.pooledCacheLanes&=o)===0&&(o=s.pooledCache,o!=null&&(s.pooledCache=null,Ho(o)))}function jd(){return Z0(),ev(),tv(),rv()}function rv(){if(Lt!==5)return!1;var s=ks,o=Np;Np=0;var d=Fh(Gr),f=O.T,y=K.p;try{K.p=32>d?32:d,O.T=null,d=kp,kp=null;var b=ks,k=Gr;if(Lt=0,_i=ks=null,Gr=0,(Ke&6)!==0)throw Error(r(331));var C=Ke;if(Ke|=4,I0(b.current),L0(b,b.current,k,d),Ke=C,ll(0,!1),jn&&typeof jn.onPostCommitFiberRoot=="function")try{jn.onPostCommitFiberRoot(Co,b)}catch{}return!0}finally{K.p=y,O.T=f,nv(s,o)}}function sv(s,o,d){o=Gn(d,o),o=rp(s.stateNode,o,2),s=ys(s,o,2),s!==null&&(Eo(s,2),wr(s))}function Je(s,o,d){if(s.tag===3)sv(s,s,d);else for(;o!==null;){if(o.tag===3){sv(o,s,d);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Ns===null||!Ns.has(f))){s=Gn(d,s),d=a0(2),f=ys(o,d,2),f!==null&&(i0(d,f,o,s),Eo(f,2),wr(f));break}}o=o.return}}function Ep(s,o,d){var f=s.pingCache;if(f===null){f=s.pingCache=new DT;var y=new Set;f.set(o,y)}else y=f.get(o),y===void 0&&(y=new Set,f.set(o,y));y.has(d)||(vp=!0,y.add(d),s=PT.bind(null,s,o,d),o.then(s,s))}function PT(s,o,d){var f=s.pingCache;f!==null&&f.delete(o),s.pingedLanes|=s.suspendedLanes&d,s.warmLanes&=~d,nt===s&&(Ue&d)===d&&(xt===4||xt===3&&(Ue&62914560)===Ue&&300>kn()-bd?(Ke&2)===0&&Mi(s,0):wp|=d,Ai===Ue&&(Ai=0)),wr(s)}function av(s,o){o===0&&(o=Zy()),s=da(s,o),s!==null&&(Eo(s,o),wr(s))}function zT(s){var o=s.memoizedState,d=0;o!==null&&(d=o.retryLane),av(s,d)}function UT(s,o){var d=0;switch(s.tag){case 31:case 13:var f=s.stateNode,y=s.memoizedState;y!==null&&(d=y.retryLane);break;case 19:f=s.stateNode;break;case 22:f=s.stateNode._retryCache;break;default:throw Error(r(314))}f!==null&&f.delete(o),av(s,d)}function HT(s,o){return zh(s,o)}var Cd=null,Di=null,Rp=!1,Td=!1,Ap=!1,Cs=0;function wr(s){s!==Di&&s.next===null&&(Di===null?Cd=Di=s:Di=Di.next=s),Td=!0,Rp||(Rp=!0,FT())}function ll(s,o){if(!Ap&&Td){Ap=!0;do for(var d=!1,f=Cd;f!==null;){if(s!==0){var y=f.pendingLanes;if(y===0)var b=0;else{var k=f.suspendedLanes,C=f.pingedLanes;b=(1<<31-Cn(42|s)+1)-1,b&=y&~(k&~C),b=b&201326741?b&201326741|1:b?b|2:0}b!==0&&(d=!0,cv(f,b))}else b=Ue,b=_c(f,f===nt?b:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(b&3)===0||To(f,b)||(d=!0,cv(f,b));f=f.next}while(d);Ap=!1}}function VT(){iv()}function iv(){Td=Rp=!1;var s=0;Cs!==0&&eE()&&(s=Cs);for(var o=kn(),d=null,f=Cd;f!==null;){var y=f.next,b=ov(f,o);b===0?(f.next=null,d===null?Cd=y:d.next=y,y===null&&(Di=d)):(d=f,(s!==0||(b&3)!==0)&&(Td=!0)),f=y}Lt!==0&&Lt!==5||ll(s),Cs!==0&&(Cs=0)}function ov(s,o){for(var d=s.suspendedLanes,f=s.pingedLanes,y=s.expirationTimes,b=s.pendingLanes&-62914561;0<b;){var k=31-Cn(b),C=1<<k,B=y[k];B===-1?((C&d)===0||(C&f)!==0)&&(y[k]=gC(C,o)):B<=o&&(s.expiredLanes|=C),b&=~C}if(o=nt,d=Ue,d=_c(s,s===o?d:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f=s.callbackNode,d===0||s===o&&(Ye===2||Ye===9)||s.cancelPendingCommit!==null)return f!==null&&f!==null&&Uh(f),s.callbackNode=null,s.callbackPriority=0;if((d&3)===0||To(s,d)){if(o=d&-d,o===s.callbackPriority)return o;switch(f!==null&&Uh(f),Fh(d)){case 2:case 8:d=Qy;break;case 32:d=Tc;break;case 268435456:d=Xy;break;default:d=Tc}return f=lv.bind(null,s),d=zh(d,f),s.callbackPriority=o,s.callbackNode=d,o}return f!==null&&f!==null&&Uh(f),s.callbackPriority=2,s.callbackNode=null,2}function lv(s,o){if(Lt!==0&&Lt!==5)return s.callbackNode=null,s.callbackPriority=0,null;var d=s.callbackNode;if(jd()&&s.callbackNode!==d)return null;var f=Ue;return f=_c(s,s===nt?f:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),f===0?null:(V0(s,f,o),ov(s,kn()),s.callbackNode!=null&&s.callbackNode===d?lv.bind(null,s):null)}function cv(s,o){if(jd())return null;V0(s,o,!0)}function FT(){nE(function(){(Ke&6)!==0?zh(Jy,VT):iv()})}function _p(){if(Cs===0){var s=bi;s===0&&(s=Ec,Ec<<=1,(Ec&261888)===0&&(Ec=256)),Cs=s}return Cs}function dv(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:Lc(""+s)}function uv(s,o){var d=o.ownerDocument.createElement("input");return d.name=o.name,d.value=o.value,s.id&&d.setAttribute("form",s.id),o.parentNode.insertBefore(d,o),s=new FormData(s),d.parentNode.removeChild(d),s}function GT(s,o,d,f,y){if(o==="submit"&&d&&d.stateNode===y){var b=dv((y[mn]||null).action),k=f.submitter;k&&(o=(o=k[mn]||null)?dv(o.formAction):k.getAttribute("formAction"),o!==null&&(b=o,k=null));var C=new Pc("action","action",null,f,y);s.push({event:C,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(Cs!==0){var B=k?uv(y,k):new FormData(y);Qf(d,{pending:!0,data:B,method:y.method,action:b},null,B)}}else typeof b=="function"&&(C.preventDefault(),B=k?uv(y,k):new FormData(y),Qf(d,{pending:!0,data:B,method:y.method,action:b},b,B))},currentTarget:y}]})}}for(var Mp=0;Mp<pf.length;Mp++){var Op=pf[Mp],qT=Op.toLowerCase(),WT=Op[0].toUpperCase()+Op.slice(1);or(qT,"on"+WT)}or(Hx,"onAnimationEnd"),or(Vx,"onAnimationIteration"),or(Fx,"onAnimationStart"),or("dblclick","onDoubleClick"),or("focusin","onFocus"),or("focusout","onBlur"),or(cT,"onTransitionRun"),or(dT,"onTransitionStart"),or(uT,"onTransitionCancel"),or(Gx,"onTransitionEnd"),ai("onMouseEnter",["mouseout","mouseover"]),ai("onMouseLeave",["mouseout","mouseover"]),ai("onPointerEnter",["pointerout","pointerover"]),ai("onPointerLeave",["pointerout","pointerover"]),ia("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ia("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ia("onBeforeInput",["compositionend","keypress","textInput","paste"]),ia("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ia("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ia("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),KT=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(cl));function hv(s,o){o=(o&4)!==0;for(var d=0;d<s.length;d++){var f=s[d],y=f.event;f=f.listeners;e:{var b=void 0;if(o)for(var k=f.length-1;0<=k;k--){var C=f[k],B=C.instance,q=C.currentTarget;if(C=C.listener,B!==b&&y.isPropagationStopped())break e;b=C,y.currentTarget=q;try{b(y)}catch(ne){Hc(ne)}y.currentTarget=null,b=B}else for(k=0;k<f.length;k++){if(C=f[k],B=C.instance,q=C.currentTarget,C=C.listener,B!==b&&y.isPropagationStopped())break e;b=C,y.currentTarget=q;try{b(y)}catch(ne){Hc(ne)}y.currentTarget=null,b=B}}}}function ze(s,o){var d=o[Gh];d===void 0&&(d=o[Gh]=new Set);var f=s+"__bubble";d.has(f)||(fv(o,s,2,!1),d.add(f))}function Dp(s,o,d){var f=0;o&&(f|=4),fv(d,s,f,o)}var Ed="_reactListening"+Math.random().toString(36).slice(2);function Lp(s){if(!s[Ed]){s[Ed]=!0,ix.forEach(function(d){d!=="selectionchange"&&(KT.has(d)||Dp(d,!1,s),Dp(d,!0,s))});var o=s.nodeType===9?s:s.ownerDocument;o===null||o[Ed]||(o[Ed]=!0,Dp("selectionchange",!1,o))}}function fv(s,o,d,f){switch(Hv(o)){case 2:var y=SE;break;case 8:y=NE;break;default:y=Jp}d=y.bind(null,o,d,s),y=void 0,!ef||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(y=!0),f?y!==void 0?s.addEventListener(o,d,{capture:!0,passive:y}):s.addEventListener(o,d,!0):y!==void 0?s.addEventListener(o,d,{passive:y}):s.addEventListener(o,d,!1)}function $p(s,o,d,f,y){var b=f;if((o&1)===0&&(o&2)===0&&f!==null)e:for(;;){if(f===null)return;var k=f.tag;if(k===3||k===4){var C=f.stateNode.containerInfo;if(C===y)break;if(k===4)for(k=f.return;k!==null;){var B=k.tag;if((B===3||B===4)&&k.stateNode.containerInfo===y)return;k=k.return}for(;C!==null;){if(k=ni(C),k===null)return;if(B=k.tag,B===5||B===6||B===26||B===27){f=b=k;continue e}C=C.parentNode}}f=f.return}xx(function(){var q=b,ne=Xh(d),se=[];e:{var Y=qx.get(s);if(Y!==void 0){var ee=Pc,xe=s;switch(s){case"keypress":if(Bc(d)===0)break e;case"keydown":case"keyup":ee=UC;break;case"focusin":xe="focus",ee=sf;break;case"focusout":xe="blur",ee=sf;break;case"beforeblur":case"afterblur":ee=sf;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ee=wx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ee=RC;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ee=FC;break;case Hx:case Vx:case Fx:ee=MC;break;case Gx:ee=qC;break;case"scroll":case"scrollend":ee=TC;break;case"wheel":ee=KC;break;case"copy":case"cut":case"paste":ee=DC;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ee=Nx;break;case"toggle":case"beforetoggle":ee=JC}var Ee=(o&4)!==0,et=!Ee&&(s==="scroll"||s==="scrollend"),U=Ee?Y!==null?Y+"Capture":null:Y;Ee=[];for(var P=q,G;P!==null;){var re=P;if(G=re.stateNode,re=re.tag,re!==5&&re!==26&&re!==27||G===null||U===null||(re=_o(P,U),re!=null&&Ee.push(dl(P,re,G))),et)break;P=P.return}0<Ee.length&&(Y=new ee(Y,xe,null,d,ne),se.push({event:Y,listeners:Ee}))}}if((o&7)===0){e:{if(Y=s==="mouseover"||s==="pointerover",ee=s==="mouseout"||s==="pointerout",Y&&d!==Qh&&(xe=d.relatedTarget||d.fromElement)&&(ni(xe)||xe[ti]))break e;if((ee||Y)&&(Y=ne.window===ne?ne:(Y=ne.ownerDocument)?Y.defaultView||Y.parentWindow:window,ee?(xe=d.relatedTarget||d.toElement,ee=q,xe=xe?ni(xe):null,xe!==null&&(et=i(xe),Ee=xe.tag,xe!==et||Ee!==5&&Ee!==27&&Ee!==6)&&(xe=null)):(ee=null,xe=q),ee!==xe)){if(Ee=wx,re="onMouseLeave",U="onMouseEnter",P="mouse",(s==="pointerout"||s==="pointerover")&&(Ee=Nx,re="onPointerLeave",U="onPointerEnter",P="pointer"),et=ee==null?Y:Ao(ee),G=xe==null?Y:Ao(xe),Y=new Ee(re,P+"leave",ee,d,ne),Y.target=et,Y.relatedTarget=G,re=null,ni(ne)===q&&(Ee=new Ee(U,P+"enter",xe,d,ne),Ee.target=G,Ee.relatedTarget=et,re=Ee),et=re,ee&&xe)t:{for(Ee=YT,U=ee,P=xe,G=0,re=U;re;re=Ee(re))G++;re=0;for(var je=P;je;je=Ee(je))re++;for(;0<G-re;)U=Ee(U),G--;for(;0<re-G;)P=Ee(P),re--;for(;G--;){if(U===P||P!==null&&U===P.alternate){Ee=U;break t}U=Ee(U),P=Ee(P)}Ee=null}else Ee=null;ee!==null&&pv(se,Y,ee,Ee,!1),xe!==null&&et!==null&&pv(se,et,xe,Ee,!0)}}e:{if(Y=q?Ao(q):window,ee=Y.nodeName&&Y.nodeName.toLowerCase(),ee==="select"||ee==="input"&&Y.type==="file")var qe=_x;else if(Rx(Y))if(Mx)qe=iT;else{qe=sT;var Se=rT}else ee=Y.nodeName,!ee||ee.toLowerCase()!=="input"||Y.type!=="checkbox"&&Y.type!=="radio"?q&&Jh(q.elementType)&&(qe=_x):qe=aT;if(qe&&(qe=qe(s,q))){Ax(se,qe,d,ne);break e}Se&&Se(s,Y,q),s==="focusout"&&q&&Y.type==="number"&&q.memoizedProps.value!=null&&Yh(Y,"number",Y.value)}switch(Se=q?Ao(q):window,s){case"focusin":(Rx(Se)||Se.contentEditable==="true")&&(ui=Se,uf=q,Po=null);break;case"focusout":Po=uf=ui=null;break;case"mousedown":hf=!0;break;case"contextmenu":case"mouseup":case"dragend":hf=!1,zx(se,d,ne);break;case"selectionchange":if(lT)break;case"keydown":case"keyup":zx(se,d,ne)}var De;if(of)e:{switch(s){case"compositionstart":var He="onCompositionStart";break e;case"compositionend":He="onCompositionEnd";break e;case"compositionupdate":He="onCompositionUpdate";break e}He=void 0}else di?Tx(s,d)&&(He="onCompositionEnd"):s==="keydown"&&d.keyCode===229&&(He="onCompositionStart");He&&(kx&&d.locale!=="ko"&&(di||He!=="onCompositionStart"?He==="onCompositionEnd"&&di&&(De=bx()):(ds=ne,tf="value"in ds?ds.value:ds.textContent,di=!0)),Se=Rd(q,He),0<Se.length&&(He=new Sx(He,s,null,d,ne),se.push({event:He,listeners:Se}),De?He.data=De:(De=Ex(d),De!==null&&(He.data=De)))),(De=XC?ZC(s,d):eT(s,d))&&(He=Rd(q,"onBeforeInput"),0<He.length&&(Se=new Sx("onBeforeInput","beforeinput",null,d,ne),se.push({event:Se,listeners:He}),Se.data=De)),GT(se,s,q,d,ne)}hv(se,o)})}function dl(s,o,d){return{instance:s,listener:o,currentTarget:d}}function Rd(s,o){for(var d=o+"Capture",f=[];s!==null;){var y=s,b=y.stateNode;if(y=y.tag,y!==5&&y!==26&&y!==27||b===null||(y=_o(s,d),y!=null&&f.unshift(dl(s,y,b)),y=_o(s,o),y!=null&&f.push(dl(s,y,b))),s.tag===3)return f;s=s.return}return[]}function YT(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function pv(s,o,d,f,y){for(var b=o._reactName,k=[];d!==null&&d!==f;){var C=d,B=C.alternate,q=C.stateNode;if(C=C.tag,B!==null&&B===f)break;C!==5&&C!==26&&C!==27||q===null||(B=q,y?(q=_o(d,b),q!=null&&k.unshift(dl(d,q,B))):y||(q=_o(d,b),q!=null&&k.push(dl(d,q,B)))),d=d.return}k.length!==0&&s.push({event:o,listeners:k})}var JT=/\r\n?/g,QT=/\u0000|\uFFFD/g;function mv(s){return(typeof s=="string"?s:""+s).replace(JT,`
`).replace(QT,"")}function gv(s,o){return o=mv(o),mv(s)===o}function Ze(s,o,d,f,y,b){switch(d){case"children":typeof f=="string"?o==="body"||o==="textarea"&&f===""||oi(s,f):(typeof f=="number"||typeof f=="bigint")&&o!=="body"&&oi(s,""+f);break;case"className":Oc(s,"class",f);break;case"tabIndex":Oc(s,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Oc(s,d,f);break;case"style":gx(s,f,b);break;case"data":if(o!=="object"){Oc(s,"data",f);break}case"src":case"href":if(f===""&&(o!=="a"||d!=="href")){s.removeAttribute(d);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(d);break}f=Lc(""+f),s.setAttribute(d,f);break;case"action":case"formAction":if(typeof f=="function"){s.setAttribute(d,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof b=="function"&&(d==="formAction"?(o!=="input"&&Ze(s,o,"name",y.name,y,null),Ze(s,o,"formEncType",y.formEncType,y,null),Ze(s,o,"formMethod",y.formMethod,y,null),Ze(s,o,"formTarget",y.formTarget,y,null)):(Ze(s,o,"encType",y.encType,y,null),Ze(s,o,"method",y.method,y,null),Ze(s,o,"target",y.target,y,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){s.removeAttribute(d);break}f=Lc(""+f),s.setAttribute(d,f);break;case"onClick":f!=null&&(s.onclick=Ar);break;case"onScroll":f!=null&&ze("scroll",s);break;case"onScrollEnd":f!=null&&ze("scrollend",s);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(d=f.__html,d!=null){if(y.children!=null)throw Error(r(60));s.innerHTML=d}}break;case"multiple":s.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":s.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){s.removeAttribute("xlink:href");break}d=Lc(""+f),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",d);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(d,""+f):s.removeAttribute(d);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(d,""):s.removeAttribute(d);break;case"capture":case"download":f===!0?s.setAttribute(d,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?s.setAttribute(d,f):s.removeAttribute(d);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?s.setAttribute(d,f):s.removeAttribute(d);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?s.removeAttribute(d):s.setAttribute(d,f);break;case"popover":ze("beforetoggle",s),ze("toggle",s),Mc(s,"popover",f);break;case"xlinkActuate":Rr(s,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":Rr(s,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":Rr(s,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":Rr(s,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":Rr(s,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":Rr(s,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":Rr(s,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":Rr(s,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":Rr(s,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Mc(s,"is",f);break;case"innerText":case"textContent":break;default:(!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(d=jC.get(d)||d,Mc(s,d,f))}}function Bp(s,o,d,f,y,b){switch(d){case"style":gx(s,f,b);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(r(61));if(d=f.__html,d!=null){if(y.children!=null)throw Error(r(60));s.innerHTML=d}}break;case"children":typeof f=="string"?oi(s,f):(typeof f=="number"||typeof f=="bigint")&&oi(s,""+f);break;case"onScroll":f!=null&&ze("scroll",s);break;case"onScrollEnd":f!=null&&ze("scrollend",s);break;case"onClick":f!=null&&(s.onclick=Ar);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!ox.hasOwnProperty(d))e:{if(d[0]==="o"&&d[1]==="n"&&(y=d.endsWith("Capture"),o=d.slice(2,y?d.length-7:void 0),b=s[mn]||null,b=b!=null?b[d]:null,typeof b=="function"&&s.removeEventListener(o,b,y),typeof f=="function")){typeof b!="function"&&b!==null&&(d in s?s[d]=null:s.hasAttribute(d)&&s.removeAttribute(d)),s.addEventListener(o,f,y);break e}d in s?s[d]=f:f===!0?s.setAttribute(d,""):Mc(s,d,f)}}}function Jt(s,o,d){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":ze("error",s),ze("load",s);var f=!1,y=!1,b;for(b in d)if(d.hasOwnProperty(b)){var k=d[b];if(k!=null)switch(b){case"src":f=!0;break;case"srcSet":y=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,o));default:Ze(s,o,b,k,d,null)}}y&&Ze(s,o,"srcSet",d.srcSet,d,null),f&&Ze(s,o,"src",d.src,d,null);return;case"input":ze("invalid",s);var C=b=k=y=null,B=null,q=null;for(f in d)if(d.hasOwnProperty(f)){var ne=d[f];if(ne!=null)switch(f){case"name":y=ne;break;case"type":k=ne;break;case"checked":B=ne;break;case"defaultChecked":q=ne;break;case"value":b=ne;break;case"defaultValue":C=ne;break;case"children":case"dangerouslySetInnerHTML":if(ne!=null)throw Error(r(137,o));break;default:Ze(s,o,f,ne,d,null)}}hx(s,b,C,B,q,k,y,!1);return;case"select":ze("invalid",s),f=k=b=null;for(y in d)if(d.hasOwnProperty(y)&&(C=d[y],C!=null))switch(y){case"value":b=C;break;case"defaultValue":k=C;break;case"multiple":f=C;default:Ze(s,o,y,C,d,null)}o=b,d=k,s.multiple=!!f,o!=null?ii(s,!!f,o,!1):d!=null&&ii(s,!!f,d,!0);return;case"textarea":ze("invalid",s),b=y=f=null;for(k in d)if(d.hasOwnProperty(k)&&(C=d[k],C!=null))switch(k){case"value":f=C;break;case"defaultValue":y=C;break;case"children":b=C;break;case"dangerouslySetInnerHTML":if(C!=null)throw Error(r(91));break;default:Ze(s,o,k,C,d,null)}px(s,f,y,b);return;case"option":for(B in d)d.hasOwnProperty(B)&&(f=d[B],f!=null)&&(B==="selected"?s.selected=f&&typeof f!="function"&&typeof f!="symbol":Ze(s,o,B,f,d,null));return;case"dialog":ze("beforetoggle",s),ze("toggle",s),ze("cancel",s),ze("close",s);break;case"iframe":case"object":ze("load",s);break;case"video":case"audio":for(f=0;f<cl.length;f++)ze(cl[f],s);break;case"image":ze("error",s),ze("load",s);break;case"details":ze("toggle",s);break;case"embed":case"source":case"link":ze("error",s),ze("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(q in d)if(d.hasOwnProperty(q)&&(f=d[q],f!=null))switch(q){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,o));default:Ze(s,o,q,f,d,null)}return;default:if(Jh(o)){for(ne in d)d.hasOwnProperty(ne)&&(f=d[ne],f!==void 0&&Bp(s,o,ne,f,d,void 0));return}}for(C in d)d.hasOwnProperty(C)&&(f=d[C],f!=null&&Ze(s,o,C,f,d,null))}function XT(s,o,d,f){switch(o){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var y=null,b=null,k=null,C=null,B=null,q=null,ne=null;for(ee in d){var se=d[ee];if(d.hasOwnProperty(ee)&&se!=null)switch(ee){case"checked":break;case"value":break;case"defaultValue":B=se;default:f.hasOwnProperty(ee)||Ze(s,o,ee,null,f,se)}}for(var Y in f){var ee=f[Y];if(se=d[Y],f.hasOwnProperty(Y)&&(ee!=null||se!=null))switch(Y){case"type":b=ee;break;case"name":y=ee;break;case"checked":q=ee;break;case"defaultChecked":ne=ee;break;case"value":k=ee;break;case"defaultValue":C=ee;break;case"children":case"dangerouslySetInnerHTML":if(ee!=null)throw Error(r(137,o));break;default:ee!==se&&Ze(s,o,Y,ee,f,se)}}Kh(s,k,C,B,q,ne,b,y);return;case"select":ee=k=C=Y=null;for(b in d)if(B=d[b],d.hasOwnProperty(b)&&B!=null)switch(b){case"value":break;case"multiple":ee=B;default:f.hasOwnProperty(b)||Ze(s,o,b,null,f,B)}for(y in f)if(b=f[y],B=d[y],f.hasOwnProperty(y)&&(b!=null||B!=null))switch(y){case"value":Y=b;break;case"defaultValue":C=b;break;case"multiple":k=b;default:b!==B&&Ze(s,o,y,b,f,B)}o=C,d=k,f=ee,Y!=null?ii(s,!!d,Y,!1):!!f!=!!d&&(o!=null?ii(s,!!d,o,!0):ii(s,!!d,d?[]:"",!1));return;case"textarea":ee=Y=null;for(C in d)if(y=d[C],d.hasOwnProperty(C)&&y!=null&&!f.hasOwnProperty(C))switch(C){case"value":break;case"children":break;default:Ze(s,o,C,null,f,y)}for(k in f)if(y=f[k],b=d[k],f.hasOwnProperty(k)&&(y!=null||b!=null))switch(k){case"value":Y=y;break;case"defaultValue":ee=y;break;case"children":break;case"dangerouslySetInnerHTML":if(y!=null)throw Error(r(91));break;default:y!==b&&Ze(s,o,k,y,f,b)}fx(s,Y,ee);return;case"option":for(var xe in d)Y=d[xe],d.hasOwnProperty(xe)&&Y!=null&&!f.hasOwnProperty(xe)&&(xe==="selected"?s.selected=!1:Ze(s,o,xe,null,f,Y));for(B in f)Y=f[B],ee=d[B],f.hasOwnProperty(B)&&Y!==ee&&(Y!=null||ee!=null)&&(B==="selected"?s.selected=Y&&typeof Y!="function"&&typeof Y!="symbol":Ze(s,o,B,Y,f,ee));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ee in d)Y=d[Ee],d.hasOwnProperty(Ee)&&Y!=null&&!f.hasOwnProperty(Ee)&&Ze(s,o,Ee,null,f,Y);for(q in f)if(Y=f[q],ee=d[q],f.hasOwnProperty(q)&&Y!==ee&&(Y!=null||ee!=null))switch(q){case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(r(137,o));break;default:Ze(s,o,q,Y,f,ee)}return;default:if(Jh(o)){for(var et in d)Y=d[et],d.hasOwnProperty(et)&&Y!==void 0&&!f.hasOwnProperty(et)&&Bp(s,o,et,void 0,f,Y);for(ne in f)Y=f[ne],ee=d[ne],!f.hasOwnProperty(ne)||Y===ee||Y===void 0&&ee===void 0||Bp(s,o,ne,Y,f,ee);return}}for(var U in d)Y=d[U],d.hasOwnProperty(U)&&Y!=null&&!f.hasOwnProperty(U)&&Ze(s,o,U,null,f,Y);for(se in f)Y=f[se],ee=d[se],!f.hasOwnProperty(se)||Y===ee||Y==null&&ee==null||Ze(s,o,se,Y,f,ee)}function yv(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ZT(){if(typeof performance.getEntriesByType=="function"){for(var s=0,o=0,d=performance.getEntriesByType("resource"),f=0;f<d.length;f++){var y=d[f],b=y.transferSize,k=y.initiatorType,C=y.duration;if(b&&C&&yv(k)){for(k=0,C=y.responseEnd,f+=1;f<d.length;f++){var B=d[f],q=B.startTime;if(q>C)break;var ne=B.transferSize,se=B.initiatorType;ne&&yv(se)&&(B=B.responseEnd,k+=ne*(B<C?1:(C-q)/(B-q)))}if(--f,o+=8*(b+k)/(y.duration/1e3),s++,10<s)break}}if(0<s)return o/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var Ip=null,Pp=null;function Ad(s){return s.nodeType===9?s:s.ownerDocument}function xv(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function bv(s,o){if(s===0)switch(o){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&o==="foreignObject"?0:s}function zp(s,o){return s==="textarea"||s==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.children=="bigint"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Up=null;function eE(){var s=window.event;return s&&s.type==="popstate"?s===Up?!1:(Up=s,!0):(Up=null,!1)}var vv=typeof setTimeout=="function"?setTimeout:void 0,tE=typeof clearTimeout=="function"?clearTimeout:void 0,wv=typeof Promise=="function"?Promise:void 0,nE=typeof queueMicrotask=="function"?queueMicrotask:typeof wv<"u"?function(s){return wv.resolve(null).then(s).catch(rE)}:vv;function rE(s){setTimeout(function(){throw s})}function Ts(s){return s==="head"}function Sv(s,o){var d=o,f=0;do{var y=d.nextSibling;if(s.removeChild(d),y&&y.nodeType===8)if(d=y.data,d==="/$"||d==="/&"){if(f===0){s.removeChild(y),Ii(o);return}f--}else if(d==="$"||d==="$?"||d==="$~"||d==="$!"||d==="&")f++;else if(d==="html")ul(s.ownerDocument.documentElement);else if(d==="head"){d=s.ownerDocument.head,ul(d);for(var b=d.firstChild;b;){var k=b.nextSibling,C=b.nodeName;b[Ro]||C==="SCRIPT"||C==="STYLE"||C==="LINK"&&b.rel.toLowerCase()==="stylesheet"||d.removeChild(b),b=k}}else d==="body"&&ul(s.ownerDocument.body);d=y}while(d);Ii(o)}function Nv(s,o){var d=s;s=0;do{var f=d.nextSibling;if(d.nodeType===1?o?(d._stashedDisplay=d.style.display,d.style.display="none"):(d.style.display=d._stashedDisplay||"",d.getAttribute("style")===""&&d.removeAttribute("style")):d.nodeType===3&&(o?(d._stashedText=d.nodeValue,d.nodeValue=""):d.nodeValue=d._stashedText||""),f&&f.nodeType===8)if(d=f.data,d==="/$"){if(s===0)break;s--}else d!=="$"&&d!=="$?"&&d!=="$~"&&d!=="$!"||s++;d=f}while(d)}function Hp(s){var o=s.firstChild;for(o&&o.nodeType===10&&(o=o.nextSibling);o;){var d=o;switch(o=o.nextSibling,d.nodeName){case"HTML":case"HEAD":case"BODY":Hp(d),qh(d);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(d.rel.toLowerCase()==="stylesheet")continue}s.removeChild(d)}}function sE(s,o,d,f){for(;s.nodeType===1;){var y=d;if(s.nodeName.toLowerCase()!==o.toLowerCase()){if(!f&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(f){if(!s[Ro])switch(o){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(b=s.getAttribute("rel"),b==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(b!==y.rel||s.getAttribute("href")!==(y.href==null||y.href===""?null:y.href)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin)||s.getAttribute("title")!==(y.title==null?null:y.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(b=s.getAttribute("src"),(b!==(y.src==null?null:y.src)||s.getAttribute("type")!==(y.type==null?null:y.type)||s.getAttribute("crossorigin")!==(y.crossOrigin==null?null:y.crossOrigin))&&b&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(o==="input"&&s.type==="hidden"){var b=y.name==null?null:""+y.name;if(y.type==="hidden"&&s.getAttribute("name")===b)return s}else return s;if(s=Jn(s.nextSibling),s===null)break}return null}function aE(s,o,d){if(o==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!d||(s=Jn(s.nextSibling),s===null))return null;return s}function kv(s,o){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!o||(s=Jn(s.nextSibling),s===null))return null;return s}function Vp(s){return s.data==="$?"||s.data==="$~"}function Fp(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function iE(s,o){var d=s.ownerDocument;if(s.data==="$~")s._reactRetry=o;else if(s.data!=="$?"||d.readyState!=="loading")o();else{var f=function(){o(),d.removeEventListener("DOMContentLoaded",f)};d.addEventListener("DOMContentLoaded",f),s._reactRetry=f}}function Jn(s){for(;s!=null;s=s.nextSibling){var o=s.nodeType;if(o===1||o===3)break;if(o===8){if(o=s.data,o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"||o==="F!"||o==="F")break;if(o==="/$"||o==="/&")return null}}return s}var Gp=null;function jv(s){s=s.nextSibling;for(var o=0;s;){if(s.nodeType===8){var d=s.data;if(d==="/$"||d==="/&"){if(o===0)return Jn(s.nextSibling);o--}else d!=="$"&&d!=="$!"&&d!=="$?"&&d!=="$~"&&d!=="&"||o++}s=s.nextSibling}return null}function Cv(s){s=s.previousSibling;for(var o=0;s;){if(s.nodeType===8){var d=s.data;if(d==="$"||d==="$!"||d==="$?"||d==="$~"||d==="&"){if(o===0)return s;o--}else d!=="/$"&&d!=="/&"||o++}s=s.previousSibling}return null}function Tv(s,o,d){switch(o=Ad(d),s){case"html":if(s=o.documentElement,!s)throw Error(r(452));return s;case"head":if(s=o.head,!s)throw Error(r(453));return s;case"body":if(s=o.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function ul(s){for(var o=s.attributes;o.length;)s.removeAttributeNode(o[0]);qh(s)}var Qn=new Map,Ev=new Set;function _d(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var qr=K.d;K.d={f:oE,r:lE,D:cE,C:dE,L:uE,m:hE,X:pE,S:fE,M:mE};function oE(){var s=qr.f(),o=Sd();return s||o}function lE(s){var o=ri(s);o!==null&&o.tag===5&&o.type==="form"?Gb(o):qr.r(s)}var Li=typeof document>"u"?null:document;function Rv(s,o,d){var f=Li;if(f&&typeof o=="string"&&o){var y=Vn(o);y='link[rel="'+s+'"][href="'+y+'"]',typeof d=="string"&&(y+='[crossorigin="'+d+'"]'),Ev.has(y)||(Ev.add(y),s={rel:s,crossOrigin:d,href:o},f.querySelector(y)===null&&(o=f.createElement("link"),Jt(o,"link",s),zt(o),f.head.appendChild(o)))}}function cE(s){qr.D(s),Rv("dns-prefetch",s,null)}function dE(s,o){qr.C(s,o),Rv("preconnect",s,o)}function uE(s,o,d){qr.L(s,o,d);var f=Li;if(f&&s&&o){var y='link[rel="preload"][as="'+Vn(o)+'"]';o==="image"&&d&&d.imageSrcSet?(y+='[imagesrcset="'+Vn(d.imageSrcSet)+'"]',typeof d.imageSizes=="string"&&(y+='[imagesizes="'+Vn(d.imageSizes)+'"]')):y+='[href="'+Vn(s)+'"]';var b=y;switch(o){case"style":b=$i(s);break;case"script":b=Bi(s)}Qn.has(b)||(s=g({rel:"preload",href:o==="image"&&d&&d.imageSrcSet?void 0:s,as:o},d),Qn.set(b,s),f.querySelector(y)!==null||o==="style"&&f.querySelector(hl(b))||o==="script"&&f.querySelector(fl(b))||(o=f.createElement("link"),Jt(o,"link",s),zt(o),f.head.appendChild(o)))}}function hE(s,o){qr.m(s,o);var d=Li;if(d&&s){var f=o&&typeof o.as=="string"?o.as:"script",y='link[rel="modulepreload"][as="'+Vn(f)+'"][href="'+Vn(s)+'"]',b=y;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":b=Bi(s)}if(!Qn.has(b)&&(s=g({rel:"modulepreload",href:s},o),Qn.set(b,s),d.querySelector(y)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(d.querySelector(fl(b)))return}f=d.createElement("link"),Jt(f,"link",s),zt(f),d.head.appendChild(f)}}}function fE(s,o,d){qr.S(s,o,d);var f=Li;if(f&&s){var y=si(f).hoistableStyles,b=$i(s);o=o||"default";var k=y.get(b);if(!k){var C={loading:0,preload:null};if(k=f.querySelector(hl(b)))C.loading=5;else{s=g({rel:"stylesheet",href:s,"data-precedence":o},d),(d=Qn.get(b))&&qp(s,d);var B=k=f.createElement("link");zt(B),Jt(B,"link",s),B._p=new Promise(function(q,ne){B.onload=q,B.onerror=ne}),B.addEventListener("load",function(){C.loading|=1}),B.addEventListener("error",function(){C.loading|=2}),C.loading|=4,Md(k,o,f)}k={type:"stylesheet",instance:k,count:1,state:C},y.set(b,k)}}}function pE(s,o){qr.X(s,o);var d=Li;if(d&&s){var f=si(d).hoistableScripts,y=Bi(s),b=f.get(y);b||(b=d.querySelector(fl(y)),b||(s=g({src:s,async:!0},o),(o=Qn.get(y))&&Wp(s,o),b=d.createElement("script"),zt(b),Jt(b,"link",s),d.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},f.set(y,b))}}function mE(s,o){qr.M(s,o);var d=Li;if(d&&s){var f=si(d).hoistableScripts,y=Bi(s),b=f.get(y);b||(b=d.querySelector(fl(y)),b||(s=g({src:s,async:!0,type:"module"},o),(o=Qn.get(y))&&Wp(s,o),b=d.createElement("script"),zt(b),Jt(b,"link",s),d.head.appendChild(b)),b={type:"script",instance:b,count:1,state:null},f.set(y,b))}}function Av(s,o,d,f){var y=(y=fe.current)?_d(y):null;if(!y)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof d.precedence=="string"&&typeof d.href=="string"?(o=$i(d.href),d=si(y).hoistableStyles,f=d.get(o),f||(f={type:"style",instance:null,count:0,state:null},d.set(o,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(d.rel==="stylesheet"&&typeof d.href=="string"&&typeof d.precedence=="string"){s=$i(d.href);var b=si(y).hoistableStyles,k=b.get(s);if(k||(y=y.ownerDocument||y,k={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},b.set(s,k),(b=y.querySelector(hl(s)))&&!b._p&&(k.instance=b,k.state.loading=5),Qn.has(s)||(d={rel:"preload",as:"style",href:d.href,crossOrigin:d.crossOrigin,integrity:d.integrity,media:d.media,hrefLang:d.hrefLang,referrerPolicy:d.referrerPolicy},Qn.set(s,d),b||gE(y,s,d,k.state))),o&&f===null)throw Error(r(528,""));return k}if(o&&f!==null)throw Error(r(529,""));return null;case"script":return o=d.async,d=d.src,typeof d=="string"&&o&&typeof o!="function"&&typeof o!="symbol"?(o=Bi(d),d=si(y).hoistableScripts,f=d.get(o),f||(f={type:"script",instance:null,count:0,state:null},d.set(o,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function $i(s){return'href="'+Vn(s)+'"'}function hl(s){return'link[rel="stylesheet"]['+s+"]"}function _v(s){return g({},s,{"data-precedence":s.precedence,precedence:null})}function gE(s,o,d,f){s.querySelector('link[rel="preload"][as="style"]['+o+"]")?f.loading=1:(o=s.createElement("link"),f.preload=o,o.addEventListener("load",function(){return f.loading|=1}),o.addEventListener("error",function(){return f.loading|=2}),Jt(o,"link",d),zt(o),s.head.appendChild(o))}function Bi(s){return'[src="'+Vn(s)+'"]'}function fl(s){return"script[async]"+s}function Mv(s,o,d){if(o.count++,o.instance===null)switch(o.type){case"style":var f=s.querySelector('style[data-href~="'+Vn(d.href)+'"]');if(f)return o.instance=f,zt(f),f;var y=g({},d,{"data-href":d.href,"data-precedence":d.precedence,href:null,precedence:null});return f=(s.ownerDocument||s).createElement("style"),zt(f),Jt(f,"style",y),Md(f,d.precedence,s),o.instance=f;case"stylesheet":y=$i(d.href);var b=s.querySelector(hl(y));if(b)return o.state.loading|=4,o.instance=b,zt(b),b;f=_v(d),(y=Qn.get(y))&&qp(f,y),b=(s.ownerDocument||s).createElement("link"),zt(b);var k=b;return k._p=new Promise(function(C,B){k.onload=C,k.onerror=B}),Jt(b,"link",f),o.state.loading|=4,Md(b,d.precedence,s),o.instance=b;case"script":return b=Bi(d.src),(y=s.querySelector(fl(b)))?(o.instance=y,zt(y),y):(f=d,(y=Qn.get(b))&&(f=g({},d),Wp(f,y)),s=s.ownerDocument||s,y=s.createElement("script"),zt(y),Jt(y,"link",f),s.head.appendChild(y),o.instance=y);case"void":return null;default:throw Error(r(443,o.type))}else o.type==="stylesheet"&&(o.state.loading&4)===0&&(f=o.instance,o.state.loading|=4,Md(f,d.precedence,s));return o.instance}function Md(s,o,d){for(var f=d.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),y=f.length?f[f.length-1]:null,b=y,k=0;k<f.length;k++){var C=f[k];if(C.dataset.precedence===o)b=C;else if(b!==y)break}b?b.parentNode.insertBefore(s,b.nextSibling):(o=d.nodeType===9?d.head:d,o.insertBefore(s,o.firstChild))}function qp(s,o){s.crossOrigin==null&&(s.crossOrigin=o.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=o.referrerPolicy),s.title==null&&(s.title=o.title)}function Wp(s,o){s.crossOrigin==null&&(s.crossOrigin=o.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=o.referrerPolicy),s.integrity==null&&(s.integrity=o.integrity)}var Od=null;function Ov(s,o,d){if(Od===null){var f=new Map,y=Od=new Map;y.set(d,f)}else y=Od,f=y.get(d),f||(f=new Map,y.set(d,f));if(f.has(s))return f;for(f.set(s,null),d=d.getElementsByTagName(s),y=0;y<d.length;y++){var b=d[y];if(!(b[Ro]||b[qt]||s==="link"&&b.getAttribute("rel")==="stylesheet")&&b.namespaceURI!=="http://www.w3.org/2000/svg"){var k=b.getAttribute(o)||"";k=s+k;var C=f.get(k);C?C.push(b):f.set(k,[b])}}return f}function Dv(s,o,d){s=s.ownerDocument||s,s.head.insertBefore(d,o==="title"?s.querySelector("head > title"):null)}function yE(s,o,d){if(d===1||o.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof o.precedence!="string"||typeof o.href!="string"||o.href==="")break;return!0;case"link":if(typeof o.rel!="string"||typeof o.href!="string"||o.href===""||o.onLoad||o.onError)break;return o.rel==="stylesheet"?(s=o.disabled,typeof o.precedence=="string"&&s==null):!0;case"script":if(o.async&&typeof o.async!="function"&&typeof o.async!="symbol"&&!o.onLoad&&!o.onError&&o.src&&typeof o.src=="string")return!0}return!1}function Lv(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}function xE(s,o,d,f){if(d.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(d.state.loading&4)===0){if(d.instance===null){var y=$i(f.href),b=o.querySelector(hl(y));if(b){o=b._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(s.count++,s=Dd.bind(s),o.then(s,s)),d.state.loading|=4,d.instance=b,zt(b);return}b=o.ownerDocument||o,f=_v(f),(y=Qn.get(y))&&qp(f,y),b=b.createElement("link"),zt(b);var k=b;k._p=new Promise(function(C,B){k.onload=C,k.onerror=B}),Jt(b,"link",f),d.instance=b}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(d,o),(o=d.state.preload)&&(d.state.loading&3)===0&&(s.count++,d=Dd.bind(s),o.addEventListener("load",d),o.addEventListener("error",d))}}var Kp=0;function bE(s,o){return s.stylesheets&&s.count===0&&$d(s,s.stylesheets),0<s.count||0<s.imgCount?function(d){var f=setTimeout(function(){if(s.stylesheets&&$d(s,s.stylesheets),s.unsuspend){var b=s.unsuspend;s.unsuspend=null,b()}},6e4+o);0<s.imgBytes&&Kp===0&&(Kp=62500*ZT());var y=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&$d(s,s.stylesheets),s.unsuspend)){var b=s.unsuspend;s.unsuspend=null,b()}},(s.imgBytes>Kp?50:800)+o);return s.unsuspend=d,function(){s.unsuspend=null,clearTimeout(f),clearTimeout(y)}}:null}function Dd(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)$d(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Ld=null;function $d(s,o){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Ld=new Map,o.forEach(vE,s),Ld=null,Dd.call(s))}function vE(s,o){if(!(o.state.loading&4)){var d=Ld.get(s);if(d)var f=d.get(null);else{d=new Map,Ld.set(s,d);for(var y=s.querySelectorAll("link[data-precedence],style[data-precedence]"),b=0;b<y.length;b++){var k=y[b];(k.nodeName==="LINK"||k.getAttribute("media")!=="not all")&&(d.set(k.dataset.precedence,k),f=k)}f&&d.set(null,f)}y=o.instance,k=y.getAttribute("data-precedence"),b=d.get(k)||f,b===f&&d.set(null,y),d.set(k,y),this.count++,f=Dd.bind(this),y.addEventListener("load",f),y.addEventListener("error",f),b?b.parentNode.insertBefore(y,b.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(y,s.firstChild)),o.state.loading|=4}}var pl={$$typeof:$,Provider:null,Consumer:null,_currentValue:Z,_currentValue2:Z,_threadCount:0};function wE(s,o,d,f,y,b,k,C,B){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Hh(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Hh(0),this.hiddenUpdates=Hh(null),this.identifierPrefix=f,this.onUncaughtError=y,this.onCaughtError=b,this.onRecoverableError=k,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=B,this.incompleteTransitions=new Map}function $v(s,o,d,f,y,b,k,C,B,q,ne,se){return s=new wE(s,o,d,k,B,q,ne,se,C),o=1,b===!0&&(o|=24),b=En(3,null,null,o),s.current=b,b.stateNode=s,o=Tf(),o.refCount++,s.pooledCache=o,o.refCount++,b.memoizedState={element:f,isDehydrated:d,cache:o},_f(b),s}function Bv(s){return s?(s=pi,s):pi}function Iv(s,o,d,f,y,b){y=Bv(y),f.context===null?f.context=y:f.pendingContext=y,f=gs(o),f.payload={element:d},b=b===void 0?null:b,b!==null&&(f.callback=b),d=ys(s,f,o),d!==null&&(wn(d,s,o),qo(d,s,o))}function Pv(s,o){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var d=s.retryLane;s.retryLane=d!==0&&d<o?d:o}}function Yp(s,o){Pv(s,o),(s=s.alternate)&&Pv(s,o)}function zv(s){if(s.tag===13||s.tag===31){var o=da(s,67108864);o!==null&&wn(o,s,67108864),Yp(s,67108864)}}function Uv(s){if(s.tag===13||s.tag===31){var o=On();o=Vh(o);var d=da(s,o);d!==null&&wn(d,s,o),Yp(s,o)}}var Bd=!0;function SE(s,o,d,f){var y=O.T;O.T=null;var b=K.p;try{K.p=2,Jp(s,o,d,f)}finally{K.p=b,O.T=y}}function NE(s,o,d,f){var y=O.T;O.T=null;var b=K.p;try{K.p=8,Jp(s,o,d,f)}finally{K.p=b,O.T=y}}function Jp(s,o,d,f){if(Bd){var y=Qp(f);if(y===null)$p(s,o,f,Id,d),Vv(s,f);else if(jE(y,s,o,d,f))f.stopPropagation();else if(Vv(s,f),o&4&&-1<kE.indexOf(s)){for(;y!==null;){var b=ri(y);if(b!==null)switch(b.tag){case 3:if(b=b.stateNode,b.current.memoizedState.isDehydrated){var k=aa(b.pendingLanes);if(k!==0){var C=b;for(C.pendingLanes|=2,C.entangledLanes|=2;k;){var B=1<<31-Cn(k);C.entanglements[1]|=B,k&=~B}wr(b),(Ke&6)===0&&(vd=kn()+500,ll(0))}}break;case 31:case 13:C=da(b,2),C!==null&&wn(C,b,2),Sd(),Yp(b,2)}if(b=Qp(f),b===null&&$p(s,o,f,Id,d),b===y)break;y=b}y!==null&&f.stopPropagation()}else $p(s,o,f,null,d)}}function Qp(s){return s=Xh(s),Xp(s)}var Id=null;function Xp(s){if(Id=null,s=ni(s),s!==null){var o=i(s);if(o===null)s=null;else{var d=o.tag;if(d===13){if(s=c(o),s!==null)return s;s=null}else if(d===31){if(s=u(o),s!==null)return s;s=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;s=null}else o!==s&&(s=null)}}return Id=s,null}function Hv(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(cC()){case Jy:return 2;case Qy:return 8;case Tc:case dC:return 32;case Xy:return 268435456;default:return 32}default:return 32}}var Zp=!1,Es=null,Rs=null,As=null,ml=new Map,gl=new Map,_s=[],kE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Vv(s,o){switch(s){case"focusin":case"focusout":Es=null;break;case"dragenter":case"dragleave":Rs=null;break;case"mouseover":case"mouseout":As=null;break;case"pointerover":case"pointerout":ml.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":gl.delete(o.pointerId)}}function yl(s,o,d,f,y,b){return s===null||s.nativeEvent!==b?(s={blockedOn:o,domEventName:d,eventSystemFlags:f,nativeEvent:b,targetContainers:[y]},o!==null&&(o=ri(o),o!==null&&zv(o)),s):(s.eventSystemFlags|=f,o=s.targetContainers,y!==null&&o.indexOf(y)===-1&&o.push(y),s)}function jE(s,o,d,f,y){switch(o){case"focusin":return Es=yl(Es,s,o,d,f,y),!0;case"dragenter":return Rs=yl(Rs,s,o,d,f,y),!0;case"mouseover":return As=yl(As,s,o,d,f,y),!0;case"pointerover":var b=y.pointerId;return ml.set(b,yl(ml.get(b)||null,s,o,d,f,y)),!0;case"gotpointercapture":return b=y.pointerId,gl.set(b,yl(gl.get(b)||null,s,o,d,f,y)),!0}return!1}function Fv(s){var o=ni(s.target);if(o!==null){var d=i(o);if(d!==null){if(o=d.tag,o===13){if(o=c(d),o!==null){s.blockedOn=o,sx(s.priority,function(){Uv(d)});return}}else if(o===31){if(o=u(d),o!==null){s.blockedOn=o,sx(s.priority,function(){Uv(d)});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){s.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Pd(s){if(s.blockedOn!==null)return!1;for(var o=s.targetContainers;0<o.length;){var d=Qp(s.nativeEvent);if(d===null){d=s.nativeEvent;var f=new d.constructor(d.type,d);Qh=f,d.target.dispatchEvent(f),Qh=null}else return o=ri(d),o!==null&&zv(o),s.blockedOn=d,!1;o.shift()}return!0}function Gv(s,o,d){Pd(s)&&d.delete(o)}function CE(){Zp=!1,Es!==null&&Pd(Es)&&(Es=null),Rs!==null&&Pd(Rs)&&(Rs=null),As!==null&&Pd(As)&&(As=null),ml.forEach(Gv),gl.forEach(Gv)}function zd(s,o){s.blockedOn===o&&(s.blockedOn=null,Zp||(Zp=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,CE)))}var Ud=null;function qv(s){Ud!==s&&(Ud=s,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){Ud===s&&(Ud=null);for(var o=0;o<s.length;o+=3){var d=s[o],f=s[o+1],y=s[o+2];if(typeof f!="function"){if(Xp(f||d)===null)continue;break}var b=ri(d);b!==null&&(s.splice(o,3),o-=3,Qf(b,{pending:!0,data:y,method:d.method,action:f},f,y))}}))}function Ii(s){function o(B){return zd(B,s)}Es!==null&&zd(Es,s),Rs!==null&&zd(Rs,s),As!==null&&zd(As,s),ml.forEach(o),gl.forEach(o);for(var d=0;d<_s.length;d++){var f=_s[d];f.blockedOn===s&&(f.blockedOn=null)}for(;0<_s.length&&(d=_s[0],d.blockedOn===null);)Fv(d),d.blockedOn===null&&_s.shift();if(d=(s.ownerDocument||s).$$reactFormReplay,d!=null)for(f=0;f<d.length;f+=3){var y=d[f],b=d[f+1],k=y[mn]||null;if(typeof b=="function")k||qv(d);else if(k){var C=null;if(b&&b.hasAttribute("formAction")){if(y=b,k=b[mn]||null)C=k.formAction;else if(Xp(y)!==null)continue}else C=k.action;typeof C=="function"?d[f+1]=C:(d.splice(f,3),f-=3),qv(d)}}}function Wv(){function s(b){b.canIntercept&&b.info==="react-transition"&&b.intercept({handler:function(){return new Promise(function(k){return y=k})},focusReset:"manual",scroll:"manual"})}function o(){y!==null&&(y(),y=null),f||setTimeout(d,20)}function d(){if(!f&&!navigation.transition){var b=navigation.currentEntry;b&&b.url!=null&&navigation.navigate(b.url,{state:b.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,y=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",o),navigation.addEventListener("navigateerror",o),setTimeout(d,100),function(){f=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",o),navigation.removeEventListener("navigateerror",o),y!==null&&(y(),y=null)}}}function em(s){this._internalRoot=s}Hd.prototype.render=em.prototype.render=function(s){var o=this._internalRoot;if(o===null)throw Error(r(409));var d=o.current,f=On();Iv(d,f,s,o,null,null)},Hd.prototype.unmount=em.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var o=s.containerInfo;Iv(s.current,2,null,s,null,null),Sd(),o[ti]=null}};function Hd(s){this._internalRoot=s}Hd.prototype.unstable_scheduleHydration=function(s){if(s){var o=rx();s={blockedOn:null,target:s,priority:o};for(var d=0;d<_s.length&&o!==0&&o<_s[d].priority;d++);_s.splice(d,0,s),d===0&&Fv(s)}};var Kv=e.version;if(Kv!=="19.2.3")throw Error(r(527,Kv,"19.2.3"));K.findDOMNode=function(s){var o=s._reactInternals;if(o===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=p(o),s=s!==null?m(s):null,s=s===null?null:s.stateNode,s};var TE={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:O,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Vd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Vd.isDisabled&&Vd.supportsFiber)try{Co=Vd.inject(TE),jn=Vd}catch{}}return bl.createRoot=function(s,o){if(!a(s))throw Error(r(299));var d=!1,f="",y=t0,b=n0,k=r0;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onUncaughtError!==void 0&&(y=o.onUncaughtError),o.onCaughtError!==void 0&&(b=o.onCaughtError),o.onRecoverableError!==void 0&&(k=o.onRecoverableError)),o=$v(s,1,!1,null,null,d,f,null,y,b,k,Wv),s[ti]=o.current,Lp(s),new em(o)},bl.hydrateRoot=function(s,o,d){if(!a(s))throw Error(r(299));var f=!1,y="",b=t0,k=n0,C=r0,B=null;return d!=null&&(d.unstable_strictMode===!0&&(f=!0),d.identifierPrefix!==void 0&&(y=d.identifierPrefix),d.onUncaughtError!==void 0&&(b=d.onUncaughtError),d.onCaughtError!==void 0&&(k=d.onCaughtError),d.onRecoverableError!==void 0&&(C=d.onRecoverableError),d.formState!==void 0&&(B=d.formState)),o=$v(s,1,!0,o,d??null,f,y,B,b,k,C,Wv),o.context=Bv(null),d=o.current,f=On(),f=Vh(f),y=gs(f),y.callback=null,ys(d,y,f),d=f,o.current.lanes=d,Eo(o,d),wr(o),s[ti]=o.current,Lp(s),new Hd(o)},bl.version="19.2.3",bl}var sw;function $E(){if(sw)return rm.exports;sw=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),rm.exports=LE(),rm.exports}var BE=$E();function ph(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(t);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(t,r[a])&&(n[r[a]]=t[r[a]]);return n}function IE(t,e,n,r){function a(i){return i instanceof n?i:new n(function(c){c(i)})}return new(n||(n=Promise))(function(i,c){function u(m){try{p(r.next(m))}catch(g){c(g)}}function h(m){try{p(r.throw(m))}catch(g){c(g)}}function p(m){m.done?i(m.value):a(m.value).then(u,h)}p((r=r.apply(t,e||[])).next())})}const PE=t=>t?(...e)=>t(...e):(...e)=>fetch(...e);class Yg extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}}class zE extends Yg{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class aw extends Yg{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class iw extends Yg{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Zm;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Zm||(Zm={}));class UE{constructor(e,{headers:n={},customFetch:r,region:a=Zm.Any}={}){this.url=e,this.headers=n,this.region=a,this.fetch=PE(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return IE(this,arguments,void 0,function*(n,r={}){var a;let i,c;try{const{headers:u,method:h,body:p,signal:m,timeout:g}=r;let x={},{region:v}=r;v||(v=this.region);const w=new URL(`${this.url}/${n}`);v&&v!=="any"&&(x["x-region"]=v,w.searchParams.set("forceFunctionRegion",v));let N;p&&(u&&!Object.prototype.hasOwnProperty.call(u,"Content-Type")||!u)?typeof Blob<"u"&&p instanceof Blob||p instanceof ArrayBuffer?(x["Content-Type"]="application/octet-stream",N=p):typeof p=="string"?(x["Content-Type"]="text/plain",N=p):typeof FormData<"u"&&p instanceof FormData?N=p:(x["Content-Type"]="application/json",N=JSON.stringify(p)):N=p;let S=m;g&&(c=new AbortController,i=setTimeout(()=>c.abort(),g),m?(S=c.signal,m.addEventListener("abort",()=>c.abort())):S=c.signal);const j=yield this.fetch(w.toString(),{method:h||"POST",headers:Object.assign(Object.assign(Object.assign({},x),this.headers),u),body:N,signal:S}).catch(R=>{throw new zE(R)}),A=j.headers.get("x-relay-error");if(A&&A==="true")throw new aw(j);if(!j.ok)throw new iw(j);let $=((a=j.headers.get("Content-Type"))!==null&&a!==void 0?a:"text/plain").split(";")[0].trim(),L;return $==="application/json"?L=yield j.json():$==="application/octet-stream"||$==="application/pdf"?L=yield j.blob():$==="text/event-stream"?L=j:$==="multipart/form-data"?L=yield j.formData():L=yield j.text(),{data:L,error:null,response:j}}catch(u){return{data:null,error:u,response:u instanceof iw||u instanceof aw?u.context:void 0}}finally{i&&clearTimeout(i)}})}}var HE=class extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}},VE=class{constructor(t){var e,n;this.shouldThrowOnError=!1,this.method=t.method,this.url=t.url,this.headers=new Headers(t.headers),this.schema=t.schema,this.body=t.body,this.shouldThrowOnError=(e=t.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=t.signal,this.isMaybeSingle=(n=t.isMaybeSingle)!==null&&n!==void 0?n:!1,t.fetch?this.fetch=t.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(t,e){return this.headers=new Headers(this.headers),this.headers.set(t,e),this}then(t,e){var n=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let a=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{let c=null,u=null,h=null,p=i.status,m=i.statusText;if(i.ok){var g,x;if(n.method!=="HEAD"){var v;const j=await i.text();j===""||(n.headers.get("Accept")==="text/csv"||n.headers.get("Accept")&&(!((v=n.headers.get("Accept"))===null||v===void 0)&&v.includes("application/vnd.pgrst.plan+text"))?u=j:u=JSON.parse(j))}const N=(g=n.headers.get("Prefer"))===null||g===void 0?void 0:g.match(/count=(exact|planned|estimated)/),S=(x=i.headers.get("content-range"))===null||x===void 0?void 0:x.split("/");N&&S&&S.length>1&&(h=parseInt(S[1])),n.isMaybeSingle&&n.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,h=null,p=406,m="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{var w;const N=await i.text();try{c=JSON.parse(N),Array.isArray(c)&&i.status===404&&(u=[],c=null,p=200,m="OK")}catch{i.status===404&&N===""?(p=204,m="No Content"):c={message:N}}if(c&&n.isMaybeSingle&&(!(c==null||(w=c.details)===null||w===void 0)&&w.includes("0 rows"))&&(c=null,p=200,m="OK"),c&&n.shouldThrowOnError)throw new HE(c)}return{error:c,data:u,count:h,status:p,statusText:m}});return this.shouldThrowOnError||(a=a.catch(i=>{var c;let u="";const h=i?.cause;if(h){var p,m,g,x;const w=(p=h?.message)!==null&&p!==void 0?p:"",N=(m=h?.code)!==null&&m!==void 0?m:"";u=`${(g=i?.name)!==null&&g!==void 0?g:"FetchError"}: ${i?.message}`,u+=`

Caused by: ${(x=h?.name)!==null&&x!==void 0?x:"Error"}: ${w}`,N&&(u+=` (${N})`),h?.stack&&(u+=`
${h.stack}`)}else{var v;u=(v=i?.stack)!==null&&v!==void 0?v:""}return{error:{message:`${(c=i?.name)!==null&&c!==void 0?c:"FetchError"}: ${i?.message}`,details:u,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),a.then(t,e)}returns(){return this}overrideTypes(){return this}},FE=class extends VE{select(t){let e=!1;const n=(t??"*").split("").map(r=>/\s/.test(r)&&!e?"":(r==='"'&&(e=!e),r)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(t,{ascending:e=!0,nullsFirst:n,foreignTable:r,referencedTable:a=r}={}){const i=a?`${a}.order`:"order",c=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${c?`${c},`:""}${t}.${e?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(t,{foreignTable:e,referencedTable:n=e}={}){const r=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(r,`${t}`),this}range(t,e,{foreignTable:n,referencedTable:r=n}={}){const a=typeof r>"u"?"offset":`${r}.offset`,i=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(a,`${t}`),this.url.searchParams.set(i,`${e-t+1}`),this}abortSignal(t){return this.signal=t,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:t=!1,verbose:e=!1,settings:n=!1,buffers:r=!1,wal:a=!1,format:i="text"}={}){var c;const u=[t?"analyze":null,e?"verbose":null,n?"settings":null,r?"buffers":null,a?"wal":null].filter(Boolean).join("|"),h=(c=this.headers.get("Accept"))!==null&&c!==void 0?c:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${h}"; options=${u};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(t){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${t}`),this}};const ow=new RegExp("[,()]");var Xi=class extends FE{eq(t,e){return this.url.searchParams.append(t,`eq.${e}`),this}neq(t,e){return this.url.searchParams.append(t,`neq.${e}`),this}gt(t,e){return this.url.searchParams.append(t,`gt.${e}`),this}gte(t,e){return this.url.searchParams.append(t,`gte.${e}`),this}lt(t,e){return this.url.searchParams.append(t,`lt.${e}`),this}lte(t,e){return this.url.searchParams.append(t,`lte.${e}`),this}like(t,e){return this.url.searchParams.append(t,`like.${e}`),this}likeAllOf(t,e){return this.url.searchParams.append(t,`like(all).{${e.join(",")}}`),this}likeAnyOf(t,e){return this.url.searchParams.append(t,`like(any).{${e.join(",")}}`),this}ilike(t,e){return this.url.searchParams.append(t,`ilike.${e}`),this}ilikeAllOf(t,e){return this.url.searchParams.append(t,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(t,e){return this.url.searchParams.append(t,`ilike(any).{${e.join(",")}}`),this}regexMatch(t,e){return this.url.searchParams.append(t,`match.${e}`),this}regexIMatch(t,e){return this.url.searchParams.append(t,`imatch.${e}`),this}is(t,e){return this.url.searchParams.append(t,`is.${e}`),this}isDistinct(t,e){return this.url.searchParams.append(t,`isdistinct.${e}`),this}in(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&ow.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`in.(${n})`),this}notIn(t,e){const n=Array.from(new Set(e)).map(r=>typeof r=="string"&&ow.test(r)?`"${r}"`:`${r}`).join(",");return this.url.searchParams.append(t,`not.in.(${n})`),this}contains(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cs.{${e.join(",")}}`):this.url.searchParams.append(t,`cs.${JSON.stringify(e)}`),this}containedBy(t,e){return typeof e=="string"?this.url.searchParams.append(t,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(t,`cd.{${e.join(",")}}`):this.url.searchParams.append(t,`cd.${JSON.stringify(e)}`),this}rangeGt(t,e){return this.url.searchParams.append(t,`sr.${e}`),this}rangeGte(t,e){return this.url.searchParams.append(t,`nxl.${e}`),this}rangeLt(t,e){return this.url.searchParams.append(t,`sl.${e}`),this}rangeLte(t,e){return this.url.searchParams.append(t,`nxr.${e}`),this}rangeAdjacent(t,e){return this.url.searchParams.append(t,`adj.${e}`),this}overlaps(t,e){return typeof e=="string"?this.url.searchParams.append(t,`ov.${e}`):this.url.searchParams.append(t,`ov.{${e.join(",")}}`),this}textSearch(t,e,{config:n,type:r}={}){let a="";r==="plain"?a="pl":r==="phrase"?a="ph":r==="websearch"&&(a="w");const i=n===void 0?"":`(${n})`;return this.url.searchParams.append(t,`${a}fts${i}.${e}`),this}match(t){return Object.entries(t).forEach(([e,n])=>{this.url.searchParams.append(e,`eq.${n}`)}),this}not(t,e,n){return this.url.searchParams.append(t,`not.${e}.${n}`),this}or(t,{foreignTable:e,referencedTable:n=e}={}){const r=n?`${n}.or`:"or";return this.url.searchParams.append(r,`(${t})`),this}filter(t,e,n){return this.url.searchParams.append(t,`${e}.${n}`),this}},GE=class{constructor(t,{headers:e={},schema:n,fetch:r}){this.url=t,this.headers=new Headers(e),this.schema=n,this.fetch=r}select(t,e){const{head:n=!1,count:r}=e??{},a=n?"HEAD":"GET";let i=!1;const c=(t??"*").split("").map(u=>/\s/.test(u)&&!i?"":(u==='"'&&(i=!i),u)).join("");return this.url.searchParams.set("select",c),r&&this.headers.append("Prefer",`count=${r}`),new Xi({method:a,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(t,{count:e,defaultToNull:n=!0}={}){var r;const a="POST";if(e&&this.headers.append("Prefer",`count=${e}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const i=t.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(i.length>0){const c=[...new Set(i)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new Xi({method:a,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}upsert(t,{onConflict:e,ignoreDuplicates:n=!1,count:r,defaultToNull:a=!0}={}){var i;const c="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),r&&this.headers.append("Prefer",`count=${r}`),a||this.headers.append("Prefer","missing=default"),Array.isArray(t)){const u=t.reduce((h,p)=>h.concat(Object.keys(p)),[]);if(u.length>0){const h=[...new Set(u)].map(p=>`"${p}"`);this.url.searchParams.set("columns",h.join(","))}}return new Xi({method:c,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(t,{count:e}={}){var n;const r="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new Xi({method:r,url:this.url,headers:this.headers,schema:this.schema,body:t,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:t}={}){var e;const n="DELETE";return t&&this.headers.append("Prefer",`count=${t}`),new Xi({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},qE=class YS{constructor(e,{headers:n={},schema:r,fetch:a}={}){this.url=e,this.headers=new Headers(n),this.schemaName=r,this.fetch=a}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new GE(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new YS(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,n={},{head:r=!1,get:a=!1,count:i}={}){var c;let u;const h=new URL(`${this.url}/rpc/${e}`);let p;r||a?(u=r?"HEAD":"GET",Object.entries(n).filter(([g,x])=>x!==void 0).map(([g,x])=>[g,Array.isArray(x)?`{${x.join(",")}}`:`${x}`]).forEach(([g,x])=>{h.searchParams.append(g,x)})):(u="POST",p=n);const m=new Headers(this.headers);return i&&m.set("Prefer",`count=${i}`),new Xi({method:u,url:h,headers:m,schema:this.schemaName,body:p,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}};class WE{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const n=process.versions;if(n&&n.node){const r=n.node,a=parseInt(r.replace(/^v/,"").split(".")[0]);return a>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${a} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${a} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){const r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const KE="2.89.0",YE=`realtime-js/${KE}`,JS="1.0.0",JE="2.0.0",lw=JS,eg=1e4,QE=1e3,XE=100;var $s;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})($s||($s={}));var Bt;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(Bt||(Bt={}));var hr;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(hr||(hr={}));var tg;(function(t){t.websocket="websocket"})(tg||(tg={}));var Ra;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Ra||(Ra={}));class ZE{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,n){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return n(this._binaryEncodeUserBroadcastPush(e));let r=[e.join_ref,e.ref,e.topic,e.event,e.payload];return n(JSON.stringify(r))}_binaryEncodeUserBroadcastPush(e){var n;return this._isArrayBuffer((n=e.payload)===null||n===void 0?void 0:n.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var n,r;const a=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,a)}_encodeJsonUserBroadcastPush(e){var n,r;const a=(r=(n=e.payload)===null||n===void 0?void 0:n.payload)!==null&&r!==void 0?r:{},c=new TextEncoder().encode(JSON.stringify(a)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,c)}_encodeUserBroadcastPush(e,n,r){var a,i;const c=e.topic,u=(a=e.ref)!==null&&a!==void 0?a:"",h=(i=e.join_ref)!==null&&i!==void 0?i:"",p=e.payload.event,m=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},g=Object.keys(m).length===0?"":JSON.stringify(m);if(h.length>255)throw new Error(`joinRef length ${h.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`ref length ${u.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`topic length ${c.length} exceeds maximum of 255`);if(p.length>255)throw new Error(`userEvent length ${p.length} exceeds maximum of 255`);if(g.length>255)throw new Error(`metadata length ${g.length} exceeds maximum of 255`);const x=this.USER_BROADCAST_PUSH_META_LENGTH+h.length+u.length+c.length+p.length+g.length,v=new ArrayBuffer(this.HEADER_LENGTH+x);let w=new DataView(v),N=0;w.setUint8(N++,this.KINDS.userBroadcastPush),w.setUint8(N++,h.length),w.setUint8(N++,u.length),w.setUint8(N++,c.length),w.setUint8(N++,p.length),w.setUint8(N++,g.length),w.setUint8(N++,n),Array.from(h,j=>w.setUint8(N++,j.charCodeAt(0))),Array.from(u,j=>w.setUint8(N++,j.charCodeAt(0))),Array.from(c,j=>w.setUint8(N++,j.charCodeAt(0))),Array.from(p,j=>w.setUint8(N++,j.charCodeAt(0))),Array.from(g,j=>w.setUint8(N++,j.charCodeAt(0)));var S=new Uint8Array(v.byteLength+r.byteLength);return S.set(new Uint8Array(v),0),S.set(new Uint8Array(r),v.byteLength),S.buffer}decode(e,n){if(this._isArrayBuffer(e)){let r=this._binaryDecode(e);return n(r)}if(typeof e=="string"){const r=JSON.parse(e),[a,i,c,u,h]=r;return n({join_ref:a,ref:i,topic:c,event:u,payload:h})}return n({})}_binaryDecode(e){const n=new DataView(e),r=n.getUint8(0),a=new TextDecoder;if(r===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,n,a)}_decodeUserBroadcast(e,n,r){const a=n.getUint8(1),i=n.getUint8(2),c=n.getUint8(3),u=n.getUint8(4);let h=this.HEADER_LENGTH+4;const p=r.decode(e.slice(h,h+a));h=h+a;const m=r.decode(e.slice(h,h+i));h=h+i;const g=r.decode(e.slice(h,h+c));h=h+c;const x=e.slice(h,e.byteLength),v=u===this.JSON_ENCODING?JSON.parse(r.decode(x)):x,w={type:this.BROADCAST_EVENT,event:m,payload:v};return c>0&&(w.meta=JSON.parse(g)),{join_ref:null,ref:null,topic:p,event:this.BROADCAST_EVENT,payload:w}}_isArrayBuffer(e){var n;return e instanceof ArrayBuffer||((n=e?.constructor)===null||n===void 0?void 0:n.name)==="ArrayBuffer"}_pick(e,n){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([r])=>n.includes(r)))}}class QS{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var at;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(at||(at={}));const cw=(t,e,n={})=>{var r;const a=(r=n.skipTypes)!==null&&r!==void 0?r:[];return e?Object.keys(e).reduce((i,c)=>(i[c]=eR(c,t,e,a),i),{}):{}},eR=(t,e,n,r)=>{const a=e.find(u=>u.name===t),i=a?.type,c=n[t];return i&&!r.includes(i)?XS(i,c):ng(c)},XS=(t,e)=>{if(t.charAt(0)==="_"){const n=t.slice(1,t.length);return sR(e,n)}switch(t){case at.bool:return tR(e);case at.float4:case at.float8:case at.int2:case at.int4:case at.int8:case at.numeric:case at.oid:return nR(e);case at.json:case at.jsonb:return rR(e);case at.timestamp:return aR(e);case at.abstime:case at.date:case at.daterange:case at.int4range:case at.int8range:case at.money:case at.reltime:case at.text:case at.time:case at.timestamptz:case at.timetz:case at.tsrange:case at.tstzrange:return ng(e);default:return ng(e)}},ng=t=>t,tR=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},nR=t=>{if(typeof t=="string"){const e=parseFloat(t);if(!Number.isNaN(e))return e}return t},rR=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch{return t}return t},sR=(t,e)=>{if(typeof t!="string")return t;const n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let i;const c=t.slice(1,n);try{i=JSON.parse("["+c+"]")}catch{i=c?c.split(","):[]}return i.map(u=>XS(e,u))}return t},aR=t=>typeof t=="string"?t.replace(" ","T"):t,ZS=t=>{const e=new URL(t);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class om{constructor(e,n,r={},a=eg){this.channel=e,this.event=n,this.payload=r,this.timeout=a,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var dw;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(dw||(dw={}));class Ll{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=n?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},a=>{const{onJoin:i,onLeave:c,onSync:u}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ll.syncState(this.state,a,i,c),this.pendingDiffs.forEach(h=>{this.state=Ll.syncDiff(this.state,h,i,c)}),this.pendingDiffs=[],u()}),this.channel._on(r.diff,{},a=>{const{onJoin:i,onLeave:c,onSync:u}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=Ll.syncDiff(this.state,a,i,c),u())}),this.onJoin((a,i,c)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:i,newPresences:c})}),this.onLeave((a,i,c)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:i,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,a){const i=this.cloneDeep(e),c=this.transformState(n),u={},h={};return this.map(i,(p,m)=>{c[p]||(h[p]=m)}),this.map(c,(p,m)=>{const g=i[p];if(g){const x=m.map(S=>S.presence_ref),v=g.map(S=>S.presence_ref),w=m.filter(S=>v.indexOf(S.presence_ref)<0),N=g.filter(S=>x.indexOf(S.presence_ref)<0);w.length>0&&(u[p]=w),N.length>0&&(h[p]=N)}else u[p]=m}),this.syncDiff(i,{joins:u,leaves:h},r,a)}static syncDiff(e,n,r,a){const{joins:i,leaves:c}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),a||(a=()=>{}),this.map(i,(u,h)=>{var p;const m=(p=e[u])!==null&&p!==void 0?p:[];if(e[u]=this.cloneDeep(h),m.length>0){const g=e[u].map(v=>v.presence_ref),x=m.filter(v=>g.indexOf(v.presence_ref)<0);e[u].unshift(...x)}r(u,m,h)}),this.map(c,(u,h)=>{let p=e[u];if(!p)return;const m=h.map(g=>g.presence_ref);p=p.filter(g=>m.indexOf(g.presence_ref)<0),e[u]=p,a(u,p,h),p.length===0&&delete e[u]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{const a=e[r];return"metas"in a?n[r]=a.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):n[r]=a,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var uw;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(uw||(uw={}));var $l;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})($l||($l={}));var Xr;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(Xr||(Xr={}));class ao{constructor(e,n={config:{}},r){var a,i;if(this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=Bt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new om(this,hr.join,this.params,this.timeout),this.rejoinTimer=new QS(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Bt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(c=>c.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Bt.closed,this.socket._remove(this)}),this._onError(c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=Bt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Bt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",c=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,c),this.state=Bt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(hr.reply,{},(c,u)=>{this._trigger(this._replyEventName(u),c)}),this.presence=new Ll(this),this.broadcastEndpointURL=ZS(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((i=(a=this.params.config)===null||a===void 0?void 0:a.broadcast)===null||i===void 0)&&i.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,n=this.timeout){var r,a,i;if(this.socket.isConnected()||this.socket.connect(),this.state==Bt.closed){const{config:{broadcast:c,presence:u,private:h}}=this.params,p=(a=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(v=>v.filter))!==null&&a!==void 0?a:[],m=!!this.bindings[$l.PRESENCE]&&this.bindings[$l.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,g={},x={broadcast:c,presence:Object.assign(Object.assign({},u),{enabled:m}),postgres_changes:p,private:h};this.socket.accessTokenValue&&(g.access_token=this.socket.accessTokenValue),this._onError(v=>e?.(Xr.CHANNEL_ERROR,v)),this._onClose(()=>e?.(Xr.CLOSED)),this.updateJoinPayload(Object.assign({config:x},g)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:v})=>{var w;if(this.socket._isManualToken()||this.socket.setAuth(),v===void 0){e?.(Xr.SUBSCRIBED);return}else{const N=this.bindings.postgres_changes,S=(w=N?.length)!==null&&w!==void 0?w:0,j=[];for(let A=0;A<S;A++){const $=N[A],{filter:{event:L,schema:R,table:M,filter:D}}=$,I=v&&v[A];if(I&&I.event===L&&ao.isFilterValueEqual(I.schema,R)&&ao.isFilterValueEqual(I.table,M)&&ao.isFilterValueEqual(I.filter,D))j.push(Object.assign(Object.assign({},$),{id:I.id}));else{this.unsubscribe(),this.state=Bt.errored,e?.(Xr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=j,e&&e(Xr.SUBSCRIBED);return}}).receive("error",v=>{this.state=Bt.errored,e?.(Xr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(v).join(", ")||"error")))}).receive("timeout",()=>{e?.(Xr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===Bt.joined&&e===$l.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,n,r)}async httpSend(e,n,r={}){var a;if(n==null)return Promise.reject("Payload is required for httpSend()");const i={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(i.Authorization=`Bearer ${this.socket.accessTokenValue}`);const c={method:"POST",headers:i,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:n,private:this.private}]})},u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(a=r.timeout)!==null&&a!==void 0?a:this.timeout);if(u.status===202)return{success:!0};let h=u.statusText;try{const p=await u.json();h=p.error||p.message||h}catch{}return Promise.reject(new Error(h))}async send(e,n={}){var r,a;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:i,payload:c}=e,u={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(u.Authorization=`Bearer ${this.socket.accessTokenValue}`);const h={method:"POST",headers:u,body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:c,private:this.private}]})};try{const p=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((a=p.body)===null||a===void 0?void 0:a.cancel()),p.ok?"ok":"error"}catch(p){return p.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var c,u,h;const p=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((h=(u=(c=this.params)===null||c===void 0?void 0:c.config)===null||u===void 0?void 0:u.broadcast)===null||h===void 0)&&h.ack)&&i("ok"),p.receive("ok",()=>i("ok")),p.receive("error",()=>i("error")),p.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Bt.leaving;const n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(hr.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(a=>{r=new om(this,hr.leave,{},e),r.receive("ok",()=>{n(),a("ok")}).receive("timeout",()=>{n(),a("timed out")}).receive("error",()=>{a("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Bt.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){const a=new AbortController,i=setTimeout(()=>a.abort(),r),c=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:a.signal}));return clearTimeout(i),c}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let a=new om(this,e,n,r);return this._canPush()?a.send():this._addToPushBuffer(a),a}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>XE){const n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var a,i;const c=e.toLocaleLowerCase(),{close:u,error:h,leave:p,join:m}=hr;if(r&&[u,h,p,m].indexOf(c)>=0&&r!==this._joinRef())return;let x=this._onMessage(c,n,r);if(n&&!x)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(c)?(a=this.bindings.postgres_changes)===null||a===void 0||a.filter(v=>{var w,N,S;return((w=v.filter)===null||w===void 0?void 0:w.event)==="*"||((S=(N=v.filter)===null||N===void 0?void 0:N.event)===null||S===void 0?void 0:S.toLocaleLowerCase())===c}).map(v=>v.callback(x,r)):(i=this.bindings[c])===null||i===void 0||i.filter(v=>{var w,N,S,j,A,$;if(["broadcast","presence","postgres_changes"].includes(c))if("id"in v){const L=v.id,R=(w=v.filter)===null||w===void 0?void 0:w.event;return L&&((N=n.ids)===null||N===void 0?void 0:N.includes(L))&&(R==="*"||R?.toLocaleLowerCase()===((S=n.data)===null||S===void 0?void 0:S.type.toLocaleLowerCase()))}else{const L=(A=(j=v?.filter)===null||j===void 0?void 0:j.event)===null||A===void 0?void 0:A.toLocaleLowerCase();return L==="*"||L===(($=n?.event)===null||$===void 0?void 0:$.toLocaleLowerCase())}else return v.type.toLocaleLowerCase()===c}).map(v=>{if(typeof x=="object"&&"ids"in x){const w=x.data,{schema:N,table:S,commit_timestamp:j,type:A,errors:$}=w;x=Object.assign(Object.assign({},{schema:N,table:S,commit_timestamp:j,eventType:A,new:{},old:{},errors:$}),this._getPayloadRecords(w))}v.callback(x,r)})}_isClosed(){return this.state===Bt.closed}_isJoined(){return this.state===Bt.joined}_isJoining(){return this.state===Bt.joining}_isLeaving(){return this.state===Bt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){const a=e.toLocaleLowerCase(),i={type:a,filter:n,callback:r};return this.bindings[a]?this.bindings[a].push(i):this.bindings[a]=[i],this}_off(e,n){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(a=>{var i;return!(((i=a.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&ao.isEqual(a.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(const r in e)if(e[r]!==n[r])return!1;return!0}static isFilterValueEqual(e,n){return(e??void 0)===(n??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(hr.close,{},e)}_onError(e){this._on(hr.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Bt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=cw(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=cw(e.columns,e.old_record)),n}}const lm=()=>{},Fd={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},iR=[1e3,2e3,5e3,1e4],oR=1e4,lR=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class cR{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=eg,this.transport=null,this.heartbeatIntervalMs=Fd.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=lm,this.ref=0,this.reconnectTimer=null,this.vsn=lw,this.logger=lm,this.conn=null,this.sendBuffer=[],this.serializer=new ZE,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=a=>a?(...i)=>a(...i):(...i)=>fetch(...i),!(!((r=n?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${tg.websocket}`,this.httpEndpoint=ZS(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=WE.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,n??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){const e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case $s.connecting:return Ra.Connecting;case $s.open:return Ra.Open;case $s.closing:return Ra.Closing;default:return Ra.Closed}}isConnected(){return this.connectionState()===Ra.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){const r=`realtime:${e}`,a=this.getChannels().find(i=>i.topic===r);if(a)return a;{const i=new ao(`realtime:${e}`,n,this);return this.channels.push(i),i}}push(e){const{topic:n,event:r,payload:a,ref:i}=e,c=()=>{this.encode(e,u=>{var h;(h=this.conn)===null||h===void 0||h.send(u)})};this.log("push",`${n} ${r} (${i})`,a),this.isConnected()?c():this.sendBuffer.push(c)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(QE,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},Fd.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(p){this.log("error","error in heartbeat callback",p)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:a,payload:i,ref:c}=n,u=c?`(${c})`:"",h=i.status||"";this.log("receive",`${h} ${r} ${a} ${u}`.trim(),i),this.channels.filter(p=>p._isMember(r)).forEach(p=>p._trigger(a,i,c)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===$s.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===$s.open||this.conn.readyState===$s.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(n=>{this.log("error","error waiting for auth on connect",n),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this._terminateWorker()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(hr.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;const r=e.match(/\?/)?"&":"?",a=new URLSearchParams(n);return`${e}${r}${a}`}_workerObjectUrl(e){let n;if(e)n=e;else{const r=new Blob([lR],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n,r=!1;if(e)n=e,r=!0;else if(this.accessToken)try{n=await this.accessToken()}catch(a){this.log("error","Error fetching access token from callback",a),n=this.accessTokenValue}else n=this.accessTokenValue;r?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(a=>{const i={access_token:n,version:YE};n&&a.updateJoinPayload(i),a.joinedOnce&&a._isJoined()&&a._push(hr.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(n=>{this.log("error",`Error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(a){this.log("error",`error in ${e} callback`,a)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new QS(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Fd.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,a,i,c,u,h,p,m,g,x,v;switch(this.transport=(n=e?.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:eg,this.heartbeatIntervalMs=(a=e?.heartbeatIntervalMs)!==null&&a!==void 0?a:Fd.HEARTBEAT_INTERVAL,this.worker=(i=e?.worker)!==null&&i!==void 0?i:!1,this.accessToken=(c=e?.accessToken)!==null&&c!==void 0?c:null,this.heartbeatCallback=(u=e?.heartbeatCallback)!==null&&u!==void 0?u:lm,this.vsn=(h=e?.vsn)!==null&&h!==void 0?h:lw,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(p=e?.reconnectAfterMs)!==null&&p!==void 0?p:(w=>iR[w-1]||oR),this.vsn){case JS:this.encode=(m=e?.encode)!==null&&m!==void 0?m:((w,N)=>N(JSON.stringify(w))),this.decode=(g=e?.decode)!==null&&g!==void 0?g:((w,N)=>N(JSON.parse(w)));break;case JE:this.encode=(x=e?.encode)!==null&&x!==void 0?x:this.serializer.encode.bind(this.serializer),this.decode=(v=e?.decode)!==null&&v!==void 0?v:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}var Jl=class extends Error{constructor(t,e){super(t),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function dR(t,e,n){const r=new URL(e,t);if(n)for(const[a,i]of Object.entries(n))i!==void 0&&r.searchParams.set(a,i);return r.toString()}async function uR(t){return!t||t.type==="none"?{}:t.type==="bearer"?{Authorization:`Bearer ${t.token}`}:t.type==="header"?{[t.name]:t.value}:t.type==="custom"?await t.getHeaders():{}}function hR(t){const e=t.fetchImpl??globalThis.fetch;return{async request({method:n,path:r,query:a,body:i,headers:c}){const u=dR(t.baseUrl,r,a),h=await uR(t.auth),p=await e(u,{method:n,headers:{...i?{"Content-Type":"application/json"}:{},...h,...c},body:i?JSON.stringify(i):void 0}),m=await p.text(),g=(p.headers.get("content-type")||"").includes("application/json"),x=g&&m?JSON.parse(m):m;if(!p.ok){const v=g?x:void 0,w=v?.error;throw new Jl(w?.message??`Request failed with status ${p.status}`,{status:p.status,icebergType:w?.type,icebergCode:w?.code,details:v})}return{status:p.status,headers:p.headers,data:x}}}}function Gd(t){return t.join("")}var fR=class{constructor(t,e=""){this.client=t,this.prefix=e}async listNamespaces(t){const e=t?{parent:Gd(t.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(r=>({namespace:r}))}async createNamespace(t,e){const n={namespace:t.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:n})).data}async dropNamespace(t){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Gd(t.namespace)}`})}async loadNamespaceMetadata(t){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Gd(t.namespace)}`})).data.properties}}async namespaceExists(t){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Gd(t.namespace)}`}),!0}catch(e){if(e instanceof Jl&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(t,e){try{return await this.createNamespace(t,e)}catch(n){if(n instanceof Jl&&n.status===409)return;throw n}}};function Pi(t){return t.join("")}var pR=class{constructor(t,e="",n){this.client=t,this.prefix=e,this.accessDelegation=n}async listTables(t){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Pi(t.namespace)}/tables`})).data.identifiers}async createTable(t,e){const n={};return this.accessDelegation&&(n["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Pi(t.namespace)}/tables`,body:e,headers:n})).data.metadata}async updateTable(t,e){const n=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Pi(t.namespace)}/tables/${t.name}`,body:e});return{"metadata-location":n.data["metadata-location"],metadata:n.data.metadata}}async dropTable(t,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Pi(t.namespace)}/tables/${t.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(t){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Pi(t.namespace)}/tables/${t.name}`,headers:e})).data.metadata}async tableExists(t){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Pi(t.namespace)}/tables/${t.name}`,headers:e}),!0}catch(n){if(n instanceof Jl&&n.status===404)return!1;throw n}}async createTableIfNotExists(t,e){try{return await this.createTable(t,e)}catch(n){if(n instanceof Jl&&n.status===409)return await this.loadTable({namespace:t.namespace,name:e.name});throw n}}},mR=class{constructor(t){let e="v1";t.catalogName&&(e+=`/${t.catalogName}`);const n=t.baseUrl.endsWith("/")?t.baseUrl:`${t.baseUrl}/`;this.client=hR({baseUrl:n,auth:t.auth,fetchImpl:t.fetch}),this.accessDelegation=t.accessDelegation?.join(","),this.namespaceOps=new fR(this.client,e),this.tableOps=new pR(this.client,e,this.accessDelegation)}async listNamespaces(t){return this.namespaceOps.listNamespaces(t)}async createNamespace(t,e){return this.namespaceOps.createNamespace(t,e)}async dropNamespace(t){await this.namespaceOps.dropNamespace(t)}async loadNamespaceMetadata(t){return this.namespaceOps.loadNamespaceMetadata(t)}async listTables(t){return this.tableOps.listTables(t)}async createTable(t,e){return this.tableOps.createTable(t,e)}async updateTable(t,e){return this.tableOps.updateTable(t,e)}async dropTable(t,e){await this.tableOps.dropTable(t,e)}async loadTable(t){return this.tableOps.loadTable(t)}async namespaceExists(t){return this.namespaceOps.namespaceExists(t)}async tableExists(t){return this.tableOps.tableExists(t)}async createNamespaceIfNotExists(t,e){return this.namespaceOps.createNamespaceIfNotExists(t,e)}async createTableIfNotExists(t,e){return this.tableOps.createTableIfNotExists(t,e)}},mh=class extends Error{constructor(t){super(t),this.__isStorageError=!0,this.name="StorageError"}};function ht(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var gR=class extends mh{constructor(t,e,n){super(t),this.name="StorageApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},rg=class extends mh{constructor(t,e){super(t),this.name="StorageUnknownError",this.originalError=e}};const Jg=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),yR=()=>Response,sg=t=>{if(Array.isArray(t))return t.map(n=>sg(n));if(typeof t=="function"||t!==Object(t))return t;const e={};return Object.entries(t).forEach(([n,r])=>{const a=n.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[a]=sg(r)}),e},xR=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},bR=t=>!t||typeof t!="string"||t.length===0||t.length>100||t.trim()!==t||t.includes("/")||t.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(t);function Ql(t){"@babel/helpers - typeof";return Ql=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ql(t)}function vR(t,e){if(Ql(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(Ql(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function wR(t){var e=vR(t,"string");return Ql(e)=="symbol"?e:e+""}function SR(t,e,n){return(e=wR(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function hw(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function Ae(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?hw(Object(n),!0).forEach(function(r){SR(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hw(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const cm=t=>{var e;return t.msg||t.message||t.error_description||(typeof t.error=="string"?t.error:(e=t.error)===null||e===void 0?void 0:e.message)||JSON.stringify(t)},NR=async(t,e,n)=>{t instanceof await yR()&&!n?.noResolveJson?t.json().then(r=>{const a=t.status||500,i=r?.statusCode||a+"";e(new gR(cm(r),a,i))}).catch(r=>{e(new rg(cm(r),r))}):e(new rg(cm(t),t))},kR=(t,e,n,r)=>{const a={method:t,headers:e?.headers||{}};return t==="GET"||!r?a:(xR(r)?(a.headers=Ae({"Content-Type":"application/json"},e?.headers),a.body=JSON.stringify(r)):a.body=r,e?.duplex&&(a.duplex=e.duplex),Ae(Ae({},a),n))};async function xc(t,e,n,r,a,i){return new Promise((c,u)=>{t(n,kR(e,r,a,i)).then(h=>{if(!h.ok)throw h;return r?.noResolveJson?h:h.json()}).then(h=>c(h)).catch(h=>NR(h,u,r))})}async function Xl(t,e,n,r){return xc(t,"GET",e,n,r)}async function ur(t,e,n,r,a){return xc(t,"POST",e,r,a,n)}async function ag(t,e,n,r,a){return xc(t,"PUT",e,r,a,n)}async function jR(t,e,n,r){return xc(t,"HEAD",e,Ae(Ae({},n),{},{noResolveJson:!0}),r)}async function Qg(t,e,n,r,a){return xc(t,"DELETE",e,r,a,n)}var CR=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e}then(t,e){return this.execute().then(t,e)}async execute(){var t=this;try{return{data:(await t.downloadFn()).body,error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(ht(e))return{data:null,error:e};throw e}}};let eN;eN=Symbol.toStringTag;var TR=class{constructor(t,e){this.downloadFn=t,this.shouldThrowOnError=e,this[eN]="BlobDownloadBuilder",this.promise=null}asStream(){return new CR(this.downloadFn,this.shouldThrowOnError)}then(t,e){return this.getPromise().then(t,e)}catch(t){return this.getPromise().catch(t)}finally(t){return this.getPromise().finally(t)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var t=this;try{return{data:await(await t.downloadFn()).blob(),error:null}}catch(e){if(t.shouldThrowOnError)throw e;if(ht(e))return{data:null,error:e};throw e}}};const ER={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},fw={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var RR=class{constructor(t,e={},n,r){this.shouldThrowOnError=!1,this.url=t,this.headers=e,this.bucketId=n,this.fetch=Jg(r)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(t,e,n,r){var a=this;try{let i;const c=Ae(Ae({},fw),r);let u=Ae(Ae({},a.headers),t==="POST"&&{"x-upsert":String(c.upsert)});const h=c.metadata;typeof Blob<"u"&&n instanceof Blob?(i=new FormData,i.append("cacheControl",c.cacheControl),h&&i.append("metadata",a.encodeMetadata(h)),i.append("",n)):typeof FormData<"u"&&n instanceof FormData?(i=n,i.has("cacheControl")||i.append("cacheControl",c.cacheControl),h&&!i.has("metadata")&&i.append("metadata",a.encodeMetadata(h))):(i=n,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType,h&&(u["x-metadata"]=a.toBase64(a.encodeMetadata(h))),(typeof ReadableStream<"u"&&i instanceof ReadableStream||i&&typeof i=="object"&&"pipe"in i&&typeof i.pipe=="function")&&!c.duplex&&(c.duplex="half")),r?.headers&&(u=Ae(Ae({},u),r.headers));const p=a._removeEmptyFolders(e),m=a._getFinalPath(p),g=await(t=="PUT"?ag:ur)(a.fetch,`${a.url}/object/${m}`,i,Ae({headers:u},c?.duplex?{duplex:c.duplex}:{}));return{data:{path:p,id:g.Id,fullPath:g.Key},error:null}}catch(i){if(a.shouldThrowOnError)throw i;if(ht(i))return{data:null,error:i};throw i}}async upload(t,e,n){return this.uploadOrUpdate("POST",t,e,n)}async uploadToSignedUrl(t,e,n,r){var a=this;const i=a._removeEmptyFolders(t),c=a._getFinalPath(i),u=new URL(a.url+`/object/upload/sign/${c}`);u.searchParams.set("token",e);try{let h;const p=Ae({upsert:fw.upsert},r),m=Ae(Ae({},a.headers),{"x-upsert":String(p.upsert)});return typeof Blob<"u"&&n instanceof Blob?(h=new FormData,h.append("cacheControl",p.cacheControl),h.append("",n)):typeof FormData<"u"&&n instanceof FormData?(h=n,h.append("cacheControl",p.cacheControl)):(h=n,m["cache-control"]=`max-age=${p.cacheControl}`,m["content-type"]=p.contentType),{data:{path:i,fullPath:(await ag(a.fetch,u.toString(),h,{headers:m})).Key},error:null}}catch(h){if(a.shouldThrowOnError)throw h;if(ht(h))return{data:null,error:h};throw h}}async createSignedUploadUrl(t,e){var n=this;try{let r=n._getFinalPath(t);const a=Ae({},n.headers);e?.upsert&&(a["x-upsert"]="true");const i=await ur(n.fetch,`${n.url}/object/upload/sign/${r}`,{},{headers:a}),c=new URL(n.url+i.url),u=c.searchParams.get("token");if(!u)throw new mh("No token returned by API");return{data:{signedUrl:c.toString(),path:t,token:u},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ht(r))return{data:null,error:r};throw r}}async update(t,e,n){return this.uploadOrUpdate("PUT",t,e,n)}async move(t,e,n){var r=this;try{return{data:await ur(r.fetch,`${r.url}/object/move`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n?.destinationBucket},{headers:r.headers}),error:null}}catch(a){if(r.shouldThrowOnError)throw a;if(ht(a))return{data:null,error:a};throw a}}async copy(t,e,n){var r=this;try{return{data:{path:(await ur(r.fetch,`${r.url}/object/copy`,{bucketId:r.bucketId,sourceKey:t,destinationKey:e,destinationBucket:n?.destinationBucket},{headers:r.headers})).Key},error:null}}catch(a){if(r.shouldThrowOnError)throw a;if(ht(a))return{data:null,error:a};throw a}}async createSignedUrl(t,e,n){var r=this;try{let a=r._getFinalPath(t),i=await ur(r.fetch,`${r.url}/object/sign/${a}`,Ae({expiresIn:e},n?.transform?{transform:n.transform}:{}),{headers:r.headers});const c=n?.download?`&download=${n.download===!0?"":n.download}`:"";return i={signedUrl:encodeURI(`${r.url}${i.signedURL}${c}`)},{data:i,error:null}}catch(a){if(r.shouldThrowOnError)throw a;if(ht(a))return{data:null,error:a};throw a}}async createSignedUrls(t,e,n){var r=this;try{const a=await ur(r.fetch,`${r.url}/object/sign/${r.bucketId}`,{expiresIn:e,paths:t},{headers:r.headers}),i=n?.download?`&download=${n.download===!0?"":n.download}`:"";return{data:a.map(c=>Ae(Ae({},c),{},{signedUrl:c.signedURL?encodeURI(`${r.url}${c.signedURL}${i}`):null})),error:null}}catch(a){if(r.shouldThrowOnError)throw a;if(ht(a))return{data:null,error:a};throw a}}download(t,e){const n=typeof e?.transform<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString(e?.transform||{}),a=r?`?${r}`:"",i=this._getFinalPath(t),c=()=>Xl(this.fetch,`${this.url}/${n}/${i}${a}`,{headers:this.headers,noResolveJson:!0});return new TR(c,this.shouldThrowOnError)}async info(t){var e=this;const n=e._getFinalPath(t);try{return{data:sg(await Xl(e.fetch,`${e.url}/object/info/${n}`,{headers:e.headers})),error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(ht(r))return{data:null,error:r};throw r}}async exists(t){var e=this;const n=e._getFinalPath(t);try{return await jR(e.fetch,`${e.url}/object/${n}`,{headers:e.headers}),{data:!0,error:null}}catch(r){if(e.shouldThrowOnError)throw r;if(ht(r)&&r instanceof rg){const a=r.originalError;if([400,404].includes(a?.status))return{data:!1,error:r}}throw r}}getPublicUrl(t,e){const n=this._getFinalPath(t),r=[],a=e?.download?`download=${e.download===!0?"":e.download}`:"";a!==""&&r.push(a);const i=typeof e?.transform<"u"?"render/image":"object",c=this.transformOptsToQueryString(e?.transform||{});c!==""&&r.push(c);let u=r.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${n}${u}`)}}}async remove(t){var e=this;try{return{data:await Qg(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ht(n))return{data:null,error:n};throw n}}async list(t,e,n){var r=this;try{const a=Ae(Ae(Ae({},ER),e),{},{prefix:t||""});return{data:await ur(r.fetch,`${r.url}/object/list/${r.bucketId}`,a,{headers:r.headers},n),error:null}}catch(a){if(r.shouldThrowOnError)throw a;if(ht(a))return{data:null,error:a};throw a}}async listV2(t,e){var n=this;try{const r=Ae({},t);return{data:await ur(n.fetch,`${n.url}/object/list-v2/${n.bucketId}`,r,{headers:n.headers},e),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ht(r))return{data:null,error:r};throw r}}encodeMetadata(t){return JSON.stringify(t)}toBase64(t){return typeof Buffer<"u"?Buffer.from(t).toString("base64"):btoa(t)}_getFinalPath(t){return`${this.bucketId}/${t.replace(/^\/+/,"")}`}_removeEmptyFolders(t){return t.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(t){const e=[];return t.width&&e.push(`width=${t.width}`),t.height&&e.push(`height=${t.height}`),t.resize&&e.push(`resize=${t.resize}`),t.format&&e.push(`format=${t.format}`),t.quality&&e.push(`quality=${t.quality}`),e.join("&")}};const tN="2.89.0",nN={"X-Client-Info":`storage-js/${tN}`};var AR=class{constructor(t,e={},n,r){this.shouldThrowOnError=!1;const a=new URL(t);r?.useNewHostname&&/supabase\.(co|in|red)$/.test(a.hostname)&&!a.hostname.includes("storage.supabase.")&&(a.hostname=a.hostname.replace("supabase.","storage.supabase.")),this.url=a.href.replace(/\/$/,""),this.headers=Ae(Ae({},nN),e),this.fetch=Jg(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(t){var e=this;try{const n=e.listBucketOptionsToQueryString(t);return{data:await Xl(e.fetch,`${e.url}/bucket${n}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ht(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await Xl(e.fetch,`${e.url}/bucket/${t}`,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ht(n))return{data:null,error:n};throw n}}async createBucket(t,e={public:!1}){var n=this;try{return{data:await ur(n.fetch,`${n.url}/bucket`,{id:t,name:t,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ht(r))return{data:null,error:r};throw r}}async updateBucket(t,e){var n=this;try{return{data:await ag(n.fetch,`${n.url}/bucket/${t}`,{id:t,name:t,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(ht(r))return{data:null,error:r};throw r}}async emptyBucket(t){var e=this;try{return{data:await ur(e.fetch,`${e.url}/bucket/${t}/empty`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ht(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Qg(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ht(n))return{data:null,error:n};throw n}}listBucketOptionsToQueryString(t){const e={};return t&&("limit"in t&&(e.limit=String(t.limit)),"offset"in t&&(e.offset=String(t.offset)),t.search&&(e.search=t.search),t.sortColumn&&(e.sortColumn=t.sortColumn),t.sortOrder&&(e.sortOrder=t.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},_R=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Ae(Ae({},nN),e),this.fetch=Jg(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await ur(e.fetch,`${e.url}/bucket`,{name:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ht(n))return{data:null,error:n};throw n}}async listBuckets(t){var e=this;try{const n=new URLSearchParams;t?.limit!==void 0&&n.set("limit",t.limit.toString()),t?.offset!==void 0&&n.set("offset",t.offset.toString()),t?.sortColumn&&n.set("sortColumn",t.sortColumn),t?.sortOrder&&n.set("sortOrder",t.sortOrder),t?.search&&n.set("search",t.search);const r=n.toString(),a=r?`${e.url}/bucket?${r}`:`${e.url}/bucket`;return{data:await Xl(e.fetch,a,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ht(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await Qg(e.fetch,`${e.url}/bucket/${t}`,{},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(ht(n))return{data:null,error:n};throw n}}from(t){var e=this;if(!bR(t))throw new mh("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const n=new mR({baseUrl:this.url,catalogName:t,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),r=this.shouldThrowOnError;return new Proxy(n,{get(a,i){const c=a[i];return typeof c!="function"?c:async(...u)=>{try{return{data:await c.apply(a,u),error:null}}catch(h){if(r)throw h;return{data:null,error:h}}}}})}};const Xg={"X-Client-Info":`storage-js/${tN}`,"Content-Type":"application/json"};var rN=class extends Error{constructor(t){super(t),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function Ln(t){return typeof t=="object"&&t!==null&&"__isStorageVectorsError"in t}var dm=class extends rN{constructor(t,e,n){super(t),this.name="StorageVectorsApiError",this.status=e,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},MR=class extends rN{constructor(t,e){super(t),this.name="StorageVectorsUnknownError",this.originalError=e}};const Zg=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),OR=t=>{if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},pw=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),DR=async(t,e,n)=>{if(t&&typeof t=="object"&&"status"in t&&"ok"in t&&typeof t.status=="number"&&!n?.noResolveJson){const r=t.status||500,a=t;if(typeof a.json=="function")a.json().then(i=>{const c=i?.statusCode||i?.code||r+"";e(new dm(pw(i),r,c))}).catch(()=>{const i=r+"";e(new dm(a.statusText||`HTTP ${r} error`,r,i))});else{const i=r+"";e(new dm(a.statusText||`HTTP ${r} error`,r,i))}}else e(new MR(pw(t),t))},LR=(t,e,n,r)=>{const a={method:t,headers:e?.headers||{}};return r?(OR(r)?(a.headers=Ae({"Content-Type":"application/json"},e?.headers),a.body=JSON.stringify(r)):a.body=r,Ae(Ae({},a),n)):a};async function $R(t,e,n,r,a,i){return new Promise((c,u)=>{t(n,LR(e,r,a,i)).then(h=>{if(!h.ok)throw h;if(r?.noResolveJson)return h;const p=h.headers.get("content-type");return!p||!p.includes("application/json")?{}:h.json()}).then(h=>c(h)).catch(h=>DR(h,u,r))})}async function $n(t,e,n,r,a){return $R(t,"POST",e,r,a,n)}var BR=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Ae(Ae({},Xg),e),this.fetch=Zg(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(t){var e=this;try{return{data:await $n(e.fetch,`${e.url}/CreateIndex`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ln(n))return{data:null,error:n};throw n}}async getIndex(t,e){var n=this;try{return{data:await $n(n.fetch,`${n.url}/GetIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers}),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Ln(r))return{data:null,error:r};throw r}}async listIndexes(t){var e=this;try{return{data:await $n(e.fetch,`${e.url}/ListIndexes`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ln(n))return{data:null,error:n};throw n}}async deleteIndex(t,e){var n=this;try{return{data:await $n(n.fetch,`${n.url}/DeleteIndex`,{vectorBucketName:t,indexName:e},{headers:n.headers})||{},error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(Ln(r))return{data:null,error:r};throw r}}},IR=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Ae(Ae({},Xg),e),this.fetch=Zg(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(t){var e=this;try{if(t.vectors.length<1||t.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await $n(e.fetch,`${e.url}/PutVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ln(n))return{data:null,error:n};throw n}}async getVectors(t){var e=this;try{return{data:await $n(e.fetch,`${e.url}/GetVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ln(n))return{data:null,error:n};throw n}}async listVectors(t){var e=this;try{if(t.segmentCount!==void 0){if(t.segmentCount<1||t.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(t.segmentIndex!==void 0&&(t.segmentIndex<0||t.segmentIndex>=t.segmentCount))throw new Error(`segmentIndex must be between 0 and ${t.segmentCount-1}`)}return{data:await $n(e.fetch,`${e.url}/ListVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ln(n))return{data:null,error:n};throw n}}async queryVectors(t){var e=this;try{return{data:await $n(e.fetch,`${e.url}/QueryVectors`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ln(n))return{data:null,error:n};throw n}}async deleteVectors(t){var e=this;try{if(t.keys.length<1||t.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await $n(e.fetch,`${e.url}/DeleteVectors`,t,{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ln(n))return{data:null,error:n};throw n}}},PR=class{constructor(t,e={},n){this.shouldThrowOnError=!1,this.url=t.replace(/\/$/,""),this.headers=Ae(Ae({},Xg),e),this.fetch=Zg(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(t){var e=this;try{return{data:await $n(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ln(n))return{data:null,error:n};throw n}}async getBucket(t){var e=this;try{return{data:await $n(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:t},{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ln(n))return{data:null,error:n};throw n}}async listBuckets(t={}){var e=this;try{return{data:await $n(e.fetch,`${e.url}/ListVectorBuckets`,t,{headers:e.headers}),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ln(n))return{data:null,error:n};throw n}}async deleteBucket(t){var e=this;try{return{data:await $n(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:t},{headers:e.headers})||{},error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(Ln(n))return{data:null,error:n};throw n}}},zR=class extends PR{constructor(t,e={}){super(t,e.headers||{},e.fetch)}from(t){return new UR(this.url,this.headers,t,this.fetch)}async createBucket(t){var e=()=>super.createBucket,n=this;return e().call(n,t)}async getBucket(t){var e=()=>super.getBucket,n=this;return e().call(n,t)}async listBuckets(t={}){var e=()=>super.listBuckets,n=this;return e().call(n,t)}async deleteBucket(t){var e=()=>super.deleteBucket,n=this;return e().call(n,t)}},UR=class extends BR{constructor(t,e,n,r){super(t,e,r),this.vectorBucketName=n}async createIndex(t){var e=()=>super.createIndex,n=this;return e().call(n,Ae(Ae({},t),{},{vectorBucketName:n.vectorBucketName}))}async listIndexes(t={}){var e=()=>super.listIndexes,n=this;return e().call(n,Ae(Ae({},t),{},{vectorBucketName:n.vectorBucketName}))}async getIndex(t){var e=()=>super.getIndex,n=this;return e().call(n,n.vectorBucketName,t)}async deleteIndex(t){var e=()=>super.deleteIndex,n=this;return e().call(n,n.vectorBucketName,t)}index(t){return new HR(this.url,this.headers,this.vectorBucketName,t,this.fetch)}},HR=class extends IR{constructor(t,e,n,r,a){super(t,e,a),this.vectorBucketName=n,this.indexName=r}async putVectors(t){var e=()=>super.putVectors,n=this;return e().call(n,Ae(Ae({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async getVectors(t){var e=()=>super.getVectors,n=this;return e().call(n,Ae(Ae({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async listVectors(t={}){var e=()=>super.listVectors,n=this;return e().call(n,Ae(Ae({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async queryVectors(t){var e=()=>super.queryVectors,n=this;return e().call(n,Ae(Ae({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}async deleteVectors(t){var e=()=>super.deleteVectors,n=this;return e().call(n,Ae(Ae({},t),{},{vectorBucketName:n.vectorBucketName,indexName:n.indexName}))}},VR=class extends AR{constructor(t,e={},n,r){super(t,e,n,r)}from(t){return new RR(this.url,this.headers,t,this.fetch)}get vectors(){return new zR(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new _R(this.url+"/iceberg",this.headers,this.fetch)}};const sN="2.89.0",Zi=30*1e3,ig=3,um=ig*Zi,FR="http://localhost:9999",GR="supabase.auth.token",qR={"X-Client-Info":`gotrue-js/${sN}`},og="X-Supabase-Api-Version",aN={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},WR=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,KR=600*1e3;class Zl extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}}function ke(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}class YR extends Zl{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}}function JR(t){return ke(t)&&t.name==="AuthApiError"}class Aa extends Zl{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}}class ss extends Zl{constructor(e,n,r,a){super(e,r,a),this.name=n,this.status=r}}class Dn extends ss{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function QR(t){return ke(t)&&t.name==="AuthSessionMissingError"}class zi extends ss{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class qd extends ss{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Wd extends ss{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function XR(t){return ke(t)&&t.name==="AuthImplicitGrantRedirectError"}class mw extends ss{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ZR extends ss{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class lg extends ss{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}}function hm(t){return ke(t)&&t.name==="AuthRetryableFetchError"}class gw extends ss{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}}class cg extends ss{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const bu="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),yw=` 	
\r=`.split(""),eA=(()=>{const t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<yw.length;e+=1)t[yw[e].charCodeAt(0)]=-2;for(let e=0;e<bu.length;e+=1)t[bu[e].charCodeAt(0)]=e;return t})();function xw(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(bu[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;n(bu[r]),e.queuedBits-=6}}function iN(t,e,n){const r=eA[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function bw(t){const e=[],n=c=>{e.push(String.fromCodePoint(c))},r={utf8seq:0,codepoint:0},a={queue:0,queuedBits:0},i=c=>{rA(c,r,n)};for(let c=0;c<t.length;c+=1)iN(t.charCodeAt(c),a,i);return e.join("")}function tA(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function nA(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){const a=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|a)+65536,n+=1}tA(r,e)}}function rA(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if((t>>7-r&1)===0){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function lo(t){const e=[],n={queue:0,queuedBits:0},r=a=>{e.push(a)};for(let a=0;a<t.length;a+=1)iN(t.charCodeAt(a),n,r);return new Uint8Array(e)}function sA(t){const e=[];return nA(t,n=>e.push(n)),new Uint8Array(e)}function Ma(t){const e=[],n={queue:0,queuedBits:0},r=a=>{e.push(a)};return t.forEach(a=>xw(a,n,r)),xw(null,n,r),e.join("")}function aA(t){return Math.round(Date.now()/1e3)+t}function iA(){return Symbol("auth-callback")}const Xt=()=>typeof window<"u"&&typeof document<"u",Na={tested:!1,writable:!1},oN=()=>{if(!Xt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Na.tested)return Na.writable;const t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Na.tested=!0,Na.writable=!0}catch{Na.tested=!0,Na.writable=!1}return Na.writable};function oA(t){const e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((a,i)=>{e[i]=a})}catch{}return n.searchParams.forEach((r,a)=>{e[a]=r}),e}const lN=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),lA=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",eo=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},ka=async(t,e)=>{const n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},Qt=async(t,e)=>{await t.removeItem(e)};class gh{constructor(){this.promise=new gh.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}}gh.promiseConstructor=Promise;function fm(t){const e=t.split(".");if(e.length!==3)throw new cg("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!WR.test(e[r]))throw new cg("JWT not in base64url format");return{header:JSON.parse(bw(e[0])),payload:JSON.parse(bw(e[1])),signature:lo(e[2]),raw:{header:e[0],payload:e[1]}}}async function cA(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function dA(t,e){return new Promise((r,a)=>{(async()=>{for(let i=0;i<1/0;i++)try{const c=await t(i);if(!e(i,null,c)){r(c);return}}catch(c){if(!e(i,c)){a(c);return}}})()})}function uA(t){return("0"+t.toString(16)).substr(-2)}function hA(){const e=new Uint32Array(56);if(typeof crypto>"u"){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length;let a="";for(let i=0;i<56;i++)a+=n.charAt(Math.floor(Math.random()*r));return a}return crypto.getRandomValues(e),Array.from(e,uA).join("")}async function fA(t){const n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),a=new Uint8Array(r);return Array.from(a).map(i=>String.fromCharCode(i)).join("")}async function pA(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;const n=await fA(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ui(t,e,n=!1){const r=hA();let a=r;n&&(a+="/PASSWORD_RECOVERY"),await eo(t,`${e}-code-verifier`,a);const i=await pA(r);return[i,r===i?"plain":"s256"]}const mA=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function gA(t){const e=t.headers.get(og);if(!e||!e.match(mA))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function yA(t){if(!t)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function xA(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const bA=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Hi(t){if(!bA.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function pm(){const t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){const r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function vA(t,e){return new Proxy(t,{get:(n,r,a)=>{if(r==="__isInsecureUserWarningProxy")return!0;if(typeof r=="symbol"){const i=r.toString();if(i==="Symbol(Symbol.toPrimitive)"||i==="Symbol(Symbol.toStringTag)"||i==="Symbol(util.inspect.custom)"||i==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(n,r,a)}return!e.value&&typeof r=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(n,r,a)}})}function vw(t){return JSON.parse(JSON.stringify(t))}const Ea=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),wA=[502,503,504];async function ww(t){var e;if(!lA(t))throw new lg(Ea(t),0);if(wA.includes(t.status))throw new lg(Ea(t),t.status);let n;try{n=await t.json()}catch(i){throw new Aa(Ea(i),i)}let r;const a=gA(t);if(a&&a.getTime()>=aN["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new gw(Ea(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Dn}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((i,c)=>i&&typeof c=="string",!0))throw new gw(Ea(n),t.status,n.weak_password.reasons);throw new YR(Ea(n),t.status||500,r)}const SA=(t,e,n,r)=>{const a={method:t,headers:e?.headers||{}};return t==="GET"?a:(a.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),a.body=JSON.stringify(r),Object.assign(Object.assign({},a),n))};async function Re(t,e,n,r){var a;const i=Object.assign({},r?.headers);i[og]||(i[og]=aN["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const c=(a=r?.query)!==null&&a!==void 0?a:{};r?.redirectTo&&(c.redirect_to=r.redirectTo);const u=Object.keys(c).length?"?"+new URLSearchParams(c).toString():"",h=await NA(t,e,n+u,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(h):{data:Object.assign({},h),error:null}}async function NA(t,e,n,r,a,i){const c=SA(e,r,a,i);let u;try{u=await t(n,Object.assign({},c))}catch(h){throw console.error(h),new lg(Ea(h),0)}if(u.ok||await ww(u),r?.noResolveJson)return u;try{return await u.json()}catch(h){await ww(h)}}function dr(t){var e;let n=null;CA(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=aA(t.expires_in)));const r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function Sw(t){const e=dr(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function zs(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function kA(t){return{data:t,error:null}}function jA(t){const{action_link:e,email_otp:n,hashed_token:r,redirect_to:a,verification_type:i}=t,c=ph(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),u={action_link:e,email_otp:n,hashed_token:r,redirect_to:a,verification_type:i},h=Object.assign({},c);return{data:{properties:u,user:h},error:null}}function Nw(t){return t}function CA(t){return t.access_token&&t.refresh_token&&t.expires_in}const mm=["global","local","others"];class TA{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=lN(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,n=mm[0]){if(mm.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${mm.join(", ")}`);try{return await Re(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(ke(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await Re(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:zs})}catch(r){if(ke(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:n}=e,r=ph(e,["options"]),a=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(a.new_email=r?.newEmail,delete a.newEmail),await Re(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:a,headers:this.headers,xform:jA,redirectTo:n?.redirectTo})}catch(n){if(ke(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await Re(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:zs})}catch(n){if(ke(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,a,i,c,u,h;try{const p={nextPage:null,lastPage:0,total:0},m=await Re(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e?.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(a=e?.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:Nw});if(m.error)throw m.error;const g=await m.json(),x=(c=m.headers.get("x-total-count"))!==null&&c!==void 0?c:0,v=(h=(u=m.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&h!==void 0?h:[];return v.length>0&&(v.forEach(w=>{const N=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(w.split(";")[1].split("=")[1]);p[`${S}Page`]=N}),p.total=parseInt(x)),{data:Object.assign(Object.assign({},g),p),error:null}}catch(p){if(ke(p))return{data:{users:[]},error:p};throw p}}async getUserById(e){Hi(e);try{return await Re(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:zs})}catch(n){if(ke(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){Hi(e);try{return await Re(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:zs})}catch(r){if(ke(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){Hi(e);try{return await Re(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:zs})}catch(r){if(ke(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){Hi(e.userId);try{const{data:n,error:r}=await Re(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:n,error:r}}catch(n){if(ke(n))return{data:null,error:n};throw n}}async _deleteFactor(e){Hi(e.userId),Hi(e.id);try{return{data:await Re(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(ke(n))return{data:null,error:n};throw n}}async _listOAuthClients(e){var n,r,a,i,c,u,h;try{const p={nextPage:null,lastPage:0,total:0},m=await Re(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e?.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(i=(a=e?.perPage)===null||a===void 0?void 0:a.toString())!==null&&i!==void 0?i:""},xform:Nw});if(m.error)throw m.error;const g=await m.json(),x=(c=m.headers.get("x-total-count"))!==null&&c!==void 0?c:0,v=(h=(u=m.headers.get("link"))===null||u===void 0?void 0:u.split(","))!==null&&h!==void 0?h:[];return v.length>0&&(v.forEach(w=>{const N=parseInt(w.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(w.split(";")[1].split("=")[1]);p[`${S}Page`]=N}),p.total=parseInt(x)),{data:Object.assign(Object.assign({},g),p),error:null}}catch(p){if(ke(p))return{data:{clients:[]},error:p};throw p}}async _createOAuthClient(e){try{return await Re(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(ke(n))return{data:null,error:n};throw n}}async _getOAuthClient(e){try{return await Re(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(ke(n))return{data:null,error:n};throw n}}async _updateOAuthClient(e,n){try{return await Re(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:n,headers:this.headers,xform:r=>({data:r,error:null})})}catch(r){if(ke(r))return{data:null,error:r};throw r}}async _deleteOAuthClient(e){try{return await Re(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(n){if(ke(n))return{data:null,error:n};throw n}}async _regenerateOAuthClientSecret(e){try{return await Re(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(ke(n))return{data:null,error:n};throw n}}}function kw(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}const Vi={debug:!!(globalThis&&oN()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class cN extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class EA extends cN{}async function RA(t,e,n){Vi.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Vi.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async a=>{if(a){Vi.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,a.name);try{return await n()}finally{Vi.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,a.name)}}else{if(e===0)throw Vi.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new EA(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Vi.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function AA(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function dN(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function _A(t){return parseInt(t,16)}function MA(t){const e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function OA(t){var e;const{chainId:n,domain:r,expirationTime:a,issuedAt:i=new Date,nonce:c,notBefore:u,requestId:h,resources:p,scheme:m,uri:g,version:x}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(c&&c.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${c}`);if(!g)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(x!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${x}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}const v=dN(t.address),w=m?`${m}://${r}`:r,N=t.statement?`${t.statement}
`:"",S=`${w} wants you to sign in with your Ethereum account:
${v}

${N}`;let j=`URI: ${g}
Version: ${x}
Chain ID: ${n}${c?`
Nonce: ${c}`:""}
Issued At: ${i.toISOString()}`;if(a&&(j+=`
Expiration Time: ${a.toISOString()}`),u&&(j+=`
Not Before: ${u.toISOString()}`),h&&(j+=`
Request ID: ${h}`),p){let A=`
Resources:`;for(const $ of p){if(!$||typeof $!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${$}`);A+=`
- ${$}`}j+=A}return`${S}
${j}`}class _t extends Error{constructor({message:e,code:n,cause:r,name:a}){var i;super(e,{cause:r}),this.__isWebAuthnError=!0,this.name=(i=a??(r instanceof Error?r.name:void 0))!==null&&i!==void 0?i:"Unknown Error",this.code=n}}class vu extends _t{constructor(e,n){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n,message:e}),this.name="WebAuthnUnknownError",this.originalError=n}}function DA({error:t,options:e}){var n,r,a;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new _t({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else if(t.name==="ConstraintError"){if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.requireResidentKey)===!0)return new _t({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:t});if(e.mediation==="conditional"&&((r=i.authenticatorSelection)===null||r===void 0?void 0:r.userVerification)==="required")return new _t({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:t});if(((a=i.authenticatorSelection)===null||a===void 0?void 0:a.userVerification)==="required")return new _t({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:t})}else{if(t.name==="InvalidStateError")return new _t({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:t});if(t.name==="NotAllowedError")return new _t({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(u=>u.type==="public-key").length===0?new _t({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:t}):new _t({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:t});if(t.name==="SecurityError"){const c=window.location.hostname;if(uN(c)){if(i.rp.id!==c)return new _t({message:`The RP ID "${i.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new _t({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new _t({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:t})}else if(t.name==="UnknownError")return new _t({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new _t({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}function LA({error:t,options:e}){const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal instanceof AbortSignal)return new _t({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:t})}else{if(t.name==="NotAllowedError")return new _t({message:t.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t});if(t.name==="SecurityError"){const r=window.location.hostname;if(uN(r)){if(n.rpId!==r)return new _t({message:`The RP ID "${n.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:t})}else return new _t({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:t})}else if(t.name==="UnknownError")return new _t({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:t})}return new _t({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t})}class $A{createNewAbortSignal(){if(this.controller){const n=new Error("Cancelling existing WebAuthn API call for new one");n.name="AbortError",this.controller.abort(n)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const BA=new $A;function IA(t){if(!t)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(t);const{challenge:e,user:n,excludeCredentials:r}=t,a=ph(t,["challenge","user","excludeCredentials"]),i=lo(e).buffer,c=Object.assign(Object.assign({},n),{id:lo(n.id).buffer}),u=Object.assign(Object.assign({},a),{challenge:i,user:c});if(r&&r.length>0){u.excludeCredentials=new Array(r.length);for(let h=0;h<r.length;h++){const p=r[h];u.excludeCredentials[h]=Object.assign(Object.assign({},p),{id:lo(p.id).buffer,type:p.type||"public-key",transports:p.transports})}}return u}function PA(t){if(!t)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(t);const{challenge:e,allowCredentials:n}=t,r=ph(t,["challenge","allowCredentials"]),a=lo(e).buffer,i=Object.assign(Object.assign({},r),{challenge:a});if(n&&n.length>0){i.allowCredentials=new Array(n.length);for(let c=0;c<n.length;c++){const u=n[c];i.allowCredentials[c]=Object.assign(Object.assign({},u),{id:lo(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return i}function zA(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t;return{id:t.id,rawId:t.id,response:{attestationObject:Ma(new Uint8Array(t.response.attestationObject)),clientDataJSON:Ma(new Uint8Array(t.response.clientDataJSON))},type:"public-key",clientExtensionResults:t.getClientExtensionResults(),authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function UA(t){var e;if("toJSON"in t&&typeof t.toJSON=="function")return t.toJSON();const n=t,r=t.getClientExtensionResults(),a=t.response;return{id:t.id,rawId:t.id,response:{authenticatorData:Ma(new Uint8Array(a.authenticatorData)),clientDataJSON:Ma(new Uint8Array(a.clientDataJSON)),signature:Ma(new Uint8Array(a.signature)),userHandle:a.userHandle?Ma(new Uint8Array(a.userHandle)):void 0},type:"public-key",clientExtensionResults:r,authenticatorAttachment:(e=n.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function uN(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}function jw(){var t,e;return!!(Xt()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((t=navigator?.credentials)===null||t===void 0?void 0:t.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function HA(t){try{const e=await navigator.credentials.create(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new vu("Browser returned unexpected credential type",e)}:{data:null,error:new vu("Empty credential response",e)}}catch(e){return{data:null,error:DA({error:e,options:t})}}}async function VA(t){try{const e=await navigator.credentials.get(t);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new vu("Browser returned unexpected credential type",e)}:{data:null,error:new vu("Empty credential response",e)}}catch(e){return{data:null,error:LA({error:e,options:t})}}}const FA={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},GA={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function wu(...t){const e=a=>a!==null&&typeof a=="object"&&!Array.isArray(a),n=a=>a instanceof ArrayBuffer||ArrayBuffer.isView(a),r={};for(const a of t)if(a)for(const i in a){const c=a[i];if(c!==void 0)if(Array.isArray(c))r[i]=c;else if(n(c))r[i]=c;else if(e(c)){const u=r[i];e(u)?r[i]=wu(u,c):r[i]=wu(c)}else r[i]=c}return r}function qA(t,e){return wu(FA,t,e||{})}function WA(t,e){return wu(GA,t,e||{})}class KA{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:n,friendlyName:r,signal:a},i){try{const{data:c,error:u}=await this.client.mfa.challenge({factorId:e,webauthn:n});if(!c)return{data:null,error:u};const h=a??BA.createNewAbortSignal();if(c.webauthn.type==="create"){const{user:p}=c.webauthn.credential_options.publicKey;p.name||(p.name=`${p.id}:${r}`),p.displayName||(p.displayName=p.name)}switch(c.webauthn.type){case"create":{const p=qA(c.webauthn.credential_options.publicKey,i?.create),{data:m,error:g}=await HA({publicKey:p,signal:h});return m?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:m}},error:null}:{data:null,error:g}}case"request":{const p=WA(c.webauthn.credential_options.publicKey,i?.request),{data:m,error:g}=await VA(Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:p,signal:h}));return m?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:m}},error:null}:{data:null,error:g}}}}catch(c){return ke(c)?{data:null,error:c}:{data:null,error:new Aa("Unexpected error in challenge",c)}}}async _verify({challengeId:e,factorId:n,webauthn:r}){return this.client.mfa.verify({factorId:n,challengeId:e,webauthn:r})}async _authenticate({factorId:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},i){if(!n)return{data:null,error:new Zl("rpId is required for WebAuthn authentication")};try{if(!jw())return{data:null,error:new Aa("Browser does not support WebAuthn",null)};const{data:c,error:u}=await this.challenge({factorId:e,webauthn:{rpId:n,rpOrigins:r},signal:a},{request:i});if(!c)return{data:null,error:u};const{webauthn:h}=c;return this._verify({factorId:e,challengeId:c.challengeId,webauthn:{type:h.type,rpId:n,rpOrigins:r,credential_response:h.credential_response}})}catch(c){return ke(c)?{data:null,error:c}:{data:null,error:new Aa("Unexpected error in authenticate",c)}}}async _register({friendlyName:e,webauthn:{rpId:n=typeof window<"u"?window.location.hostname:void 0,rpOrigins:r=typeof window<"u"?[window.location.origin]:void 0,signal:a}={}},i){if(!n)return{data:null,error:new Zl("rpId is required for WebAuthn registration")};try{if(!jw())return{data:null,error:new Aa("Browser does not support WebAuthn",null)};const{data:c,error:u}=await this._enroll({friendlyName:e});if(!c)return await this.client.mfa.listFactors().then(m=>{var g;return(g=m.data)===null||g===void 0?void 0:g.all.find(x=>x.factor_type==="webauthn"&&x.friendly_name===e&&x.status!=="unverified")}).then(m=>m?this.client.mfa.unenroll({factorId:m?.id}):void 0),{data:null,error:u};const{data:h,error:p}=await this._challenge({factorId:c.id,friendlyName:c.friendly_name,webauthn:{rpId:n,rpOrigins:r},signal:a},{create:i});return h?this._verify({factorId:c.id,challengeId:h.challengeId,webauthn:{rpId:n,rpOrigins:r,type:h.webauthn.type,credential_response:h.webauthn.credential_response}}):{data:null,error:p}}catch(c){return ke(c)?{data:null,error:c}:{data:null,error:new Aa("Unexpected error in register",c)}}}}AA();const YA={url:FR,storageKey:GR,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:qR,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function Cw(t,e,n){return await n()}const Fi={};class ec{get jwks(){var e,n;return(n=(e=Fi[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){Fi[this.storageKey]=Object.assign(Object.assign({},Fi[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=Fi[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Fi[this.storageKey]=Object.assign(Object.assign({},Fi[this.storageKey]),{cachedAt:e})}constructor(e){var n,r,a;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const i=Object.assign(Object.assign({},YA),e);if(this.storageKey=i.storageKey,this.instanceID=(n=ec.nextInstanceID[this.storageKey])!==null&&n!==void 0?n:0,ec.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.instanceID>0&&Xt()){const c=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(c),this.logDebugMessages&&console.trace(c)}if(this.persistSession=i.persistSession,this.autoRefreshToken=i.autoRefreshToken,this.admin=new TA({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=lN(i.fetch),this.lock=i.lock||Cw,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,this.throwOnError=i.throwOnError,i.lock?this.lock=i.lock:this.persistSession&&Xt()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=RA:this.lock=Cw,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new KA(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:oN()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=kw(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=kw(this.memoryStorage)),Xt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(c){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",c)}(a=this.broadcastChannel)===null||a===void 0||a.addEventListener("message",async c=>{this._debug("received broadcast notification from other tab or client",c),await this._notifyAllSubscribers(c.data.event,c.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${sN}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n={},r="none";if(Xt()&&(n=oA(window.location.href),this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce")),Xt()&&this.detectSessionInUrl&&r!=="none"){const{data:a,error:i}=await this._getSessionFromURL(n,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),XR(i)){const h=(e=i.details)===null||e===void 0?void 0:e.code;if(h==="identity_already_exists"||h==="identity_not_found"||h==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:c,redirectType:u}=a;return this._debug("#_initialize()","detected session in URL",c,"redirect type",u),await this._saveSession(c),setTimeout(async()=>{u==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",c):await this._notifyAllSubscribers("SIGNED_IN",c)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return ke(n)?this._returnResult({error:n}):this._returnResult({error:new Aa("Unexpected error during initialization",n)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,a;try{const i=await Re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e?.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(a=e?.options)===null||a===void 0?void 0:a.captchaToken}},xform:dr}),{data:c,error:u}=i;if(u||!c)return this._returnResult({data:{user:null,session:null},error:u});const h=c.session,p=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:p,session:h},error:null})}catch(i){if(ke(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signUp(e){var n,r,a;try{let i;if("email"in e){const{email:m,password:g,options:x}=e;let v=null,w=null;this.flowType==="pkce"&&([v,w]=await Ui(this.storage,this.storageKey)),i=await Re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:x?.emailRedirectTo,body:{email:m,password:g,data:(n=x?.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:x?.captchaToken},code_challenge:v,code_challenge_method:w},xform:dr})}else if("phone"in e){const{phone:m,password:g,options:x}=e;i=await Re(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:m,password:g,data:(r=x?.data)!==null&&r!==void 0?r:{},channel:(a=x?.channel)!==null&&a!==void 0?a:"sms",gotrue_meta_security:{captcha_token:x?.captchaToken}},xform:dr})}else throw new qd("You must provide either an email or phone number and a password");const{data:c,error:u}=i;if(u||!c)return await Qt(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:u});const h=c.session,p=c.user;return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",h)),this._returnResult({data:{user:p,session:h},error:null})}catch(i){if(await Qt(this.storage,`${this.storageKey}-code-verifier`),ke(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithPassword(e){try{let n;if("email"in e){const{email:i,password:c,options:u}=e;n=await Re(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:c,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Sw})}else if("phone"in e){const{phone:i,password:c,options:u}=e;n=await Re(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:c,gotrue_meta_security:{captcha_token:u?.captchaToken}},xform:Sw})}else throw new qd("You must provide either an email or phone number and a password");const{data:r,error:a}=n;if(a)return this._returnResult({data:{user:null,session:null},error:a});if(!r||!r.session||!r.user){const i=new zi;return this._returnResult({data:{user:null,session:null},error:i})}return r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),this._returnResult({data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:a})}catch(n){if(ke(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOAuth(e){var n,r,a,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(a=e.options)===null||a===void 0?void 0:a.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,a,i,c,u,h,p,m,g,x;let v,w;if("message"in e)v=e.message,w=e.signature;else{const{chain:N,wallet:S,statement:j,options:A}=e;let $;if(Xt())if(typeof S=="object")$=S;else{const W=window;if("ethereum"in W&&typeof W.ethereum=="object"&&"request"in W.ethereum&&typeof W.ethereum.request=="function")$=W.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!A?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");$=S}const L=new URL((n=A?.url)!==null&&n!==void 0?n:window.location.href),R=await $.request({method:"eth_requestAccounts"}).then(W=>W).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!R||R.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const M=dN(R[0]);let D=(r=A?.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!D){const W=await $.request({method:"eth_chainId"});D=_A(W)}const I={domain:L.host,address:M,statement:j,uri:L.href,version:"1",chainId:D,nonce:(a=A?.signInWithEthereum)===null||a===void 0?void 0:a.nonce,issuedAt:(c=(i=A?.signInWithEthereum)===null||i===void 0?void 0:i.issuedAt)!==null&&c!==void 0?c:new Date,expirationTime:(u=A?.signInWithEthereum)===null||u===void 0?void 0:u.expirationTime,notBefore:(h=A?.signInWithEthereum)===null||h===void 0?void 0:h.notBefore,requestId:(p=A?.signInWithEthereum)===null||p===void 0?void 0:p.requestId,resources:(m=A?.signInWithEthereum)===null||m===void 0?void 0:m.resources};v=OA(I),w=await $.request({method:"personal_sign",params:[MA(v),M]})}try{const{data:N,error:S}=await Re(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:v,signature:w},!((g=e.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(x=e.options)===null||x===void 0?void 0:x.captchaToken}}:null),xform:dr});if(S)throw S;if(!N||!N.session||!N.user){const j=new zi;return this._returnResult({data:{user:null,session:null},error:j})}return N.session&&(await this._saveSession(N.session),await this._notifyAllSubscribers("SIGNED_IN",N.session)),this._returnResult({data:Object.assign({},N),error:S})}catch(N){if(ke(N))return this._returnResult({data:{user:null,session:null},error:N});throw N}}async signInWithSolana(e){var n,r,a,i,c,u,h,p,m,g,x,v;let w,N;if("message"in e)w=e.message,N=e.signature;else{const{chain:S,wallet:j,statement:A,options:$}=e;let L;if(Xt())if(typeof j=="object")L=j;else{const M=window;if("solana"in M&&typeof M.solana=="object"&&("signIn"in M.solana&&typeof M.solana.signIn=="function"||"signMessage"in M.solana&&typeof M.solana.signMessage=="function"))L=M.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof j!="object"||!$?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");L=j}const R=new URL((n=$?.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in L&&L.signIn){const M=await L.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},$?.signInWithSolana),{version:"1",domain:R.host,uri:R.href}),A?{statement:A}:null));let D;if(Array.isArray(M)&&M[0]&&typeof M[0]=="object")D=M[0];else if(M&&typeof M=="object"&&"signedMessage"in M&&"signature"in M)D=M;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in D&&"signature"in D&&(typeof D.signedMessage=="string"||D.signedMessage instanceof Uint8Array)&&D.signature instanceof Uint8Array)w=typeof D.signedMessage=="string"?D.signedMessage:new TextDecoder().decode(D.signedMessage),N=D.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in L)||typeof L.signMessage!="function"||!("publicKey"in L)||typeof L!="object"||!L.publicKey||!("toBase58"in L.publicKey)||typeof L.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");w=[`${R.host} wants you to sign in with your Solana account:`,L.publicKey.toBase58(),...A?["",A,""]:[""],"Version: 1",`URI: ${R.href}`,`Issued At: ${(a=(r=$?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&a!==void 0?a:new Date().toISOString()}`,...!((i=$?.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${$.signInWithSolana.notBefore}`]:[],...!((c=$?.signInWithSolana)===null||c===void 0)&&c.expirationTime?[`Expiration Time: ${$.signInWithSolana.expirationTime}`]:[],...!((u=$?.signInWithSolana)===null||u===void 0)&&u.chainId?[`Chain ID: ${$.signInWithSolana.chainId}`]:[],...!((h=$?.signInWithSolana)===null||h===void 0)&&h.nonce?[`Nonce: ${$.signInWithSolana.nonce}`]:[],...!((p=$?.signInWithSolana)===null||p===void 0)&&p.requestId?[`Request ID: ${$.signInWithSolana.requestId}`]:[],...!((g=(m=$?.signInWithSolana)===null||m===void 0?void 0:m.resources)===null||g===void 0)&&g.length?["Resources",...$.signInWithSolana.resources.map(D=>`- ${D}`)]:[]].join(`
`);const M=await L.signMessage(new TextEncoder().encode(w),"utf8");if(!M||!(M instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");N=M}}try{const{data:S,error:j}=await Re(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:w,signature:Ma(N)},!((x=e.options)===null||x===void 0)&&x.captchaToken?{gotrue_meta_security:{captcha_token:(v=e.options)===null||v===void 0?void 0:v.captchaToken}}:null),xform:dr});if(j)throw j;if(!S||!S.session||!S.user){const A=new zi;return this._returnResult({data:{user:null,session:null},error:A})}return S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),this._returnResult({data:Object.assign({},S),error:j})}catch(S){if(ke(S))return this._returnResult({data:{user:null,session:null},error:S});throw S}}async _exchangeCodeForSession(e){const n=await ka(this.storage,`${this.storageKey}-code-verifier`),[r,a]=(n??"").split("/");try{if(!r&&this.flowType==="pkce")throw new ZR;const{data:i,error:c}=await Re(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:dr});if(await Qt(this.storage,`${this.storageKey}-code-verifier`),c)throw c;if(!i||!i.session||!i.user){const u=new zi;return this._returnResult({data:{user:null,session:null,redirectType:null},error:u})}return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),this._returnResult({data:Object.assign(Object.assign({},i),{redirectType:a??null}),error:c})}catch(i){if(await Qt(this.storage,`${this.storageKey}-code-verifier`),ke(i))return this._returnResult({data:{user:null,session:null,redirectType:null},error:i});throw i}}async signInWithIdToken(e){try{const{options:n,provider:r,token:a,access_token:i,nonce:c}=e,u=await Re(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:a,access_token:i,nonce:c,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:dr}),{data:h,error:p}=u;if(p)return this._returnResult({data:{user:null,session:null},error:p});if(!h||!h.session||!h.user){const m=new zi;return this._returnResult({data:{user:null,session:null},error:m})}return h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),this._returnResult({data:h,error:p})}catch(n){if(ke(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async signInWithOtp(e){var n,r,a,i,c;try{if("email"in e){const{email:u,options:h}=e;let p=null,m=null;this.flowType==="pkce"&&([p,m]=await Ui(this.storage,this.storageKey));const{error:g}=await Re(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:u,data:(n=h?.data)!==null&&n!==void 0?n:{},create_user:(r=h?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},code_challenge:p,code_challenge_method:m},redirectTo:h?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:g})}if("phone"in e){const{phone:u,options:h}=e,{data:p,error:m}=await Re(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:u,data:(a=h?.data)!==null&&a!==void 0?a:{},create_user:(i=h?.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:h?.captchaToken},channel:(c=h?.channel)!==null&&c!==void 0?c:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:p?.message_id},error:m})}throw new qd("You must provide either an email or phone number.")}catch(u){if(await Qt(this.storage,`${this.storageKey}-code-verifier`),ke(u))return this._returnResult({data:{user:null,session:null},error:u});throw u}}async verifyOtp(e){var n,r;try{let a,i;"options"in e&&(a=(n=e.options)===null||n===void 0?void 0:n.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:c,error:u}=await Re(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:a,xform:dr});if(u)throw u;if(!c)throw new Error("An error occurred on token verification.");const h=c.session,p=c.user;return h?.access_token&&(await this._saveSession(h),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",h)),this._returnResult({data:{user:p,session:h},error:null})}catch(a){if(ke(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}}async signInWithSSO(e){var n,r,a,i,c;try{let u=null,h=null;this.flowType==="pkce"&&([u,h]=await Ui(this.storage,this.storageKey));const p=await Re(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((a=e?.options)===null||a===void 0)&&a.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:u,code_challenge_method:h}),headers:this.headers,xform:kA});return!((i=p.data)===null||i===void 0)&&i.url&&Xt()&&!(!((c=e.options)===null||c===void 0)&&c.skipBrowserRedirect)&&window.location.assign(p.data.url),this._returnResult(p)}catch(u){if(await Qt(this.storage,`${this.storageKey}-code-verifier`),ke(u))return this._returnResult({data:null,error:u});throw u}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Dn;const{error:a}=await Re(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return this._returnResult({data:{user:null,session:null},error:a})})}catch(e){if(ke(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const n=`${this.url}/resend`;if("email"in e){const{email:r,type:a,options:i}=e,{error:c}=await Re(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:a,gotrue_meta_security:{captcha_token:i?.captchaToken}},redirectTo:i?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:c})}else if("phone"in e){const{phone:r,type:a,options:i}=e,{data:c,error:u}=await Re(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:a,gotrue_meta_security:{captcha_token:i?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:c?.message_id},error:u})}throw new qd("You must provide either an email or phone number and a type")}catch(n){if(ke(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),a=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await a}catch{}})()),a}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const n=await ka(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<um:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const c=await ka(this.userStorage,this.storageKey+"-user");c?.user?e.user=c.user:e.user=pm()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const c={value:this.suppressGetSessionWarning};e.user=vA(e.user,c),c.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:a,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{session:null},error:i}):this._returnResult({data:{session:a},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const n=await this._acquireLock(-1,async()=>await this._getUser());return n.data.user&&(this.suppressGetSessionWarning=!0),n}async _getUser(e){try{return e?await Re(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:zs}):await this._useSession(async n=>{var r,a,i;const{data:c,error:u}=n;if(u)throw u;return!(!((r=c.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Dn}:await Re(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(a=c.session)===null||a===void 0?void 0:a.access_token)!==null&&i!==void 0?i:void 0,xform:zs})})}catch(n){if(ke(n))return QR(n)&&(await this._removeSession(),await Qt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:n});throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{const{data:a,error:i}=r;if(i)throw i;if(!a.session)throw new Dn;const c=a.session;let u=null,h=null;this.flowType==="pkce"&&e.email!=null&&([u,h]=await Ui(this.storage,this.storageKey));const{data:p,error:m}=await Re(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:u,code_challenge_method:h}),jwt:c.access_token,xform:zs});if(m)throw m;return c.user=p.user,await this._saveSession(c),await this._notifyAllSubscribers("USER_UPDATED",c),this._returnResult({data:{user:c.user},error:null})})}catch(r){if(await Qt(this.storage,`${this.storageKey}-code-verifier`),ke(r))return this._returnResult({data:{user:null},error:r});throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Dn;const n=Date.now()/1e3;let r=n,a=!0,i=null;const{payload:c}=fm(e.access_token);if(c.exp&&(r=c.exp,a=r<=n),a){const{data:u,error:h}=await this._callRefreshToken(e.refresh_token);if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!u)return{data:{user:null,session:null},error:null};i=u}else{const{data:u,error:h}=await this._getUser(e.access_token);if(h)throw h;i={access_token:e.access_token,refresh_token:e.refresh_token,user:u.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return this._returnResult({data:{user:i.user,session:i},error:null})}catch(n){if(ke(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){const{data:c,error:u}=n;if(u)throw u;e=(r=c.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Dn;const{data:a,error:i}=await this._callRefreshToken(e.refresh_token);return i?this._returnResult({data:{user:null,session:null},error:i}):a?this._returnResult({data:{user:a.user,session:a},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(n){if(ke(n))return this._returnResult({data:{user:null,session:null},error:n});throw n}}async _getSessionFromURL(e,n){try{if(!Xt())throw new Wd("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Wd(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new mw("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Wd("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new mw("No code detected.");const{data:A,error:$}=await this._exchangeCodeForSession(e.code);if($)throw $;const L=new URL(window.location.href);return L.searchParams.delete("code"),window.history.replaceState(window.history.state,"",L.toString()),{data:{session:A.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:a,access_token:i,refresh_token:c,expires_in:u,expires_at:h,token_type:p}=e;if(!i||!u||!c||!p)throw new Wd("No session defined in URL");const m=Math.round(Date.now()/1e3),g=parseInt(u);let x=m+g;h&&(x=parseInt(h));const v=x-m;v*1e3<=Zi&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${v}s, should have been closer to ${g}s`);const w=x-g;m-w>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",w,x,m):m-w<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",w,x,m);const{data:N,error:S}=await this._getUser(i);if(S)throw S;const j={provider_token:r,provider_refresh_token:a,access_token:i,expires_in:g,expires_at:x,refresh_token:c,token_type:p,user:N.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:j,redirectType:e.type},error:null})}catch(r){if(ke(r))return this._returnResult({data:{session:null,redirectType:null},error:r});throw r}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const n=await ka(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i)return this._returnResult({error:i});const c=(r=a.session)===null||r===void 0?void 0:r.access_token;if(c){const{error:u}=await this.admin.signOut(c,e);if(u&&!(JR(u)&&(u.status===404||u.status===401||u.status===403)))return this._returnResult({error:u})}return e!=="others"&&(await this._removeSession(),await Qt(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const n=iA(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,a;try{const{data:{session:i},error:c}=n;if(c)throw c;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((a=this.stateChangeEmitters.get(e))===null||a===void 0?void 0:a.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,n={}){let r=null,a=null;this.flowType==="pkce"&&([r,a]=await Ui(this.storage,this.storageKey,!0));try{return await Re(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:a,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(i){if(await Qt(this.storage,`${this.storageKey}-code-verifier`),ke(i))return this._returnResult({data:null,error:i});throw i}}async getUserIdentities(){var e;try{const{data:n,error:r}=await this.getUser();if(r)throw r;return this._returnResult({data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(n){if(ke(n))return this._returnResult({data:null,error:n});throw n}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var n;try{const{data:r,error:a}=await this._useSession(async i=>{var c,u,h,p,m;const{data:g,error:x}=i;if(x)throw x;const v=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(c=e.options)===null||c===void 0?void 0:c.redirectTo,scopes:(u=e.options)===null||u===void 0?void 0:u.scopes,queryParams:(h=e.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:!0});return await Re(this.fetch,"GET",v,{headers:this.headers,jwt:(m=(p=g.session)===null||p===void 0?void 0:p.access_token)!==null&&m!==void 0?m:void 0})});if(a)throw a;return Xt()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r?.url),this._returnResult({data:{provider:e.provider,url:r?.url},error:null})}catch(r){if(ke(r))return this._returnResult({data:{provider:e.provider,url:null},error:r});throw r}}async linkIdentityIdToken(e){return await this._useSession(async n=>{var r;try{const{error:a,data:{session:i}}=n;if(a)throw a;const{options:c,provider:u,token:h,access_token:p,nonce:m}=e,g=await Re(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(r=i?.access_token)!==null&&r!==void 0?r:void 0,body:{provider:u,id_token:h,access_token:p,nonce:m,link_identity:!0,gotrue_meta_security:{captcha_token:c?.captchaToken}},xform:dr}),{data:x,error:v}=g;return v?this._returnResult({data:{user:null,session:null},error:v}):!x||!x.session||!x.user?this._returnResult({data:{user:null,session:null},error:new zi}):(x.session&&(await this._saveSession(x.session),await this._notifyAllSubscribers("USER_UPDATED",x.session)),this._returnResult({data:x,error:v}))}catch(a){if(await Qt(this.storage,`${this.storageKey}-code-verifier`),ke(a))return this._returnResult({data:{user:null,session:null},error:a});throw a}})}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,a;const{data:i,error:c}=n;if(c)throw c;return await Re(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(a=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&a!==void 0?a:void 0})})}catch(n){if(ke(n))return this._returnResult({data:null,error:n});throw n}}async _refreshAccessToken(e){const n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{const r=Date.now();return await dA(async a=>(a>0&&await cA(200*Math.pow(2,a-1)),this._debug(n,"refreshing attempt",a),await Re(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:dr})),(a,i)=>{const c=200*Math.pow(2,a);return i&&hm(i)&&Date.now()+c-r<Zi})}catch(r){if(this._debug(n,"error",r),ke(r))return this._returnResult({data:{session:null,user:null},error:r});throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Xt()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const a=await ka(this.storage,this.storageKey);if(a&&this.userStorage){let c=await ka(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!c&&(c={user:a.user},await eo(this.userStorage,this.storageKey+"-user",c)),a.user=(e=c?.user)!==null&&e!==void 0?e:pm()}else if(a&&!a.user&&!a.user){const c=await ka(this.storage,this.storageKey+"-user");c&&c?.user?(a.user=c.user,await Qt(this.storage,this.storageKey+"-user"),await eo(this.storage,this.storageKey,a)):a.user=pm()}if(this._debug(r,"session from storage",a),!this._isValidSession(a)){this._debug(r,"session is not valid"),a!==null&&await this._removeSession();return}const i=((n=a.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<um;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${um}s`),i){if(this.autoRefreshToken&&a.refresh_token){const{error:c}=await this._callRefreshToken(a.refresh_token);c&&(console.error(c),hm(c)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",c),await this._removeSession()))}}else if(a.user&&a.user.__isUserNotAvailableProxy===!0)try{const{data:c,error:u}=await this._getUser(a.access_token);!u&&c?.user?(a.user=c.user,await this._saveSession(a),await this._notifyAllSubscribers("SIGNED_IN",a)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(c){console.error("Error getting user data:",c),this._debug(r,"error getting user data, skipping SIGNED_IN notification",c)}else await this._notifyAllSubscribers("SIGNED_IN",a)}catch(a){this._debug(r,"error",a),console.error(a);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Dn;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const a=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(a,"begin");try{this.refreshingDeferred=new gh;const{data:i,error:c}=await this._refreshAccessToken(e);if(c)throw c;if(!i.session)throw new Dn;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const u={data:i.session,error:null};return this.refreshingDeferred.resolve(u),u}catch(i){if(this._debug(a,"error",i),ke(i)){const c={data:null,error:i};return hm(i)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(c),c}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(a,"end")}}async _notifyAllSubscribers(e,n,r=!0){const a=`#_notifyAllSubscribers(${e})`;this._debug(a,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});const i=[],c=Array.from(this.stateChangeEmitters.values()).map(async u=>{try{await u.callback(e,n)}catch(h){i.push(h)}});if(await Promise.all(c),i.length>0){for(let u=0;u<i.length;u+=1)console.error(i[u]);throw i[0]}}finally{this._debug(a,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Qt(this.storage,`${this.storageKey}-code-verifier`);const n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await eo(this.userStorage,this.storageKey+"-user",{user:n.user});const a=Object.assign({},n);delete a.user;const i=vw(a);await eo(this.storage,this.storageKey,i)}else{const a=vw(n);await eo(this.storage,this.storageKey,a)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Qt(this.storage,this.storageKey),await Qt(this.storage,this.storageKey+"-code-verifier"),await Qt(this.storage,this.storageKey+"-user"),this.userStorage&&await Qt(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Xt()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Zi);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async n=>{const{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const a=Math.floor((r.expires_at*1e3-e)/Zi);this._debug("#_autoRefreshTokenTick()",`access token expires in ${a} ticks, a tick lasts ${Zi}ms, refresh threshold is ${ig} ticks`),a<=ig&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof cN)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Xt()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){const a=[`provider=${encodeURIComponent(n)}`];if(r?.redirectTo&&a.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&a.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,c]=await Ui(this.storage,this.storageKey),u=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(c)}`});a.push(u.toString())}if(r?.queryParams){const i=new URLSearchParams(r.queryParams);a.push(i.toString())}return r?.skipBrowserRedirect&&a.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${a.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;return i?this._returnResult({data:null,error:i}):await Re(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(ke(n))return this._returnResult({data:null,error:n});throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,a;const{data:i,error:c}=n;if(c)return this._returnResult({data:null,error:c});const u=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:h,error:p}=await Re(this.fetch,"POST",`${this.url}/factors`,{body:u,headers:this.headers,jwt:(r=i?.session)===null||r===void 0?void 0:r.access_token});return p?this._returnResult({data:null,error:p}):(e.factorType==="totp"&&h.type==="totp"&&(!((a=h?.totp)===null||a===void 0)&&a.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),this._returnResult({data:h,error:null}))})}catch(n){if(ke(n))return this._returnResult({data:null,error:n});throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i)return this._returnResult({data:null,error:i});const c=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?zA(e.webauthn.credential_response):UA(e.webauthn.credential_response)})}:{code:e.code}),{data:u,error:h}=await Re(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:c,headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token});return h?this._returnResult({data:null,error:h}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+u.expires_in},u)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",u),this._returnResult({data:u,error:h}))})}catch(n){if(ke(n))return this._returnResult({data:null,error:n});throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;const{data:a,error:i}=n;if(i)return this._returnResult({data:null,error:i});const c=await Re(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(r=a?.session)===null||r===void 0?void 0:r.access_token});if(c.error)return c;const{data:u}=c;if(u.type!=="webauthn")return{data:u,error:null};switch(u.webauthn.type){case"create":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:IA(u.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},u),{webauthn:Object.assign(Object.assign({},u.webauthn),{credential_options:Object.assign(Object.assign({},u.webauthn.credential_options),{publicKey:PA(u.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(n){if(ke(n))return this._returnResult({data:null,error:n});throw n}})}async _challengeAndVerify(e){const{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?this._returnResult({data:null,error:r}):await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){var e;const{data:{user:n},error:r}=await this.getUser();if(r)return{data:null,error:r};const a={all:[],phone:[],totp:[],webauthn:[]};for(const i of(e=n?.factors)!==null&&e!==void 0?e:[])a.all.push(i),i.status==="verified"&&a[i.factor_type].push(i);return{data:a,error:null}}async _getAuthenticatorAssuranceLevel(){var e,n;const{data:{session:r},error:a}=await this.getSession();if(a)return this._returnResult({data:null,error:a});if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=fm(r.access_token);let c=null;i.aal&&(c=i.aal);let u=c;((n=(e=r.user.factors)===null||e===void 0?void 0:e.filter(m=>m.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(u="aal2");const p=i.amr||[];return{data:{currentLevel:c,nextLevel:u,currentAuthenticationMethods:p},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;return a?this._returnResult({data:null,error:a}):r?await Re(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:r.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new Dn})})}catch(n){if(ke(n))return this._returnResult({data:null,error:n});throw n}}async _approveAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:a},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!a)return this._returnResult({data:null,error:new Dn});const c=await Re(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"approve"},xform:u=>({data:u,error:null})});return c.data&&c.data.redirect_url&&Xt()&&!n?.skipBrowserRedirect&&window.location.assign(c.data.redirect_url),c})}catch(r){if(ke(r))return this._returnResult({data:null,error:r});throw r}}async _denyAuthorization(e,n){try{return await this._useSession(async r=>{const{data:{session:a},error:i}=r;if(i)return this._returnResult({data:null,error:i});if(!a)return this._returnResult({data:null,error:new Dn});const c=await Re(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:a.access_token,body:{action:"deny"},xform:u=>({data:u,error:null})});return c.data&&c.data.redirect_url&&Xt()&&!n?.skipBrowserRedirect&&window.location.assign(c.data.redirect_url),c})}catch(r){if(ke(r))return this._returnResult({data:null,error:r});throw r}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:n},error:r}=e;return r?this._returnResult({data:null,error:r}):n?await Re(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,xform:a=>({data:a,error:null})}):this._returnResult({data:null,error:new Dn})})}catch(e){if(ke(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async n=>{const{data:{session:r},error:a}=n;return a?this._returnResult({data:null,error:a}):r?(await Re(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:r.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Dn})})}catch(n){if(ke(n))return this._returnResult({data:null,error:n});throw n}}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(u=>u.kid===e);if(r)return r;const a=Date.now();if(r=this.jwks.keys.find(u=>u.kid===e),r&&this.jwks_cached_at+KR>a)return r;const{data:i,error:c}=await Re(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(c)throw c;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=a,r=i.keys.find(u=>u.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){const{data:v,error:w}=await this.getSession();if(w||!v.session)return this._returnResult({data:null,error:w});r=v.session.access_token}const{header:a,payload:i,signature:c,raw:{header:u,payload:h}}=fm(r);n?.allowExpired||yA(i.exp);const p=!a.alg||a.alg.startsWith("HS")||!a.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(a.kid,n?.keys?{keys:n.keys}:n?.jwks);if(!p){const{error:v}=await this.getUser(r);if(v)throw v;return{data:{claims:i,header:a,signature:c},error:null}}const m=xA(a.alg),g=await crypto.subtle.importKey("jwk",p,m,!0,["verify"]);if(!await crypto.subtle.verify(m,g,c,sA(`${u}.${h}`)))throw new cg("Invalid JWT signature");return{data:{claims:i,header:a,signature:c},error:null}}catch(r){if(ke(r))return this._returnResult({data:null,error:r});throw r}}}ec.nextInstanceID={};const JA=ec,QA="2.89.0";let Rl="";typeof Deno<"u"?Rl="deno":typeof document<"u"?Rl="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Rl="react-native":Rl="node";const XA={"X-Client-Info":`supabase-js-${Rl}/${QA}`},ZA={headers:XA},e_={schema:"public"},t_={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},n_={};function tc(t){"@babel/helpers - typeof";return tc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tc(t)}function r_(t,e){if(tc(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(tc(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function s_(t){var e=r_(t,"string");return tc(e)=="symbol"?e:e+""}function a_(t,e,n){return(e=s_(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Tw(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(t,a).enumerable})),n.push.apply(n,r)}return n}function vt(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Tw(Object(n),!0).forEach(function(r){a_(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Tw(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const i_=t=>t?(...e)=>t(...e):(...e)=>fetch(...e),o_=()=>Headers,l_=(t,e,n)=>{const r=i_(n),a=o_();return async(i,c)=>{var u;const h=(u=await e())!==null&&u!==void 0?u:t;let p=new a(c?.headers);return p.has("apikey")||p.set("apikey",t),p.has("Authorization")||p.set("Authorization",`Bearer ${h}`),r(i,vt(vt({},c),{},{headers:p}))}};function c_(t){return t.endsWith("/")?t:t+"/"}function d_(t,e){var n,r;const{db:a,auth:i,realtime:c,global:u}=t,{db:h,auth:p,realtime:m,global:g}=e,x={db:vt(vt({},h),a),auth:vt(vt({},p),i),realtime:vt(vt({},m),c),storage:{},global:vt(vt(vt({},g),u),{},{headers:vt(vt({},(n=g?.headers)!==null&&n!==void 0?n:{}),(r=u?.headers)!==null&&r!==void 0?r:{})}),accessToken:async()=>""};return t.accessToken?x.accessToken=t.accessToken:delete x.accessToken,x}function u_(t){const e=t?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(c_(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var h_=class extends JA{constructor(t){super(t)}},f_=class{constructor(t,e,n){var r,a;this.supabaseUrl=t,this.supabaseKey=e;const i=u_(t);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",i),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",i),this.storageUrl=new URL("storage/v1",i),this.functionsUrl=new URL("functions/v1",i);const c=`sb-${i.hostname.split(".")[0]}-auth-token`,u={db:e_,realtime:n_,auth:vt(vt({},t_),{},{storageKey:c}),global:ZA},h=d_(n??{},u);if(this.storageKey=(r=h.auth.storageKey)!==null&&r!==void 0?r:"",this.headers=(a=h.global.headers)!==null&&a!==void 0?a:{},h.accessToken)this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(m,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}});else{var p;this.auth=this._initSupabaseAuthClient((p=h.auth)!==null&&p!==void 0?p:{},this.headers,h.global.fetch)}this.fetch=l_(e,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(vt({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.accessToken&&this.accessToken().then(m=>this.realtime.setAuth(m)).catch(m=>console.warn("Failed to set initial Realtime auth token:",m)),this.rest=new qE(new URL("rest/v1",i).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new VR(this.storageUrl.href,this.headers,this.fetch,n?.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new UE(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(t){return this.rest.from(t)}schema(t){return this.rest.schema(t)}rpc(t,e={},n={head:!1,get:!1,count:void 0}){return this.rest.rpc(t,e,n)}channel(t,e={config:{}}){return this.realtime.channel(t,e)}getChannels(){return this.realtime.getChannels()}removeChannel(t){return this.realtime.removeChannel(t)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var t=this,e,n;if(t.accessToken)return await t.accessToken();const{data:r}=await t.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:t.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:a,storageKey:i,flowType:c,lock:u,debug:h,throwOnError:p},m,g){const x={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new h_({url:this.authUrl.href,headers:vt(vt({},x),m),storageKey:i,autoRefreshToken:t,persistSession:e,detectSessionInUrl:n,storage:r,userStorage:a,flowType:c,lock:u,debug:h,throwOnError:p,fetch:g,hasCustomAuthorizationHeader:Object.keys(this.headers).some(v=>v.toLowerCase()==="authorization")})}_initRealtimeClient(t){return new cR(this.realtimeUrl.href,vt(vt({},t),{},{params:vt(vt({},{apikey:this.supabaseKey}),t?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,e)=>{this._handleTokenChanged(t,"CLIENT",e?.access_token)})}_handleTokenChanged(t,e,n){(t==="TOKEN_REFRESHED"||t==="SIGNED_IN")&&this.changedAccessToken!==n?(this.changedAccessToken=n,this.realtime.setAuth(n)):t==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const p_=(t,e,n)=>new f_(t,e,n);function m_(){if(typeof window<"u"||typeof process>"u")return!1;const t=process.version;if(t==null)return!1;const e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}m_()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const g_="https://dceicfrztvmmuuyjzaeb.supabase.co",y_="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRjZWljZnJ6dHZtbXV1eWp6YWViIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY4ODYxMDEsImV4cCI6MjA4MjQ2MjEwMX0.mjIPrvFKNDht83bnsfVwiRiiqvkwuHLL1nNXdXDpGoE",Fe=p_(g_,y_),hN=E.createContext();function Ya(){const t=E.useContext(hN);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t}function x_({children:t}){const[e,n]=E.useState(null),[r,a]=E.useState(null),[i,c]=E.useState(!0),[u,h]=E.useState(!1),[p,m]=E.useState(!1),g=async w=>{if(!w){h(!1),m(!1);return}try{m(!0);const N=new Promise(($,L)=>setTimeout(()=>L(new Error("Timeout")),5e3)),S=Fe.from("admin_profiles").select("approved").eq("user_id",w).maybeSingle(),{data:j,error:A}=await Promise.race([S,N]);if(A){console.error("Error checking approval:",A),h(!1);return}console.log("Approval check result:",j),h(j?.approved||!1)}catch(N){console.error("Error checking approval:",N),h(!1)}finally{m(!1)}};E.useEffect(()=>{Fe.auth.getSession().then(({data:{session:N}})=>{n(N),a(N?.user??null),N?.user&&g(N.user.id),c(!1)});const{data:{subscription:w}}=Fe.auth.onAuthStateChange((N,S)=>{n(S),a(S?.user??null),S?.user?g(S.user.id):h(!1),c(!1)});return()=>w.unsubscribe()},[]);const v={session:e,user:r,loading:i,approved:u,checkingApproval:p,signOut:async()=>{const{error:w}=await Fe.auth.signOut();w&&console.error("Error signing out:",w)},checkApprovalStatus:g};return l.jsx(hN.Provider,{value:v,children:t})}const fN=E.createContext();function as(){const t=E.useContext(fN);if(!t)throw new Error("useCharacter must be used within a CharacterProvider");return t}function b_({children:t,userId:e,roomCode:n}){const[r,a]=E.useState(null),[i,c]=E.useState(!0),[u,h]=E.useState(null),p=E.useRef(null),m=E.useRef({}),g=E.useRef(new Set),x=E.useRef(!1),v=R=>R?{...R,classFeatures:R.class_features,className:R.class_name,destinyPoints:R.destiny_points,hpCurrent:R.hp_current,hpMax:R.hp_max,userId:R.user_id,roomCode:R.room_code,galaxySavesClaimed:R.galaxy_saves_claimed||0,advancementOptions:R.advancement_options||[],baseStats:R.base_stats,baseHpMax:R.base_hp_max}:null;E.useEffect(()=>{if(!e||!n)return;async function R(){try{const{data:M,error:D}=await Fe.from("characters").select("*").eq("user_id",e).eq("room_code",n).maybeSingle();if(D)throw D;a(v(M))}catch(M){console.error("Error loading character:",M),h(M.message)}finally{c(!1)}}R()},[e,n]),E.useEffect(()=>{if(!r?.id)return;const R=Fe.channel(`character:${r.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"characters",filter:`id=eq.${r.id}`},M=>{if(console.log("Character updated:",M.new),x.current)return;const D=v(M.new);a(I=>{if(!I)return D;const W={...I};return Object.keys(D).forEach(ue=>{g.current.has(ue)||(W[ue]=D[ue])}),W})}).subscribe();return()=>{Fe.removeChannel(R)}},[r?.id]);const w=E.useCallback(async R=>{if(!e||!n)throw new Error("Missing userId or roomCode");try{c(!0);const{data:M,error:D}=await Fe.from("rooms").select("code").eq("code",n).maybeSingle();if(!M&&!D){const{error:J}=await Fe.from("rooms").insert({code:n,gm_id:e});if(J&&J.code!=="23505")throw J}const I={user_id:e,room_code:n,name:R.name||"Unnamed Rebel",class:R.class,species:R.species,stats:R.stats,base_stats:R.base_stats||R.stats,hp_current:R.hp_current,hp_max:R.hp_max,base_hp_max:R.base_hp_max||R.hp_max,equipment:R.equipment||[],bits:R.bits||0,motivation:R.motivation||null,destiny_points:R.destiny_points||0,class_features:R.classFeatures||null,class_name:R.className||R.class,galaxy_saves_claimed:R.galaxySavesClaimed||0,advancement_options:R.advancementOptions||[]},{data:W,error:ue}=await Fe.from("characters").insert(I).select().single();if(ue)throw ue;const he=v(W);return a(he),he}catch(M){throw console.error("Error saving character:",M),h(M.message),M}finally{c(!1)}},[e,n]),N=E.useCallback(async R=>{if(!r?.id)throw new Error("No character to update");m.current={...m.current,...R},Object.keys(R).forEach(M=>{g.current.add(M)}),a(M=>M&&v({...M,...R})),p.current&&clearTimeout(p.current),p.current=setTimeout(async()=>{try{x.current=!0;const M={...m.current};m.current={};const{data:D,error:I}=await Fe.from("characters").update(M).eq("id",r.id).select().single();if(I)throw I;g.current.clear();const W=v(D);return a(W),W}catch(M){throw console.error("Error updating character:",M),h(M.message),M}finally{x.current=!1}},500)},[r?.id]),S=E.useCallback((R,M)=>N({[R]:M}),[N]);E.useEffect(()=>()=>{p.current&&clearTimeout(p.current)},[]);const j=E.useCallback(async()=>{if(!r?.id)throw new Error("No character to delete");try{c(!0);const{error:R}=await Fe.from("characters").delete().eq("id",r.id);if(R)throw R;a(null)}catch(R){throw console.error("Error deleting character:",R),h(R.message),R}finally{c(!1)}},[r?.id]),A=E.useCallback(async R=>{if(!r?.id)throw new Error("No character to promote");try{const{hpIncrease:M,statIncreases:D,advancementId:I,advancementResult:W}=R,ue={...r.stats};D.forEach(X=>{ue[X]<6&&(ue[X]+=1)});const he=r.hp_max+M,J=r.hp_current+M,_=[...r.advancementOptions||[],{id:I,claimedAt:new Date().toISOString(),result:W}];let V={...r.classFeatures};if(W?.rolledFeature){const X=W.rolledFeature;switch(X.type){case"heirloom":V.advancedHeirloom=X;break;case"skill":V.advancedSkill=X;break;case"function":V.advancedFunction=X;break;case"magiAwakening":V.advancedMagiArt=X.art,V.advancedDragoonNemesis=X.nemesis;break;case"scratchBuild":V.advancedScratchBuild=X;break}}const F={stats:ue,hp_max:he,hp_current:J,galaxy_saves_claimed:(r.galaxySavesClaimed||0)+1,advancement_options:_,class_features:V},{data:O,error:K}=await Fe.from("characters").update(F).eq("id",r.id).select().single();if(K)throw K;const Z=v(O);return a(Z),Z}catch(M){throw console.error("Error claiming promotion:",M),h(M.message),M}},[r]),$=E.useCallback(async()=>{if(!r?.id)throw new Error("No character to respec");try{const R=r.base_stats||r.baseStats||r.stats,M=r.base_hp_max||r.baseHpMax||r.hp_max,D={...r.classFeatures};delete D.advancedHeirloom,delete D.advancedSkill,delete D.advancedFunction,delete D.advancedMagiArt,delete D.advancedDragoonNemesis,delete D.advancedScratchBuild;const I={stats:R,hp_max:M,hp_current:M,galaxy_saves_claimed:0,advancement_options:[],class_features:D,base_stats:R,base_hp_max:M},{data:W,error:ue}=await Fe.from("characters").update(I).eq("id",r.id).select().single();if(ue)throw ue;const he=v(W);return a(he),he}catch(R){throw console.error("Error respeccing character:",R),h(R.message),R}},[r]),L={character:r,loading:i,error:u,saveCharacter:w,updateCharacter:N,updateField:S,deleteCharacter:j,claimPromotion:A,respecCharacter:$};return l.jsx(fN.Provider,{value:L,children:t})}const pN=E.createContext();function Ja(){const t=E.useContext(pN);if(!t)throw new Error("useParty must be used within a PartyProvider");return t}function v_({children:t,roomCode:e}){const[n,r]=E.useState([]),[a,i]=E.useState(!0),[c,u]=E.useState(null),h=g=>g?{...g,classFeatures:g.class_features,className:g.class_name,destinyPoints:g.destiny_points,hpCurrent:g.hp_current,hpMax:g.hp_max,userId:g.user_id,roomCode:g.room_code,galaxySavesClaimed:g.galaxy_saves_claimed||0,advancementOptions:g.advancement_options||[]}:null,p=E.useCallback(async()=>{if(!e){i(!1);return}try{console.log(`[PartyContext] Loading party members for room: ${e}`);const{data:g,error:x}=await Fe.from("characters").select("*").eq("room_code",e).order("created_at",{ascending:!0});if(x)throw x;console.log(`[PartyContext] Loaded ${g?.length||0} party members:`,g);const v=(g||[]).map(h);r(v)}catch(g){console.error("Error loading party members:",g),u(g.message)}finally{i(!1)}},[e]);E.useEffect(()=>{p()},[p]),E.useEffect(()=>{if(!e)return;console.log(`[PartyContext] Setting up realtime subscription for room: ${e}`);const g=Fe.channel(`party:${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"characters",filter:`room_code=eq.${e}`},x=>{console.log("[PartyContext] Character added to party:",x.new),r(v=>v.some(w=>w.id===x.new.id)?v:[...v,h(x.new)])}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"characters",filter:`room_code=eq.${e}`},x=>{console.log("[PartyContext] Character updated in party:",x.new),r(v=>v.map(w=>w.id===x.new.id?h(x.new):w))}).on("postgres_changes",{event:"DELETE",schema:"public",table:"characters",filter:`room_code=eq.${e}`},x=>{console.log("[PartyContext] Character removed from party:",x.old),r(v=>v.filter(w=>w.id!==x.old.id))}).subscribe(x=>{console.log(`[PartyContext] Subscription status for room ${e}:`,x)});return()=>{console.log(`[PartyContext] Cleaning up subscription for room: ${e}`),Fe.removeChannel(g)}},[e,p]);const m={partyMembers:n,loading:a,error:c,refreshPartyMembers:p};return l.jsx(pN.Provider,{value:m,children:t})}const mN=E.createContext(),w_=()=>`client-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;function Ge(){const t=E.useContext(mN);if(!t)throw new Error("useGame must be used within a GameProvider");return t}const Kd={threatDie:1,missions:[],dangerClocks:[],journal:"",log:[],includePVOracles:!0,includeStarforgedOracles:!0,panelStates:{},spaceCombat:{isActive:!1,shipArmor:2,torpedoesLoaded:0,hyperdriveCharge:0,stationAssignments:{pilot:null,copilot:null,engineer1:null,engineer2:null,gunner1:null,gunner2:null},combatLog:[]},ship:{name:"The Rebel Corvette",heroicUpgrades:[],purchasedUpgrades:[],torpedoInventory:{standard:0,cluster:0,hunterKiller:0,chaff:0,ion:0},turboLaserStation:null,galaxiesSaved:0}};function S_({children:t,roomCode:e}){const[n,r]=E.useState(Kd),[a,i]=E.useState(!0),[c,u]=E.useState(null),h=E.useRef(null),p=E.useRef(null),m=E.useRef(new Set),g=E.useRef(!1),x=E.useRef(null),v=E.useRef(0),w=E.useMemo(()=>w_(),[]);E.useEffect(()=>{if(!e){i(!1);return}async function L(){try{const{data:R,error:M}=await Fe.from("sessions").select("game_state").eq("room_code",e).single();if(M)if(M.code==="PGRST116")r(Kd);else throw M;else if(R?.game_state){const D={...R.game_state,ship:R.game_state.ship||Kd.ship,panelStates:R.game_state.panelStates||Kd.panelStates};r(D)}}catch(R){console.error("Error loading game state:",R),u(R.message)}finally{i(!1)}}L()},[e]),E.useEffect(()=>{if(!e)return;const L=Fe.channel(`game-sync:${e}`).on("broadcast",{event:"game_state_update"},R=>{const{senderId:M,timestamp:D,updates:I}=R.payload;M!==w&&(D<=v.current||(v.current=D,r(W=>{const ue={...W};return Object.keys(I).forEach(he=>{m.current.has(he)||(ue[he]=I[he])}),ue})))}).subscribe();return x.current=L,()=>{Fe.removeChannel(L),x.current=null}},[e,w]),E.useEffect(()=>{if(!e)return;const L=Fe.channel(`room:${e}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"sessions",filter:`room_code=eq.${e}`},R=>{if(R.new?.game_state){const M=R.new.game_state;r(D=>{if(g.current)return D;const I={...D};return Object.keys(M).forEach(W=>{m.current.has(W)||(I[W]=M[W])}),I})}}).subscribe();return()=>{Fe.removeChannel(L)}},[e]),E.useEffect(()=>()=>{h.current&&clearTimeout(h.current)},[]);const N=E.useCallback(L=>{if(!e)return;let R,M=new Set,D={};r(I=>(R=typeof L=="function"?L(I):{...I,...L},p.current=R,typeof L=="function"?Object.keys(R).forEach(W=>{JSON.stringify(I[W])!==JSON.stringify(R[W])&&(M.add(W),D[W]=R[W])}):Object.keys(L).forEach(W=>{M.add(W),D[W]=L[W]}),M.forEach(W=>m.current.add(W)),R)),x.current&&Object.keys(D).length>0&&x.current.send({type:"broadcast",event:"game_state_update",payload:{senderId:w,timestamp:Date.now(),updates:D}}),h.current&&clearTimeout(h.current),h.current=setTimeout(async()=>{try{g.current=!0;const I=p.current,{error:W}=await Fe.from("sessions").upsert({room_code:e,game_state:I});if(W)throw W;m.current.clear()}catch(I){console.error("Error syncing game state:",I),u(I.message)}finally{g.current=!1}},300)},[e,w]),S=E.useCallback((L,R="info")=>{N(M=>({...M,log:[{id:Date.now().toString(),timestamp:new Date().toISOString(),message:L,type:R},...M.log].slice(0,100)}))},[N]),j=E.useCallback(L=>{N(R=>({...R,includePVOracles:L}))},[N]),A=E.useCallback(L=>{N(R=>({...R,includeStarforgedOracles:L}))},[N]),$={gameState:n,updateGameState:N,addLog:S,togglePVOracles:j,toggleStarforgedOracles:A,loading:a,error:c,roomCode:e};return l.jsx(mN.Provider,{value:$,children:t})}function sn(t,e){return t?t.heroicUpgrades.includes(e)||t.purchasedUpgrades.includes(e):!1}function Ew(t,e){return t>=e}function io(t){return sn(t,"overchargeShields")?3:2}function N_(t,e){return sn(t,"turboLasers")&&t.turboLaserStation===e?"1d8":"1d6"}function Rw(t){return sn(t,"torpedoWinch")}function k_(t){return!t||!t.torpedoInventory?[]:Object.entries(t.torpedoInventory).filter(([,e])=>e>0).map(([e,n])=>({type:e,count:n}))}function gN(t){return t?Math.max(0,t.galaxiesSaved-t.heroicUpgrades.length):0}const dg=["","","","","","","","","",""],nc={hunterFighter:{id:"hunterFighter",name:"Hunter Fighter",hp:6,morale:7,moraleBoosted:8,armor:0,weapon:{name:"Turbo Laser",damage:"1d6",diceCount:1,diceSides:6},hyperdrive:!1,traits:["Mass Produced","Squadthink"],description:"Mass-produced Legion fighters. A single hit destroys them.",fodder:!0,dr:12},predatorLeader:{id:"predatorLeader",name:"Predator Leader",hp:12,morale:10,armor:2,weapon:{name:"Particle Beam",damage:"1d8",diceCount:1,diceSides:8},hyperdrive:!0,traits:["Elite"],description:"Elite Legion command ship. DR14 to defend against.",fodder:!1,dr:14},dreadnought:{id:"dreadnought",name:"Dreadnought Carrier",hp:null,morale:null,armor:null,weapon:{name:"Turbo Cannon Batteries",damage:"1d10",diceCount:1,diceSides:10},hyperdrive:!0,traits:["Impervious","Heartless"],description:"Massive carrier. Cannot be destroyed by fighters - plot device ship.",fodder:!1,dr:12,special:"Rebels can stay out of range for 1 round with DR12 AGI test instead of taking action."},pirateMarauder:{id:"pirateMarauder",name:"Pirate Marauder",hp:12,morale:7,armor:1,weapon:{name:"Twin Turbo Turrets",damage:"1d8",diceCount:1,diceSides:8,advantage:!0},hyperdrive:!0,traits:["Communications Disruption","Boarding Airlock"],description:"Pirate raider with jamming and boarding capabilities.",fodder:!1,dr:12,special:"Jamming prevents outgoing comms. Boarding in D2+1 rounds."}},yh={sleekInterceptor:{id:"sleekInterceptor",name:"Sleek Interceptor",roll:1,effect:"Goes first in combat (test PRS DR12 or interceptor acts first)",modifiers:{initiative:!0},description:"Incredible speed allows it to strike out of nowhere."},bulkyInterdictor:{id:"bulkyInterdictor",name:"Bulky Interdictor",roll:2,effect:"Tractor beam prevents hyperspace jumps. Tier 2 armor.",modifiers:{armor:2,tractorBeam:!0},description:"Tractor beam ship with heavy armor."},flyingWing:{id:"flyingWing",name:"Flying Wing",roll:3,effect:"Disadvantage to hit for first 2 rounds of combat.",modifiers:{evasion:2},description:"Flat build makes it hard to target on approach."},twinSeatBomber:{id:"twinSeatBomber",name:"Twin-Seat Bomber",roll:4,effect:"Attacks every other round with D10 bomb. Explodes on death.",modifiers:{weapon:{name:"Particle Bomb",damage:"1d10",diceCount:1,diceSides:10},attackEveryOther:!0,explodesOnDeath:!0},description:"Deadly payload, attacks every other round."},reconBotSaucer:{id:"reconBotSaucer",name:"Recon Bot Saucer",roll:5,effect:"Calls reinforcements from carrier in D4 rounds.",modifiers:{weapon:{name:"Beam Gun",damage:"1d4",diceCount:1,diceSides:4},callsReinforcements:!0},description:"Weak weapons but calls for backup."},armorPlatedHull:{id:"armorPlatedHull",name:"Armor-Plated Hull",roll:6,effect:"Increase armor tier by 1.",modifiers:{armorBonus:1},description:"Extra plating provides additional protection."}},Bl=Object.values(yh),Su={active:{id:"active",label:"Active",color:"cyan",icon:"crosshair"},fleeing:{id:"fleeing",label:"Fleeing",color:"yellow",icon:"arrow-right"},surrendered:{id:"surrendered",label:"Surrendered",color:"gray",icon:"flag"},destroyed:{id:"destroyed",label:"Destroyed",color:"red",icon:"skull"}},Nu={0:{tier:0,reduction:0,dice:null,label:"None"},1:{tier:1,reduction:2,dice:"d2",label:"Tier 1 (-D2)"},2:{tier:2,reduction:4,dice:"d4",label:"Tier 2 (-D4)"},3:{tier:3,reduction:6,dice:"d6",label:"Tier 3 (-D6)"}},Yd={triggers:["The leader is killed","Half the group is eliminated","A single enemy has only 1/3 of its HP left"],check:"Roll 2d6. If result > highest MRL in group, they are demoralized.",outcomes:[{roll:"1-4",result:"Flees"},{roll:"5-6",result:"Surrenders"}],squadthink:"If 4+ fighters in group, MRL is 8 instead of 7."},j_={shipVsPeople:{title:"Ship vs People",description:"Spaceships roll double damage dice against people not in ships (e.g., D6 becomes 2D6)."},handheldVsShip:{title:"Handheld vs Ships",description:"Spaceships take half damage from handheld weapons dealing under D10."},hyperdriveWarning:{title:"Hyperdrive in Combat",description:"Jumping to hyperspace with 4+ enemies destroys the Rebel ship!"},eliteDefense:{title:"Elite Enemies",description:"DR14 to defend against Elite enemies (Predator Leader, Dragoon, Bounty Hunter)."}};function Al(t,e={}){const n=nc[t];if(!n)throw new Error(`Unknown ship type: ${t}`);const r=crypto.randomUUID(),a=e.suffix||"",i=e.build||null;let c=n.armor,u={...n.weapon},h=[...n.traits];if(i){const p=yh[i];p&&(h.push(p.name),p.modifiers.armor!==void 0&&(c=p.modifiers.armor),p.modifiers.armorBonus&&(c=(c||0)+p.modifiers.armorBonus),p.modifiers.weapon&&(u={...p.modifiers.weapon}))}return{id:r,name:`${n.name}${a?" "+a:""}`,type:t,build:i,hp:{current:n.hp,max:n.hp},morale:n.morale,armor:c,weapon:u,traits:h,status:"active",notes:"",fodder:n.fodder,dr:n.dr,createdAt:Date.now()}}function Aw(t,e,n={}){const r=[];for(let a=0;a<e&&a<dg.length;a++)r.push(Al(t,{...n,suffix:dg[a]}));return r}function gm(){const t=Math.floor(Math.random()*6);return Bl[t]}function C_(t){const e=Math.floor(Math.random()*6)+1,n=Math.floor(Math.random()*6)+1,r=e+n,a=r>t;let i=null;return a&&(i=Math.floor(Math.random()*6)+1<=4?"flees":"surrenders"),{dice:[e,n],total:r,morale:t,demoralized:a,outcome:i}}function T_(t,e=!1){const{diceCount:n,diceSides:r}=t,a=[];for(let c=0;c<n;c++)if(e){const u=Math.floor(Math.random()*r)+1,h=Math.floor(Math.random()*r)+1;a.push({roll1:u,roll2:h,best:Math.max(u,h)})}else a.push(Math.floor(Math.random()*r)+1);const i=e?a.reduce((c,u)=>c+u.best,0):a.reduce((c,u)=>c+u,0);return{weapon:t.name,damage:t.damage,rolls:a,total:i,advantage:e}}function E_(t,e){if(e===0||e===null)return{finalDamage:t,reduction:0,armorRoll:null};const n=Nu[e];if(!n||!n.reduction)return{finalDamage:t,reduction:0,armorRoll:null};const r=Math.floor(Math.random()*n.reduction)+1;return{finalDamage:Math.max(0,t-r),reduction:r,armorRoll:r,armorDie:n.dice}}const yN=E.createContext(),R_=()=>`combat-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;function pn(){const t=E.useContext(yN);if(!t)throw new Error("useSpaceCombat must be used within a SpaceCombatProvider");return t}const A_={isActive:!1,shipArmor:2,torpedoesLoaded:0,hyperdriveCharge:0,stationAssignments:{pilot:null,copilot:null,engineer1:null,engineer2:null,gunner1:null,gunner2:null},combatLog:[],enemies:[]},Gi=t=>`star-dashborg-combat-view-${t}`;function __({children:t}){const{gameState:e,updateGameState:n,addLog:r,roomCode:a}=Ge(),[i,c]=E.useState(A_),u=E.useRef(null),h=E.useRef(0),p=E.useMemo(()=>R_(),[]),[m,g]=E.useState(()=>{if(!a)return!1;try{return localStorage.getItem(Gi(a))==="true"}catch{return!1}});E.useEffect(()=>{if(!a)return;const T=Fe.channel(`combat-sync:${a}`).on("broadcast",{event:"combat_update"},z=>{const{senderId:H,timestamp:Q,type:de,data:fe}=z.payload;if(H!==p&&!(Q<=h.current))if(h.current=Q,de==="ENEMY_HP_ADJUST"){const{enemyId:ae,newHp:we,newStatus:me}=fe;c(tt=>({...tt,enemies:(tt.enemies||[]).map(mt=>mt.id===ae?{...mt,hp:{...mt.hp,current:we},status:me}:mt)}))}else de==="COMBAT_STATE_UPDATE"&&c(ae=>({...ae,...fe}))}).subscribe();return u.current=T,()=>{Fe.removeChannel(T),u.current=null}},[a,p]),E.useEffect(()=>{e.spaceCombat&&c(e.spaceCombat)},[e.spaceCombat]),E.useEffect(()=>{if(a)try{localStorage.setItem(Gi(a),m.toString())}catch{}},[m,a]),E.useEffect(()=>{if(a){if(e.spaceCombat?.isActive)try{localStorage.getItem(Gi(a))==="true"&&!m&&g(!0)}catch{}if(e.spaceCombat&&!e.spaceCombat.isActive)try{localStorage.removeItem(Gi(a))}catch{}}},[e.spaceCombat?.isActive,a]);const x=E.useCallback(T=>{c(z=>{const H=typeof T=="function"?T(z):{...z,...T};return n({spaceCombat:H}),H})},[n]),v=E.useCallback(()=>{x({isActive:!0,shipArmor:2,torpedoesLoaded:0,hyperdriveCharge:0,combatLog:[]}),g(!0),r("Entering space combat - Battle Stations!","combat")},[x,r]),w=E.useCallback(()=>{if(g(!1),a)try{localStorage.removeItem(Gi(a))}catch{}},[a]),N=E.useCallback(()=>{g(!0)},[]),S=E.useCallback(()=>{if(x({isActive:!1}),g(!1),a)try{localStorage.removeItem(Gi(a))}catch{}r("Space combat ended","combat")},[x,r,a]),j=E.useCallback((T,z)=>{x(H=>({...H,stationAssignments:{...H.stationAssignments,[T]:z}}))},[x]),A=E.useCallback(T=>{x(z=>({...z,stationAssignments:{...z.stationAssignments,[T]:null}}))},[x]),$=E.useCallback(T=>{if(T<0){const H=new Audio("/star-dashborg/sounds/shield-hit.mp3");H.volume=.5,H.play().catch(()=>{})}else if(T>0){const H=new Audio("/star-dashborg/sounds/shield-power-up.mp3");H.volume=.5,H.play().catch(()=>{})}const z=io(e.ship||{});x(H=>{const Q=Math.max(0,Math.min(z,H.shipArmor+T));return{...H,shipArmor:Q}})},[x,e.ship]),L=E.useCallback(T=>{x(z=>({...z,torpedoesLoaded:z.torpedoesLoaded+T}))},[x]),R=E.useCallback(()=>{x(T=>({...T,torpedoesLoaded:Math.max(0,T.torpedoesLoaded-1)}))},[x]),M=E.useCallback(()=>{x(T=>({...T,hyperdriveCharge:Math.min(3,T.hyperdriveCharge+1)}))},[x]),D=E.useCallback(()=>{const T=new Audio("/star-dashborg/sounds/hyperdrive-power-down.mp3");T.volume=.5,T.play().catch(()=>{}),x(z=>({...z,hyperdriveCharge:Math.max(0,z.hyperdriveCharge-1)}))},[x]),I=E.useCallback(()=>{x(T=>({...T,hyperdriveCharge:0}))},[x]),W=E.useCallback((T,z="info",H=null)=>{x(Q=>({...Q,combatLog:[{id:Date.now().toString(),timestamp:new Date().toISOString(),message:T,type:z,data:H},...Q.combatLog].slice(0,50)}))},[x]),ue=E.useCallback(T=>{x(z=>({...z,enemies:[...z.enemies||[],T]})),W(`Enemy spawned: ${T.name}`,"enemy",{enemyId:T.id})},[x,W]),he=E.useCallback(T=>{x(H=>({...H,enemies:[...H.enemies||[],...T]}));const z=T.map(H=>H.name).join(", ");W(`Enemies spawned: ${z}`,"enemy",{count:T.length})},[x,W]),J=E.useCallback((T,z)=>{x(H=>({...H,enemies:(H.enemies||[]).map(Q=>Q.id===T?{...Q,...z}:Q)}))},[x]),_=E.useCallback(T=>{x(z=>({...z,enemies:(z.enemies||[]).filter(H=>H.id!==T)}))},[x]),V=E.useCallback(()=>{x(T=>({...T,enemies:[]})),W("All enemies cleared","info")},[x,W]),F=E.useCallback((T,z)=>{x(H=>{const Q=H.enemies||[],de=Q.find(gt=>gt.id===T);if(!de)return H;const{finalDamage:fe,reduction:ae,armorDie:we}=E_(z,de.armor);let me;de.fodder&&fe>0?me=0:me=Math.max(0,de.hp.current-fe);const tt=me===0?"destroyed":de.status;let mt=`${de.name} takes ${fe} damage`;return ae>0&&(mt+=` (${z} - ${we}[${ae}] armor)`),me===0?mt+=" - DESTROYED!":mt+=` [${me}/${de.hp.max} HP]`,{...H,enemies:Q.map(gt=>gt.id===T?{...gt,hp:{...gt.hp,current:me},status:tt}:gt),combatLog:[{id:Date.now().toString(),timestamp:new Date().toISOString(),message:mt,type:me===0?"destroy":"damage",data:{enemyId:T,damage:z,finalDamage:fe,reduction:ae}},...H.combatLog].slice(0,50)}})},[x]),O=E.useCallback(T=>{const H=(i.enemies||[]).find(de=>de.id===T);if(!H||!H.weapon)return null;const Q=T_(H.weapon,H.weapon.advantage);return W(`${H.name} attacks with ${H.weapon.name}: ${Q.total} damage`,"attack",{enemyId:T,...Q}),Q},[i.enemies,W]),K=E.useCallback(T=>{const z=i.enemies||[],H=z.find(me=>me.id===T);if(!H||H.morale===null)return null;const Q=z.filter(me=>me.type===H.type&&me.status==="active").length,de=nc[H.type],fe=Q>=4&&de?.moraleBoosted?de.moraleBoosted:H.morale,ae=C_(fe);let we=`${H.name} morale check: [${ae.dice.join(", ")}] = ${ae.total} vs MRL ${fe}`;return Q>=4&&de?.moraleBoosted&&(we+=" (Squadthink)"),ae.demoralized?(we+=` - DEMORALIZED! ${ae.outcome==="flees"?"FLEEING!":"SURRENDERS!"}`,x(me=>({...me,enemies:(me.enemies||[]).map(tt=>tt.id===T?{...tt,status:ae.outcome==="flees"?"fleeing":"surrendered"}:tt)}))):we+=" - Holds firm!",W(we,ae.demoralized?"morale-fail":"morale",{enemyId:T,...ae,effectiveMorale:fe}),ae},[i.enemies,W,x]),Z=E.useCallback((T,z)=>{const Q=(i.enemies||[]).find(ae=>ae.id===T);if(!Q)return;const de=Math.max(0,Math.min(Q.hp.max,Q.hp.current+z)),fe=de===0?"destroyed":de>0&&Q.status==="destroyed"?"active":Q.status;if(z<0){const ae=new Audio("/star-dashborg/sounds/heavy-laser-fire.mp3");ae.volume=.5,ae.play().catch(()=>{})}else if(z>0){const ae=new Audio("/star-dashborg/sounds/shield-power-up.mp3");ae.volume=.5,ae.play().catch(()=>{})}u.current&&u.current.send({type:"broadcast",event:"combat_update",payload:{senderId:p,timestamp:Date.now(),type:"ENEMY_HP_ADJUST",data:{enemyId:T,newHp:de,newStatus:fe}}}),x(ae=>{const we=ae.enemies||[],me=we.find(gt=>gt.id===T);if(!me)return ae;const tt=Math.max(0,Math.min(me.hp.max,me.hp.current+z)),mt=tt===0?"destroyed":tt>0&&me.status==="destroyed"?"active":me.status;return{...ae,enemies:we.map(gt=>gt.id===T?{...gt,hp:{...gt.hp,current:tt},status:mt}:gt)}})},[x,i.enemies,p]),X=E.useCallback(()=>(i.enemies||[]).filter(T=>T.status==="active").length,[i.enemies]),te={spaceCombat:i,viewingCombat:m,updateSpaceCombat:x,enterCombat:v,exitCombat:S,exitCombatView:w,joinCombatView:N,assignStation:j,unassignStation:A,modifyArmor:$,loadTorpedoes:L,fireTorpedo:R,chargeHyperdrive:M,decrementHyperdrive:D,resetHyperdrive:I,addCombatLog:W,addEnemy:ue,addEnemies:he,updateEnemy:J,removeEnemy:_,clearAllEnemies:V,applyDamageToEnemy:F,rollEnemyAttack:O,rollEnemyMorale:K,adjustEnemyHp:Z,getActiveEnemyCount:X};return l.jsx(yN.Provider,{value:te,children:t})}function xN(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var a=t.length;for(e=0;e<a;e++)t[e]&&(n=xN(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function M_(){for(var t,e,n=0,r="",a=arguments.length;n<a;n++)(t=arguments[n])&&(e=xN(t))&&(r&&(r+=" "),r+=e);return r}const O_=(t,e)=>{const n=new Array(t.length+e.length);for(let r=0;r<t.length;r++)n[r]=t[r];for(let r=0;r<e.length;r++)n[t.length+r]=e[r];return n},D_=(t,e)=>({classGroupId:t,validator:e}),bN=(t=new Map,e=null,n)=>({nextPart:t,validators:e,classGroupId:n}),ku="-",_w=[],L_="arbitrary..",$_=t=>{const e=I_(t),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=t;return{getClassGroupId:c=>{if(c.startsWith("[")&&c.endsWith("]"))return B_(c);const u=c.split(ku),h=u[0]===""&&u.length>1?1:0;return vN(u,h,e)},getConflictingClassGroupIds:(c,u)=>{if(u){const h=r[c],p=n[c];return h?p?O_(p,h):h:p||_w}return n[c]||_w}}},vN=(t,e,n)=>{if(t.length-e===0)return n.classGroupId;const a=t[e],i=n.nextPart.get(a);if(i){const p=vN(t,e+1,i);if(p)return p}const c=n.validators;if(c===null)return;const u=e===0?t.join(ku):t.slice(e).join(ku),h=c.length;for(let p=0;p<h;p++){const m=c[p];if(m.validator(u))return m.classGroupId}},B_=t=>t.slice(1,-1).indexOf(":")===-1?void 0:(()=>{const e=t.slice(1,-1),n=e.indexOf(":"),r=e.slice(0,n);return r?L_+r:void 0})(),I_=t=>{const{theme:e,classGroups:n}=t;return P_(n,e)},P_=(t,e)=>{const n=bN();for(const r in t){const a=t[r];ey(a,n,r,e)}return n},ey=(t,e,n,r)=>{const a=t.length;for(let i=0;i<a;i++){const c=t[i];z_(c,e,n,r)}},z_=(t,e,n,r)=>{if(typeof t=="string"){U_(t,e,n);return}if(typeof t=="function"){H_(t,e,n,r);return}V_(t,e,n,r)},U_=(t,e,n)=>{const r=t===""?e:wN(e,t);r.classGroupId=n},H_=(t,e,n,r)=>{if(F_(t)){ey(t(r),e,n,r);return}e.validators===null&&(e.validators=[]),e.validators.push(D_(n,t))},V_=(t,e,n,r)=>{const a=Object.entries(t),i=a.length;for(let c=0;c<i;c++){const[u,h]=a[c];ey(h,wN(e,u),n,r)}},wN=(t,e)=>{let n=t;const r=e.split(ku),a=r.length;for(let i=0;i<a;i++){const c=r[i];let u=n.nextPart.get(c);u||(u=bN(),n.nextPart.set(c,u)),n=u}return n},F_=t=>"isThemeGetter"in t&&t.isThemeGetter===!0,G_=t=>{if(t<1)return{get:()=>{},set:()=>{}};let e=0,n=Object.create(null),r=Object.create(null);const a=(i,c)=>{n[i]=c,e++,e>t&&(e=0,r=n,n=Object.create(null))};return{get(i){let c=n[i];if(c!==void 0)return c;if((c=r[i])!==void 0)return a(i,c),c},set(i,c){i in n?n[i]=c:a(i,c)}}},ug="!",Mw=":",q_=[],Ow=(t,e,n,r,a)=>({modifiers:t,hasImportantModifier:e,baseClassName:n,maybePostfixModifierPosition:r,isExternal:a}),W_=t=>{const{prefix:e,experimentalParseClassName:n}=t;let r=a=>{const i=[];let c=0,u=0,h=0,p;const m=a.length;for(let N=0;N<m;N++){const S=a[N];if(c===0&&u===0){if(S===Mw){i.push(a.slice(h,N)),h=N+1;continue}if(S==="/"){p=N;continue}}S==="["?c++:S==="]"?c--:S==="("?u++:S===")"&&u--}const g=i.length===0?a:a.slice(h);let x=g,v=!1;g.endsWith(ug)?(x=g.slice(0,-1),v=!0):g.startsWith(ug)&&(x=g.slice(1),v=!0);const w=p&&p>h?p-h:void 0;return Ow(i,v,x,w)};if(e){const a=e+Mw,i=r;r=c=>c.startsWith(a)?i(c.slice(a.length)):Ow(q_,!1,c,void 0,!0)}if(n){const a=r;r=i=>n({className:i,parseClassName:a})}return r},K_=t=>{const e=new Map;return t.orderSensitiveModifiers.forEach((n,r)=>{e.set(n,1e6+r)}),n=>{const r=[];let a=[];for(let i=0;i<n.length;i++){const c=n[i],u=c[0]==="[",h=e.has(c);u||h?(a.length>0&&(a.sort(),r.push(...a),a=[]),r.push(c)):a.push(c)}return a.length>0&&(a.sort(),r.push(...a)),r}},Y_=t=>({cache:G_(t.cacheSize),parseClassName:W_(t),sortModifiers:K_(t),...$_(t)}),J_=/\s+/,Q_=(t,e)=>{const{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:a,sortModifiers:i}=e,c=[],u=t.trim().split(J_);let h="";for(let p=u.length-1;p>=0;p-=1){const m=u[p],{isExternal:g,modifiers:x,hasImportantModifier:v,baseClassName:w,maybePostfixModifierPosition:N}=n(m);if(g){h=m+(h.length>0?" "+h:h);continue}let S=!!N,j=r(S?w.substring(0,N):w);if(!j){if(!S){h=m+(h.length>0?" "+h:h);continue}if(j=r(w),!j){h=m+(h.length>0?" "+h:h);continue}S=!1}const A=x.length===0?"":x.length===1?x[0]:i(x).join(":"),$=v?A+ug:A,L=$+j;if(c.indexOf(L)>-1)continue;c.push(L);const R=a(j,S);for(let M=0;M<R.length;++M){const D=R[M];c.push($+D)}h=m+(h.length>0?" "+h:h)}return h},X_=(...t)=>{let e=0,n,r,a="";for(;e<t.length;)(n=t[e++])&&(r=SN(n))&&(a&&(a+=" "),a+=r);return a},SN=t=>{if(typeof t=="string")return t;let e,n="";for(let r=0;r<t.length;r++)t[r]&&(e=SN(t[r]))&&(n&&(n+=" "),n+=e);return n},Z_=(t,...e)=>{let n,r,a,i;const c=h=>{const p=e.reduce((m,g)=>g(m),t());return n=Y_(p),r=n.cache.get,a=n.cache.set,i=u,u(h)},u=h=>{const p=r(h);if(p)return p;const m=Q_(h,n);return a(h,m),m};return i=c,(...h)=>i(X_(...h))},eM=[],$t=t=>{const e=n=>n[t]||eM;return e.isThemeGetter=!0,e},NN=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,kN=/^\((?:(\w[\w-]*):)?(.+)\)$/i,tM=/^\d+\/\d+$/,nM=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,rM=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,sM=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,aM=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,iM=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,qi=t=>tM.test(t),Ie=t=>!!t&&!Number.isNaN(Number(t)),Os=t=>!!t&&Number.isInteger(Number(t)),ym=t=>t.endsWith("%")&&Ie(t.slice(0,-1)),Wr=t=>nM.test(t),oM=()=>!0,lM=t=>rM.test(t)&&!sM.test(t),jN=()=>!1,cM=t=>aM.test(t),dM=t=>iM.test(t),uM=t=>!be(t)&&!ve(t),hM=t=>wo(t,EN,jN),be=t=>NN.test(t),ja=t=>wo(t,RN,lM),xm=t=>wo(t,yM,Ie),Dw=t=>wo(t,CN,jN),fM=t=>wo(t,TN,dM),Jd=t=>wo(t,AN,cM),ve=t=>kN.test(t),vl=t=>So(t,RN),pM=t=>So(t,xM),Lw=t=>So(t,CN),mM=t=>So(t,EN),gM=t=>So(t,TN),Qd=t=>So(t,AN,!0),wo=(t,e,n)=>{const r=NN.exec(t);return r?r[1]?e(r[1]):n(r[2]):!1},So=(t,e,n=!1)=>{const r=kN.exec(t);return r?r[1]?e(r[1]):n:!1},CN=t=>t==="position"||t==="percentage",TN=t=>t==="image"||t==="url",EN=t=>t==="length"||t==="size"||t==="bg-size",RN=t=>t==="length",yM=t=>t==="number",xM=t=>t==="family-name",AN=t=>t==="shadow",bM=()=>{const t=$t("color"),e=$t("font"),n=$t("text"),r=$t("font-weight"),a=$t("tracking"),i=$t("leading"),c=$t("breakpoint"),u=$t("container"),h=$t("spacing"),p=$t("radius"),m=$t("shadow"),g=$t("inset-shadow"),x=$t("text-shadow"),v=$t("drop-shadow"),w=$t("blur"),N=$t("perspective"),S=$t("aspect"),j=$t("ease"),A=$t("animate"),$=()=>["auto","avoid","all","avoid-page","page","left","right","column"],L=()=>["center","top","bottom","left","right","top-left","left-top","top-right","right-top","bottom-right","right-bottom","bottom-left","left-bottom"],R=()=>[...L(),ve,be],M=()=>["auto","hidden","clip","visible","scroll"],D=()=>["auto","contain","none"],I=()=>[ve,be,h],W=()=>[qi,"full","auto",...I()],ue=()=>[Os,"none","subgrid",ve,be],he=()=>["auto",{span:["full",Os,ve,be]},Os,ve,be],J=()=>[Os,"auto",ve,be],_=()=>["auto","min","max","fr",ve,be],V=()=>["start","end","center","between","around","evenly","stretch","baseline","center-safe","end-safe"],F=()=>["start","end","center","stretch","center-safe","end-safe"],O=()=>["auto",...I()],K=()=>[qi,"auto","full","dvw","dvh","lvw","lvh","svw","svh","min","max","fit",...I()],Z=()=>[t,ve,be],X=()=>[...L(),Lw,Dw,{position:[ve,be]}],te=()=>["no-repeat",{repeat:["","x","y","space","round"]}],T=()=>["auto","cover","contain",mM,hM,{size:[ve,be]}],z=()=>[ym,vl,ja],H=()=>["","none","full",p,ve,be],Q=()=>["",Ie,vl,ja],de=()=>["solid","dashed","dotted","double"],fe=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ae=()=>[Ie,ym,Lw,Dw],we=()=>["","none",w,ve,be],me=()=>["none",Ie,ve,be],tt=()=>["none",Ie,ve,be],mt=()=>[Ie,ve,be],gt=()=>[qi,"full",...I()];return{cacheSize:500,theme:{animate:["spin","ping","pulse","bounce"],aspect:["video"],blur:[Wr],breakpoint:[Wr],color:[oM],container:[Wr],"drop-shadow":[Wr],ease:["in","out","in-out"],font:[uM],"font-weight":["thin","extralight","light","normal","medium","semibold","bold","extrabold","black"],"inset-shadow":[Wr],leading:["none","tight","snug","normal","relaxed","loose"],perspective:["dramatic","near","normal","midrange","distant","none"],radius:[Wr],shadow:[Wr],spacing:["px",Ie],text:[Wr],"text-shadow":[Wr],tracking:["tighter","tight","normal","wide","wider","widest"]},classGroups:{aspect:[{aspect:["auto","square",qi,be,ve,S]}],container:["container"],columns:[{columns:[Ie,be,ve,u]}],"break-after":[{"break-after":$()}],"break-before":[{"break-before":$()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],sr:["sr-only","not-sr-only"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:R()}],overflow:[{overflow:M()}],"overflow-x":[{"overflow-x":M()}],"overflow-y":[{"overflow-y":M()}],overscroll:[{overscroll:D()}],"overscroll-x":[{"overscroll-x":D()}],"overscroll-y":[{"overscroll-y":D()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:W()}],"inset-x":[{"inset-x":W()}],"inset-y":[{"inset-y":W()}],start:[{start:W()}],end:[{end:W()}],top:[{top:W()}],right:[{right:W()}],bottom:[{bottom:W()}],left:[{left:W()}],visibility:["visible","invisible","collapse"],z:[{z:[Os,"auto",ve,be]}],basis:[{basis:[qi,"full","auto",u,...I()]}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["nowrap","wrap","wrap-reverse"]}],flex:[{flex:[Ie,qi,"auto","initial","none",be]}],grow:[{grow:["",Ie,ve,be]}],shrink:[{shrink:["",Ie,ve,be]}],order:[{order:[Os,"first","last","none",ve,be]}],"grid-cols":[{"grid-cols":ue()}],"col-start-end":[{col:he()}],"col-start":[{"col-start":J()}],"col-end":[{"col-end":J()}],"grid-rows":[{"grid-rows":ue()}],"row-start-end":[{row:he()}],"row-start":[{"row-start":J()}],"row-end":[{"row-end":J()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":_()}],"auto-rows":[{"auto-rows":_()}],gap:[{gap:I()}],"gap-x":[{"gap-x":I()}],"gap-y":[{"gap-y":I()}],"justify-content":[{justify:[...V(),"normal"]}],"justify-items":[{"justify-items":[...F(),"normal"]}],"justify-self":[{"justify-self":["auto",...F()]}],"align-content":[{content:["normal",...V()]}],"align-items":[{items:[...F(),{baseline:["","last"]}]}],"align-self":[{self:["auto",...F(),{baseline:["","last"]}]}],"place-content":[{"place-content":V()}],"place-items":[{"place-items":[...F(),"baseline"]}],"place-self":[{"place-self":["auto",...F()]}],p:[{p:I()}],px:[{px:I()}],py:[{py:I()}],ps:[{ps:I()}],pe:[{pe:I()}],pt:[{pt:I()}],pr:[{pr:I()}],pb:[{pb:I()}],pl:[{pl:I()}],m:[{m:O()}],mx:[{mx:O()}],my:[{my:O()}],ms:[{ms:O()}],me:[{me:O()}],mt:[{mt:O()}],mr:[{mr:O()}],mb:[{mb:O()}],ml:[{ml:O()}],"space-x":[{"space-x":I()}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":I()}],"space-y-reverse":["space-y-reverse"],size:[{size:K()}],w:[{w:[u,"screen",...K()]}],"min-w":[{"min-w":[u,"screen","none",...K()]}],"max-w":[{"max-w":[u,"screen","none","prose",{screen:[c]},...K()]}],h:[{h:["screen","lh",...K()]}],"min-h":[{"min-h":["screen","lh","none",...K()]}],"max-h":[{"max-h":["screen","lh",...K()]}],"font-size":[{text:["base",n,vl,ja]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:[r,ve,xm]}],"font-stretch":[{"font-stretch":["ultra-condensed","extra-condensed","condensed","semi-condensed","normal","semi-expanded","expanded","extra-expanded","ultra-expanded",ym,be]}],"font-family":[{font:[pM,be,e]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:[a,ve,be]}],"line-clamp":[{"line-clamp":[Ie,"none",ve,xm]}],leading:[{leading:[i,...I()]}],"list-image":[{"list-image":["none",ve,be]}],"list-style-position":[{list:["inside","outside"]}],"list-style-type":[{list:["disc","decimal","none",ve,be]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"placeholder-color":[{placeholder:Z()}],"text-color":[{text:Z()}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...de(),"wavy"]}],"text-decoration-thickness":[{decoration:[Ie,"from-font","auto",ve,ja]}],"text-decoration-color":[{decoration:Z()}],"underline-offset":[{"underline-offset":[Ie,"auto",ve,be]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:I()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",ve,be]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],wrap:[{wrap:["break-word","anywhere","normal"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",ve,be]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:X()}],"bg-repeat":[{bg:te()}],"bg-size":[{bg:T()}],"bg-image":[{bg:["none",{linear:[{to:["t","tr","r","br","b","bl","l","tl"]},Os,ve,be],radial:["",ve,be],conic:[Os,ve,be]},gM,fM]}],"bg-color":[{bg:Z()}],"gradient-from-pos":[{from:z()}],"gradient-via-pos":[{via:z()}],"gradient-to-pos":[{to:z()}],"gradient-from":[{from:Z()}],"gradient-via":[{via:Z()}],"gradient-to":[{to:Z()}],rounded:[{rounded:H()}],"rounded-s":[{"rounded-s":H()}],"rounded-e":[{"rounded-e":H()}],"rounded-t":[{"rounded-t":H()}],"rounded-r":[{"rounded-r":H()}],"rounded-b":[{"rounded-b":H()}],"rounded-l":[{"rounded-l":H()}],"rounded-ss":[{"rounded-ss":H()}],"rounded-se":[{"rounded-se":H()}],"rounded-ee":[{"rounded-ee":H()}],"rounded-es":[{"rounded-es":H()}],"rounded-tl":[{"rounded-tl":H()}],"rounded-tr":[{"rounded-tr":H()}],"rounded-br":[{"rounded-br":H()}],"rounded-bl":[{"rounded-bl":H()}],"border-w":[{border:Q()}],"border-w-x":[{"border-x":Q()}],"border-w-y":[{"border-y":Q()}],"border-w-s":[{"border-s":Q()}],"border-w-e":[{"border-e":Q()}],"border-w-t":[{"border-t":Q()}],"border-w-r":[{"border-r":Q()}],"border-w-b":[{"border-b":Q()}],"border-w-l":[{"border-l":Q()}],"divide-x":[{"divide-x":Q()}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":Q()}],"divide-y-reverse":["divide-y-reverse"],"border-style":[{border:[...de(),"hidden","none"]}],"divide-style":[{divide:[...de(),"hidden","none"]}],"border-color":[{border:Z()}],"border-color-x":[{"border-x":Z()}],"border-color-y":[{"border-y":Z()}],"border-color-s":[{"border-s":Z()}],"border-color-e":[{"border-e":Z()}],"border-color-t":[{"border-t":Z()}],"border-color-r":[{"border-r":Z()}],"border-color-b":[{"border-b":Z()}],"border-color-l":[{"border-l":Z()}],"divide-color":[{divide:Z()}],"outline-style":[{outline:[...de(),"none","hidden"]}],"outline-offset":[{"outline-offset":[Ie,ve,be]}],"outline-w":[{outline:["",Ie,vl,ja]}],"outline-color":[{outline:Z()}],shadow:[{shadow:["","none",m,Qd,Jd]}],"shadow-color":[{shadow:Z()}],"inset-shadow":[{"inset-shadow":["none",g,Qd,Jd]}],"inset-shadow-color":[{"inset-shadow":Z()}],"ring-w":[{ring:Q()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:Z()}],"ring-offset-w":[{"ring-offset":[Ie,ja]}],"ring-offset-color":[{"ring-offset":Z()}],"inset-ring-w":[{"inset-ring":Q()}],"inset-ring-color":[{"inset-ring":Z()}],"text-shadow":[{"text-shadow":["none",x,Qd,Jd]}],"text-shadow-color":[{"text-shadow":Z()}],opacity:[{opacity:[Ie,ve,be]}],"mix-blend":[{"mix-blend":[...fe(),"plus-darker","plus-lighter"]}],"bg-blend":[{"bg-blend":fe()}],"mask-clip":[{"mask-clip":["border","padding","content","fill","stroke","view"]},"mask-no-clip"],"mask-composite":[{mask:["add","subtract","intersect","exclude"]}],"mask-image-linear-pos":[{"mask-linear":[Ie]}],"mask-image-linear-from-pos":[{"mask-linear-from":ae()}],"mask-image-linear-to-pos":[{"mask-linear-to":ae()}],"mask-image-linear-from-color":[{"mask-linear-from":Z()}],"mask-image-linear-to-color":[{"mask-linear-to":Z()}],"mask-image-t-from-pos":[{"mask-t-from":ae()}],"mask-image-t-to-pos":[{"mask-t-to":ae()}],"mask-image-t-from-color":[{"mask-t-from":Z()}],"mask-image-t-to-color":[{"mask-t-to":Z()}],"mask-image-r-from-pos":[{"mask-r-from":ae()}],"mask-image-r-to-pos":[{"mask-r-to":ae()}],"mask-image-r-from-color":[{"mask-r-from":Z()}],"mask-image-r-to-color":[{"mask-r-to":Z()}],"mask-image-b-from-pos":[{"mask-b-from":ae()}],"mask-image-b-to-pos":[{"mask-b-to":ae()}],"mask-image-b-from-color":[{"mask-b-from":Z()}],"mask-image-b-to-color":[{"mask-b-to":Z()}],"mask-image-l-from-pos":[{"mask-l-from":ae()}],"mask-image-l-to-pos":[{"mask-l-to":ae()}],"mask-image-l-from-color":[{"mask-l-from":Z()}],"mask-image-l-to-color":[{"mask-l-to":Z()}],"mask-image-x-from-pos":[{"mask-x-from":ae()}],"mask-image-x-to-pos":[{"mask-x-to":ae()}],"mask-image-x-from-color":[{"mask-x-from":Z()}],"mask-image-x-to-color":[{"mask-x-to":Z()}],"mask-image-y-from-pos":[{"mask-y-from":ae()}],"mask-image-y-to-pos":[{"mask-y-to":ae()}],"mask-image-y-from-color":[{"mask-y-from":Z()}],"mask-image-y-to-color":[{"mask-y-to":Z()}],"mask-image-radial":[{"mask-radial":[ve,be]}],"mask-image-radial-from-pos":[{"mask-radial-from":ae()}],"mask-image-radial-to-pos":[{"mask-radial-to":ae()}],"mask-image-radial-from-color":[{"mask-radial-from":Z()}],"mask-image-radial-to-color":[{"mask-radial-to":Z()}],"mask-image-radial-shape":[{"mask-radial":["circle","ellipse"]}],"mask-image-radial-size":[{"mask-radial":[{closest:["side","corner"],farthest:["side","corner"]}]}],"mask-image-radial-pos":[{"mask-radial-at":L()}],"mask-image-conic-pos":[{"mask-conic":[Ie]}],"mask-image-conic-from-pos":[{"mask-conic-from":ae()}],"mask-image-conic-to-pos":[{"mask-conic-to":ae()}],"mask-image-conic-from-color":[{"mask-conic-from":Z()}],"mask-image-conic-to-color":[{"mask-conic-to":Z()}],"mask-mode":[{mask:["alpha","luminance","match"]}],"mask-origin":[{"mask-origin":["border","padding","content","fill","stroke","view"]}],"mask-position":[{mask:X()}],"mask-repeat":[{mask:te()}],"mask-size":[{mask:T()}],"mask-type":[{"mask-type":["alpha","luminance"]}],"mask-image":[{mask:["none",ve,be]}],filter:[{filter:["","none",ve,be]}],blur:[{blur:we()}],brightness:[{brightness:[Ie,ve,be]}],contrast:[{contrast:[Ie,ve,be]}],"drop-shadow":[{"drop-shadow":["","none",v,Qd,Jd]}],"drop-shadow-color":[{"drop-shadow":Z()}],grayscale:[{grayscale:["",Ie,ve,be]}],"hue-rotate":[{"hue-rotate":[Ie,ve,be]}],invert:[{invert:["",Ie,ve,be]}],saturate:[{saturate:[Ie,ve,be]}],sepia:[{sepia:["",Ie,ve,be]}],"backdrop-filter":[{"backdrop-filter":["","none",ve,be]}],"backdrop-blur":[{"backdrop-blur":we()}],"backdrop-brightness":[{"backdrop-brightness":[Ie,ve,be]}],"backdrop-contrast":[{"backdrop-contrast":[Ie,ve,be]}],"backdrop-grayscale":[{"backdrop-grayscale":["",Ie,ve,be]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[Ie,ve,be]}],"backdrop-invert":[{"backdrop-invert":["",Ie,ve,be]}],"backdrop-opacity":[{"backdrop-opacity":[Ie,ve,be]}],"backdrop-saturate":[{"backdrop-saturate":[Ie,ve,be]}],"backdrop-sepia":[{"backdrop-sepia":["",Ie,ve,be]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":I()}],"border-spacing-x":[{"border-spacing-x":I()}],"border-spacing-y":[{"border-spacing-y":I()}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["","all","colors","opacity","shadow","transform","none",ve,be]}],"transition-behavior":[{transition:["normal","discrete"]}],duration:[{duration:[Ie,"initial",ve,be]}],ease:[{ease:["linear","initial",j,ve,be]}],delay:[{delay:[Ie,ve,be]}],animate:[{animate:["none",A,ve,be]}],backface:[{backface:["hidden","visible"]}],perspective:[{perspective:[N,ve,be]}],"perspective-origin":[{"perspective-origin":R()}],rotate:[{rotate:me()}],"rotate-x":[{"rotate-x":me()}],"rotate-y":[{"rotate-y":me()}],"rotate-z":[{"rotate-z":me()}],scale:[{scale:tt()}],"scale-x":[{"scale-x":tt()}],"scale-y":[{"scale-y":tt()}],"scale-z":[{"scale-z":tt()}],"scale-3d":["scale-3d"],skew:[{skew:mt()}],"skew-x":[{"skew-x":mt()}],"skew-y":[{"skew-y":mt()}],transform:[{transform:[ve,be,"","none","gpu","cpu"]}],"transform-origin":[{origin:R()}],"transform-style":[{transform:["3d","flat"]}],translate:[{translate:gt()}],"translate-x":[{"translate-x":gt()}],"translate-y":[{"translate-y":gt()}],"translate-z":[{"translate-z":gt()}],"translate-none":["translate-none"],accent:[{accent:Z()}],appearance:[{appearance:["none","auto"]}],"caret-color":[{caret:Z()}],"color-scheme":[{scheme:["normal","dark","light","light-dark","only-dark","only-light"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",ve,be]}],"field-sizing":[{"field-sizing":["fixed","content"]}],"pointer-events":[{"pointer-events":["auto","none"]}],resize:[{resize:["none","","y","x"]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":I()}],"scroll-mx":[{"scroll-mx":I()}],"scroll-my":[{"scroll-my":I()}],"scroll-ms":[{"scroll-ms":I()}],"scroll-me":[{"scroll-me":I()}],"scroll-mt":[{"scroll-mt":I()}],"scroll-mr":[{"scroll-mr":I()}],"scroll-mb":[{"scroll-mb":I()}],"scroll-ml":[{"scroll-ml":I()}],"scroll-p":[{"scroll-p":I()}],"scroll-px":[{"scroll-px":I()}],"scroll-py":[{"scroll-py":I()}],"scroll-ps":[{"scroll-ps":I()}],"scroll-pe":[{"scroll-pe":I()}],"scroll-pt":[{"scroll-pt":I()}],"scroll-pr":[{"scroll-pr":I()}],"scroll-pb":[{"scroll-pb":I()}],"scroll-pl":[{"scroll-pl":I()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",ve,be]}],fill:[{fill:["none",...Z()]}],"stroke-w":[{stroke:[Ie,vl,ja,xm]}],stroke:[{stroke:["none",...Z()]}],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-x","border-w-y","border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-x","border-color-y","border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],translate:["translate-x","translate-y","translate-none"],"translate-none":["translate","translate-x","translate-y","translate-z"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]},orderSensitiveModifiers:["*","**","after","backdrop","before","details-content","file","first-letter","first-line","marker","placeholder","selection"]}},vM=Z_(bM);function oe(...t){return vM(M_(t))}function _N(){const t="ABCDEFGHJKLMNPQRSTUVWXYZ23456789";let e="";for(let n=0;n<4;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}function wM(){return new URLSearchParams(window.location.search).get("room")}function SM(t){const e=new URL(window.location);e.searchParams.set("room",t),window.history.pushState({},"",e)}const NM=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),kM=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,r)=>r?r.toUpperCase():n.toLowerCase()),$w=t=>{const e=kM(t);return e.charAt(0).toUpperCase()+e.slice(1)},MN=(...t)=>t.filter((e,n,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===n).join(" ").trim(),jM=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};var CM={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const TM=E.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:a="",children:i,iconNode:c,...u},h)=>E.createElement("svg",{ref:h,...CM,width:e,height:e,stroke:t,strokeWidth:r?Number(n)*24/Number(e):n,className:MN("lucide",a),...!i&&!jM(u)&&{"aria-hidden":"true"},...u},[...c.map(([p,m])=>E.createElement(p,m)),...Array.isArray(i)?i:[i]]));const ye=(t,e)=>{const n=E.forwardRef(({className:r,...a},i)=>E.createElement(TM,{ref:i,iconNode:e,className:MN(`lucide-${NM($w(t))}`,`lucide-${t}`,r),...a}));return n.displayName=$w(t),n};const EM=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],ty=ye("arrow-right",EM);const RM=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],pr=ye("award",RM);const AM=[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]],hg=ye("bold",AM);const _M=[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],Bw=ye("book-marked",_M);const MM=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],rc=ye("book-open",MM);const OM=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],Ks=ye("check",OM);const DM=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],No=ye("chevron-down",DM);const LM=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],$M=ye("chevron-left",LM);const BM=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],ny=ye("chevron-right",BM);const IM=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],ON=ye("chevron-up",IM);const PM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],zM=ye("circle-alert",PM);const UM=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],DN=ye("circle-check-big",UM);const HM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],VM=ye("circle-plus",HM);const FM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],GM=ye("circle-question-mark",FM);const qM=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],WM=ye("clock",qM);const KM=[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]],fg=ye("coins",KM);const YM=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],LN=ye("copy",YM);const JM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]],sc=ye("crosshair",JM);const QM=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M16 8h.01",key:"cr5u4v"}],["path",{d:"M8 8h.01",key:"1e4136"}],["path",{d:"M8 16h.01",key:"18s6g9"}],["path",{d:"M16 16h.01",key:"1f9h7w"}],["path",{d:"M12 12h.01",key:"1mp3jc"}]],pg=ye("dice-5",QM);const XM=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["path",{d:"M16 8h.01",key:"cr5u4v"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M16 16h.01",key:"1f9h7w"}],["path",{d:"M8 8h.01",key:"1e4136"}],["path",{d:"M8 12h.01",key:"czm47f"}],["path",{d:"M8 16h.01",key:"18s6g9"}]],ZM=ye("dice-6",XM);const eO=[["rect",{width:"12",height:"12",x:"2",y:"10",rx:"2",ry:"2",key:"6agr2n"}],["path",{d:"m17.92 14 3.5-3.5a2.24 2.24 0 0 0 0-3l-5-4.92a2.24 2.24 0 0 0-3 0L10 6",key:"1o487t"}],["path",{d:"M6 18h.01",key:"uhywen"}],["path",{d:"M10 14h.01",key:"ssrbsk"}],["path",{d:"M15 6h.01",key:"cblpky"}],["path",{d:"M18 9h.01",key:"2061c0"}]],tr=ye("dices",eO);const tO=[["path",{d:"M4 22V4a1 1 0 0 1 .4-.8A6 6 0 0 1 8 2c3 0 5 2 7.333 2q2 0 3.067-.8A1 1 0 0 1 20 4v10a1 1 0 0 1-.4.8A6 6 0 0 1 16 16c-3 0-5-2-8-2a6 6 0 0 0-4 1.528",key:"1jaruq"}]],$N=ye("flag",tO);const nO=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],rO=ye("grip-vertical",nO);const sO=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],aO=ye("heart",sO);const iO=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],oO=ye("info",iO);const lO=[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]],BN=ye("italic",lO);const cO=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],IN=ye("list",cO);const dO=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],Iw=ye("lock",dO);const uO=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],Pw=ye("log-out",uO);const hO=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],zw=ye("map-pin",hO);const fO=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],pO=ye("map",fO);const mO=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],gO=ye("maximize-2",mO);const yO=[["path",{d:"M5 12h14",key:"1ays0h"}]],bc=ye("minus",yO);const xO=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],PN=ye("play",xO);const bO=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],ir=ye("plus",bO);const vO=[["path",{d:"M16.247 7.761a6 6 0 0 1 0 8.478",key:"1fwjs5"}],["path",{d:"M19.075 4.933a10 10 0 0 1 0 14.134",key:"ehdyv1"}],["path",{d:"M4.925 19.067a10 10 0 0 1 0-14.134",key:"1q22gi"}],["path",{d:"M7.753 16.239a6 6 0 0 1 0-8.478",key:"r2q7qm"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Uw=ye("radio",vO);const wO=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],mg=ye("refresh-cw",wO);const SO=[["path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z",key:"m3kijz"}],["path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z",key:"1fmvmk"}],["path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0",key:"1f8sc4"}],["path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5",key:"qeys4"}]],ac=ye("rocket",SO);const NO=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],kO=ye("save",NO);const jO=[["path",{d:"M19 17V5a2 2 0 0 0-2-2H4",key:"zz82l3"}],["path",{d:"M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3",key:"1ph1d7"}]],CO=ye("scroll",jO);const TO=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Hw=ye("search",TO);const EO=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ic=ye("settings",EO);const RO=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],AO=ye("shield-alert",RO);const _O=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]],MO=ye("shield-off",_O);const OO=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],vc=ye("shield",OO);const DO=[["path",{d:"M12 10.189V14",key:"1p8cqu"}],["path",{d:"M12 2v3",key:"qbqxhf"}],["path",{d:"M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6",key:"qpkstq"}],["path",{d:"M19.38 20A11.6 11.6 0 0 0 21 14l-8.188-3.639a2 2 0 0 0-1.624 0L3 14a11.6 11.6 0 0 0 2.81 7.76",key:"7tigtc"}],["path",{d:"M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1s1.2 1 2.5 1c2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"1924j5"}]],zN=ye("ship",DO);const LO=[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]],gg=ye("shopping-cart",LO);const $O=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],BO=ye("shuffle",$O);const IO=[["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M15 22a1 1 0 0 0 1-1v-1a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20v1a1 1 0 0 0 1 1z",key:"1o5pge"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}]],UN=ye("skull",IO);const PO=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],HN=ye("sparkles",PO);const zO=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],mr=ye("star",zO);const UO=[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]],VN=ye("strikethrough",UO);const HO=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]],VO=ye("swords",HO);const FO=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Va=ye("target",FO);const GO=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],rs=ye("trash-2",GO);const qO=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],WO=ye("trending-up",qO);const KO=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ar=ye("triangle-alert",KO);const YO=[["path",{d:"M10 14.66v1.626a2 2 0 0 1-.976 1.696A5 5 0 0 0 7 21.978",key:"1n3hpd"}],["path",{d:"M14 14.66v1.626a2 2 0 0 0 .976 1.696A5 5 0 0 1 17 21.978",key:"rfe1zi"}],["path",{d:"M18 9h1.5a1 1 0 0 0 0-5H18",key:"7xy6bh"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M6 9a6 6 0 0 0 12 0V3a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1z",key:"1mhfuq"}],["path",{d:"M6 9H4.5a1 1 0 0 1 0-5H6",key:"tex48p"}]],JO=ye("trophy",YO);const QO=[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]],FN=ye("underline",QO);const XO=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],ZO=ye("user-x",XO);const eD=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],Fs=ye("user",eD);const tD=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],ry=ye("users",tD);const nD=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],rD=ye("volume-2",nD);const sD=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],aD=ye("volume-x",sD);const iD=[["path",{d:"M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.106-3.105c.32-.322.863-.22.983.218a6 6 0 0 1-8.259 7.057l-7.91 7.91a1 1 0 0 1-2.999-3l7.91-7.91a6 6 0 0 1 7.057-8.259c.438.12.54.662.219.984z",key:"1ngwbx"}]],GN=ye("wrench",iD);const oD=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Er=ye("x",oD);const lD=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],In=ye("zap",lD);function ge({children:t,variant:e="primary",className:n,onClick:r,disabled:a,...i}){const c="px-3 sm:px-4 py-2 font-orbitron font-bold uppercase text-xs sm:text-sm border-3 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed active:scale-[0.98] active:shadow-inner leading-tight",u={primary:"bg-accent-cyan text-bg-primary border-accent-cyan hover:bg-transparent hover:text-accent-cyan hover:shadow-[0_0_15px_rgba(0,240,255,0.6)]",secondary:"bg-accent-yellow text-bg-primary border-accent-yellow hover:bg-transparent hover:text-accent-yellow hover:shadow-[0_0_15px_rgba(255,252,0,0.6)]",danger:"bg-accent-red text-bg-primary border-accent-red hover:bg-transparent hover:text-accent-red hover:shadow-[0_0_15px_rgba(255,0,60,0.6)]",ghost:"bg-transparent text-accent-cyan border-accent-cyan hover:bg-accent-cyan hover:text-bg-primary hover:shadow-[0_0_15px_rgba(0,240,255,0.6)]"};return l.jsx("button",{className:oe(c,u[e],n),onClick:r,disabled:a,...i,children:t})}var ko=KS();const cD=WS(ko);function Qa(){const t=document.activeElement;if(!t)return!1;const e=t.tagName;return!!(e==="INPUT"||e==="TEXTAREA"||t.isContentEditable||t.getAttribute("contenteditable")==="true")}function dD({result:t,variant:e="cyan",onDismiss:n}){const[r,a]=E.useState(!1);if(E.useEffect(()=>{t&&(a(!1),setTimeout(()=>a(!0),50))},[t]),!t)return null;const i={cyan:"border-accent-cyan",yellow:"border-accent-yellow",red:"border-accent-red"},c={cyan:"text-accent-cyan",yellow:"text-accent-yellow",red:"text-accent-red"},u={cyan:"text-glow-cyan",yellow:"text-glow-yellow",red:"text-glow-red"};return l.jsxs("div",{className:oe("border-2 bg-bg-primary p-3 mt-3 relative",i[e],r?"fade-in":"opacity-0"),children:[n&&l.jsx("button",{onClick:n,className:oe("absolute top-1 right-1 p-1 hover:bg-opacity-20 transition-colors",c[e]),children:l.jsx(Er,{className:"w-3 h-3"})}),l.jsxs("div",{className:"space-y-2",children:[t.roll!==void 0&&l.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[l.jsx("span",{className:"text-gray-400 font-orbitron",children:"ROLL:"}),l.jsxs("span",{className:oe("font-orbitron font-bold",c[e],u[e]),children:["[",t.roll,"]"]})]}),t.result&&l.jsx("div",{className:oe("text-sm font-orbitron font-bold",c[e],u[e]),children:t.result}),t.detail&&!t.weather&&l.jsx("div",{className:"text-xs text-text-primary",children:t.detail}),t.size&&t.weather&&t.npcReaction&&l.jsxs("div",{className:"space-y-1 text-xs",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Detail:"})," ",t.detail]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Size:"})," ",t.size]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Weather:"})," ",t.weather]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"NPC:"})," ",t.npcReaction]})]}),t.type&&t.typeRoll&&l.jsxs("div",{className:"space-y-1 text-xs",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-gray-400",children:["Type [",t.typeRoll,"]:"]})," ",l.jsx("span",{className:oe("font-bold",c[e]),children:t.type})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-gray-400",children:["Goods [",t.goodsRoll,"]:"]})," ",l.jsx("span",{className:c[e],children:t.goods})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-gray-400",children:["Spot [",t.spotRoll,"]:"]})," ",l.jsx("span",{className:c[e],children:t.spot})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-gray-400",children:["Reward [",t.rewardRoll,"]:"]})," ",l.jsx("span",{className:"text-accent-yellow",children:t.reward})]})]}),t.action&&t.target&&l.jsxs("div",{className:"space-y-1 text-xs",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Action:"})," ",l.jsx("span",{className:oe("font-bold",c[e]),children:t.action})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Target:"})," ",l.jsx("span",{className:oe("font-bold",c[e]),children:t.target})]})]}),t.location&&t.tone&&t.obstacle&&l.jsxs("div",{className:"space-y-1 text-xs",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Location:"})," ",l.jsx("span",{className:c[e],children:t.location})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Tone:"})," ",t.tone]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Obstacle:"})," ",l.jsx("span",{className:"text-accent-red",children:t.obstacle})]})]}),t.verb&&t.subject&&l.jsxs("div",{className:"space-y-1 text-xs",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Verb:"})," ",t.verb]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Subject:"})," ",t.subject]})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Specific:"})," ",l.jsx("span",{className:oe("font-bold",c[e]),children:t.specific})]})]}),t.role&&t.species&&l.jsxs("div",{className:"space-y-1 text-xs",children:[t.name&&l.jsxs("div",{className:"mb-2",children:[l.jsx("span",{className:"text-gray-400",children:"Name:"})," ",l.jsx("span",{className:oe("text-sm font-bold font-orbitron",c[e],u[e]),children:t.name})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Role:"})," ",l.jsx("span",{className:oe("font-bold",c[e]),children:t.role})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Species:"})," ",t.species]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Motivation:"})," ",t.motivation]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Demeanor:"})," ",t.demeanor]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Secret:"})," ",t.secret]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Trait:"})," ",t.trait]})]}),t.terrain&&t.weather&&!t.npcReaction&&l.jsxs("div",{className:"space-y-1 text-xs",children:[t.name&&l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Name:"})," ",l.jsx("span",{className:oe("font-bold",c[e],u[e]),children:t.name})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Terrain:"})," ",l.jsx("span",{className:c[e],children:t.terrain})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Weather:"})," ",t.weather]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Color:"})," ",t.color]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Population:"})," ",t.population]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Control:"})," ",t.control]})]}),t.villain&&!t.visage&&l.jsxs("div",{className:"space-y-1 text-xs",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Villain:"})," ",l.jsx("span",{className:oe("font-bold",c[e]),children:t.villain})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Goal:"})," ",t.goal]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Plan:"})," ",t.plan]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Means:"})," ",t.means]})]}),t.incident&&l.jsxs("div",{className:"space-y-2 text-xs",children:[l.jsx("div",{className:oe("text-sm font-orbitron font-bold",c[e],u[e]),children:t.incident}),t.followUpQuestions&&l.jsx("div",{className:"text-gray-500 italic text-[10px] space-y-0.5 border-t border-gray-700 pt-1.5 mt-2",children:t.followUpQuestions.map((h,p)=>l.jsxs("div",{children:[" ",h]},p))})]}),t.titleType&&t.col1&&t.col2&&t.col3&&t.col4&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"grid grid-cols-4 gap-1 text-xs",children:[l.jsx("div",{className:c[e],children:t.col1}),l.jsx("div",{className:c[e],children:t.col2}),l.jsx("div",{className:c[e],children:t.col3}),l.jsx("div",{className:c[e],children:t.col4})]}),l.jsxs("div",{className:oe("text-sm font-bold font-orbitron",c[e],u[e]),children:[t.col1," ",t.col2," ",t.col3," ",t.col4]})]}),typeof t=="string"&&l.jsx("div",{className:oe("text-sm",c[e]),children:t})]})]})}const Vw=[{incident:"Imminent Annihilation. Your current location is about to be destroyed.",followUpQuestions:["What's the source of potential destruction?","What are the potential means of escape?"]},{incident:"Alien Ambush. You're pinned down by hostile alien forces.",followUpQuestions:["What do you know about the aliens?","How have they gotten you in a tight spot?"]},{incident:"Rescue. You're in the middle of saving an individual or group whose well-being is at risk.",followUpQuestions:["Who are you rescuing?","Who wants to stop you?","What's the greatest obstacle you face?"]},{incident:"Crash Landing. You've been forced to land your ship on a planet, moon, or asteroid.",followUpQuestions:["Why are you being forced to make a crash landing?","What dangers await you?"]},{incident:"Boarding Action. A hostile force has just breached your ship's airlock.",followUpQuestions:["Who or what is coming on board?","What do they want from you?"]},{incident:"Mutiny. A ship's crew revolts against their commanders.",followUpQuestions:["Whose side are you on?","What precipitated the revolt?","What's at stake?"]},{incident:"Blown Cover. You're deep undercover and hostile forces have discovered your identity.",followUpQuestions:["Who were you deceiving?","What was your cover?","What's the immediate threat?"]},{incident:"Heist Gone Wrong. You got what you came for, but now all hell's broken loose.",followUpQuestions:["What are you stealing?","What went wrong?","Who or what is coming after you?"]},{incident:"Biohazard Outbreak. A deadly virus has been released, and you're at ground zero.",followUpQuestions:["What does the virus do?","What protective measures can be taken to avoid its effects?"]}],uD=[{incident:"Hostage Situation. Someone is being held by a hostile group, and they're in danger.",followUpQuestions:["Who's being held hostage?","Why do you need to help them?","Who is the hostile group?"]},{incident:"Biohazard Outbreak. A deadly pathogen has escaped containment.",followUpQuestions:["Where was it being contained?","What allowed it to escape?","What does it do to people?"]},{incident:"Diplomatic Sabotage. Peace talks between hostile factions are on the verge of collapse.",followUpQuestions:["What factions are involved?","Who's the saboteur?","Whose side are you on?"]},{incident:"Crash Landing. You've been forced to land your ship on a planet, moon, or asteroid.",followUpQuestions:["Why are you being forced to make a crash landing?","What dangers await you?"]},{incident:"Planetary Invasion. You're caught in the path of a powerful invading force.",followUpQuestions:["Who are the invaders?","What is their objective?","How can you escape alive?"]},{incident:"Derelict Escape. You discovered something life-threatening aboard an abandoned hulk.",followUpQuestions:["What were you looking for aboard the derelict?","What threat did you discover?"]},{incident:"Prison Break. You've broken someone out, and the authorities are in pursuit.",followUpQuestions:["Who was in jail?","Why did you break them out?","How close are the authorities?"]},{incident:"Interstellar Ambush. A hostile ship has issued a demand for your surrender.",followUpQuestions:["Why are you vulnerable right now?","Who among you knows the opposing ship's captain?"]},{incident:"Imminent Impact. A rogue asteroid is on a collision course with your current location.",followUpQuestions:["How can you possibly escape?","What else will surely be destroyed?"]},{incident:"Navigational Error. You've popped out of jumpspace too close to a stellar body.",followUpQuestions:["Where and what is the stellar body?","How can you escape its gravitational pull?"]}],hD=["Ad","Al","Ala","An","Ar","As","Bal","Ban","Bol","Bor","Bra","Bru","Can","Cin","Cie","Da","Dal","Das","Dav","Daz","Dol","Do","Fan","Fin","Gar","Gre","Gro","Ha","Haz","Hu","Il","In","Is","Jan","Jel","Ji","Jil","Jor","Kal","Kan","Ke","Ko","La","Lan","Lar","Le","Lo","Lor","Lu","Ma","Mi","Mol","Mul","No","Ol","On","Or","Os","Pai","Par","Pir","Pra","Pru","Ra","Ras","Re","Ril","Rin","Rol","Ron","Sa","San","Shan","Si","Ta","Ul","Un","Us","Va","Val","Vaz","Vel","Ves","Vi","Vin","Vu","Vuz","Wa","Wan","Was","Wi","Wu","Xa","Xi","Yel","Zal","Zar","Zil","Zir","Zor"],fD=["","","","","","","","","","","a","ab","abe","al","als","am","an","ana","ar","arn","arna","arra","as","ax","be","ca","can","car","dar","de","dira","da","do","dor","dra","","e","gana","go","i","ia","ib","in","inia","io","ios","ira","is","issa","ja","jo","ju","k","ka","ko","la","lo","lu","mar","mo","mua","na","nar","nor","nora","o","on","ona","or","ora","","ra","ran","ras","rab","","s","si","sir","sira","sun","ta","tam","tama","tar","than","thana","tir","tira","tor","tora","tu","tyl","tyn","u","un","ura","ust","z","zo"],pD=["A","Al","An","Ar","As","Ba","Ban","Bar","Be","Ber","Bi","Blu","Bran","Bras","Bri","Brin","Bro","Bry","Bur","Cam","Can","Cas","Cor","Da","Dan","Del","Des","Dol","Don","Dor","E","El","En","Fil","Fol","Fon","Gran","Gren","Gun","Han","Har","Hin","Hor","I","Il","Jan","Jin","Jis","Ka","Kal","Kan","Kar","Kil","Kin","Kla","Klu","Kol","Kun","La","Lu","Man","Mi","Min","O","Ol","On","Or","Pan","Par","Por","Qua","Qui","Quin","Ra","Re","Ri","Ru","Sa","Sar","Shi","Si","Su","Sun","Tha","Tham","Thi","Til","Ty","U","Ul","Un","Ven","Von","Wil","Win","Ya","Yar","Yin","Zan","Zin"],mD=["aleon","ana","and","ard","as","au","ban","bar","da","dar","daras","darian","dark","daros","das","den","dis","dool","dor","een","en","ene","fa","fir","fo","for","fu","gar","garas","gas","gir","gis","i","if","il","in","is","jan","janas","jarian","ka","kar","karas","karian","kark","kaws","ko","kor","la","las","lo","ma","mak","mar","maras","marian","mark","mas","mik","mo","nall","nar","ne","nor","noros","o","ool","phas","phe","phes","pho","ra","ra","rand","sard","stee","tar","taras","tarian","taro","to","tor","tos","tyr","ul","um","us","vin","vir","yk","za","zar","zaras","zarian","zel","zil","zir","zo","zor","zu"],gD=["A","Alder","Ar","Ash","Bar","Ber","Bes","Bik","Bo","Bosh","Brak","Bre","Bri","Bug","Bur","Cal","Cam","Car","Cas","Cha","Chrys","Cor","Coz","Crac","Dab","Dag","Dun","E","El","Far","Fin","Fir","Fr","Gab","Gar","Haa","Han","Har","Hark","Hol","Jan","Jar","Jas","Jaz","Kam","Kash","Kav","Kir","Kish","Kr","Kul","Lee","Len","Les","Man","Mar","Min","Mir","Mon","Mor","Mur","Murk","Must","Nab","Nal","Nan","Neo","Nin","O","On","Op","Oph","Par","Pell","Pir","Pos","San","Sar","Sin","Star","Stel","Swan","Tal","Tan","Tar","Tat","Tin","Tol","U","Un","Ur","Var","Vir","X","Yan","Yar","Yin","Zab","Zan","Zin"],yD=["a","aak","aan","aar","adan","adir","ag","agan","al","alan","ar","aria","aris","bad","bar","bin","bor","dar","ellia","en","eng","eria","gar","gath","gir","gith","go","gol","gu","i","ic","igar","ilin","in","ina","ing","ino","ir","irin","irra","is","it","ix","kar","kat","ken","kir","ko","ma","min","mo","na","no","o","obah","odan","odir","on","onia","onis","oo","oon","or","oris","oro","orra","osia","osis","paar","pan","para","pin","ra","ro","sar","sid","sil","silia","silor","sk","sko","taa","tal","thami","thar","thor","to","u","ucidar","un","unc","ung","untor","ur","uria","uscant","ut","yk","zar","zir"],xD=["Acceptance","Air","Anguish","Awe","Balance","Beauty","Belief","Belonging","Birth","Bliss","Calm","Chaos","Comfort","Courage","Creation","Darkness","Dawn","Death","Denial","Desolation","Despair","Destiny","Destruction","Devotion","Discovery","Dismay","Dream","Dusk","Earth","Enlightenment","Fate","Fear","Fire","Fortune","Freedom","Fury","Grief","Growth","Harmony","Harvest","Heart","Honor","Hope","Isolation","Joy","Justice","Knowledge","Legacy","Life","Light","Loss","Love","Mercy","Moon","Music","Mystery","Order","Patience","Peace","Power","Promise","Prophecy","Prospect","Protection","Providence","Rage","Rain","Rebirth","Redemption","Refusal","Regret","Renewal","Restoration","Resurrection","Reverence","Reverie","Sacrifice","Serenity","Sight","Solitude","Sorrow","Strength","Sun","Thunder","Time","Tranquility","Transformation","Triumph","Truth","Unity","Victory","Vision","War","Water","Wind","Wisdom","Wonder","Worry","Wrath","Zeal"],bD=["Amber","Arisen","Ascendant","Ashen","Azure","Black","Blessed","Blossom","Blue","Bright","Broken","Certain","Clear","Close","Clouded","Cold","Crystal","Dark","Deep","Doubtful","East","Echo","Eternal","Fallen","False","Far","Fire","Flowering","Forgotten","Forsaken","Free","Gas","Gold","Great","Green","Hidden","High","Holy","Ice","Lone","Lost","Low","Loyal","Lunar","Mist","Moon","Moonlit","Near","New","North","Old","Open","Peaceful","Quiet","Radiant","Reborn","Red","Rocky","Sea","Serene","Shady","Shallow","Sharp","Shining","Silver","Sky","Smoke","Soft","Solar","South","Star","Starlit","Stellar","Strong","Sun","Sunny","Tranquil","True","United","West","White","Yellow","[NPC Name]","[NPC Name]","[NPC Name]","[NPC Name]","[NPC Name]","[NPC Name]","[NPC Name]","[NPC Name]","[NPC Surname]","[NPC Surname]","[NPC Surname]","[NPC Surname]","[NPC Surname]","[NPC Surname]","[NPC Surname]","[NPC Surname]","[NPC Surname]","[NPC Surname]"],vD=["Apex","Ascent","Base","Bastion","Bed","Bottom","Branch","Bridge","Camp","Chasm","Circle","Citadel","Cloud","Cluster","Coast","Colony","Conclave","Corner","Crack","Cradle","Crater","Creche","Crest","Cross","Crossing","Dawn","Depot","Dig","Domain","Echo","Enclave","End","Exchange","Fist","Forge","Fort","Fortress","Fount","Garden","Garrison","Haven","Hole","Hollow","Home","Horizon","Hub","Junction","Keep","Labyrinth","Market","Mill","Monument","Nest","Nexus","Oasis","Outland","Outpost","Peak","Perch","Pit","Platform","Pocket","Port","Post","Prison","Reach","Redoubt","Respite","Ridge","Ring","Rise","River","Roost","Root","Ruin","Sanctuary","Sanctuary","Sector","Settlement","Shaft","Shield","Shoal","Shrine","Source","Spire","Springs","Stage","Stand","Station","Strand","Stronghold","Summit","Sword","Terminal","Tower","Township","Valley","Wall","Water","Well"],wD=["[Quality]","[Quality]","[Quality]","[Quality]","[Quality]","[Quality]","[Quality]","[Quality]","[Quality]","[Quality]","[Quality]","[Quality]","[Quality]","[Quality]","[Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Adjective] [Quality]","[Quality]'s [Form]","[Quality]'s [Form]","[Quality]'s [Form]","[Quality]'s [Form]","[Quality]'s [Form]","[Quality]'s [Form]","[Quality]'s [Form]","[Quality]'s [Form]","[Quality]'s [Form]","[Quality]'s [Form]","[Quality]'s [Form]","[Quality]'s [Form]","[Quality]'s [Form]","[Quality]'s [Form]","[Quality]'s [Form]","[Form] [Number]","[Form] [Number]","[Form] [Number]","[Form] [Number]","[Form] [Number]","[Form] [Number]","[Form] [Number]","[Form] [Number]","[Form] [Number]","[Form] [Number]","[Form] [Number]","[Form] [Number]","[Form] [Number]","[Form] [Number]","[Form] [Number]","The [Adjective] [Form]","The [Adjective] [Form]","The [Adjective] [Form]","The [Adjective] [Form]","The [Adjective] [Form]","The [Adjective] [Form]","The [Adjective] [Form]","The [Adjective] [Form]","The [Adjective] [Form]","The [Adjective] [Form]","The [Adjective] [Form]","The [Adjective] [Form]","The [Adjective] [Form]","The [Adjective] [Form]","The [Adjective] [Form]","[Form] of the [Adjective]","[Form] of the [Adjective]","[Form] of the [Adjective]","[Form] of the [Adjective]","[Form] of the [Adjective]","[Form] of the [Adjective]","[Form] of the [Adjective]","[Form] of the [Adjective]","[Form] of the [Adjective]","[Form] of the [Adjective]","[Form] of the [Adjective]","[Form] of the [Adjective]","[Form] of the [Adjective]","[Form] of the [Adjective]","[Form] of the [Adjective]","The [Form] of [Quality]","The [Form] of [Quality]","The [Form] of [Quality]","The [Form] of [Quality]","The [Form] of [Quality]","[Structure] of the [Adjective] [Noun]","[Structure] of the [Adjective] [Noun]","[Structure] of the [Adjective] [Noun]","[Structure] of the [Adjective] [Noun]","[Structure] of the [Adjective] [Noun]"],qN=["Agency","Alliance","Alliance","Assembly","Axis","Band","Barony","Battalion","Bloc","Brotherhood","Cartel","Cartel","Cartel","Cartel","Cell","Circle","Citadel","Clan","Clan","Coalition","Coalition","Collective","Company","Confederation","Conglomerate","Consortium","Cooperative","Council","Council","Council","Council","Corporation","Corporation","Coven","Covenant","Crew","Directorate","Division","Domain","Domain","Enterprise","Federation","Federation","Fellowship","Following","Force","Foundation","Front","Gang","Gang","Gang","Gang","Group","Guild","Guild","Guild","Guild","Hive","Industries","Insurgency","Initiative","League","League","Legion","Legion","Marauders","Mercenaries","Movement","Network","Network","Nexus","Order","Order","Order","Order","Party","Pod","Pyramid","Rebellion","Resistance","Revolution","Sect","Section","Sisterhood","Society","Society","Squad","Syndicate","Syndicate","Syndicate","Syndicate","Systems","Tree","Tribe","Union","Union","Unity","Uprising","Vanguard","Web"],SD=["Ascendant","Arisen","Ashen","Avenging","Awakened","Black","Blessed","Blood","Blue","Bright","Broken","Celestial","Cloud","Code","Cold","Crimson","Crystal","Cursed","Dark","Data","Death","Dream","Eternal","Ethereal","Fallen","False","Far","Fire","Five","Forgotten","Free","Frozen","Golden","Great","Glorious","Green","Hidden","High","Holy","Invisible","Joined","Light","Liquid","Living","Lore","Lost","Low","Lunar","New","Night","Old","Orbital","Phantom","Quantum","Radiant","Reborn","Red","Righteous","Rogue","Scarlet","Secret","Seven","Shadow","Silent","Silver","Sky","Sleeping","Solar","Sovereign","Space","Stellar","Terminal","Three","True","Unbroken","Undying","United","Vigilant","Violet","Void","War","White","Yellow","[NPC Surname]","[NPC Surname]","[NPC Surname]","[NPC Surname]","[NPC Surname]","[NPC Surname]","[NPC Surname]","[NPC Surname]","[Place Name]","[Place Name]","[Place Name]","[Place Name]","[Place Name]","[Place Name]","[Place Name]","[Place Name]","[Place Name]"],WN=["Apex","Arc","Assassin(s)","Avenger(s)","Beacon(s)","Believer(s)","Blade(s)","Branch(es)","Brother(s)","Cascade","Claw(s)","Cloak(s)","Dawn","Death","Defender(s)","Disciple(s)","Devil(s)","Echo(es)","Edge","Exile(s)","Eye(s)","Father(s)","Fist(s)","Flame(s)","Force","Forge","Garden","Ghost(s)","Glitch","God(s)","Guard(s)","Guardian(s)","Guide(s)","Halo(s)","Hammer(s)","Hand(s)","Heart(s)","Horizon","Hunter(s)","Life","Lord(s)","Mark(s)","Mask(s)","Monolith","Mother(s)","Omen(s)","Oracle(s)","Orb(s)","Outlaw(s)","Paragon","Path","Pirate(s)","Power","Priest(s)","Prism","Raider(s)","Ray(s)","Rebel(s)","Reach","Reaver(s)","Renegade(s)","Rider(s)","Root(s)","Runner(s)","Saint(s)","Sanctuary","Savior(s)","Scar(s)","Scepter(s)","Scum","Sector(s)","Seed(s)","Seeker(s)","Sentinel(s)","Serpent(s)","Shadow(s)","Shard(s)","Shield(s)","Sight","Sister(s)","Skull(s)","Source","Specter(s)","Spire","Star(s)","Steward(s)","Sun(s)","System(s)","Thief/Thieves","Truth","Vanguard","Vector(s)","Vessel(s)","Vision","Voice","Walker(s)","Warrior(s)","Way","Wing(s)","Wolf/Wolves"],ND=["The [Structure]","The [Structure]","The [Structure]","The [Structure]","The [Structure]","The [Structure]","The [Structure]","The [Structure]","The [Structure]","The [Structure]","The [Structure]","The [Structure]","The [Structure]","The [Structure]","The [Structure]","The [Adjective]","The [Adjective]","The [Adjective]","The [Adjective]","The [Adjective]","The [Adjective]","The [Adjective]","The [Adjective]","The [Adjective]","The [Adjective]","The [Adjective]","The [Adjective]","The [Adjective]","The [Adjective]","The [Adjective]","The [Noun]","The [Noun]","The [Noun]","The [Noun]","The [Noun]","The [Noun]","The [Noun]","The [Noun]","The [Noun]","The [Noun]","The [Noun]","The [Noun]","The [Noun]","The [Noun]","The [Noun]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Structure]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Adjective] [Noun]","The [Noun] [Structure]","The [Noun] [Structure]","The [Noun] [Structure]","The [Noun] [Structure]","The [Noun] [Structure]","The [Noun] [Structure]","The [Noun] [Structure]","The [Noun] [Structure]","The [Noun] [Structure]","The [Noun] [Structure]","The [Noun] [Structure]","The [Noun] [Structure]","The [Noun] [Structure]","The [Noun] [Structure]","The [Noun] [Structure]","The [Structure] of [Noun]","The [Structure] of [Noun]","The [Structure] of [Noun]","The [Structure] of [Noun]","The [Structure] of [Noun]","[Structure] of the [Adjective] [Noun]","[Structure] of the [Adjective] [Noun]","[Structure] of the [Adjective] [Noun]","[Structure] of the [Adjective] [Noun]","[Structure] of the [Adjective] [Noun]"],kD=[{incident:"Aid a starship caught in a spacetime fracture."},{incident:"Broker peace between two feuding settlements."},{incident:"Chart a new passage between isolated settlements."},{incident:"Defend the people of a beleaguered settlement against raiders."},{incident:"Discover who sabotaged a settlement's air processors."},{incident:"Escort a tradeship carrying prized cargo."},{incident:"Ferry a rescue team to a perilous disaster site."},{incident:"Infiltrate a fortified base to steal crucial data."},{incident:"Investigate terrifying manifestations at a remote settlement."},{incident:"Locate a downed spacer on an uninhabited planet."},{incident:"Protect a fugitive from a relentless bounty hunter."},{incident:"Recover a cherished pre-exodus artifact from an enemy."},{incident:"Rescue a starship crew held captive by mutineers."},{incident:"Retrieve a cache of stolen weapons from a pirate ship."},{incident:"Sabotage an enemy installation."},{incident:"Search for a missing expedition in the depths of a precursor vault."},{incident:"Shield a wondrous lifeform from those who seek to destroy it."},{incident:"Track and slay a marauding beast."},{incident:"Transport a displaced people to their new home."}],dt={affirmation:{1:{result:"Extreme No",detail:"As bad as it can be",size:"Miniscule / One",weather:"Electric Storm",npcReaction:"Immediately Attack"},"2-3":{result:"No",detail:"It's Gnarly",size:"Small / Pair",weather:"Ice Storm",npcReaction:"Hostile"},"4-5":{result:"No",detail:"Oof, What Now",size:"Handful (d4+1)",weather:"Blowing Dust",npcReaction:"Threatening"},"6-7":{result:"No",detail:"Could Use a Hand",size:"Several (d6+1)",weather:"Heavy Rain",npcReaction:"Wary"},"8-9":{result:"No, but",detail:"Average",size:"Several (d6+1)",weather:"Drizzling",npcReaction:"Curious"},"10-11":{result:"Random Event",detail:"Average",size:"Several (d6+2)",weather:"Foggy",npcReaction:"Indifferent"},"12-13":{result:"Yes, but",detail:"Average",size:"Several (d6+2)",weather:"Overcast",npcReaction:"Indifferent"},"14-15":{result:"Yes",detail:"I've Seen Better",size:"Several (d6+3)",weather:"A Bit Warm",npcReaction:"Helpful"},"16-17":{result:"Yes",detail:"I've Got This",size:"Patrol (d10+5)",weather:"Sunny",npcReaction:"Helpful"},"18-19":{result:"Yes",detail:"The Good Stuff",size:"Unit (d20+10)",weather:"Comfortable",npcReaction:"Generous"},20:{result:"Extreme Yes",detail:"Top Shelf",size:"Gigantic / Too Many",weather:"Chilly",npcReaction:"Willing to Betray"}},openingScene:["You've been poisoned with a timer-release toxin (d6 days).","A new character pleads for help hiding from a Bounty Hunter.","An important piece of your tech was just broken.","You are in a scrape at a cantina.","You are being chased by a Bounty Hunter.","An electrical storm has knocked out communications.","A bomb has gone off in the nearby spaceport.","Rebels have assaulted an official and are cornered in a plaza.","You've been stopped at a Galactic Legion checkpoint.","A scrap trader offers to sell you a rusty old bot and box of parts.","A patrol is knocking on doors demanding information on rebels.","A ship was just shot down nearby.","Word that a connection to the PC has been captured.","Word that the Galactic Legion has destroyed PC's homeworld.","A major storm has halted all travel.","An NPC has betrayed you, the Galactic Legion is on the way.","A festival and hov-zoom racing event.","Broke down vehicle hails you for an emergency lift.","Galactic Legion forces have just arrived in the area.","You're being held by a group of gangsters."],sceneShakeup:["Rival appears.","Ambush.","Something in the environment changes.","Someone gets hurt.","You discover a beneficial opportunity.","New NPC appears.","Resource you had is lost.","You discover a beneficial object.","New Event takes place.","All Danger Clocks advance."],critBlunder:{crit:["You gain useful information.","You gain a minor item or resource.","You gain a tactical advantage.","You double the intended effect."],blunder:["Something thought true now appears false.","You break or lose gear or a resource.","More enemies or obstacles appear.","The intended effect harms you or an ally."]},eventOracle:[{roll:1,verb:"Abandon",subject:"Battle",description:"Foul",activity:"Fighting",omen:"Shadow"},{roll:2,verb:"Acquire",subject:"Enemy",description:"Dark",activity:"Seeking",omen:"Sound"},{roll:3,verb:"Seek",subject:"Path",description:"Modified",activity:"Hunting",omen:"Odor"},{roll:4,verb:"Betray",subject:"Balance",description:"Corrupt",activity:"Learning",omen:"Tracks"},{roll:5,verb:"Return",subject:"Peace",description:"Blocked",activity:"Stealing",omen:"Blood"},{roll:6,verb:"Destroy",subject:"Law",description:"Hidden",activity:"Repairing",omen:"Scorching"},{roll:7,verb:"Plot",subject:"Leader",description:"Refined",activity:"Dying",omen:"Debris"},{roll:8,verb:"Move",subject:"Device",description:"Mystical",activity:"Killing",omen:"Wreckage"},{roll:9,verb:"Begin",subject:"Secret",description:"Strange",activity:"Negotiating",omen:"Disconnected"},{roll:10,verb:"Pursue",subject:"Knowledge",description:"Protected",activity:"Planning",omen:"Voices"},{roll:11,verb:"Control",subject:"Fellowship",description:"Feeble",activity:"Lying",omen:"Message"},{roll:12,verb:"Breach",subject:"Structure",description:"Harsh",activity:"Guiding",omen:"Sparks"},{roll:13,verb:"Guard",subject:"Corruption",description:"Worn",activity:"Demanding",omen:"Footsteps"},{roll:14,verb:"Deliver",subject:"Faction",description:"New",activity:"Examining",omen:"Scratches"},{roll:15,verb:"Oppress",subject:"Weapon",description:"Complex",activity:"Gambling",omen:"Body"},{roll:16,verb:"Hunt",subject:"Ally",description:"Rare",activity:"Hiding",omen:"Damage"},{roll:17,verb:"Secure",subject:"Debt",description:"Broken",activity:"Performing",omen:"Slime"},{roll:18,verb:"Inspect",subject:"Community",description:"Ancient",activity:"Conspiring",omen:"Temperature"},{roll:19,verb:"Protect",subject:"Supply",description:"Grimy",activity:"Escorting",omen:"Blocked"},{roll:20,verb:"Explore",subject:"Vow",description:"Graceful",activity:"Disabling",omen:"Illness"}],eventSpecific:["PC Positive","PC Negative","Far Away Event","Relating to current Mission","NPC Positive","NPC Negative"]},wt={villain:["Crime Lord","Space Monstrosity","Galactic Legion","Legionary Grand Admiral","Dragoon","Lord Commander Vortex"],villainGoal:["Destroy","Enrich","Control","Chaos","Justice","Return"],villainPlan:["Recruit","Poison","Overrun","Silence","Subterfuge","Catastrophe"],villainMeans:["Mercenaries","Beasts","Troops","Technology","Super Weapon","Ancient Magi Arts"],missionType:["Deliver","Rescue","Steal","Destroy","Locate","Negotiate"],missionGoods:["Weapons","Leader","Plans","Base","Magi","Bits"],missionSpot:["Crime Lord","Space Ship","Space Pirates","Remote Planet","Bounty Hunter","Base"],missionReward:["Ally","Bits","Key","Weapon","Item","Tactical Advantage"],quickMission:["Locate","Steal","Rescue","Protect","Sabotage","Destroy"],quickTarget:["Valuable contraband / Bounty Hunter target","Prototype Tech / Captured prince","Blackmail / Small but formidable creature","Powerful relic / Crime Lord confidant","Forbidden knowledge / Legionary high-up","Legionary Super Weapon / Bot with secret plans"],scenarios:[{title:"The Planet Gun",desc:"Legion using super hyperdrive to smash planets together. Drop antiparticle bomb in core to destroy."},{title:"Bot-Mind Overlord",desc:"Colossal bot mind reprogramming billions. Install data tape countermind to wipe memory banks."},{title:"The Antispace Circuit",desc:"Pirate warstation disabling hyperdrives. Activate thrusters to misalign circuit and destroy field."},{title:"The Doomsday Engine",desc:"Floating mega-factory disassembling planets. Kill Lord Commander Vortex on throne to tear machine apart."},{title:"The Magi Harvester",desc:"Extracting Magi powers for Immortals. Demolish ancient necropolis foundation to collapse facility."},{title:"The Pangalactic Teleporter",desc:"Instant troop travel via pulsar station. Sabotage super-solar collectors to malfunction permanently."}]},Le={sceneLocation:["Wilderness","Wilderness","Settlement","Settlement","Space Ship","Base"],sceneTone:["Too quiet","Lively","On alert","Secretive","Dangerous","Cryptic"],sceneObstacle:["Wildlife / Alien Beast","Guards / Security","Terrain / Weather","Lock / Barrier / Trap","NPC","Villain"],urgentObstacles:["Fire spreading towards fuel/people (D2+1 rounds).","Tremors/Unstable footing, chasm opening (D2+1 rounds).","Flooding with toxic gas/insects/sewage (D2+1 rounds).","Turret calibrating / Monster waking / Machine approaching (D2+1 rounds).","Evidence of battle discovered soon, area on high alert in 20 mins.","Public execution / Prison barge departing / Weapon firing (4 rounds)."],generalMishaps:[{roll:1,title:"LURKING MONSTER",desc:"The trash chute leads to a swampy dump with an enormous alien beast that eats trash AND people."},{roll:2,title:"AMBUSH",desc:"There's a Bounty Hunter with a Net Launcher waiting by the back exit."},{roll:3,title:"INCLEMENT WEATHER",desc:"Escaping outside leads into dangerous lightning storms (landslides, low atmosphere, acid floods). Maybe it was better to stay inside?"},{roll:4,title:"STINK BOMB",desc:"The explosion used for a distraction erupts in a cloud of choking poison. It spreads quickly, leaving anyone who breathes it in agonising pain (sick, paralyzed, hypnotic visions)."},{roll:5,title:"TRACKING DEVICE",desc:"When the Rebels finally get to rest, they realize they've been tagged with a tracking beacon. A deadly Murder Bot is on its way."},{roll:6,title:"A MYSTERY UNFOLDS",desc:"Rumors have led the Rebels this far, but the only way to discover the truth is to go deeper inside, where even greater dangers lurk."}],spaceObstacles:["Debris field of destroyed ships/warheads.","Asteroid field infested with Space Worms.","Stellar nursery with explosive gas.","Comet Tail with freezing fog.","Space Lane Traffic Jam.","Freak Ion Pulse disabled ships."],hyperspaceMishaps:["Timespace Rift (Your future ship needs help).","Uncharted Hypermagnetic Storm.","Magi Temple Ship (Near black hole).","Hyperspace Femtosharks.","Protocol Bot Corsairs (Polite robbery).","Rebel Distress Signal (Trap)."],planetTerrain:["Mountainous/Wasteland","Swampy/Canyonlands","Fungal/Desert","Forested/Oceanic","Barren/Hilly","Volcanic/Crystalline"],planetWeather:["Frozen","Rain","Arid","Windy","Static Storms","Pleasant"],planetColor:["Blue","Green","Yellow","Brown","Red","White"],planetPopulation:["Hundreds","Hundreds","Thousands","Thousands","Millions","Outpost/Abandoned"],planetControl:["Local Gov","Rebels","Pirates","Crime Lord","Galactic Legion","Galactic Legion"],settlementAppearance:["Colorful tents","Mobile huts","Circular buildings on stilts","Container towers","Underground bunkers","Dusty low buildings","Floating villas","Stone ziggurat","Stacked modular highrises","Legion-constructed prefabs"],settlementKnownFor:["Rebels","Trade","Information","Carousing","Transports","Mining","Prison","Trade","Racing","Legion"],settlementCurrentState:["Noisy / Chaotic","Dangerous / Curfew","Quiet / Industrious","Political Upheaval","Preparing for threat","Suspicious locals","Fertile / Productive","Wild / Overgrown","Sleepy / Docile","Seized by Legion"],settlementComplication:["Electrical storms","Flood / Quake","Creatures","Crime","Science","Illness","Dark omen","Raiders","Factional warfare","Revolt"],settlementLeader:["Crime Lord","Galactic Legion","Elected Leader","Two separate Gangsters","Exiled Smuggler","Space Pirates"],settlementLandmark:["Neon obelisk","Crashed ship","Dark grey prison building","Large fountain plaza","Tall communications tower","Hill with glass roof"],settlementRumors:["Map","Gear","Secret information","Combat","Hacking","Uprising"],settlementHookups:["Transfer of Bits","Stolen information","Disguised Magi","Weapons cache","Transport","Huge refining factory"],planetFeatures:["Desert of dead sea salt, bleached coral, boneyards.","Pits of gurgling mud and geysers.","Bottomless misty canyons with petrified trees.","Lakes of bioluminescent scum beneath sunless sky.","Choking black dust storms, electro lanterns needed.","Industrial sludge waves, red lightning clouds.","Creeping vines/tropical trees reclaiming megacity.","Craters of scorched glass, fulgurite pillars.","Partially constructed ring station on asteroids.","Revelers lounging in hallucinogenic fungal colonies."],backwaters:["High atmosphere gas mining operations.","Spice-dust farmstead with malfunctioning bots.","Space ice quarry carving comet blocks.","Pre-terraforming fertilizer crew.","Bot graveyard (Grand Galactic Backup).","Slime rigs on moon-sized protoplasm."],backalleys:["Flickering hologram signs in factory smog.","Snow/sleet from refrigeration unit.","Iridescent oil pools under solar dome.","Scaly hides drying in sweltering air.","Tethered dynamo towers sapping aurora energy.","Razorleaf vines taking over hovels."],hiddenFeatures:["Downtrodden locals ready to rise up!","Secret network of local Rebels.","Old friend working on the inside.","Vault full of bits.","Concealed weak point.","Secret back entrance.","Readily available stimpacks.","The Rebels' map doesn't match location.","Rigged to explode.","IT'S A TRAP!"],locationDangers:["Swarming with Legionary Foot Soldiers.","Team of Bounty Hunters.","Security cameras everywhere.","Space Pirates using Rebels as distraction.","Hungry wildlife.","Impenetrable force fields.","Guarded by laser turrets.","Patrolling security bots.","Caged Space Monstrosity.","Bottomless pit."]},Xd={features:[{roll:1,ship:"Plain",base:"Dormitory",obstacle:"Bot",search:"Junk"},{roll:2,ship:"Barracks",base:"Holding",obstacle:"Alarm",search:"Scrap (Tradeable to right client)"},{roll:3,ship:"Pod Bay",base:"Storage",obstacle:"Enemy",search:"Bot Parts"},{roll:4,ship:"Workshop",base:"Fighting Pit",obstacle:"Enemy",search:"Goods (Worth Bits on Black Market)"},{roll:5,ship:"Comms",base:"Parts",obstacle:"Enemy",search:"Eye / Headwear"},{roll:6,ship:"Medical",base:"Trash",obstacle:"Missile",search:"Clothing"},{roll:7,ship:"Hangar",base:"Mess",obstacle:"Debris",search:"Datapad"},{roll:8,ship:"Trash",base:"Torture",obstacle:"Trap",search:"Stimpack"},{roll:9,ship:"Scrap",base:"Cage",obstacle:"Lost",search:"Repair Toolkit"},{roll:10,ship:"Mess",base:"Armory",obstacle:"Monster",search:"Bits"},{roll:11,ship:"Life Support",base:"Laboratory",obstacle:"Barrier",search:"Power Pack / Battery"},{roll:12,ship:"Interrogation",base:"Cantina",obstacle:"Shaft",search:"Melee Weapon"},{roll:13,ship:"Prison Cells",base:"Lounge",obstacle:"Environment",search:"Ranged Weapon"},{roll:14,ship:"Mission Deck",base:"Gambling",obstacle:"Device",search:"Thrown Weapon"},{roll:15,ship:"Officer Quarters",base:"Storage",obstacle:"Ambush",search:"Random Gear"},{roll:16,ship:"Armory",base:"Vault",obstacle:"Crushing",search:"Armor"},{roll:17,ship:"Science",base:"Quarters",obstacle:"Distraction",search:"Legionary Equipment"},{roll:18,ship:"Cargo",base:"Hover-Port",obstacle:"Surveillance",search:"Special Item"},{roll:19,ship:"Bridge",base:"Generator",obstacle:"Resources",search:"Keycard"},{roll:20,ship:"Power",base:"Comms",obstacle:"Gas",search:"Ally"}]},It={travelTheme:["Hostility","Trade","Tracking","Smuggling","Battle","Assistance","Wreck","Science","Religion","Weather"],travelActor:["Legionary Troopers","Caravan","Bounty Hunter","Gangsters","Crime Lord","Survivors","Space Pirates","Refugees","Alien Beast","Monstrosity"],npcRoles:["Soldier","Bounty Hunter","Smuggler","Commoner","Youth","Magi","Guard","Criminal","Pilot","Bot","Gangster","Mercenary","Clone","Trader","Mechanic","Politician","Hacker","Gambler","Leader","Healer"],npcSpecies:["Baseline Human","Woolly Anthrosquatch","Fish-eyed Ichthyoid","Scaley Lacertian","Flatheaded Tricladid","Runtish Zinto","Sucker-lipped Anuran","Flightless Macrobat","Lithe Pseudopoid","Little Ursanid","Ocular Picaroo","Flammari Siren","Ratling Ambau","Avian Caldecta","Horned Thernee","Cerebral Roothan","Bantam Clookoo","Waifish Nilata","Green Mardonalians","Pale Vril-ya"],npcMotivations:["Revenge","Truth","Belonging","Adventure","Favor","Mentor","Discipline","Chaos","Reputation","Connection","Wealth","Rebellion","Power","Discovery","Redemption","Peace","War","Death","Love","Justice"],npcSecrets:["Killed someone powerful","Owns valuable data pad","Noble birth","Wealthy","Has mystical pull","Desires power","Will betray","Has bunker of stolen goods","Never been in battle","Holding valuable info","Wants to be someone else","Wanted fugitive","Stolen identity","Lost family in conflict","Deserter","Wants war","Collects scandalous info","Massive debt","Is a Clone","More powerful than lets on"],npcTraits:["Tattoo on face","Ragged clothes","Visible scar","Drunkard","Well-dressed","Missing eye","Tall","Missing hand","Big hair","Charming voice","Bristly beard","Gaunt","Covered hand","Rotten teeth","Mechanical leg","Facial birthmark","Pierced chin","Sideburns","Glasses","Beaded beard"],npcDemeanor:["Stoic","Harsh","Jovial","Menacing","Thoughtful","Warm","Hostile","Chatty","Greedy","Humorous","Merciful","Terse","Needy","Mopey","Ambitious","Aggressive","Polite","Lazy","Anxious","Kind"],rebelContacts:["Gwarark (Grumpy Anthrosquatch)","TN-60 (Talkative Bot)","Boomer (Sly Roothan)","Selene (Guilty Avian)","Tuz Rix (Experienced Ichthyoid)","Bamro (Radical Ursanid)"],weirdoAliens:["Ylat Dara (Conniving Anuran)","Erden Rainsinger (Enthusiastic Mardonalian)","Kodo Shif (Suave Thernee)","Corde Nenu (Bored Flammari)","Tillie Winai (Curious Pseudopoid)","Gorts (Grunting Lacertian)","Shoom (Aloof Macrobat)","Cataru (Keen Zinto)","HD-3N (Dull Bot)","Valin Pax (Reclusive Magi)"],reactions:["Hostile","Betray","Angered","Cautious","Indifferent","Curious","Friendly","Helpful"]},ut={baselineFirst:["Mason","Wren","Alex","Luca","Harper","Teagan","Ellis","Vick","Dylan","Jace"],botNamePrefixes:["XT","RY","KT","Q","VV","ZZT","L5R","NTH","ALT","TM"],botNameSuffixes:["64","90","37","88","42","5E","02","16","F4","006"],familyNames:["Parsec","Lighthour","Cotorn","Bastion","Outlander","Quasar","Voyager","Hadron","Fraction","Lysander"],shipNames:["Z / Wing","Midnight / Bolt","Crimson / Ray","Violet / Baroness","Boreal / Storm","Nova / Dragon","Shadow / Huntress","Light / Banshee","Fallen / Chimera","Centurion / Hawk"],shipNameFirstParts:["Androm","Anth","Aph","Aqu","Ar","Arc","Ast","Astr","Ath","Aur","Bell","Cael","Cap","Cass","Cast","Ch","Chron","Cr","Crys","Cyg","D","Dr","Drac","El","Elys","Erid","Eryth","G","Gal","Galax","Geos","H","Heli","Hesp","Hul","Hulv","Hydr","Hyp","Icar","Ir","Jup","L","Lar","Lum","Lumi","Lun","Lyr","M","Mar","Min","Mon","N","Neb","Nep","Nept","Nim","Nom","Nov","Nyx","Or","Os","P","Peg","Per","Pers","Ph","Phaet","Pis","Plut","Pol","Prox","Pyr","Pyth","R","Rhex","Rhiz","S","Sel","Selen","Sol","Solar","Solv","Stas","Stel","Styg","T","Tar","Taur","Th","Thalas","Tir","Titan","Ur","Urb","Urs","V","Vir","Virg","Z","Zeph"],shipNameSecondParts:["a","adan","aelios","aidon","alis","an","anithos","anthys","antia","aphos","ar","ara","aras","arax","archos","arex","aria","arion","aros","arpos","arubra","aryx","as","aster","astra","astria","astrias","astro","ate","athos","axis","edon","elios","ella","emoros","eneon","eneus","entus","eon","eonia","eonis","ephyra","erato","eratus","ere","erium","eron","erra","ex","exus","ia","iarex","ichthon","idon","ilia","ilion","ima","imatra","ina","ion","ios","ipolis","irra","is","isaurum","isilva","ithos","ius","oclia","ocris","odon","olis","olith","on","onexus","onis","onox","onyx","or","ora","oria","oros","os","oterra","otos","ox","ubra","ulon","ulos","urox","us","usis","usmaris","ux","ygia","ympus","ys","ythos","ythron","yx"],planetNames:["Corinath","Mardestine","Poxor","Faergonh","Bal'poex","Hurs-V","Laerdwu","Muwh_13","Cirgo","Cordinnia","Gornath","Jagost","Xirnoth","Qul","Otr System","Rusgith Major","Sartun","Dornsu","Vilnix","Lormae 6"],settlementNamePrefixes:["Ger","Nabeck","Dablar","Grim","Saar","Hyro","Popwa","Urvok","Vandirg","Tar"],settlementNameSuffixes:["-atoom","-rikaant","-ordest","-cite","-tex","-avor","-dorp","Outpost","City","Station"],legionaryNames:["Aelia / Albus","Caelia / Calvus","Decima / Domitius","Fabricia / Faustus","Galla / Gaius","Juliana / Jovian","Marcella / Maximus","Sabina / Scorpio","Tatiana / Tiberius","Vita / Virgil"],bountyHunterNames:["Harkin 'The Red'","Graven","Boris Deadlock","Ragna Nebula","Cassandra Syko","Sskob","Scotch Torga","H3-0"],crimeLordNames:["Andras 'the Duke'","Witch of Baa","Blood Prince Odaros","'Crusher' Vuul","Shax 'Kingpin of Krysar'","Dr. Raum","Brainy Zelez","Voynix 'the Bookie'","'Numbers'","Yurdra 'the Jeweler'"],pirateCrewNames:["Bloody Bots","Gnar Dogs","Rogue Gang","Lost Squad","Shiver Hellions","Dread Posse","Wicked Raiders","Skull Scoundrels","Deep Legends","Wild Pirates"]},Us={bobsWeapons:["Utility Knife (D4 damage)","Upcycled Staff (D4 damage)","Modified Shock Baton (D6, shoddy)","Pocket Blaster (D6, reload)","Old Service Blaster (D6 damage)","Busted Blaster Rifle (D8, bulky, shoddy)"],bobsGear:["Deck of Hologram Playing Cards","Binocular with Laser Microphone","Legionary Bot Head (answers one question, then explodes D8)","Space Helmet with 5 minutes of air","Counterfeit Bits","Collapsible Gravbike (shoddy)"],bobsArmor:["Tattered Robes over a Tunic","Scuffed Boots and Smudged Goggles","Patched-up Flight Suit","Bandoleer and Vest","Scarf and Leather Jacket (tier 1, -D2)","Scavenged Bot Plate Armor (tier 2, -D4)"],galacticSpecies:["Baseline Human","Woolly Anthrosquatch","Fish-eyed Ichthyoid","Scaley Lacertian","Flatheaded Tricladid","Runtish Zinto","Sucker-lipped Anuran","Flightless Macrobat","Lithe Pseudopoid","Little Ursanid"],rebelMotivations:["Destroy criminal record database.","Free long lost twin from prison.","Find cure for pet space lizard.","Solve cold case of what happened years ago.","Convince childhood friend to defect.","Revenge on elusive adversary.","Repay favor to Rebel General.","Prove you aren't a low-life.","Protect best pal on the mission.","Atonement: You caused this crisis."],broken:[{roll:1,result:"Unconscious D4 rounds, awaken with D4 HP."},{roll:2,result:"Roll D6: 13 Broken Limb, 45 Severed Limb, 6 Lost Eye. Unconscious D4 rounds."},{roll:3,result:"Severe Injury! Death in 1 hour unless treated. All tests DR16/DR18."},{roll:4,result:"Dead! Roll a new Rebel."}]},jD={spaceJunk:["Scrapped Bot parts","Dim Fusion Lantern","Glitched Data Pad","Discarded Key Card","Flimsy Trip Mine","Shoddy Blaster D6","Broken Blazer Sword","Bits"]},Ca={beastAdaptations:["Stalker: Always attacks first.","Ferocious: Attacks twice per round (DR10 to hit).","Stinger: D6 damage + D2 next round.","Carapace: Armor tier 3 -D6.","Bile: Regurgitates acid puddles (D10).","Wings: DR14 to hit with melee attacks."],monstrosityAdaptations:["Calcified Shell: Can only target Weak Spot with Melee.","Gigantic: Double damage attacks, Rebels defend with Advantage.","Horrid: Rebels test PRS DR12 or skip first turn.","Bioelectric: Melee attackers take D6 damage.","Venomous: Target suffers D2 damage every turn until treated.","Jaws: Bite holds target (D6/turn), STR DR14 to escape."],weakSpots:["Glowing Eye","Pulsating Core","Soft Underbelly","Old Wound","Open Mouth","Missing Exoskeleton Plate"],monsterNames:{prefix:["Rukkadon","Wroat","Irragorr","Phyto","Vorpal","Xith","Kanth","Jadoon","Balo","Zodan"],suffix:["Beast","Kraken","Raptor","Worm","Dragon","Hound","Brute","Beak","Hog","Crawler"]}},bm={meleeWeapons:["Knife (D4)","Chain Whip (D4)","Slash Staff (D4)","Quakehammer (D6)","Taser Baton (D6)","Rivet Gun (D8, bulky)","Sonic Mining Drill (D8, bulky)","Battle Axe (D8, bulky)","Blazer Sword (2D6)"],rangedWeapons:["Hold-Out Blaster (D4)","Blaster Pistol (D6)","Blaster Rifle (D8, bulky)","Scatter Blaster (2D4, blast)","Bolt Caster (D10, bulky)","Rocket Launcher (D12, blast)"],gear:["Magnetic Boots","Grapple Hook","Repair Toolkit","Battery Lamp","Lockpicking Kit","Grav-Lock Manacles","Stimpack","Shortwave Communicator"]},Fw={personnel:[{name:"Minion",hp:"6-12",morale:"7",armor:"None",weapon:"Blaster D6",notes:"Rebels roll DR12 AGI to dodge."},{name:"Leader",hp:"12-24",morale:"10",armor:"Tier 2 (-D4)",weapon:"D8 or D10",notes:"Rebels roll DR14 AGI to dodge."},{name:"Legionary Foot Soldier",hp:"6 (Fodder)",morale:"6 (Squad 8)",armor:"Tier 1 (-D2)",weapon:"Blaster D6",notes:"Dies in 1 hit."},{name:"Legionary Officer",hp:"6",morale:"9",armor:"None",weapon:"Sidearm D6",notes:"Calls D4 backup."},{name:"War Bot",hp:"12",morale:"-",armor:"Tier 2 (-D4)",weapon:"Blaster D6",notes:"Ceaseless."},{name:"Dragoon (Elite)",hp:"40",morale:"10",armor:"Tier 2 (-D4)",weapon:"Blazer Sword 2D6",notes:"Magi Arts. DR14 to defend."},{name:"Space Pirate",hp:"8",morale:"7",armor:"None",weapon:"Blaster D6",notes:"Slippery."},{name:"Bounty Hunter (Elite)",hp:"14",morale:"10",armor:"Tier 2 (-D4)",weapon:"Pulse Rifle D6+1",notes:"Greedy."}],monsters:[{name:"Alien Beast",hp:"12",morale:"9",armor:"Tier 1 (-D2)",weapon:"Bite/Claw D8",notes:"Wilds."},{name:"Space Monstrosity",hp:"45",morale:"10",armor:"Carapace -D8",weapon:"Tusk/Talon D10",notes:"Weak Spot DR16."}]},an={theEpic:{col1:["The","The","The","A","A","Attack"],col2:["New","Rise","Fall","Last","Void","Prophecy"],col3:["Hope","Empire","Cosmic","Ascending","Shadow","Sword"],col4:["Prophet","War","Gambit","Star","Gods","Exile"]},theEpisode:{col1:["The","The","The","A","A","NPC Name"],col2:["Cage","Trap","Flight","Final","Doppelganger","Errand"],col3:["Dagger","Plot","Operation","Metamorphosis","Journey","Hidden"],col4:["Doom","Arena","Garden","Separation","Home","Sacrifice"]}},KN={boost:["Star / Compass / Direction","Skull / Death / Danger","Blaster / Attack / Conflict","Droid / Tech / AI","Atom / Science / Energy","Cloak / Hidden / Secret","Monster / Beast / Wild","Arrow / Up / Rise","Remote / Control / Signal","Mask / Deception / Persona","Planet / World / Environment","TIE Fighter / Enemy / Empire","Hand / Stop / Help","Spiral / Confusion / Hypnosis","Card / Chance / Gamble","Boot / Kick / Travel","Mushrooms / Nature / Growth","Trash / Container / Loot","Radar / Search / Scan","Saber / Weapon / Power"]},Wi={dastardlyWeapons:["Homing Missile (D6, DR14 to dodge)","Laser Eye Beams (D6, fire at any time)","Bits Blaster (D8, fires currency)","Repeating Bolt Caster (D10, bulky, no reload)"],lordlyVisages:["Bloated slug with stimulant gas tanks.","Enormous pulsating brain in a jar.","Bickering two-headed bot.","Colossal hologram (real body hidden).","Battle-scarred Legionary dragoon.","Slobbering chitinous queen in royal jelly."],criminalBases:["Souped-up spaceship orbiting a blackhole.","Floating palace in gas giant tempest.","Grand penthouse on throne world.","Decommissioned military fortress.","Submersible arena on swamp world.","Sewage nexus station beneath starport."]};function ie(t){return Math.floor(Math.random()*t)+1}function CD(t,e){const n=[];for(let r=0;r<t;r++)n.push(ie(e));return n}function on(t){return!t||t.length===0?"Table not found or empty":t[Math.floor(Math.random()*t.length)]}function uu(){const t=ie(20);if(t===1)return{roll:t,...dt.affirmation[1]};if(t>=2&&t<=3)return{roll:t,...dt.affirmation["2-3"]};if(t>=4&&t<=5)return{roll:t,...dt.affirmation["4-5"]};if(t>=6&&t<=7)return{roll:t,...dt.affirmation["6-7"]};if(t>=8&&t<=9)return{roll:t,...dt.affirmation["8-9"]};if(t>=10&&t<=11)return{roll:t,...dt.affirmation["10-11"]};if(t>=12&&t<=13)return{roll:t,...dt.affirmation["12-13"]};if(t>=14&&t<=15)return{roll:t,...dt.affirmation["14-15"]};if(t>=16&&t<=17)return{roll:t,...dt.affirmation["16-17"]};if(t>=18&&t<=19)return{roll:t,...dt.affirmation["18-19"]};if(t===20)return{roll:t,...dt.affirmation[20]}}function YN(){const t=ie(20),e=ie(20),n=ie(20),r=ie(20),a=ie(20),i=ie(6);return{roll:t,verbRoll:t,subjectRoll:e,descRoll:n,activityRoll:r,omenRoll:a,specificRoll:i,verb:dt.eventOracle[t-1].verb,subject:dt.eventOracle[e-1].subject,description:dt.eventOracle[n-1].description,activity:dt.eventOracle[r-1].activity,omen:dt.eventOracle[a-1].omen,specific:dt.eventSpecific[i-1]}}function JN(t=1){const e=ie(20),n=e+t,r=n>=15;let a=null;if(r){const i=ie(20),c=i+t,u=Math.min(c-1,dt.sceneShakeup.length-1);a={d20:i,roll:c,result:dt.sceneShakeup[u]}}return{checkRoll:e,threatDie:t,total:n,success:r,shakeup:a}}function QN(){const t=ie(wt.missionType.length),e=ie(wt.missionGoods.length),n=ie(wt.missionSpot.length),r=ie(wt.missionReward.length);return{typeRoll:t,goodsRoll:e,spotRoll:n,rewardRoll:r,type:wt.missionType[t-1],goods:wt.missionGoods[e-1],spot:wt.missionSpot[n-1],reward:wt.missionReward[r-1]}}function TD(){const t=ie(wt.quickMission.length),e=ie(wt.quickTarget.length);return{actionRoll:t,targetRoll:e,action:wt.quickMission[t-1],target:wt.quickTarget[e-1]}}function XN(){const t=ie(wt.villain.length),e=ie(wt.villainGoal.length),n=ie(wt.villainPlan.length),r=ie(wt.villainMeans.length);return{villainRoll:t,goalRoll:e,planRoll:n,meansRoll:r,villain:wt.villain[t-1],goal:wt.villainGoal[e-1],plan:wt.villainPlan[n-1],means:wt.villainMeans[r-1]}}function ZN(t=!1){let e;if(t&&ie(2)===2)e=ak().fullName;else{const h=ut.baselineFirst[ie(10)-1],p=ut.familyNames[ie(10)-1];e=`${h} ${p}`}const n=ie(It.npcRoles.length),r=ie(It.npcSpecies.length),a=ie(It.npcMotivations.length),i=ie(It.npcSecrets.length),c=ie(It.npcTraits.length),u=ie(It.npcDemeanor.length);return{name:e,roleRoll:n,speciesRoll:r,motivationRoll:a,secretRoll:i,traitRoll:c,demeanorRoll:u,role:It.npcRoles[n-1],species:It.npcSpecies[r-1],motivation:It.npcMotivations[a-1],secret:It.npcSecrets[i-1],trait:It.npcTraits[c-1],demeanor:It.npcDemeanor[u-1]}}function ek(){const t=ie(Le.planetTerrain.length),e=ie(Le.planetWeather.length),n=ie(Le.planetColor.length),r=ie(Le.planetPopulation.length),a=ie(Le.planetControl.length),i=ie(ut.planetNames.length);return{terrainRoll:t,weatherRoll:e,colorRoll:n,populationRoll:r,controlRoll:a,nameRoll:i,terrain:Le.planetTerrain[t-1],weather:Le.planetWeather[e-1],color:Le.planetColor[n-1],population:Le.planetPopulation[r-1],control:Le.planetControl[a-1],name:ut.planetNames[i-1]}}function ED(t=!1){const e=ie(Le.settlementAppearance.length),n=ie(Le.settlementKnownFor.length),r=ie(Le.settlementCurrentState.length),a=ie(Le.settlementComplication.length),i=ie(Le.settlementLeader.length),c=ie(Le.settlementLandmark.length),u=ie(Le.settlementRumors.length),h=ie(Le.settlementHookups.length),p=ie(ut.settlementNamePrefixes.length),m=ie(ut.settlementNameSuffixes.length),g=ut.settlementNamePrefixes[p-1],x=ut.settlementNameSuffixes[m-1];let v;return t&&ie(2)===2?v=ik().fullName:v=x.startsWith("-")?`${g}${x}`:`${g} ${x}`,{appearanceRoll:e,knownForRoll:n,currentStateRoll:r,complicationRoll:a,leaderRoll:i,landmarkRoll:c,rumorsRoll:u,hookupsRoll:h,namePrefixRoll:p,nameSuffixRoll:m,appearance:Le.settlementAppearance[e-1],knownFor:Le.settlementKnownFor[n-1],currentState:Le.settlementCurrentState[r-1],complication:Le.settlementComplication[a-1],leader:Le.settlementLeader[i-1],landmark:Le.settlementLandmark[c-1],rumors:Le.settlementRumors[u-1],hookups:Le.settlementHookups[h-1],name:v}}function tk(){const t=ie(Le.sceneLocation.length),e=ie(Le.sceneTone.length),n=ie(Le.sceneObstacle.length);return{locationRoll:t,toneRoll:e,obstacleRoll:n,location:Le.sceneLocation[t-1],tone:Le.sceneTone[e-1],obstacle:Le.sceneObstacle[n-1]}}function RD(t=1){const e=ie(20),n=e+t,r=n>=12;let a=null;if(r){const i=ie(It.travelTheme.length),c=ie(It.travelActor.length);a={themeRoll:i,actorRoll:c,theme:It.travelTheme[i-1],actor:It.travelActor[c-1]}}return{checkRoll:e,threatDie:t,total:n,success:r,encounter:a}}function hu(t=1){const e=ie(20),n=ie(20),r=ie(20),a=ie(20),i=ie(20),c=i+t,u=c>=12;return{shipRoll:e,baseRoll:n,obstacleRoll:r,searchRoll:a,threatRoll:i,threatTotal:c,threatDie:t,obstacleTriggered:u,ship:Xd.features[e-1].ship,base:Xd.features[n-1].base,obstacle:Xd.features[r-1].obstacle,search:Xd.features[a-1].search}}function AD(){const t=ie(6),e=ie(6),n=ie(6),r=ie(Ca.monsterNames.prefix.length),a=ie(Ca.monsterNames.suffix.length);return{beastRoll:t,monstrosityRoll:e,weakSpotRoll:n,namePrefixRoll:r,nameSuffixRoll:a,beast:Ca.beastAdaptations[t-1],monstrosity:Ca.monstrosityAdaptations[e-1],weakSpot:Ca.weakSpots[n-1],name:`${Ca.monsterNames.prefix[r-1]} ${Ca.monsterNames.suffix[a-1]}`}}function nk(){const t=ie(an.theEpic.col1.length),e=ie(an.theEpic.col2.length),n=ie(an.theEpic.col3.length),r=ie(an.theEpic.col4.length);return{col1Roll:t,col2Roll:e,col3Roll:n,col4Roll:r,col1:an.theEpic.col1[t-1],col2:an.theEpic.col2[e-1],col3:an.theEpic.col3[n-1],col4:an.theEpic.col4[r-1]}}function rk(){const t=ie(an.theEpisode.col1.length),e=ie(an.theEpisode.col2.length),n=ie(an.theEpisode.col3.length),r=ie(an.theEpisode.col4.length);return{col1Roll:t,col2Roll:e,col3Roll:n,col4Roll:r,col1:an.theEpisode.col1[t-1],col2:an.theEpisode.col2[e-1],col3:an.theEpisode.col3[n-1],col4:an.theEpisode.col4[r-1]}}function _D(){const t=ie(ut.crimeLordNames.length),e=ie(Wi.lordlyVisages.length),n=ie(Wi.dastardlyWeapons.length),r=ie(Wi.criminalBases.length);return{nameRoll:t,visageRoll:e,weaponRoll:n,baseRoll:r,name:ut.crimeLordNames[t-1],visage:Wi.lordlyVisages[e-1],weapon:Wi.dastardlyWeapons[n-1],base:Wi.criminalBases[r-1]}}function MD(){const t=on(ut.shipNameFirstParts),e=on(ut.shipNameSecondParts);return`The ${t}${e}`}function sk(){const t=ie(100),e=ie(100),n=hD[t-1],r=fD[e-1];return{firstRoll:t,secondRoll:e,firstName:n,secondPart:r,fullName:`${n}${r}`,source:"perilousVoid"}}function xh(){const t=ie(100),e=ie(100),n=pD[t-1],r=mD[e-1];return{firstRoll:t,secondRoll:e,firstPart:n,secondPart:r,fullSurname:`${n}${r}`,source:"perilousVoid"}}function ak(){const t=sk(),e=xh();return{nameFirstRoll:t.firstRoll,nameSecondRoll:t.secondRoll,surnameFirstRoll:e.firstRoll,surnameSecondRoll:e.secondRoll,firstName:t.fullName,surname:e.fullSurname,fullName:`${t.fullName} ${e.fullSurname}`,source:"perilousVoid"}}function OD(){const t=ie(100),e=ie(100),n=gD[t-1],r=yD[e-1];return{firstRoll:t,secondRoll:e,firstPart:n,secondPart:r,fullName:`${n}${r}`,source:"perilousVoid"}}function ik(){const t=ie(100),e=wD[t-1];let n={templateRoll:t,template:e,source:"perilousVoid"},r=e;if(r.includes("[Quality]")){const a=ie(100),i=xD[a-1];n.qualityRoll=a,n.quality=i,r=r.replace("[Quality]",i)}if(r.includes("[Adjective]")){const a=ie(100),i=bD[a-1];if(n.adjectiveRoll=a,i==="[NPC Name]"){const c=sk();n.adjective=c.fullName,n.adjectiveIsNPCName=!0,n.npcNameRolls=[c.firstRoll,c.secondRoll]}else if(i==="[NPC Surname]"){const c=xh();n.adjective=c.fullSurname,n.adjectiveIsNPCSurname=!0,n.npcSurnameRolls=[c.firstRoll,c.secondRoll]}else n.adjective=i;r=r.replace("[Adjective]",n.adjective)}if(r.includes("[Form]")){const a=ie(100),i=vD[a-1];n.formRoll=a,n.form=i,r=r.replace("[Form]",i)}if(r.includes("[Number]")){const a=CD(3,10),i=a.reduce((c,u)=>c+u,0);n.numberRolls=a,n.number=i,r=r.replace("[Number]",i.toString())}if(r.includes("[Structure]")){const a=ie(100),i=qN[a-1];n.structureRoll=a,n.structure=i,r=r.replace("[Structure]",i)}if(r.includes("[Noun]")){const a=ie(100),i=WN[a-1];n.nounRoll=a,n.noun=i,r=r.replace("[Noun]",i)}return r=r.replace(/\s+/g," ").trim(),r=r.replace(/\(\s+/g,"(").replace(/\s+\)/g,")"),n.fullName=r,n}function DD(){const t=ie(100),e=ND[t-1];let n={templateRoll:t,template:e,source:"perilousVoid"},r=e;if(r.includes("[Structure]")){const a=ie(100),i=qN[a-1];n.structureRoll=a,n.structure=i,r=r.replace("[Structure]",i)}if(r.includes("[Adjective]")){const a=ie(100),i=SD[a-1];if(n.adjectiveRoll=a,i==="[NPC Surname]"){const c=xh();n.adjective=c.fullSurname,n.adjectiveIsNPCSurname=!0,n.npcSurnameRolls=[c.firstRoll,c.secondRoll]}else if(i==="[Place Name]"){const c=ik();n.adjective=c.fullName,n.adjectiveIsPlaceName=!0,n.placeNameTemplate=c.template}else n.adjective=i;r=r.replace("[Adjective]",n.adjective)}if(r.includes("[Noun]")){const a=ie(100),i=WN[a-1];n.nounRoll=a,n.noun=i,r=r.replace("[Noun]",i)}return r=r.replace(/\s+/g," ").trim(),n.fullName=r,n}function LD(t=!0){if(t){const e=dt.openingScene.map((a,i)=>({scene:a,originalIndex:i})).filter((a,i)=>i!==4),n=e.length+Vw.length,r=ie(n);if(r<=e.length)return{roll:r,result:e[r-1].scene,source:"starBorg"};{const a=r-e.length-1,i=Vw[a];return{roll:r,incident:i.incident,followUpQuestions:i.followUpQuestions,source:"perilousVoid"}}}else{const e=ie(20);return{roll:e,result:dt.openingScene[e-1],source:"starBorg"}}}function ok(t=!0,e=!0){const n=[];if(t&&n.push(...uD.map(i=>({...i,source:"perilousVoid"}))),e&&n.push(...kD.map(i=>({...i,source:"starforged"}))),n.length===0)return null;const r=ie(n.length),a=`d${n.length}`;return{roll:r,diceType:a,...n[r-1]}}function $D({isOpen:t,onClose:e}){const[n,r]=E.useState(null),[a,i]=E.useState({}),{addLog:c,gameState:u}=Ge();E.useEffect(()=>{const v=w=>{t&&(Qa()||w.key==="Escape"&&e())};return window.addEventListener("keydown",v),()=>window.removeEventListener("keydown",v)},[t,e]);const h=[{label:"Generate Epic Title",specific:"epicTitle"},{label:"Generate Villain Plot",specific:"villain"}];(u.includePVOracles||u.includeStarforgedOracles)&&h.push({label:"Generate Inciting Incident",specific:"inciting"});const p=[{id:1,title:"Create Character(s)",subtitle:"Campaign Start Only",icon:PN,color:"cyan",description:"Use the rules in the Star Borg Rebel Handbook to create your character.",actions:[{label:"Character Creation",tab:"creation"},{label:"Roll Species",specific:"species"},{label:"Roll Motivation",specific:"motivation"}]},{id:2,title:"Roll Campaign Goal",subtitle:"Campaign Start Only",icon:Va,color:"yellow",description:"Roll on the Epic and Damn Fool Idealistic Crusade Tables to determine your Rebel's main goal to save the galaxy.",actions:h},{id:3,title:"Current Mission",subtitle:"Session Play",icon:CO,color:"cyan",description:"Roll on the Episode and Mission Tables to determine your Rebel's current mission.",actions:[{label:"Generate Episode Title",specific:"episodeTitle"},{label:"Generate Mission",specific:"mission"}]},{id:4,title:"Set Threat & Tracks",subtitle:"Session Play",icon:WM,color:"red",description:"Set the Threat Die to 1 and take note of any Mission Tracks and Danger Clocks.",actions:[{label:"Reset Threat Die",specific:"threatDie"},{label:"Add Mission Track",specific:"missionTrack"},{label:"Add Danger Clock",specific:"dangerClock"}]},{id:5,title:"Opening Scene",subtitle:"Session Play",icon:In,color:"yellow",description:"Roll on the Opening Scene table to determine how the action begins.",actions:[{label:"Roll Opening Scene",specific:"openingScene"},{label:"Generate Scene",specific:"scene"}]},{id:6,title:"Use Solo Tools",subtitle:"Session Play",icon:ZM,color:"cyan",description:"Use the Solo Tools, tables, oracles, and your imagination to generate locations, obstacles, characters, and see where your adventure leads.",actions:[{label:"Ask Oracle",specific:"askOracle"},{label:"Generate NPC",specific:"npc"},{label:"Generate Planet",specific:"planet"}]},{id:7,title:"Resolve Actions",subtitle:"Session Play",icon:Va,color:"red",description:"Use the Star Borg Core and Solo rules to resolve your Rebel's actions, adjusting the Threat Die accordingly and take note of the consequences.",actions:[{label:"Roll Dice",specific:"dice"},{label:"Crit/Blunder Table",specific:"critBlunder"}]},{id:8,title:"Continue Scene",subtitle:"Session Play",icon:In,color:"yellow",description:"Roll a Scene Shakeup, Event, or reference the Boost Oracle to continue the scene.",actions:[{label:"Scene Shakeup",specific:"shakeup"},{label:"Event Oracle",specific:"event"},{label:"Boost Oracle",specific:"boost"}]},{id:9,title:"Record & Check Progress",subtitle:"Session Play",icon:DN,color:"cyan",description:"When a scene's action is completely resolved, record the pertinent details and check for progress on the Mission Tracks and Danger Clocks.",actions:[{label:"Update Journal",specific:"journal"},{label:"Check Tracks",specific:"tracks"}]},{id:10,title:"Prepare Next Scene",subtitle:"Session Play",icon:pO,color:"yellow",description:"Prepare the next scene by rolling on the Scene or Event Oracle Tables.",actions:[{label:"Generate Scene",specific:"scene"},{label:"Event Oracle",specific:"event"}]}],m=v=>{r(n===v?null:v)},g=(v,w,N="cyan")=>{let S=null,j="";switch(w){case"species":S=on(Us.galacticSpecies),j=`Species: ${S}`,S={result:S,roll:Math.floor(Math.random()*10)+1};break;case"motivation":S=on(Us.rebelMotivations),j=`Motivation: ${S}`,S={result:S,roll:Math.floor(Math.random()*10)+1};break;case"epicTitle":S=nk(),S.titleType="epic",j=`Epic Title [${S.col1Roll}, ${S.col2Roll}, ${S.col3Roll}, ${S.col4Roll}]: ${S.col1} ${S.col2} ${S.col3} ${S.col4}`;break;case"villain":S=XN(),j=`Villain: ${S.villain}`;break;case"inciting":S=ok(u.includePVOracles,u.includeStarforgedOracles),S?j=`Inciting Incident [${S.diceType} ${S.roll}]: ${S.incident}`:(S={result:"No inciting incident sources enabled"},j="Inciting Incident: No sources enabled");break;case"episodeTitle":S=rk(),S.titleType="episode",j=`Episode Title [${S.col1Roll}, ${S.col2Roll}, ${S.col3Roll}, ${S.col4Roll}]: ${S.col1} ${S.col2} ${S.col3} ${S.col4}`;break;case"mission":S=QN(),j=`Mission [${S.typeRoll}, ${S.goodsRoll}, ${S.spotRoll}, ${S.rewardRoll}]: ${S.type} ${S.goods} ${S.spot} for ${S.reward}`;break;case"openingScene":S=LD(u.includePVOracles),S.incident?j=`Opening Scene [${S.roll}]: ${S.incident}`:j=`Opening Scene [${S.roll}]: ${S.result}`;break;case"scene":S=tk(),j=`Scene: ${S.location} - ${S.tone}`;break;case"askOracle":S=uu(),j=`Oracle (${S.roll}): ${S.result}`;break;case"npc":S=ZN(u.includePVOracles),j=`NPC: ${S.name} - ${S.role} - ${S.species}`;break;case"planet":S=ek(),j=`Planet: ${S.terrain}${S.name?" - "+S.name:""}`;break;case"shakeup":{const A=u.threatDie||1,$=JN(A);$.success?(S={roll:$.total,result:"Scene Shakeup",detail:$.shakeup.result},j=`Scene Shakeup: ${$.shakeup.result}`):(S={roll:$.total,result:"No Scene Shakeup",detail:`Rolled ${$.total}, need 15+`},j=`No Scene Shakeup (rolled ${$.total})`);break}case"event":S=YN(),j=`Event: ${S.verb} ${S.subject} - ${S.specific}`;break;case"boost":S=on(KN.boost),j=`Boost Oracle: ${S}`,S={result:S,roll:Math.floor(Math.random()*20)+1};break;default:console.log("Quick action:",w);return}S&&(i(A=>({...A,[v]:{result:S,variant:N}})),c(j,"roll"))},x=v=>{i(w=>{const N={...w};return delete N[v],N})};return ko.createPortal(l.jsxs(l.Fragment,{children:[l.jsx("div",{className:oe("fixed inset-0 bg-black transition-opacity duration-300",t?"opacity-70 pointer-events-auto z-[9998]":"opacity-0 pointer-events-none z-[-1]"),onClick:e,style:{position:"fixed",top:0,left:0,right:0,bottom:0}}),l.jsxs("div",{className:oe("fixed w-full md:w-[480px] bg-bg-primary border-r-3 border-accent-cyan transform transition-transform duration-300 ease-in-out scanlines overflow-hidden flex flex-col",t?"translate-x-0 z-[9999]":"-translate-x-full z-[-1]"),style:{position:"fixed",top:0,left:0,height:"100vh",maxHeight:"100vh"},children:[l.jsxs("div",{className:"border-b-3 border-accent-cyan bg-bg-secondary p-4 flex items-center justify-between shrink-0",children:[l.jsxs("div",{children:[l.jsx("h2",{className:"text-accent-cyan font-orbitron font-bold text-xl uppercase text-glow-cyan",children:"Game Flow Guide"}),l.jsx("p",{className:"text-gray-400 text-xs font-orbitron mt-1",children:"Solo Play Procedure"})]}),l.jsx("button",{onClick:e,className:"text-accent-red hover:text-accent-red hover:bg-accent-red hover:bg-opacity-20 p-2 transition-colors border-2 border-accent-red",children:l.jsx(Er,{className:"w-6 h-6"})})]}),l.jsxs("div",{className:"overflow-y-auto flex-1 p-4",children:[l.jsxs("div",{className:"mb-6",children:[l.jsxs("div",{className:"text-accent-yellow font-orbitron text-sm uppercase tracking-wider mb-3 flex items-center gap-2",children:[l.jsx("div",{className:"h-px flex-1 bg-accent-yellow opacity-30"}),l.jsx("span",{children:"Campaign Start"}),l.jsx("div",{className:"h-px flex-1 bg-accent-yellow opacity-30"})]}),p.slice(0,2).map(v=>l.jsx(Gw,{step:v,isExpanded:n===v.id,onToggle:()=>m(v.id),onQuickAction:g,stepResult:a[v.id],onClearResult:x},v.id))]}),l.jsxs("div",{children:[l.jsxs("div",{className:"text-accent-cyan font-orbitron text-sm uppercase tracking-wider mb-3 flex items-center gap-2",children:[l.jsx("div",{className:"h-px flex-1 bg-accent-cyan opacity-30"}),l.jsx("span",{children:"Session Play (Steps 3-10)"}),l.jsx("div",{className:"h-px flex-1 bg-accent-cyan opacity-30"})]}),p.slice(2).map(v=>l.jsx(Gw,{step:v,isExpanded:n===v.id,onToggle:()=>m(v.id),onQuickAction:g,stepResult:a[v.id],onClearResult:x},v.id))]}),l.jsxs("div",{className:"mt-6 p-4 border-2 border-accent-yellow bg-bg-secondary",children:[l.jsx("div",{className:"text-accent-yellow font-orbitron text-xs uppercase mb-2",children:"Pro Tip"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Use the Quick Action buttons at the top of the Oracle Compendium for fast access to the most common rolls during play."})]})]})]})]}),document.body)}function Gw({step:t,isExpanded:e,onToggle:n,onQuickAction:r,stepResult:a,onClearResult:i}){t.icon;const u={cyan:{border:"border-accent-cyan",text:"text-accent-cyan",bg:"bg-accent-cyan",glow:"glow-cyan"},yellow:{border:"border-accent-yellow",text:"text-accent-yellow",bg:"bg-accent-yellow",glow:"glow-yellow"},red:{border:"border-accent-red",text:"text-accent-red",bg:"bg-accent-red",glow:"glow-red"}}[t.color];return l.jsxs("div",{className:oe("border-2 mb-3 bg-bg-secondary transition-all",u.border,e&&u.glow),children:[l.jsxs("button",{onClick:n,className:oe("w-full p-3 flex items-center justify-between hover:bg-opacity-10 transition-all duration-200 active:scale-[0.99]",`hover:${u.bg}`),children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:oe("w-8 h-8 rounded-full flex items-center justify-center border-2",u.border,u.bg,"bg-opacity-20"),children:l.jsx("span",{className:oe("font-orbitron font-bold text-sm",u.text),children:t.id})}),l.jsxs("div",{className:"text-left",children:[l.jsx("div",{className:oe("font-orbitron font-bold text-sm uppercase",u.text),children:t.title}),l.jsx("div",{className:"text-gray-400 text-xs font-orbitron",children:t.subtitle})]})]}),l.jsx(ny,{className:oe("w-5 h-5 transition-all duration-300",u.text,e&&"rotate-90")})]}),e&&l.jsxs("div",{className:oe("border-t-2 p-4 space-y-3 accordion-reveal overflow-hidden",u.border),children:[l.jsx("p",{className:"text-gray-300 text-sm leading-relaxed",children:t.description}),t.actions&&t.actions.length>0&&l.jsxs("div",{className:"space-y-2",children:[l.jsx("div",{className:"text-xs font-orbitron uppercase text-gray-400 mb-2",children:"Quick Actions:"}),l.jsx("div",{className:"grid grid-cols-1 gap-2",children:t.actions.map((h,p)=>{const m=h.specific&&["species","motivation","epicTitle","villain","inciting","episodeTitle","mission","openingScene","scene","askOracle","npc","planet","shakeup","event","boost"].includes(h.specific),g=h.tab||!m&&h.specific;return l.jsxs("button",{onClick:()=>{h.specific&&m?r(t.id,h.specific,t.color):console.log("Action not yet implemented:",h.specific||h.tab)},disabled:g,className:oe("px-3 py-2 text-xs font-orbitron uppercase border-2 transition-all text-left",m?[u.border,u.text,"hover:bg-opacity-20",`hover:${u.bg}`]:["border-gray-500","text-gray-400","hover:border-gray-400","italic"]),children:[g&&" ",h.label,g&&" (reminder)"]},p)})}),a&&l.jsx(dD,{result:a.result,variant:a.variant,onDismiss:()=>i(t.id)})]})]})]})}function BD({isOpen:t,onClose:e}){return E.useEffect(()=>{const n=r=>{t&&(Qa()||r.key==="Escape"&&e())};return window.addEventListener("keydown",n),()=>window.removeEventListener("keydown",n)},[t,e]),ko.createPortal(l.jsxs(l.Fragment,{children:[l.jsx("div",{className:oe("fixed inset-0 bg-black transition-opacity duration-300",t?"opacity-70 pointer-events-auto z-[9998]":"opacity-0 pointer-events-none z-[-1]"),onClick:e,style:{position:"fixed",top:0,left:0,right:0,bottom:0}}),l.jsxs("div",{className:oe("fixed w-full md:w-[480px] bg-bg-primary border-r-3 border-accent-yellow transform transition-transform duration-300 ease-in-out scanlines overflow-hidden flex flex-col",t?"translate-x-0 z-[9999]":"-translate-x-full z-[-1]"),style:{position:"fixed",top:0,left:0,height:"100vh",maxHeight:"100vh"},children:[l.jsxs("div",{className:"border-b-3 border-accent-yellow bg-bg-secondary p-4 flex items-center justify-between shrink-0",children:[l.jsxs("div",{children:[l.jsx("h2",{className:"text-accent-yellow font-orbitron font-bold text-xl uppercase text-glow-yellow",children:"Quick Reference"}),l.jsx("p",{className:"text-gray-400 text-xs font-orbitron mt-1",children:"Essential Rules & Mechanics"})]}),l.jsx("button",{onClick:e,className:"text-accent-red hover:text-accent-red hover:bg-accent-red hover:bg-opacity-20 p-2 transition-colors border-2 border-accent-red",children:l.jsx(Er,{className:"w-6 h-6"})})]}),l.jsxs("div",{className:"overflow-y-auto flex-1 p-4 space-y-4 text-sm",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"font-orbitron font-bold text-accent-cyan uppercase mb-2 text-xs",children:"Difficulty Ratings"}),l.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Routine:"}),l.jsx("span",{className:"text-text-primary font-mono",children:"DR 8"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Easy:"}),l.jsx("span",{className:"text-text-primary font-mono",children:"DR 10"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Normal:"}),l.jsx("span",{className:"text-text-primary font-mono font-bold",children:"DR 12"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Difficult:"}),l.jsx("span",{className:"text-text-primary font-mono",children:"DR 14"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Complicated:"}),l.jsx("span",{className:"text-text-primary font-mono",children:"DR 16"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Impossible:"}),l.jsx("span",{className:"text-text-primary font-mono",children:"DR 18"})]})]})]}),l.jsxs("div",{className:"border-t border-accent-yellow/30 pt-3",children:[l.jsx("h3",{className:"font-orbitron font-bold text-accent-cyan uppercase mb-2 text-xs",children:"Abilities"}),l.jsxs("div",{className:"space-y-2 text-xs",children:[l.jsxs("div",{children:[l.jsx("span",{className:"font-bold text-accent-cyan font-mono",children:"AGI"}),l.jsx("span",{className:"text-accent-yellow mx-1",children:""}),l.jsx("span",{className:"text-gray-400",children:"Agility:"}),l.jsx("div",{className:"text-gray-300 ml-4",children:"Sneak, Dodge, Pilot, Throw"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-bold text-accent-cyan font-mono",children:"KNW"}),l.jsx("span",{className:"text-accent-yellow mx-1",children:""}),l.jsx("span",{className:"text-gray-400",children:"Knowledge:"}),l.jsx("div",{className:"text-gray-300 ml-4",children:"Tech, Search, Magi Arts"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-bold text-accent-cyan font-mono",children:"PRS"}),l.jsx("span",{className:"text-accent-yellow mx-1",children:""}),l.jsx("span",{className:"text-gray-400",children:"Presence:"}),l.jsx("div",{className:"text-gray-300 ml-4",children:"Charm, Bluff, Fire Blaster"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-bold text-accent-cyan font-mono",children:"STR"}),l.jsx("span",{className:"text-accent-yellow mx-1",children:""}),l.jsx("span",{className:"text-gray-400",children:"Strength:"}),l.jsx("div",{className:"text-gray-300 ml-4",children:"Strike, Wrestle, Lift, Endure"})]})]})]}),l.jsxs("div",{className:"border-t border-accent-yellow/30 pt-3",children:[l.jsx("h3",{className:"font-orbitron font-bold text-accent-cyan uppercase mb-2 text-xs",children:"Solo Test Results (D20 + Ability)"}),l.jsxs("div",{className:"space-y-1",children:[l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-cyan font-mono font-bold",children:"12+"}),l.jsxs("div",{children:[l.jsx("span",{className:"font-bold text-accent-cyan",children:"STRONG HIT:"}),l.jsx("span",{className:"text-gray-300 ml-1",children:"Things go exactly as planned."})]})]}),l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-yellow font-mono font-bold",children:"9-11"}),l.jsxs("div",{children:[l.jsx("span",{className:"font-bold text-accent-yellow",children:"WEAK HIT:"}),l.jsx("span",{className:"text-gray-300 ml-1",children:"Good, but not completely as planned."})]})]}),l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-red font-mono font-bold",children:"8<"}),l.jsxs("div",{children:[l.jsx("span",{className:"font-bold text-accent-red",children:"FAIL:"}),l.jsx("span",{className:"text-gray-300 ml-1",children:"Things are not going your way."})]})]})]})]}),l.jsxs("div",{className:"border-t border-accent-yellow/30 pt-3",children:[l.jsx("h3",{className:"font-orbitron font-bold text-accent-cyan uppercase mb-2 text-xs",children:"Combat Tests (DR12 Default)"}),l.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Melee:"}),l.jsx("span",{className:"text-text-primary font-mono",children:"STR"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Ranged:"}),l.jsx("span",{className:"text-text-primary font-mono",children:"PRS"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Throw:"}),l.jsx("span",{className:"text-text-primary font-mono",children:"AGI"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Defense:"}),l.jsx("span",{className:"text-text-primary font-mono",children:"AGI"})]})]})]}),l.jsxs("div",{className:"border-t border-accent-yellow/30 pt-3",children:[l.jsx("h3",{className:"font-orbitron font-bold text-accent-cyan uppercase mb-2 text-xs",children:"Armor Tiers"}),l.jsxs("div",{className:"space-y-1 text-xs",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Tier 1 (Light):"}),l.jsx("span",{className:"text-text-primary font-mono",children:"-D2 damage"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Tier 2 (Medium):"}),l.jsx("span",{className:"text-text-primary font-mono",children:"-D4 damage"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Tier 3 (Heavy):"}),l.jsx("span",{className:"text-text-primary font-mono",children:"-D6 damage"})]}),l.jsx("div",{className:"text-gray-500 text-xs mt-1",children:"* Reduced one tier on Defense blunder"})]})]}),l.jsxs("div",{className:"border-t border-accent-yellow/30 pt-3",children:[l.jsx("h3",{className:"font-orbitron font-bold text-accent-cyan uppercase mb-2 text-xs",children:"Resting & Recovery"}),l.jsxs("div",{className:"space-y-1 text-xs",children:[l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Catch Breath:"}),l.jsx("span",{className:"text-text-primary font-mono",children:"Restore D4 HP"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Night's Sleep:"}),l.jsx("span",{className:"text-text-primary font-mono",children:"Restore D6 HP"})]}),l.jsxs("div",{className:"flex justify-between",children:[l.jsx("span",{className:"text-gray-400",children:"Healing Tank (1 week):"}),l.jsx("span",{className:"text-text-primary font-mono",children:"Full HP"})]})]})]}),l.jsxs("div",{className:"border-t border-accent-yellow/30 pt-3",children:[l.jsx("h3",{className:"font-orbitron font-bold text-accent-cyan uppercase mb-2 text-xs",children:"Destiny Points"}),l.jsxs("div",{className:"space-y-2 text-xs",children:[l.jsxs("p",{className:"text-gray-300",children:["Start with ",l.jsx("span",{className:"text-accent-yellow font-bold",children:"D2 Destiny Points"}),". Regain by rolling D2 after spending all and resting."]}),l.jsxs("div",{className:"text-gray-300",children:[l.jsx("span",{className:"font-bold text-accent-cyan",children:"Use Destiny to:"}),l.jsxs("div",{className:"ml-4 mt-1 space-y-0.5",children:[" Deal maximum damage with one attack",l.jsx("br",{})," Reroll a dice roll (yours or someone else's)",l.jsx("br",{})," Lower damage dealt to you by D6",l.jsx("br",{})," Neutralize a Crit or Blunder",l.jsx("br",{})," -4DR to one test (before rolling)"]})]})]})]}),l.jsxs("div",{className:"border-t border-accent-yellow/30 pt-3",children:[l.jsx("h3",{className:"font-orbitron font-bold text-accent-cyan uppercase mb-2 text-xs",children:"Natural 20 / Natural 1"}),l.jsxs("div",{className:"space-y-2 text-xs",children:[l.jsxs("div",{children:[l.jsx("span",{className:"font-bold text-accent-cyan",children:"CRIT (20):"}),l.jsxs("div",{className:"text-gray-300 ml-4",children:[" Attack: Double damage, reduce armor 1 tier",l.jsx("br",{})," Defense: Gain free attack",l.jsx("br",{})," Other: Outrageous success"]})]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-bold text-accent-red",children:"BLUNDER (1):"}),l.jsx("div",{className:"text-gray-300 ml-4",children:" Roll on Blunder table (d4)"})]})]})]}),l.jsxs("div",{className:"border-t border-accent-yellow/30 pt-3",children:[l.jsx("h3",{className:"font-orbitron font-bold text-accent-cyan uppercase mb-2 text-xs",children:"Enemy Morale"}),l.jsxs("div",{className:"text-xs space-y-1",children:[l.jsx("p",{className:"text-gray-300",children:"Roll 2D6 when:"}),l.jsxs("div",{className:"text-gray-400 ml-4",children:[" Leader killed",l.jsx("br",{})," Half group eliminated",l.jsx("br",{})," Single enemy at 1/3 HP"]}),l.jsxs("p",{className:"text-gray-300 mt-2",children:["If roll > enemy MRL: Roll D6",l.jsx("br",{}),l.jsx("span",{className:"ml-4",children:"1-4 = Flees, 5-6 = Surrenders"})]})]})]}),l.jsxs("div",{className:"border-t border-accent-yellow/30 pt-3",children:[l.jsx("h3",{className:"font-orbitron font-bold text-accent-cyan uppercase mb-2 text-xs",children:"Threat Die Triggers"}),l.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-accent-red font-bold",children:"INCREASE:"}),l.jsxs("div",{className:"text-gray-400 ml-2 mt-1",children:[" New Danger Clock",l.jsx("br",{})," Roll Blunder",l.jsx("br",{})," Begin Escape"]})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-accent-cyan font-bold",children:"DECREASE:"}),l.jsxs("div",{className:"text-gray-400 ml-2 mt-1",children:[" Complete Mission",l.jsx("br",{})," Resolve Clock",l.jsx("br",{})," Roll Critical",l.jsx("br",{})," Catch Breath"]})]})]}),l.jsx("p",{className:"text-gray-400 text-xs mt-2",children:"When TD = 6: Advance ALL Clocks +1, OR fill ONE Clock"})]}),l.jsxs("div",{className:"border-t border-accent-yellow/30 pt-3",children:[l.jsx("h3",{className:"font-orbitron font-bold text-accent-cyan uppercase mb-2 text-xs",children:"Bits  (Currency)"}),l.jsxs("div",{className:"space-y-2 text-xs",children:[l.jsx("p",{className:"text-gray-300",children:"The standard currency of the galaxy. Rebels either have Bits or they don't."}),l.jsxs("div",{className:"text-gray-300",children:[l.jsx("span",{className:"font-bold text-accent-yellow",children:"Starting Bits (Roll D6):"}),l.jsxs("div",{className:"ml-4 mt-1",children:[l.jsx("span",{className:"text-accent-red",children:"1-3:"})," No Bits",l.jsx("br",{}),l.jsx("span",{className:"text-accent-cyan",children:"4-6:"})," You got Bits "]})]}),l.jsxs("div",{className:"text-gray-400 text-xs border-t border-gray-700 pt-2 mt-2",children:[l.jsx("span",{className:"font-bold text-accent-yellow",children:""})," = Costs all the bits you have",l.jsx("br",{}),l.jsx("span",{className:"font-bold text-accent-yellow",children:""})," = Costs all the bits the party has"]})]})]})]})]})]}),document.body)}function jt({title:t,children:e,defaultOpen:n=!1}){const[r,a]=E.useState(n);return l.jsxs("div",{className:"border-3 border-accent-yellow mb-2",children:[l.jsxs("button",{onClick:()=>a(!r),className:"w-full px-4 py-3 flex items-center justify-between bg-transparent hover:bg-accent-yellow hover:text-bg-primary transition-all duration-200 font-orbitron font-bold uppercase text-sm active:scale-[0.99]",children:[l.jsx("span",{children:t}),l.jsx(No,{className:oe("w-5 h-5 transition-all duration-300",r&&"transform rotate-180")})]}),r&&l.jsx("div",{className:"p-4 bg-bg-primary border-t-3 border-accent-yellow accordion-reveal overflow-hidden",children:e})]})}function ID({isOpen:t,onClose:e}){const{gameState:n,togglePVOracles:r,toggleStarforgedOracles:a}=Ge(),{signOut:i,user:c}=Ya(),[u,h]=E.useState(!1);return E.useEffect(()=>{const p=m=>{t&&(Qa()||m.key==="Escape"&&e())};return window.addEventListener("keydown",p),()=>window.removeEventListener("keydown",p)},[t,e]),ko.createPortal(l.jsxs(l.Fragment,{children:[l.jsx("div",{className:oe("fixed inset-0 bg-black transition-opacity duration-300",t?"opacity-70 pointer-events-auto z-[9998]":"opacity-0 pointer-events-none z-[-1]"),onClick:e,style:{position:"fixed",top:0,left:0,right:0,bottom:0}}),l.jsxs("div",{className:oe("fixed w-full md:w-[480px] bg-bg-primary border-l-3 border-accent-cyan transform transition-transform duration-300 ease-in-out scanlines overflow-hidden flex flex-col",t?"translate-x-0 z-[9999]":"translate-x-full z-[-1]"),style:{position:"fixed",top:0,right:0,height:"100vh",maxHeight:"100vh"},children:[l.jsxs("div",{className:"border-b-3 border-accent-cyan bg-bg-secondary p-4 flex items-center justify-between shrink-0",children:[l.jsxs("div",{children:[l.jsx("h2",{className:"text-accent-cyan font-orbitron font-bold text-xl uppercase text-glow-cyan",children:"Settings"}),l.jsx("p",{className:"text-gray-400 text-xs font-orbitron mt-1",children:"Configure Your Dashboard"})]}),l.jsx("button",{onClick:e,className:"text-accent-red hover:text-accent-red hover:bg-accent-red hover:bg-opacity-20 p-2 transition-colors border-2 border-accent-red",children:l.jsx(Er,{className:"w-6 h-6"})})]}),l.jsxs("div",{className:"overflow-y-auto flex-1 p-4",children:[l.jsx(jt,{title:"Content Sources",defaultOpen:!0,children:l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"text-gray-400 text-sm mb-4",children:"Toggle additional content from compatible sourcebooks and supplements."}),l.jsxs("label",{className:"flex items-start gap-3 cursor-pointer p-3 border-2 border-accent-yellow bg-bg-secondary hover:bg-accent-yellow hover:bg-opacity-10 transition-colors",children:[l.jsx("input",{type:"checkbox",checked:n.includePVOracles,onChange:p=>r(p.target.checked),className:"w-5 h-5 mt-0.5 accent-accent-yellow cursor-pointer flex-shrink-0"}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-accent-yellow font-orbitron text-sm font-bold uppercase",children:"The Perilous Void"}),n.includePVOracles&&l.jsx("span",{className:"text-accent-yellow text-xs px-2 py-0.5 border border-accent-yellow rounded",children:"ACTIVE"})]}),l.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Adds opening scenes (d20d30) and an Inciting Incident generator for campaign setup"}),n.includePVOracles&&l.jsxs("div",{className:"text-accent-yellow text-xs mt-2 space-y-1",children:[l.jsx("div",{children:" Opening Scene: d30 table"}),l.jsx("div",{children:" Mission Generator: Inciting tab"}),l.jsx("div",{children:" Game Flow: Inciting Incident option"})]})]})]}),l.jsxs("label",{className:"flex items-start gap-3 cursor-pointer p-3 border-2 border-accent-cyan bg-bg-secondary hover:bg-accent-cyan hover:bg-opacity-10 transition-colors",children:[l.jsx("input",{type:"checkbox",checked:n.includeStarforgedOracles,onChange:p=>a(p.target.checked),className:"w-5 h-5 mt-0.5 accent-accent-cyan cursor-pointer flex-shrink-0"}),l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-accent-cyan font-orbitron text-sm font-bold uppercase",children:"Starforged"}),n.includeStarforgedOracles&&l.jsx("span",{className:"text-accent-cyan text-xs px-2 py-0.5 border border-accent-cyan rounded",children:"ACTIVE"})]}),l.jsx("p",{className:"text-gray-400 text-xs mt-1",children:"Adds 19 inciting incidents for campaign setup"}),n.includeStarforgedOracles&&l.jsxs("div",{className:"text-accent-cyan text-xs mt-2 space-y-1",children:[l.jsx("div",{children:" Mission Generator: Inciting tab"}),l.jsx("div",{children:" Game Flow: Inciting Incident option"})]})]})]}),l.jsx("div",{className:"p-3 border-2 border-gray-600 bg-bg-secondary opacity-50",children:l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("input",{type:"checkbox",disabled:!0,className:"w-5 h-5 mt-0.5 cursor-not-allowed"}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-500 font-orbitron text-sm font-bold uppercase",children:"Additional Sources"}),l.jsx("p",{className:"text-gray-600 text-xs mt-1",children:"More sourcebook integrations coming soon..."})]})]})})]})}),l.jsx(jt,{title:"Display Preferences",defaultOpen:!1,children:l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"text-gray-400 text-sm mb-4",children:"Customize the appearance and behavior of your dashboard."}),l.jsx("div",{className:"p-3 border-2 border-gray-600 bg-bg-secondary opacity-50",children:l.jsx("span",{className:"text-gray-500 font-orbitron text-sm",children:"Display options coming soon..."})})]})}),l.jsx(jt,{title:"Game Options",defaultOpen:!1,children:l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"text-gray-400 text-sm mb-4",children:"Configure house rules and gameplay variants."}),l.jsx("div",{className:"p-3 border-2 border-gray-600 bg-bg-secondary opacity-50",children:l.jsx("span",{className:"text-gray-500 font-orbitron text-sm",children:"Game options coming soon..."})})]})}),l.jsxs("div",{className:"mt-6 p-4 border-2 border-accent-cyan bg-bg-secondary",children:[l.jsx("div",{className:"text-accent-cyan font-orbitron text-xs uppercase mb-2",children:"About Settings"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Settings are saved automatically and synced across your session. Changes take effect immediately."})]}),l.jsxs("div",{className:"mt-6 space-y-4",children:[l.jsx("div",{className:"flex items-center justify-between",children:l.jsxs("div",{children:[l.jsx("div",{className:"text-accent-yellow font-orbitron text-sm uppercase font-bold",children:"Account"}),c?.email&&l.jsx("div",{className:"text-gray-400 text-xs mt-1 font-mono",children:c.email})]})}),u?l.jsxs("div",{className:"p-4 border-2 border-accent-red bg-accent-red bg-opacity-10 space-y-3",children:[l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx(ar,{className:"w-5 h-5 text-accent-red mt-0.5 flex-shrink-0"}),l.jsxs("div",{children:[l.jsx("div",{className:"text-accent-red font-orbitron text-sm font-bold uppercase",children:"Confirm Sign Out"}),l.jsx("p",{className:"text-gray-300 text-xs mt-1",children:"You will be logged out of your session. Your character and game progress are saved."})]})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs(ge,{onClick:async()=>{await i(),e()},variant:"danger",className:"flex-1",children:[l.jsx(Pw,{className:"w-4 h-4 mr-2"}),"Confirm"]}),l.jsx(ge,{onClick:()=>h(!1),variant:"ghost",className:"flex-1",children:"Cancel"})]})]}):l.jsxs("button",{onClick:()=>h(!0),className:"w-full p-3 border-2 border-accent-red bg-bg-secondary hover:bg-accent-red hover:bg-opacity-10 transition-all group flex items-center justify-center gap-2",children:[l.jsx(Pw,{className:"w-4 h-4 text-accent-red group-hover:text-accent-red transition-colors"}),l.jsx("span",{className:"text-accent-red font-orbitron text-sm uppercase group-hover:text-accent-red transition-colors",children:"Sign Out"})]})]}),l.jsx("div",{className:"h-8"})]})]})]}),document.body)}function PD({roomCode:t,onOpenCharacterSheet:e}){const{character:n}=as(),{spaceCombat:r,viewingCombat:a,enterCombat:i,exitCombatView:c,joinCombatView:u}=pn(),[h,p]=E.useState(!1),[m,g]=E.useState(!1),[x,v]=E.useState(!1),[w,N]=E.useState(!1),[S,j]=E.useState(!1);E.useEffect(()=>{const R=()=>{j(window.scrollY>20)};return window.addEventListener("scroll",R,{passive:!0}),()=>window.removeEventListener("scroll",R)},[]);const A=()=>{const R=`${window.location.origin}${window.location.pathname}?room=${t}`;navigator.clipboard.writeText(R),p(!0),setTimeout(()=>p(!1),2e3)},$=()=>{const R=_N(),M=`${window.location.origin}${window.location.pathname}?room=${R}`;window.location.href=M},L=()=>{a?c():r.isActive?u():i()};return l.jsxs(l.Fragment,{children:[l.jsx("header",{className:"sticky top-0 z-50 border-b-3 border-accent-yellow bg-bg-secondary p-3 md:p-4 border-flicker shadow-lg lg:relative lg:shadow-none transition-all duration-300",children:l.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[l.jsxs("div",{className:`flex items-center gap-2 md:gap-4 transition-all duration-300 ${S?"max-h-0 overflow-hidden opacity-0 lg:max-h-none lg:opacity-100":"max-h-20 opacity-100"}`,children:[l.jsxs("div",{children:[l.jsx("h1",{className:"font-orbitron font-black text-2xl md:text-4xl text-accent-yellow text-glow-yellow tracking-wider",children:"STAR DASHBORG"}),l.jsx("p",{className:"text-accent-cyan text-xs md:text-sm font-orbitron",children:"REBEL MISSION DASHBOARD"})]}),l.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[n&&e&&l.jsxs(ge,{variant:"primary",onClick:e,className:"flex items-center gap-2",title:n.name||"Character Sheet",children:[l.jsx(Fs,{className:"w-4 h-4"}),l.jsx("span",{children:n.name?n.name.split(" ")[0]:"Character"})]}),l.jsxs(ge,{variant:"secondary",onClick:L,className:"flex items-center gap-2",children:[l.jsx(ac,{className:"w-4 h-4"}),"Battle"]}),l.jsxs(ge,{variant:"primary",onClick:()=>g(!0),className:"flex items-center gap-2",children:[l.jsx(rc,{className:"w-4 h-4"}),"Flow"]}),l.jsxs(ge,{variant:"secondary",onClick:()=>v(!0),className:"flex items-center gap-2",children:[l.jsx(Bw,{className:"w-4 h-4"}),"Ref"]}),l.jsxs(ge,{variant:"secondary",onClick:()=>N(!0),className:"flex items-center gap-2",children:[l.jsx(ic,{className:"w-4 h-4"}),"Settings"]})]})]}),l.jsxs("div",{className:`flex items-center gap-2 md:gap-4 transition-all duration-300 ${S?"max-h-0 overflow-hidden opacity-0 lg:max-h-none lg:opacity-100":"max-h-20 opacity-100"}`,children:[l.jsxs("div",{className:"text-right",children:[l.jsx("p",{className:"text-xs text-gray-400 font-orbitron uppercase",children:"Room Code"}),l.jsx("p",{className:"text-lg md:text-2xl font-orbitron font-bold text-accent-cyan text-glow-cyan",children:t})]}),l.jsxs("div",{className:"flex gap-1 md:gap-2",children:[l.jsxs(ge,{variant:"secondary",onClick:$,className:"flex items-center gap-1 md:gap-2 px-2 md:px-4",children:[l.jsx(ir,{className:"w-4 h-4"}),l.jsx("span",{className:"hidden sm:inline",children:"New Room"})]}),l.jsx(ge,{variant:"ghost",onClick:A,className:"flex items-center gap-1 md:gap-2 px-2 md:px-4",children:h?l.jsxs(l.Fragment,{children:[l.jsx(Ks,{className:"w-4 h-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Copied!"})]}):l.jsxs(l.Fragment,{children:[l.jsx(LN,{className:"w-4 h-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Copy Invite"})]})})]})]}),l.jsxs("div",{className:`md:hidden w-full grid gap-2 ${n&&e?"grid-cols-5":"grid-cols-4"}`,children:[n&&e&&l.jsxs(ge,{variant:"primary",onClick:e,className:"flex items-center justify-center gap-1",title:n.name||"Character Sheet",children:[l.jsx(Fs,{className:"w-4 h-4"}),l.jsx("span",{className:"whitespace-nowrap",children:n.name?n.name.split(" ")[0]:"Char"})]}),l.jsxs(ge,{variant:"secondary",onClick:L,className:"flex items-center justify-center gap-1",children:[l.jsx(ac,{className:"w-4 h-4"}),l.jsx("span",{className:"whitespace-nowrap",children:"Battle"})]}),l.jsxs(ge,{variant:"primary",onClick:()=>g(!0),className:"flex items-center justify-center gap-1",children:[l.jsx(rc,{className:"w-4 h-4"}),l.jsx("span",{className:"whitespace-nowrap",children:"Flow"})]}),l.jsxs(ge,{variant:"secondary",onClick:()=>v(!0),className:"flex items-center justify-center gap-1",children:[l.jsx(Bw,{className:"w-4 h-4"}),l.jsx("span",{className:"whitespace-nowrap",children:"Ref"})]}),l.jsxs(ge,{variant:"secondary",onClick:()=>N(!0),className:"flex items-center justify-center gap-1",children:[l.jsx(ic,{className:"w-4 h-4"}),l.jsx("span",{className:"whitespace-nowrap",children:"Settings"})]})]})]})}),l.jsx($D,{isOpen:m,onClose:()=>g(!1)}),l.jsx(BD,{isOpen:x,onClose:()=>v(!1)}),l.jsx(ID,{isOpen:w,onClose:()=>N(!1)})]})}function qw({title:t,children:e,className:n,variant:r="cyan",onHelpClick:a,draggable:i,onDragStart:c,onDragEnd:u,collapsible:h,collapsed:p,onCollapsedChange:m,mobileMaxHeight:g,touchDraggable:x,panelId:v,isDragging:w,isDropTarget:N}){const S={cyan:"border-accent-cyan",yellow:"border-accent-yellow",red:"border-accent-red"},j={cyan:"text-accent-cyan",yellow:"text-accent-yellow",red:"text-accent-red"},A=i||x;return l.jsxs("div",{className:oe("border-3 flex flex-col relative transition-all duration-300 bg-bg-secondary overflow-hidden",p?"h-auto":"h-full",S[r],w&&"opacity-50 scale-[0.98]",N&&"ring-2 ring-accent-cyan ring-offset-2 ring-offset-bg-primary",n),children:[t&&l.jsxs("div",{draggable:i,onDragStart:c,onDragEnd:u,"data-panel-header":x?!0:void 0,"data-panel-id":x?v:void 0,className:oe("px-4 py-2 font-orbitron font-bold uppercase text-lg shrink-0 flex items-center justify-between h-[52px]",j[r],"bg-bg-primary","overflow-hidden",!p&&`border-b-3 ${S[r]}`,(i||x)&&"cursor-grab active:cursor-grabbing",x&&"select-none"),children:[l.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[A&&l.jsx("div",{className:"flex items-center justify-center shrink-0 p-1 -ml-1 rounded hover:bg-current/10 active:bg-current/20 transition-colors",children:l.jsx(rO,{className:"w-5 h-5 opacity-60"})}),l.jsx("span",{className:"break-words truncate",children:t})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[a&&l.jsx("button",{onClick:$=>{$.stopPropagation(),a()},className:oe("p-1 hover:bg-current/10 transition-all duration-200 rounded",j[r]),"aria-label":"Show help",children:l.jsx(GM,{className:"w-4 h-4"})}),h&&l.jsx("button",{onClick:$=>{$.stopPropagation(),m&&m(!p)},className:oe("p-1 hover:bg-current/10 transition-all duration-200 rounded",j[r]),"aria-label":p?"Expand panel":"Collapse panel",children:l.jsx(No,{className:oe("w-4 h-4 transition-transform duration-200",!p&&"rotate-180")})})]})]}),!p&&l.jsx("div",{className:oe("p-4 flex-1 overflow-y-auto overflow-x-hidden accordion-reveal relative overscroll-contain",g&&"scroll-smooth"),style:g?{maxHeight:g,touchAction:"pan-y",isolation:"isolate"}:void 0,children:e})]})}function Ww(){const{gameState:t,updateGameState:e,addLog:n}=Ge(),[r,a]=E.useState(!1),i=()=>{if(r)return;a(!0);const u=t.threatDie===6?1:t.threatDie+1;e({threatDie:u}),n(`Threat Die set to ${u}`,"threat"),setTimeout(()=>a(!1),400)},c=t.threatDie===6;return l.jsxs("div",{className:"flex flex-col items-center gap-4",children:[l.jsx("button",{onClick:i,className:`w-32 h-32 bg-accent-red text-bg-primary font-orbitron font-black text-6xl border-3 border-accent-red hover:bg-transparent hover:text-accent-red transition-all glow-red hover:shadow-[0_0_20px_rgba(255,0,60,0.8)] active:scale-95 ${r?"threat-cycle glow-pulse-red":""} ${c?"glow-pulse-red":""}`,children:l.jsx("span",{className:r?"number-flip inline-block":"inline-block",children:t.threatDie})}),l.jsx("p",{className:"text-accent-red text-sm font-orbitron uppercase",children:"Click to Cycle"}),c&&l.jsxs("div",{className:"w-full border-3 border-accent-red bg-accent-red/10 p-4 inline-alert-pulse",children:[l.jsxs("div",{className:"flex items-start gap-3 mb-2",children:[l.jsx(ar,{className:"w-5 h-5 text-accent-red flex-shrink-0 mt-0.5"}),l.jsx("h4",{className:"font-orbitron font-bold text-accent-red uppercase text-sm",children:"Maximum Threat"})]}),l.jsx("p",{className:"text-text-primary text-sm mb-2 pl-8",children:"Choose one:"}),l.jsxs("ul",{className:"space-y-1 pl-8",children:[l.jsxs("li",{className:"text-text-primary text-sm flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-red",children:""}),l.jsx("span",{children:"Advance ALL Danger Clocks by 1"})]}),l.jsxs("li",{className:"text-text-primary text-sm flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-red",children:""}),l.jsx("span",{children:"Completely fill ONE Danger Clock"})]})]})]})]})}function Kw(){const{gameState:t,updateGameState:e,addLog:n}=Ge(),[r,a]=E.useState(""),[i,c]=E.useState(6),[u,h]=E.useState(!1),p=()=>{if(!r.trim()){h(!0),setTimeout(()=>h(!1),400);return}const v={id:Date.now().toString(),title:r,length:i,progress:0};e({missions:[...t.missions,v]}),n(`New mission added: ${r}`,"mission"),a("")},m=(v,w)=>{const N=t.missions.find(j=>j.id===v),S=t.missions.map(j=>j.id===v?{...j,progress:w}:j);e({missions:S}),w===N.length&&n(`Mission completed: ${N.title}`,"success")},g=v=>{const w=t.missions.find(N=>N.id===v);e({missions:t.missions.filter(N=>N.id!==v)}),n(`Mission removed: ${w.title}`,"info")},x=v=>{const w=t.missions.find(L=>L.id===v);if(!w)return;const S={4:10,6:12,8:14,10:16}[w.length]||12,j=ie(20),A=j+w.progress;if(A>=S)n(`Mission completion [${j}] + [${w.progress}] = ${A} vs DR${S}  SUCCESS! "${w.title}" completed!`,"success"),e({missions:t.missions.filter(L=>L.id!==v)});else{n(`Mission completion [${j}] + [${w.progress}] = ${A} vs DR${S}  FAIL. Remove 1 progress, increase Threat Die.`,"danger");const L=t.missions.map(R=>R.id===v?{...R,progress:Math.max(0,R.progress-1)}:R);e({missions:L})}};return l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("input",{type:"text",placeholder:"Enter mission objective...",value:r,onChange:v=>a(v.target.value),onKeyPress:v=>v.key==="Enter"&&p(),className:`w-full px-3 py-2 bg-bg-primary border-2 border-accent-cyan text-text-primary focus:outline-none focus:border-accent-yellow focus:shadow-[0_0_15px_rgba(255,252,0,0.4)] transition-all duration-300 font-orbitron ${u?"input-shake border-accent-red":""}`}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs("select",{value:i,onChange:v=>c(Number(v.target.value)),className:"flex-1 px-3 py-2 bg-bg-primary border-2 border-accent-cyan text-text-primary focus:outline-none focus:border-accent-yellow focus:shadow-[0_0_15px_rgba(255,252,0,0.4)] transition-all duration-300 font-orbitron [&>option]:bg-bg-secondary [&>option]:text-text-primary",children:[l.jsx("option",{value:4,className:"bg-bg-secondary text-text-primary",children:"Short / Easy (DR10)"}),l.jsx("option",{value:6,className:"bg-bg-secondary text-text-primary",children:"Average / Normal (DR12)"}),l.jsx("option",{value:8,className:"bg-bg-secondary text-text-primary",children:"Long / Difficult (DR14)"}),l.jsx("option",{value:10,className:"bg-bg-secondary text-text-primary",children:"Galaxy Saving (DR16)"})]}),l.jsxs(ge,{onClick:p,variant:"primary",className:"flex items-center gap-2",children:[l.jsx(ir,{className:"w-4 h-4"}),"Add"]})]})]}),l.jsx("div",{className:"space-y-3",children:t.missions.length===0?l.jsxs("div",{className:"text-center py-8 space-y-2",children:[l.jsx("div",{className:"text-accent-cyan/30 text-4xl mb-2",children:""}),l.jsx("p",{className:"text-gray-500 font-orbitron text-sm",children:"NO ACTIVE MISSIONS"}),l.jsx("p",{className:"text-gray-600 text-xs",children:"Add a mission to track your progress"})]}):t.missions.map(v=>l.jsxs("div",{className:"bg-bg-primary p-3 border-2 border-accent-cyan",children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("h4",{className:"font-orbitron font-bold text-accent-cyan",children:v.title}),l.jsx("button",{onClick:()=>g(v.id),className:"text-accent-red hover:text-red-400",children:l.jsx(rs,{className:"w-4 h-4"})})]}),l.jsx("div",{className:"flex gap-1",children:Array.from({length:v.length}).map((w,N)=>l.jsx("button",{onClick:()=>m(v.id,N+1),className:`flex-1 h-6 border-2 transition-all duration-200 ${N<v.progress?"bg-accent-cyan border-accent-cyan segment-fill":"bg-transparent border-accent-cyan hover:bg-accent-cyan hover:bg-opacity-30 hover:scale-105"} ${N===v.progress-1?"ripple":""} ${v.progress===v.length&&N===v.length-1?"completion-bounce":""}`},N))}),l.jsxs("div",{className:"mt-2 flex items-center justify-between text-xs",children:[l.jsxs("span",{className:"text-gray-400 font-orbitron",children:["Progress: ",v.progress," | DR",v.length===4?"10":v.length===6?"12":v.length===8?"14":"16"]}),l.jsxs("button",{onClick:()=>x(v.id),className:"px-2 py-1 bg-transparent border-2 border-accent-yellow text-accent-yellow hover:bg-accent-yellow hover:text-bg-primary transition-all font-orbitron font-bold uppercase text-xs flex items-center gap-1",children:[l.jsx(Va,{className:"w-3 h-3"}),"Attempt"]})]})]},v.id))})]})}function Yw(){const{gameState:t,updateGameState:e,addLog:n}=Ge(),[r,a]=E.useState(""),[i,c]=E.useState(6),[u,h]=E.useState(!1),p=()=>{if(!r.trim()){h(!0),setTimeout(()=>h(!1),400);return}const x={id:Date.now().toString(),title:r,segments:i,filled:0};e({dangerClocks:[...t.dangerClocks,x]}),n(`New danger clock added: ${r}`,"danger"),a("")},m=(x,v)=>{const w=t.dangerClocks.map(S=>S.id===x?{...S,filled:v}:S);e({dangerClocks:w});const N=t.dangerClocks.find(S=>S.id===x);v===N.segments&&n(`DANGER! Clock filled: ${N.title}`,"danger")},g=x=>{const v=t.dangerClocks.find(w=>w.id===x);e({dangerClocks:t.dangerClocks.filter(w=>w.id!==x)}),n(`Danger clock removed: ${v.title}`,"info")};return l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("input",{type:"text",placeholder:"Enter looming threat...",value:r,onChange:x=>a(x.target.value),onKeyPress:x=>x.key==="Enter"&&p(),className:`w-full px-3 py-2 bg-bg-primary border-2 border-accent-red text-text-primary focus:outline-none focus:border-accent-yellow focus:shadow-[0_0_15px_rgba(255,252,0,0.4)] transition-all duration-300 font-orbitron ${u?"input-shake border-accent-red":""}`}),l.jsxs("div",{className:"flex gap-2",children:[l.jsxs("select",{value:i,onChange:x=>c(Number(x.target.value)),className:"flex-1 px-3 py-2 bg-bg-primary border-2 border-accent-red text-text-primary focus:outline-none focus:border-accent-yellow focus:shadow-[0_0_15px_rgba(255,252,0,0.4)] transition-all duration-300 font-orbitron [&>option]:bg-bg-secondary [&>option]:text-text-primary",children:[l.jsx("option",{value:4,className:"bg-bg-secondary text-text-primary",children:"4 Segments - Imminent"}),l.jsx("option",{value:6,className:"bg-bg-secondary text-text-primary",children:"6 Segments - Building"}),l.jsx("option",{value:8,className:"bg-bg-secondary text-text-primary",children:"8 Segments - Slow Burn"}),l.jsx("option",{value:10,className:"bg-bg-secondary text-text-primary",children:"10 Segments - Long Game"})]}),l.jsxs(ge,{onClick:p,variant:"danger",className:"flex items-center gap-2",children:[l.jsx(ir,{className:"w-4 h-4"}),"Add"]})]})]}),l.jsx("div",{className:"space-y-3",children:t.dangerClocks.length===0?l.jsxs("div",{className:"text-center py-8 space-y-2",children:[l.jsx("div",{className:"text-accent-red/30 text-4xl mb-2",children:""}),l.jsx("p",{className:"text-gray-500 font-orbitron text-sm",children:"NO DANGER CLOCKS"}),l.jsx("p",{className:"text-gray-600 text-xs",children:"Track looming threats and countdowns"})]}):t.dangerClocks.map(x=>{const v=x.filled===x.segments;return l.jsxs("div",{className:`bg-bg-primary p-3 border-2 border-accent-red ${v?"glow-pulse-red":""}`,children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("h4",{className:"font-orbitron font-bold text-accent-red",children:x.title}),l.jsx("button",{onClick:()=>g(x.id),className:"text-accent-red hover:text-red-400",children:l.jsx(rs,{className:"w-4 h-4"})})]}),l.jsxs("div",{className:"relative w-24 h-24 mx-auto my-3",children:[l.jsxs("svg",{viewBox:"0 0 100 100",className:"transform -rotate-90",children:[l.jsx("circle",{cx:"50",cy:"50",r:"45",fill:"none",stroke:"#1a1a1a",strokeWidth:"10"}),Array.from({length:x.segments}).map((w,N)=>{const S=360/x.segments,j=N*S,A=N<x.filled;return l.jsx("path",{d:zD(50,50,45,j,j+S-2),fill:"none",stroke:A?"#ff003c":"#333",strokeWidth:"10",className:"cursor-pointer hover:opacity-80 transition-all duration-200 hover:stroke-[#ff003c]",style:{transition:"stroke 0.3s ease-out"},onClick:()=>m(x.id,N+1)},N)})]}),l.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:l.jsxs("span",{className:`font-orbitron font-bold text-accent-red text-xl transition-all ${x.filled===x.segments?"completion-bounce text-glow-red":""}`,children:[x.filled,"/",x.segments]})})]}),l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsxs("button",{onClick:()=>x.filled>0&&m(x.id,x.filled-1),disabled:x.filled===0,className:"px-3 py-1 bg-bg-primary border-2 border-accent-red text-accent-red hover:bg-accent-red hover:text-bg-primary disabled:opacity-30 disabled:cursor-not-allowed transition-all font-orbitron text-sm flex items-center gap-1",children:[l.jsx(bc,{className:"w-3 h-3"}),"-1"]}),l.jsxs("button",{onClick:()=>x.filled<x.segments&&m(x.id,x.filled+1),disabled:x.filled===x.segments,className:"px-3 py-1 bg-bg-primary border-2 border-accent-red text-accent-red hover:bg-accent-red hover:text-bg-primary disabled:opacity-30 disabled:cursor-not-allowed transition-all font-orbitron text-sm flex items-center gap-1",children:[l.jsx(VM,{className:"w-3 h-3"}),"+1"]})]}),v&&l.jsx("div",{className:"mt-3 border-3 border-accent-red bg-accent-red/10 p-3 inline-alert-pulse",children:l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx(ar,{className:"w-4 h-4 text-accent-red flex-shrink-0 mt-0.5"}),l.jsxs("div",{children:[l.jsx("h5",{className:"font-orbitron font-bold text-accent-red uppercase text-xs",children:"Danger Triggered!"}),l.jsx("p",{className:"text-text-primary text-xs mt-1",children:"The consequence occurs"})]})]})})]},x.id)})})]})}function zD(t,e,n,r,a){const i=Jw(t,e,n,a),c=Jw(t,e,n,r),u=a-r<=180?"0":"1";return["M",i.x,i.y,"A",n,n,0,u,0,c.x,c.y].join(" ")}function Jw(t,e,n,r){const a=(r-90)*Math.PI/180;return{x:t+n*Math.cos(a),y:e+n*Math.sin(a)}}const Qw={D4:l.jsx("svg",{viewBox:"0 0 24 24",className:"w-4 h-4 inline-block",fill:"currentColor",children:l.jsx("polygon",{points:"12,4 20,20 4,20",stroke:"currentColor",strokeWidth:"1.5",fill:"none"})}),D6:l.jsx("svg",{viewBox:"0 0 24 24",className:"w-4 h-4 inline-block",fill:"currentColor",children:l.jsx("rect",{x:"6",y:"6",width:"12",height:"12",stroke:"currentColor",strokeWidth:"1.5",fill:"none",rx:"1"})}),D8:l.jsx("svg",{viewBox:"0 0 24 24",className:"w-4 h-4 inline-block",fill:"currentColor",children:l.jsx("polygon",{points:"12,4 18,9 18,15 12,20 6,15 6,9",stroke:"currentColor",strokeWidth:"1.5",fill:"none"})}),D10:l.jsx("svg",{viewBox:"0 0 24 24",className:"w-4 h-4 inline-block",fill:"currentColor",children:l.jsx("polygon",{points:"8,12 12,4 16,12 12,20",stroke:"currentColor",strokeWidth:"1.5",fill:"none"})}),D12:l.jsx("svg",{viewBox:"0 0 24 24",className:"w-4 h-4 inline-block",fill:"currentColor",children:l.jsx("polygon",{points:"12,3 16,6 19,10 19,14 16,18 12,21 8,18 5,14 5,10 8,6",stroke:"currentColor",strokeWidth:"1.5",fill:"none"})}),D20:l.jsx("svg",{viewBox:"0 0 24 24",className:"w-4 h-4 inline-block",fill:"currentColor",children:l.jsx("circle",{cx:"12",cy:"12",r:"9",stroke:"currentColor",strokeWidth:"1.5",fill:"none"})}),D100:l.jsx("svg",{viewBox:"0 0 24 24",className:"w-4 h-4 inline-block",fill:"currentColor",children:l.jsx("rect",{x:"5",y:"8",width:"14",height:"8",stroke:"currentColor",strokeWidth:"1.5",fill:"none",rx:"1"})}),"2D6":l.jsxs("svg",{viewBox:"0 0 24 24",className:"w-4 h-4 inline-block",fill:"currentColor",children:[l.jsx("rect",{x:"4",y:"4",width:"8",height:"8",stroke:"currentColor",strokeWidth:"1.5",fill:"none",rx:"1"}),l.jsx("rect",{x:"12",y:"12",width:"8",height:"8",stroke:"currentColor",strokeWidth:"1.5",fill:"none",rx:"1"})]})},UD=({message:t,type:e})=>e==="roll"?l.jsx(HD,{message:t}):e==="oracle"?l.jsx(VD,{message:t}):l.jsx("span",{children:t}),HD=({message:t})=>{if(t.includes("(ADV)")||t.includes("(DIS)")){const n=t.match(/^(.*?)(\((?:ADV|DIS)\))(.*)$/);if(n){const[,r,a,i]=n,c=i.match(/^(.*= )(\d+)$/);if(c){const[,u,h]=c;return l.jsxs(l.Fragment,{children:[r,l.jsx("span",{className:"text-accent-yellow",children:a}),u,l.jsx("strong",{className:"text-glow-cyan",children:h})]})}return l.jsxs(l.Fragment,{children:[r,l.jsx("span",{className:"text-accent-yellow",children:a}),i]})}}const e=t.match(/^(.*: )(\d+)$/);if(e){const[,n,r]=e;return l.jsxs(l.Fragment,{children:[n,l.jsx("strong",{className:"text-glow-cyan",children:r})]})}return l.jsx("span",{children:t})},VD=({message:t})=>{if(t.includes(" | ")){const n=t.split(" | ");return l.jsx(l.Fragment,{children:n.map((r,a)=>l.jsxs("span",{children:[a>0&&l.jsx("span",{className:"text-accent-yellow/40",children:" | "}),a===0?r:l.jsx("span",{className:"text-accent-cyan",children:r})]},a))})}const e=t.match(/^(.*: )([^:]+)$/);if(e){const[,n,r]=e;return l.jsxs(l.Fragment,{children:[n,l.jsx("span",{className:"text-accent-cyan",children:r})]})}return l.jsx("span",{children:t})};function Xw(){const{gameState:t}=Ge(),e=E.useRef(null),[n,r]=E.useState(null);E.useEffect(()=>{if(e.current&&t.log.length>0){const u=e.current.parentElement;u&&requestAnimationFrame(()=>{u.scrollTop=u.scrollHeight})}},[t.log]),E.useEffect(()=>{if(t.log.length>0){const u=t.log[t.log.length-1];u.id!==n&&r(u.id)}},[t.log,n]);const a=u=>{switch(u){case"threat":return"text-accent-red";case"danger":return"text-accent-red font-bold";case"success":return"text-accent-cyan";case"mission":return"text-accent-yellow";case"roll":return"text-accent-cyan";case"oracle":return"text-accent-yellow";default:return"text-gray-400"}},i=(u,h)=>{if(u==="roll"&&h.includes("Rolled")){const p=h.match(/Rolled (D\d+|2D6)/);if(p&&Qw[p[1]])return Qw[p[1]]}switch(u){case"threat":return"";case"danger":return"";case"success":return"";case"mission":return"";case"oracle":return"";default:return""}},c=u=>new Date(u).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1});return l.jsx("div",{ref:e,className:"space-y-2 font-mono text-sm",children:t.log.length===0?l.jsx("div",{className:"h-full flex items-center justify-center",children:l.jsxs("div",{className:"text-center space-y-2",children:[l.jsxs("div",{className:"text-accent-cyan/20 text-3xl font-mono",children:["[ ]",l.jsx("br",{}),">","_"]}),l.jsx("p",{className:"text-gray-500 font-orbitron text-sm",children:"SHIP LOG EMPTY"}),l.jsx("p",{className:"text-gray-600 text-xs",children:"Activity will appear here"})]})}):t.log.slice().reverse().map((u,h)=>{const p=u.id===n&&h===0,m=h<t.log.length-1?t.log.slice().reverse()[h+1]:null,g=m&&m.type===u.type;return l.jsx("div",{className:`border-l-2 pl-3 py-1 hover:border-accent-cyan hover:bg-bg-secondary/30 transition-all duration-200 ${p?"log-entry-slide new-entry-pulse":"slide-up"} ${g?"border-accent-cyan/30":"border-accent-cyan/50 mt-1"}`,children:l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx("span",{className:`${a(u.type)} mt-0.5 flex-shrink-0`,children:i(u.type,u.message)}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("span",{className:`text-xs mr-2 ${u.type==="threat"||u.type==="danger"?"text-accent-red/60":u.type==="success"?"text-accent-cyan/60":u.type==="mission"||u.type==="oracle"?"text-accent-yellow/60":"text-accent-cyan/60"}`,children:c(u.timestamp)}),l.jsx("span",{className:a(u.type),children:l.jsx(UD,{message:u.message,type:u.type})})]})]})},`${u.id}-${h}`)})})}var vm={exports:{}},wm={};var Zw;function FD(){if(Zw)return wm;Zw=1;var t=yc();function e(g,x){return g===x&&(g!==0||1/g===1/x)||g!==g&&x!==x}var n=typeof Object.is=="function"?Object.is:e,r=t.useState,a=t.useEffect,i=t.useLayoutEffect,c=t.useDebugValue;function u(g,x){var v=x(),w=r({inst:{value:v,getSnapshot:x}}),N=w[0].inst,S=w[1];return i(function(){N.value=v,N.getSnapshot=x,h(N)&&S({inst:N})},[g,v,x]),a(function(){return h(N)&&S({inst:N}),g(function(){h(N)&&S({inst:N})})},[g]),c(v),v}function h(g){var x=g.getSnapshot;g=g.value;try{var v=x();return!n(g,v)}catch{return!0}}function p(g,x){return x()}var m=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?p:u;return wm.useSyncExternalStore=t.useSyncExternalStore!==void 0?t.useSyncExternalStore:m,wm}var e1;function lk(){return e1||(e1=1,vm.exports=FD()),vm.exports}var ck=lk();function Zt(t){this.content=t}Zt.prototype={constructor:Zt,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,a=r.find(t),i=r.content.slice();return a==-1?i.push(n||t,e):(i[a+1]=e,n&&(i[a]=n)),new Zt(i)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new Zt(n)},addToStart:function(t,e){return new Zt([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new Zt(n)},addBefore:function(t,e,n){var r=this.remove(e),a=r.content.slice(),i=r.find(t);return a.splice(i==-1?a.length:i,0,e,n),new Zt(a)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=Zt.from(t),t.size?new Zt(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=Zt.from(t),t.size?new Zt(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=Zt.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};Zt.from=function(t){if(t instanceof Zt)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new Zt(e)};function dk(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let a=t.child(r),i=e.child(r);if(a==i){n+=a.nodeSize;continue}if(!a.sameMarkup(i))return n;if(a.isText&&a.text!=i.text){for(let c=0;a.text[c]==i.text[c];c++)n++;return n}if(a.content.size||i.content.size){let c=dk(a.content,i.content,n+1);if(c!=null)return c}n+=a.nodeSize}}function uk(t,e,n,r){for(let a=t.childCount,i=e.childCount;;){if(a==0||i==0)return a==i?null:{a:n,b:r};let c=t.child(--a),u=e.child(--i),h=c.nodeSize;if(c==u){n-=h,r-=h;continue}if(!c.sameMarkup(u))return{a:n,b:r};if(c.isText&&c.text!=u.text){let p=0,m=Math.min(c.text.length,u.text.length);for(;p<m&&c.text[c.text.length-p-1]==u.text[u.text.length-p-1];)p++,n--,r--;return{a:n,b:r}}if(c.content.size||u.content.size){let p=uk(c.content,u.content,n-1,r-1);if(p)return p}n-=h,r-=h}}class le{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,a=0,i){for(let c=0,u=0;u<n;c++){let h=this.content[c],p=u+h.nodeSize;if(p>e&&r(h,a+u,i||null,c)!==!1&&h.content.size){let m=u+1;h.nodesBetween(Math.max(0,e-m),Math.min(h.content.size,n-m),r,a+m)}u=p}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,a){let i="",c=!0;return this.nodesBetween(e,n,(u,h)=>{let p=u.isText?u.text.slice(Math.max(e,h)-h,n-h):u.isLeaf?a?typeof a=="function"?a(u):a:u.type.spec.leafText?u.type.spec.leafText(u):"":"";u.isBlock&&(u.isLeaf&&p||u.isTextblock)&&r&&(c?c=!1:i+=r),i+=p},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,a=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(a[a.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)a.push(e.content[i]);return new le(a,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],a=0;if(n>e)for(let i=0,c=0;c<n;i++){let u=this.content[i],h=c+u.nodeSize;h>e&&((c<e||h>n)&&(u.isText?u=u.cut(Math.max(0,e-c),Math.min(u.text.length,n-c)):u=u.cut(Math.max(0,e-c-1),Math.min(u.content.size,n-c-1))),r.push(u),a+=u.nodeSize),c=h}return new le(r,a)}cutByIndex(e,n){return e==n?le.empty:e==0&&n==this.content.length?this:new le(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let a=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return a[e]=n,new le(a,i)}addToStart(e){return new le([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new le(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let a=this.content[n];e(a,r,n),r+=a.nodeSize}}findDiffStart(e,n=0){return dk(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return uk(this,e,n,r)}findIndex(e){if(e==0)return Zd(0,e);if(e==this.size)return Zd(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let a=this.child(n),i=r+a.nodeSize;if(i>=e)return i==e?Zd(n+1,i):Zd(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return le.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new le(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return le.empty;let n,r=0;for(let a=0;a<e.length;a++){let i=e[a];r+=i.nodeSize,a&&i.isText&&e[a-1].sameMarkup(i)?(n||(n=e.slice(0,a)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new le(n||e,r)}static from(e){if(!e)return le.empty;if(e instanceof le)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new le([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}le.empty=new le([],0);const Sm={index:0,offset:0};function Zd(t,e){return Sm.index=t,Sm.offset=e,Sm}function ju(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!ju(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!ju(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let st=class yg{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let a=0;a<e.length;a++){let i=e[a];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,a));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,a)),n.push(this),r=!0),n&&n.push(i)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&ju(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let a=r.create(n.attrs);return r.checkAttrs(a.attrs),a}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return yg.none;if(e instanceof yg)return[e];let n=e.slice();return n.sort((r,a)=>r.type.rank-a.type.rank),n}};st.none=[];class Cu extends Error{}class pe{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=fk(this.content,e+this.openStart,n);return r&&new pe(r,this.openStart,this.openEnd)}removeBetween(e,n){return new pe(hk(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return pe.empty;let r=n.openStart||0,a=n.openEnd||0;if(typeof r!="number"||typeof a!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new pe(le.fromJSON(e,n.content),r,a)}static maxOpen(e,n=!0){let r=0,a=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)a++;return new pe(e,r,a)}}pe.empty=new pe(le.empty,0,0);function hk(t,e,n){let{index:r,offset:a}=t.findIndex(e),i=t.maybeChild(r),{index:c,offset:u}=t.findIndex(n);if(a==e||i.isText){if(u!=n&&!t.child(c).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=c)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(hk(i.content,e-a-1,n-a-1)))}function fk(t,e,n,r){let{index:a,offset:i}=t.findIndex(e),c=t.maybeChild(a);if(i==e||c.isText)return r&&!r.canReplace(a,a,n)?null:t.cut(0,e).append(n).append(t.cut(e));let u=fk(c.content,e-i-1,n,c);return u&&t.replaceChild(a,c.copy(u))}function GD(t,e,n){if(n.openStart>t.depth)throw new Cu("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Cu("Inconsistent open depths");return pk(t,e,n,0)}function pk(t,e,n,r){let a=t.index(r),i=t.node(r);if(a==e.index(r)&&r<t.depth-n.openStart){let c=pk(t,e,n,r+1);return i.copy(i.content.replaceChild(a,c))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let c=t.parent,u=c.content;return Ia(c,u.cut(0,t.parentOffset).append(n.content).append(u.cut(e.parentOffset)))}else{let{start:c,end:u}=qD(n,t);return Ia(i,gk(t,c,u,e,r))}else return Ia(i,Tu(t,e,r))}function mk(t,e){if(!e.type.compatibleContent(t.type))throw new Cu("Cannot join "+e.type.name+" onto "+t.type.name)}function xg(t,e,n){let r=t.node(n);return mk(r,e.node(n)),r}function Ba(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Il(t,e,n,r){let a=(e||t).node(n),i=0,c=e?e.index(n):a.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(Ba(t.nodeAfter,r),i++));for(let u=i;u<c;u++)Ba(a.child(u),r);e&&e.depth==n&&e.textOffset&&Ba(e.nodeBefore,r)}function Ia(t,e){return t.type.checkContent(e),t.copy(e)}function gk(t,e,n,r,a){let i=t.depth>a&&xg(t,e,a+1),c=r.depth>a&&xg(n,r,a+1),u=[];return Il(null,t,a,u),i&&c&&e.index(a)==n.index(a)?(mk(i,c),Ba(Ia(i,gk(t,e,n,r,a+1)),u)):(i&&Ba(Ia(i,Tu(t,e,a+1)),u),Il(e,n,a,u),c&&Ba(Ia(c,Tu(n,r,a+1)),u)),Il(r,null,a,u),new le(u)}function Tu(t,e,n){let r=[];if(Il(null,t,n,r),t.depth>n){let a=xg(t,e,n+1);Ba(Ia(a,Tu(t,e,n+1)),r)}return Il(e,null,n,r),new le(r)}function qD(t,e){let n=e.depth-t.openStart,a=e.node(n).copy(t.content);for(let i=n-1;i>=0;i--)a=e.node(i).copy(le.from(a));return{start:a.resolveNoCache(t.openStart+n),end:a.resolveNoCache(a.content.size-t.openEnd-n)}}class oc{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],a=e.child(n);return r?e.child(n).cut(r):a}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],a=n==0?0:this.path[n*3-1]+1;for(let i=0;i<e;i++)a+=r.child(i).nodeSize;return a}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return st.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),a=e.maybeChild(n);if(!r){let u=r;r=a,a=u}let i=r.marks;for(var c=0;c<i.length;c++)i[c].type.spec.inclusive===!1&&(!a||!i[c].isInSet(a.marks))&&(i=i[c--].removeFromSet(i));return i}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,a=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!a||!r[i].isInSet(a.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new Eu(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],a=0,i=n;for(let c=e;;){let{index:u,offset:h}=c.content.findIndex(i),p=i-h;if(r.push(c,u,a+h),!p||(c=c.child(u),c.isText))break;i=p-1,a+=h+1}return new oc(n,r,i)}static resolveCached(e,n){let r=t1.get(e);if(r)for(let i=0;i<r.elts.length;i++){let c=r.elts[i];if(c.pos==n)return c}else t1.set(e,r=new WD);let a=r.elts[r.i]=oc.resolve(e,n);return r.i=(r.i+1)%KD,a}}class WD{constructor(){this.elts=[],this.i=0}}const KD=12,t1=new WeakMap;class Eu{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const YD=Object.create(null);class yr{constructor(e,n,r,a=st.none){this.type=e,this.attrs=n,this.marks=a,this.content=r||le.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,a=0){this.content.nodesBetween(e,n,r,a,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,a){return this.content.textBetween(e,n,r,a)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&ju(this.attrs,n||e.defaultAttrs||YD)&&st.sameSet(this.marks,r||st.none)}copy(e=null){return e==this.content?this:new yr(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new yr(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return pe.empty;let a=this.resolve(e),i=this.resolve(n),c=r?0:a.sharedDepth(n),u=a.start(c),p=a.node(c).content.cut(a.pos-u,i.pos-u);return new pe(p,a.depth-c,i.depth-c)}replace(e,n,r){return GD(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:a}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(a==e||n.isText)return n;e-=a+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let a=this.content.child(n-1);return{node:a,index:n-1,offset:r-a.nodeSize}}resolve(e){return oc.resolveCached(this,e)}resolveNoCache(e){return oc.resolve(this,e)}rangeHasMark(e,n,r){let a=!1;return n>e&&this.nodesBetween(e,n,i=>(r.isInSet(i.marks)&&(a=!0),!a)),a}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),yk(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=le.empty,a=0,i=r.childCount){let c=this.contentMatchAt(e).matchFragment(r,a,i),u=c&&c.matchFragment(this.content,n);if(!u||!u.validEnd)return!1;for(let h=a;h<i;h++)if(!this.type.allowsMarks(r.child(h).marks))return!1;return!0}canReplaceWith(e,n,r,a){if(a&&!this.type.allowsMarks(a))return!1;let i=this.contentMatchAt(e).matchType(r),c=i&&i.matchFragment(this.content,n);return c?c.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=st.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!st.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let a=le.fromJSON(e,n.content),i=e.nodeType(n.type).create(n.attrs,a,r);return i.type.checkAttrs(i.attrs),i}}yr.prototype.text=void 0;class Ru extends yr{constructor(e,n,r,a){if(super(e,n,null,a),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):yk(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Ru(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Ru(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function yk(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class Fa{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new JD(e,n);if(r.next==null)return Fa.empty;let a=xk(r);r.next&&r.err("Unexpected trailing text");let i=r3(n3(a));return s3(i,r),i}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let a=this;for(let i=n;a&&i<r;i++)a=a.matchType(e.child(i).type);return a}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let a=[this];function i(c,u){let h=c.matchFragment(e,r);if(h&&(!n||h.validEnd))return le.from(u.map(p=>p.createAndFill()));for(let p=0;p<c.next.length;p++){let{type:m,next:g}=c.next[p];if(!(m.isText||m.hasRequiredAttrs())&&a.indexOf(g)==-1){a.push(g);let x=i(g,u.concat(m));if(x)return x}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let a=r.shift(),i=a.match;if(i.matchType(e)){let c=[];for(let u=a;u.type;u=u.via)c.push(u.type);return c.reverse()}for(let c=0;c<i.next.length;c++){let{type:u,next:h}=i.next[c];!u.isLeaf&&!u.hasRequiredAttrs()&&!(u.name in n)&&(!a.type||h.validEnd)&&(r.push({match:u.contentMatch,type:u,via:a}),n[u.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let a=0;a<r.next.length;a++)e.indexOf(r.next[a].next)==-1&&n(r.next[a].next)}return n(this),e.map((r,a)=>{let i=a+(r.validEnd?"*":" ")+" ";for(let c=0;c<r.next.length;c++)i+=(c?", ":"")+r.next[c].type.name+"->"+e.indexOf(r.next[c].next);return i}).join(`
`)}}Fa.empty=new Fa(!0);class JD{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function xk(t){let e=[];do e.push(QD(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function QD(t){let e=[];do e.push(XD(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function XD(t){let e=t3(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=ZD(t,e);else break;return e}function n1(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function ZD(t,e){let n=n1(t),r=n;return t.eat(",")&&(t.next!="}"?r=n1(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function e3(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let a=[];for(let i in n){let c=n[i];c.isInGroup(e)&&a.push(c)}return a.length==0&&t.err("No node type or group '"+e+"' found"),a}function t3(t){if(t.eat("(")){let e=xk(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=e3(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function n3(t){let e=[[]];return a(i(t,0),n()),e;function n(){return e.push([])-1}function r(c,u,h){let p={term:h,to:u};return e[c].push(p),p}function a(c,u){c.forEach(h=>h.to=u)}function i(c,u){if(c.type=="choice")return c.exprs.reduce((h,p)=>h.concat(i(p,u)),[]);if(c.type=="seq")for(let h=0;;h++){let p=i(c.exprs[h],u);if(h==c.exprs.length-1)return p;a(p,u=n())}else if(c.type=="star"){let h=n();return r(u,h),a(i(c.expr,h),h),[r(h)]}else if(c.type=="plus"){let h=n();return a(i(c.expr,u),h),a(i(c.expr,h),h),[r(h)]}else{if(c.type=="opt")return[r(u)].concat(i(c.expr,u));if(c.type=="range"){let h=u;for(let p=0;p<c.min;p++){let m=n();a(i(c.expr,h),m),h=m}if(c.max==-1)a(i(c.expr,h),h);else for(let p=c.min;p<c.max;p++){let m=n();r(h,m),a(i(c.expr,h),m),h=m}return[r(h)]}else{if(c.type=="name")return[r(u,void 0,c.value)];throw new Error("Unknown expr type")}}}}function bk(t,e){return e-t}function r1(t,e){let n=[];return r(e),n.sort(bk);function r(a){let i=t[a];if(i.length==1&&!i[0].term)return r(i[0].to);n.push(a);for(let c=0;c<i.length;c++){let{term:u,to:h}=i[c];!u&&n.indexOf(h)==-1&&r(h)}}}function r3(t){let e=Object.create(null);return n(r1(t,0));function n(r){let a=[];r.forEach(c=>{t[c].forEach(({term:u,to:h})=>{if(!u)return;let p;for(let m=0;m<a.length;m++)a[m][0]==u&&(p=a[m][1]);r1(t,h).forEach(m=>{p||a.push([u,p=[]]),p.indexOf(m)==-1&&p.push(m)})})});let i=e[r.join(",")]=new Fa(r.indexOf(t.length-1)>-1);for(let c=0;c<a.length;c++){let u=a[c][1].sort(bk);i.next.push({type:a[c][0],next:e[u.join(",")]||n(u)})}return i}}function s3(t,e){for(let n=0,r=[t];n<r.length;n++){let a=r[n],i=!a.validEnd,c=[];for(let u=0;u<a.next.length;u++){let{type:h,next:p}=a.next[u];c.push(h.name),i&&!(h.isText||h.hasRequiredAttrs())&&(i=!1),r.indexOf(p)==-1&&r.push(p)}i&&e.err("Only non-generatable nodes ("+c.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function vk(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function wk(t,e){let n=Object.create(null);for(let r in t){let a=e&&e[r];if(a===void 0){let i=t[r];if(i.hasDefault)a=i.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=a}return n}function Sk(t,e,n,r){for(let a in e)if(!(a in t))throw new RangeError(`Unsupported attribute ${a} for ${n} of type ${a}`);for(let a in t){let i=t[a];i.validate&&i.validate(e[a])}}function Nk(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new i3(t,r,e[r]);return n}let s1=class kk{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=Nk(e,r.attrs),this.defaultAttrs=vk(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Fa.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:wk(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new yr(this,this.computeAttrs(e),le.from(n),st.setFrom(r))}createChecked(e=null,n,r){return n=le.from(n),this.checkContent(n),new yr(this,this.computeAttrs(e),n,st.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=le.from(n),n.size){let c=this.contentMatch.fillBefore(n);if(!c)return null;n=c.append(n)}let a=this.contentMatch.matchFragment(n),i=a&&a.fillBefore(le.empty,!0);return i?new yr(this,e,n.append(i),st.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Sk(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:st.none:e}static compile(e,n){let r=Object.create(null);e.forEach((i,c)=>r[i]=new kk(i,n,c));let a=n.spec.topNode||"doc";if(!r[a])throw new RangeError("Schema is missing its top node type ('"+a+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function a3(t,e,n){let r=n.split("|");return a=>{let i=a===null?"null":typeof a;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${i}`)}}class i3{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?a3(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class bh{constructor(e,n,r,a){this.name=e,this.rank=n,this.schema=r,this.spec=a,this.attrs=Nk(e,a.attrs),this.excluded=null;let i=vk(this.attrs);this.instance=i?new st(this,i):null}create(e=null){return!e&&this.instance?this.instance:new st(this,wk(this.attrs,e))}static compile(e,n){let r=Object.create(null),a=0;return e.forEach((i,c)=>r[i]=new bh(i,a++,n,c)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){Sk(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class jk{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let a in e)n[a]=e[a];n.nodes=Zt.from(e.nodes),n.marks=Zt.from(e.marks||{}),this.nodes=s1.compile(this.spec.nodes,this),this.marks=bh.compile(this.spec.marks,this);let r=Object.create(null);for(let a in this.nodes){if(a in this.marks)throw new RangeError(a+" can not be both a node and a mark");let i=this.nodes[a],c=i.spec.content||"",u=i.spec.marks;if(i.contentMatch=r[c]||(r[c]=Fa.parse(c,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=u=="_"?null:u?a1(this,u.split(" ")):u==""||!i.inlineContent?[]:null}for(let a in this.marks){let i=this.marks[a],c=i.spec.excludes;i.excluded=c==null?[i]:c==""?[]:a1(this,c.split(" "))}this.nodeFromJSON=a=>yr.fromJSON(this,a),this.markFromJSON=a=>st.fromJSON(this,a),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,a){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof s1){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,a)}text(e,n){let r=this.nodes.text;return new Ru(r,r.defaultAttrs,e,st.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function a1(t,e){let n=[];for(let r=0;r<e.length;r++){let a=e[r],i=t.marks[a],c=i;if(i)n.push(i);else for(let u in t.marks){let h=t.marks[u];(a=="_"||h.spec.group&&h.spec.group.split(" ").indexOf(a)>-1)&&n.push(c=h)}if(!c)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function o3(t){return t.tag!=null}function l3(t){return t.style!=null}class Ys{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(a=>{if(o3(a))this.tags.push(a);else if(l3(a)){let i=/[^=]*/.exec(a.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(a)}}),this.normalizeLists=!this.tags.some(a=>{if(!/^(ul|ol)\b/.test(a.tag)||!a.node)return!1;let i=e.nodes[a.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new o1(this,n,!1);return r.addAll(e,st.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new o1(this,n,!0);return r.addAll(e,st.none,n.from,n.to),pe.maxOpen(r.finish())}matchTag(e,n,r){for(let a=r?this.tags.indexOf(r)+1:0;a<this.tags.length;a++){let i=this.tags[a];if(u3(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let c=i.getAttrs(e);if(c===!1)continue;i.attrs=c||void 0}return i}}}matchStyle(e,n,r,a){for(let i=a?this.styles.indexOf(a)+1:0;i<this.styles.length;i++){let c=this.styles[i],u=c.style;if(!(u.indexOf(e)!=0||c.context&&!r.matchesContext(c.context)||u.length>e.length&&(u.charCodeAt(e.length)!=61||u.slice(e.length+1)!=n))){if(c.getAttrs){let h=c.getAttrs(n);if(h===!1)continue;c.attrs=h||void 0}return c}}}static schemaRules(e){let n=[];function r(a){let i=a.priority==null?50:a.priority,c=0;for(;c<n.length;c++){let u=n[c];if((u.priority==null?50:u.priority)<i)break}n.splice(c,0,a)}for(let a in e.marks){let i=e.marks[a].spec.parseDOM;i&&i.forEach(c=>{r(c=l1(c)),c.mark||c.ignore||c.clearMark||(c.mark=a)})}for(let a in e.nodes){let i=e.nodes[a].spec.parseDOM;i&&i.forEach(c=>{r(c=l1(c)),c.node||c.ignore||c.mark||(c.node=a)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new Ys(e,Ys.schemaRules(e)))}}const Ck={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},c3={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Tk={ol:!0,ul:!0},lc=1,bg=2,Pl=4;function i1(t,e,n){return e!=null?(e?lc:0)|(e==="full"?bg:0):t&&t.whitespace=="pre"?lc|bg:n&~Pl}class eu{constructor(e,n,r,a,i,c){this.type=e,this.attrs=n,this.marks=r,this.solid=a,this.options=c,this.content=[],this.activeMarks=st.none,this.match=i||(c&Pl?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(le.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,a;return(a=r.findWrapping(e.type))?(this.match=r,a):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&lc)){let r=this.content[this.content.length-1],a;if(r&&r.isText&&(a=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==a[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-a[0].length))}}let n=le.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(le.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Ck.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class o1{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let a=n.topNode,i,c=i1(null,n.preserveWhitespace,0)|(r?Pl:0);a?i=new eu(a.type,a.attrs,st.none,!0,n.topMatch||a.type.contentMatch,c):r?i=new eu(null,null,st.none,!0,null,c):i=new eu(e.schema.topNodeType,null,st.none,!0,null,c),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,a=this.top,i=a.options&bg?"full":this.localPreserveWS||(a.options&lc)>0,{schema:c}=this.parser;if(i==="full"||a.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(c.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(c.linebreakReplacement.create())){let u=r.split(/\r?\n|\r/);for(let h=0;h<u.length;h++)h&&this.insertNode(c.linebreakReplacement.create(),n,!0),u[h]&&this.insertNode(c.text(u[h]),n,!/\S/.test(u[h]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let u=a.content[a.content.length-1],h=e.previousSibling;(!u||h&&h.nodeName=="BR"||u.isText&&/[ \t\r\n\u000c]$/.test(u.text))&&(r=r.slice(1))}r&&this.insertNode(c.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let a=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let c=e.nodeName.toLowerCase(),u;Tk.hasOwnProperty(c)&&this.parser.normalizeLists&&d3(e);let h=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(u=this.parser.matchTag(e,this,r));e:if(h?h.ignore:c3.hasOwnProperty(c))this.findInside(e),this.ignoreFallback(e,n);else if(!h||h.skip||h.closeParent){h&&h.closeParent?this.open=Math.max(0,this.open-1):h&&h.skip.nodeType&&(e=h.skip);let p,m=this.needsBlock;if(Ck.hasOwnProperty(c))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),p=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let g=h&&h.skip?n:this.readStyles(e,n);g&&this.addAll(e,g),p&&this.sync(i),this.needsBlock=m}else{let p=this.readStyles(e,n);p&&this.addElementByRule(e,h,p,h.consuming===!1?u:void 0)}this.localPreserveWS=a}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let a=0;a<this.parser.matchedStyles.length;a++){let i=this.parser.matchedStyles[a],c=r.getPropertyValue(i);if(c)for(let u=void 0;;){let h=this.parser.matchStyle(i,c,this,u);if(!h)break;if(h.ignore)return null;if(h.clearMark?n=n.filter(p=>!h.clearMark(p)):n=n.concat(this.parser.schema.marks[h.mark].create(h.attrs)),h.consuming===!1)u=h;else break}}return n}addElementByRule(e,n,r,a){let i,c;if(n.node)if(c=this.parser.schema.nodes[n.node],c.isLeaf)this.insertNode(c.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let h=this.enter(c,n.attrs||null,r,n.preserveWhitespace);h&&(i=!0,r=h)}else{let h=this.parser.schema.marks[n.mark];r=r.concat(h.create(n.attrs))}let u=this.top;if(c&&c.isLeaf)this.findInside(e);else if(a)this.addElement(e,r,a);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(h=>this.insertNode(h,r,!1));else{let h=e;typeof n.contentElement=="string"?h=e.querySelector(n.contentElement):typeof n.contentElement=="function"?h=n.contentElement(e):n.contentElement&&(h=n.contentElement),this.findAround(e,h,!0),this.addAll(h,r),this.findAround(e,h,!1)}i&&this.sync(u)&&this.open--}addAll(e,n,r,a){let i=r||0;for(let c=r?e.childNodes[r]:e.firstChild,u=a==null?null:e.childNodes[a];c!=u;c=c.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(c,n);this.findAtPoint(e,i)}findPlace(e,n,r){let a,i;for(let c=this.open,u=0;c>=0;c--){let h=this.nodes[c],p=h.findWrapping(e);if(p&&(!a||a.length>p.length+u)&&(a=p,i=h,!p.length))break;if(h.solid){if(r)break;u+=2}}if(!a)return null;this.sync(i);for(let c=0;c<a.length;c++)n=this.enterInner(a[c],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let a=this.findPlace(e,n,r);if(a){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let c=st.none;for(let u of a.concat(e.marks))(i.type?i.type.allowsMarkType(u.type):c1(u.type,e.type))&&(c=u.addToSet(c));return i.content.push(e.mark(c)),!0}return!1}enter(e,n,r,a){let i=this.findPlace(e.create(n),r,!1);return i&&(i=this.enterInner(e,n,r,!0,a)),i}enterInner(e,n,r,a=!1,i){this.closeExtra();let c=this.top;c.match=c.match&&c.match.matchType(e);let u=i1(e,i,c.options);c.options&Pl&&c.content.length==0&&(u|=Pl);let h=st.none;return r=r.filter(p=>(c.type?c.type.allowsMarkType(p.type):c1(p.type,e))?(h=p.addToSet(h),!1):!0),this.nodes.push(new eu(e,n,h,a,null,u)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=lc)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let a=r.length-1;a>=0;a--)e+=r[a].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let a=0;a<this.find.length;a++)this.find[a].pos==null&&e.nodeType==1&&e.contains(this.find[a].node)&&n.compareDocumentPosition(this.find[a].node)&(r?2:4)&&(this.find[a].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,a=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(a?0:1),c=(u,h)=>{for(;u>=0;u--){let p=n[u];if(p==""){if(u==n.length-1||u==0)continue;for(;h>=i;h--)if(c(u-1,h))return!0;return!1}else{let m=h>0||h==0&&a?this.nodes[h].type:r&&h>=i?r.node(h-i).type:null;if(!m||m.name!=p&&!m.isInGroup(p))return!1;h--}}return!0};return c(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function d3(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&Tk.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function u3(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function l1(t){let e={};for(let n in t)e[n]=t[n];return e}function c1(t,e){let n=e.schema.nodes;for(let r in n){let a=n[r];if(!a.allowsMarkType(t))continue;let i=[],c=u=>{i.push(u);for(let h=0;h<u.edgeCount;h++){let{type:p,next:m}=u.edge(h);if(p==e||i.indexOf(m)<0&&c(m))return!0}};if(c(a.contentMatch))return!0}}class Xa{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=Nm(n).createDocumentFragment());let a=r,i=[];return e.forEach(c=>{if(i.length||c.marks.length){let u=0,h=0;for(;u<i.length&&h<c.marks.length;){let p=c.marks[h];if(!this.marks[p.type.name]){h++;continue}if(!p.eq(i[u][0])||p.type.spec.spanning===!1)break;u++,h++}for(;u<i.length;)a=i.pop()[1];for(;h<c.marks.length;){let p=c.marks[h++],m=this.serializeMark(p,c.isInline,n);m&&(i.push([p,a]),a.appendChild(m.dom),a=m.contentDOM||m.dom)}}a.appendChild(this.serializeNodeInner(c,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:a}=fu(Nm(n),this.nodes[e.type.name](e),null,e.attrs);if(a){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,a)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let a=e.marks.length-1;a>=0;a--){let i=this.serializeMark(e.marks[a],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,n,r={}){let a=this.marks[e.type.name];return a&&fu(Nm(r),a(e,n),null,e.attrs)}static renderSpec(e,n,r=null,a){return fu(e,n,r,a)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new Xa(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=d1(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return d1(e.marks)}}function d1(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Nm(t){return t.document||window.document}const u1=new WeakMap;function h3(t){let e=u1.get(t);return e===void 0&&u1.set(t,e=f3(t)),e}function f3(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let a=0;a<r.length;a++)n(r[a]);else for(let a in r)n(r[a])}return n(t),e}function fu(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let a=e[0],i;if(typeof a!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=h3(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let c=a.indexOf(" ");c>0&&(n=a.slice(0,c),a=a.slice(c+1));let u,h=n?t.createElementNS(n,a):t.createElement(a),p=e[1],m=1;if(p&&typeof p=="object"&&p.nodeType==null&&!Array.isArray(p)){m=2;for(let g in p)if(p[g]!=null){let x=g.indexOf(" ");x>0?h.setAttributeNS(g.slice(0,x),g.slice(x+1),p[g]):g=="style"&&h.style?h.style.cssText=p[g]:h.setAttribute(g,p[g])}}for(let g=m;g<e.length;g++){let x=e[g];if(x===0){if(g<e.length-1||g>m)throw new RangeError("Content hole must be the only child of its parent node");return{dom:h,contentDOM:h}}else{let{dom:v,contentDOM:w}=fu(t,x,n,r);if(h.appendChild(v),w){if(u)throw new RangeError("Multiple content holes");u=w}}}return{dom:h,contentDOM:u}}const Ek=65535,Rk=Math.pow(2,16);function p3(t,e){return t+e*Rk}function h1(t){return t&Ek}function m3(t){return(t-(t&Ek))/Rk}const Ak=1,_k=2,pu=4,Mk=8;class vg{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&Mk)>0}get deletedBefore(){return(this.delInfo&(Ak|pu))>0}get deletedAfter(){return(this.delInfo&(_k|pu))>0}get deletedAcross(){return(this.delInfo&pu)>0}}class Bn{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&Bn.empty)return Bn.empty}recover(e){let n=0,r=h1(e);if(!this.inverted)for(let a=0;a<r;a++)n+=this.ranges[a*3+2]-this.ranges[a*3+1];return this.ranges[r*3]+n+m3(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let a=0,i=this.inverted?2:1,c=this.inverted?1:2;for(let u=0;u<this.ranges.length;u+=3){let h=this.ranges[u]-(this.inverted?a:0);if(h>e)break;let p=this.ranges[u+i],m=this.ranges[u+c],g=h+p;if(e<=g){let x=p?e==h?-1:e==g?1:n:n,v=h+a+(x<0?0:m);if(r)return v;let w=e==(n<0?h:g)?null:p3(u/3,e-h),N=e==h?_k:e==g?Ak:pu;return(n<0?e!=h:e!=g)&&(N|=Mk),new vg(v,N,w)}a+=m-p}return r?e+a:new vg(e+a,0,null)}touches(e,n){let r=0,a=h1(n),i=this.inverted?2:1,c=this.inverted?1:2;for(let u=0;u<this.ranges.length;u+=3){let h=this.ranges[u]-(this.inverted?r:0);if(h>e)break;let p=this.ranges[u+i],m=h+p;if(e<=m&&u==a*3)return!0;r+=this.ranges[u+c]-p}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let a=0,i=0;a<this.ranges.length;a+=3){let c=this.ranges[a],u=c-(this.inverted?i:0),h=c+(this.inverted?0:i),p=this.ranges[a+n],m=this.ranges[a+r];e(u,u+p,h,h+m),i+=m-p}}invert(){return new Bn(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?Bn.empty:new Bn(e<0?[0,-e,0]:[0,0,e])}}Bn.empty=new Bn([]);class cc{constructor(e,n,r=0,a=e?e.length:0){this.mirror=n,this.from=r,this.to=a,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new cc(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let a=e.getMirror(n);this.appendMap(e._maps[n],a!=null&&a<n?r+a:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let a=e.getMirror(n);this.appendMap(e._maps[n].invert(),a!=null&&a>n?r-a-1:void 0)}}invert(){let e=new cc;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let a=0;for(let i=this.from;i<this.to;i++){let c=this._maps[i],u=c.mapResult(e,n);if(u.recover!=null){let h=this.getMirror(i);if(h!=null&&h>i&&h<this.to){i=h,e=this._maps[h].recover(u.recover);continue}}a|=u.delInfo,e=u.pos}return r?e:new vg(e,a,null)}}const km=Object.create(null);class cn{getMap(){return Bn.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=km[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in km)throw new RangeError("Duplicate use of step JSON ID "+e);return km[e]=n,n.prototype.jsonID=e,n}}class Mt{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new Mt(e,null)}static fail(e){return new Mt(null,e)}static fromReplace(e,n,r,a){try{return Mt.ok(e.replace(n,r,a))}catch(i){if(i instanceof Cu)return Mt.fail(i.message);throw i}}}function sy(t,e,n){let r=[];for(let a=0;a<t.childCount;a++){let i=t.child(a);i.content.size&&(i=i.copy(sy(i.content,e,i))),i.isInline&&(i=e(i,n,a)),r.push(i)}return le.fromArray(r)}class Gs extends cn{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),a=r.node(r.sharedDepth(this.to)),i=new pe(sy(n.content,(c,u)=>!c.isAtom||!u.type.allowsMarkType(this.mark.type)?c:c.mark(this.mark.addToSet(c.marks)),a),n.openStart,n.openEnd);return Mt.fromReplace(e,this.from,this.to,i)}invert(){return new gr(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Gs(n.pos,r.pos,this.mark)}merge(e){return e instanceof Gs&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Gs(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Gs(n.from,n.to,e.markFromJSON(n.mark))}}cn.jsonID("addMark",Gs);class gr extends cn{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new pe(sy(n.content,a=>a.mark(this.mark.removeFromSet(a.marks)),e),n.openStart,n.openEnd);return Mt.fromReplace(e,this.from,this.to,r)}invert(){return new Gs(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new gr(n.pos,r.pos,this.mark)}merge(e){return e instanceof gr&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new gr(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new gr(n.from,n.to,e.markFromJSON(n.mark))}}cn.jsonID("removeMark",gr);class qs extends cn{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Mt.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return Mt.fromReplace(e,this.pos,this.pos+1,new pe(le.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let a=0;a<n.marks.length;a++)if(!n.marks[a].isInSet(r))return new qs(this.pos,n.marks[a]);return new qs(this.pos,this.mark)}}return new Ga(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new qs(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new qs(n.pos,e.markFromJSON(n.mark))}}cn.jsonID("addNodeMark",qs);class Ga extends cn{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Mt.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return Mt.fromReplace(e,this.pos,this.pos+1,new pe(le.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new qs(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Ga(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Ga(n.pos,e.markFromJSON(n.mark))}}cn.jsonID("removeNodeMark",Ga);class Ht extends cn{constructor(e,n,r,a=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=a}apply(e){return this.structure&&wg(e,this.from,this.to)?Mt.fail("Structure replace would overwrite content"):Mt.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Bn([this.from,this.to-this.from,this.slice.size])}invert(e){return new Ht(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new Ht(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof Ht)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?pe.empty:new pe(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new Ht(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?pe.empty:new pe(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new Ht(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new Ht(n.from,n.to,pe.fromJSON(e,n.slice),!!n.structure)}}cn.jsonID("replace",Ht);class Ft extends cn{constructor(e,n,r,a,i,c,u=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=a,this.slice=i,this.insert=c,this.structure=u}apply(e){if(this.structure&&(wg(e,this.from,this.gapFrom)||wg(e,this.gapTo,this.to)))return Mt.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return Mt.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?Mt.fromReplace(e,this.from,this.to,r):Mt.fail("Content does not fit in gap")}getMap(){return new Bn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new Ft(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),a=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||a<n.pos||i>r.pos?null:new Ft(n.pos,r.pos,a,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new Ft(n.from,n.to,n.gapFrom,n.gapTo,pe.fromJSON(e,n.slice),n.insert,!!n.structure)}}cn.jsonID("replaceAround",Ft);function wg(t,e,n){let r=t.resolve(e),a=n-e,i=r.depth;for(;a>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,a--;if(a>0){let c=r.node(i).maybeChild(r.indexAfter(i));for(;a>0;){if(!c||c.isLeaf)return!0;c=c.firstChild,a--}}return!1}function g3(t,e,n,r){let a=[],i=[],c,u;t.doc.nodesBetween(e,n,(h,p,m)=>{if(!h.isInline)return;let g=h.marks;if(!r.isInSet(g)&&m.type.allowsMarkType(r.type)){let x=Math.max(p,e),v=Math.min(p+h.nodeSize,n),w=r.addToSet(g);for(let N=0;N<g.length;N++)g[N].isInSet(w)||(c&&c.to==x&&c.mark.eq(g[N])?c.to=v:a.push(c=new gr(x,v,g[N])));u&&u.to==x?u.to=v:i.push(u=new Gs(x,v,r))}}),a.forEach(h=>t.step(h)),i.forEach(h=>t.step(h))}function y3(t,e,n,r){let a=[],i=0;t.doc.nodesBetween(e,n,(c,u)=>{if(!c.isInline)return;i++;let h=null;if(r instanceof bh){let p=c.marks,m;for(;m=r.isInSet(p);)(h||(h=[])).push(m),p=m.removeFromSet(p)}else r?r.isInSet(c.marks)&&(h=[r]):h=c.marks;if(h&&h.length){let p=Math.min(u+c.nodeSize,n);for(let m=0;m<h.length;m++){let g=h[m],x;for(let v=0;v<a.length;v++){let w=a[v];w.step==i-1&&g.eq(a[v].style)&&(x=w)}x?(x.to=p,x.step=i):a.push({style:g,from:Math.max(u,e),to:p,step:i})}}}),a.forEach(c=>t.step(new gr(c.from,c.to,c.style)))}function ay(t,e,n,r=n.contentMatch,a=!0){let i=t.doc.nodeAt(e),c=[],u=e+1;for(let h=0;h<i.childCount;h++){let p=i.child(h),m=u+p.nodeSize,g=r.matchType(p.type);if(!g)c.push(new Ht(u,m,pe.empty));else{r=g;for(let x=0;x<p.marks.length;x++)n.allowsMarkType(p.marks[x].type)||t.step(new gr(u,m,p.marks[x]));if(a&&p.isText&&n.whitespace!="pre"){let x,v=/\r?\n|\r/g,w;for(;x=v.exec(p.text);)w||(w=new pe(le.from(n.schema.text(" ",n.allowedMarks(p.marks))),0,0)),c.push(new Ht(u+x.index,u+x.index+x[0].length,w))}}u=m}if(!r.validEnd){let h=r.fillBefore(le.empty,!0);t.replace(u,u,new pe(h,0,0))}for(let h=c.length-1;h>=0;h--)t.step(c[h])}function x3(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function jo(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth,a=0,i=0;;--r){let c=t.$from.node(r),u=t.$from.index(r)+a,h=t.$to.indexAfter(r)-i;if(r<t.depth&&c.canReplace(u,h,n))return r;if(r==0||c.type.spec.isolating||!x3(c,u,h))break;u&&(a=1),h<c.childCount&&(i=1)}return null}function b3(t,e,n){let{$from:r,$to:a,depth:i}=e,c=r.before(i+1),u=a.after(i+1),h=c,p=u,m=le.empty,g=0;for(let w=i,N=!1;w>n;w--)N||r.index(w)>0?(N=!0,m=le.from(r.node(w).copy(m)),g++):h--;let x=le.empty,v=0;for(let w=i,N=!1;w>n;w--)N||a.after(w+1)<a.end(w)?(N=!0,x=le.from(a.node(w).copy(x)),v++):p++;t.step(new Ft(h,p,c,u,new pe(m.append(x),g,v),m.size-g,!0))}function iy(t,e,n=null,r=t){let a=v3(t,e),i=a&&w3(r,e);return i?a.map(f1).concat({type:e,attrs:n}).concat(i.map(f1)):null}function f1(t){return{type:t,attrs:null}}function v3(t,e){let{parent:n,startIndex:r,endIndex:a}=t,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;let c=i.length?i[0]:e;return n.canReplaceWith(r,a,c)?i:null}function w3(t,e){let{parent:n,startIndex:r,endIndex:a}=t,i=n.child(r),c=e.contentMatch.findWrapping(i.type);if(!c)return null;let h=(c.length?c[c.length-1]:e).contentMatch;for(let p=r;h&&p<a;p++)h=h.matchType(n.child(p).type);return!h||!h.validEnd?null:c}function S3(t,e,n){let r=le.empty;for(let c=n.length-1;c>=0;c--){if(r.size){let u=n[c].type.contentMatch.matchFragment(r);if(!u||!u.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=le.from(n[c].type.create(n[c].attrs,r))}let a=e.start,i=e.end;t.step(new Ft(a,i,a,i,new pe(r,0,0),n.length,!0))}function N3(t,e,n,r,a){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,(c,u)=>{let h=typeof a=="function"?a(c):a;if(c.isTextblock&&!c.hasMarkup(r,h)&&k3(t.doc,t.mapping.slice(i).map(u),r)){let p=null;if(r.schema.linebreakReplacement){let v=r.whitespace=="pre",w=!!r.contentMatch.matchType(r.schema.linebreakReplacement);v&&!w?p=!1:!v&&w&&(p=!0)}p===!1&&Dk(t,c,u,i),ay(t,t.mapping.slice(i).map(u,1),r,void 0,p===null);let m=t.mapping.slice(i),g=m.map(u,1),x=m.map(u+c.nodeSize,1);return t.step(new Ft(g,x,g+1,x-1,new pe(le.from(r.create(h,null,c.marks)),0,0),1,!0)),p===!0&&Ok(t,c,u,i),!1}})}function Ok(t,e,n,r){e.forEach((a,i)=>{if(a.isText){let c,u=/\r?\n|\r/g;for(;c=u.exec(a.text);){let h=t.mapping.slice(r).map(n+1+i+c.index);t.replaceWith(h,h+1,e.type.schema.linebreakReplacement.create())}}})}function Dk(t,e,n,r){e.forEach((a,i)=>{if(a.type==a.type.schema.linebreakReplacement){let c=t.mapping.slice(r).map(n+1+i);t.replaceWith(c,c+1,e.type.schema.text(`
`))}})}function k3(t,e,n){let r=t.resolve(e),a=r.index();return r.parent.canReplaceWith(a,a+1,n)}function j3(t,e,n,r,a){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let c=n.create(r,null,a||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,c);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Ft(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new pe(le.from(c),0,0),1,!0))}function ts(t,e,n=1,r){let a=t.resolve(e),i=a.depth-n,c=r&&r[r.length-1]||a.parent;if(i<0||a.parent.type.spec.isolating||!a.parent.canReplace(a.index(),a.parent.childCount)||!c.type.validContent(a.parent.content.cutByIndex(a.index(),a.parent.childCount)))return!1;for(let p=a.depth-1,m=n-2;p>i;p--,m--){let g=a.node(p),x=a.index(p);if(g.type.spec.isolating)return!1;let v=g.content.cutByIndex(x,g.childCount),w=r&&r[m+1];w&&(v=v.replaceChild(0,w.type.create(w.attrs)));let N=r&&r[m]||g;if(!g.canReplace(x+1,g.childCount)||!N.type.validContent(v))return!1}let u=a.indexAfter(i),h=r&&r[0];return a.node(i).canReplaceWith(u,u,h?h.type:a.node(i+1).type)}function C3(t,e,n=1,r){let a=t.doc.resolve(e),i=le.empty,c=le.empty;for(let u=a.depth,h=a.depth-n,p=n-1;u>h;u--,p--){i=le.from(a.node(u).copy(i));let m=r&&r[p];c=le.from(m?m.type.create(m.attrs,c):a.node(u).copy(c))}t.step(new Ht(e,e,new pe(i.append(c),n,n),!0))}function ta(t,e){let n=t.resolve(e),r=n.index();return Lk(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function T3(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let a=0;a<e.childCount;a++){let i=e.child(a),c=i.type==r?t.type.schema.nodes.text:i.type;if(n=n.matchType(c),!n||!t.type.allowsMarks(i.marks))return!1}return n.validEnd}function Lk(t,e){return!!(t&&e&&!t.isLeaf&&T3(t,e))}function vh(t,e,n=-1){let r=t.resolve(e);for(let a=r.depth;;a--){let i,c,u=r.index(a);if(a==r.depth?(i=r.nodeBefore,c=r.nodeAfter):n>0?(i=r.node(a+1),u++,c=r.node(a).maybeChild(u)):(i=r.node(a).maybeChild(u-1),c=r.node(a+1)),i&&!i.isTextblock&&Lk(i,c)&&r.node(a).canReplace(u,u+1))return e;if(a==0)break;e=n<0?r.before(a):r.after(a)}}function E3(t,e,n){let r=null,{linebreakReplacement:a}=t.doc.type.schema,i=t.doc.resolve(e-n),c=i.node().type;if(a&&c.inlineContent){let m=c.whitespace=="pre",g=!!c.contentMatch.matchType(a);m&&!g?r=!1:!m&&g&&(r=!0)}let u=t.steps.length;if(r===!1){let m=t.doc.resolve(e+n);Dk(t,m.node(),m.before(),u)}c.inlineContent&&ay(t,e+n-1,c,i.node().contentMatchAt(i.index()),r==null);let h=t.mapping.slice(u),p=h.map(e-n);if(t.step(new Ht(p,h.map(e+n,-1),pe.empty,!0)),r===!0){let m=t.doc.resolve(p);Ok(t,m.node(),m.before(),t.steps.length)}return t}function R3(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let a=r.depth-1;a>=0;a--){let i=r.index(a);if(r.node(a).canReplaceWith(i,i,n))return r.before(a+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let a=r.depth-1;a>=0;a--){let i=r.indexAfter(a);if(r.node(a).canReplaceWith(i,i,n))return r.after(a+1);if(i<r.node(a).childCount)return null}return null}function $k(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let a=n.content;for(let i=0;i<n.openStart;i++)a=a.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let c=r.depth;c>=0;c--){let u=c==r.depth?0:r.pos<=(r.start(c+1)+r.end(c+1))/2?-1:1,h=r.index(c)+(u>0?1:0),p=r.node(c),m=!1;if(i==1)m=p.canReplace(h,h,a);else{let g=p.contentMatchAt(h).findWrapping(a.firstChild.type);m=g&&p.canReplaceWith(h,h,g[0])}if(m)return u==0?r.pos:u<0?r.before(c+1):r.after(c+1)}return null}function wh(t,e,n=e,r=pe.empty){if(e==n&&!r.size)return null;let a=t.resolve(e),i=t.resolve(n);return Bk(a,i,r)?new Ht(e,n,r):new A3(a,i,r).fit()}function Bk(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class A3{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=le.empty;for(let a=0;a<=e.depth;a++){let i=e.node(a);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(a))})}for(let a=e.depth;a>0;a--)this.placed=le.from(e.node(a).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let p=this.findFittable();p?this.placeNodes(p):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,a=this.close(e<0?this.$to:r.doc.resolve(e));if(!a)return null;let i=this.placed,c=r.depth,u=a.depth;for(;c&&u&&i.childCount==1;)i=i.firstChild.content,c--,u--;let h=new pe(i,c,u);return e>-1?new Ft(r.pos,e,this.$to.pos,this.$to.end(),h,n):h.size||r.pos!=this.$to.pos?new Ht(r.pos,a.pos,h):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,a=this.unplaced.openEnd;r<e;r++){let i=n.firstChild;if(n.childCount>1&&(a=0),i.type.spec.isolating&&a<=r){e=r;break}n=i.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let a,i=null;r?(i=jm(this.unplaced.content,r-1).firstChild,a=i.content):a=this.unplaced.content;let c=a.firstChild;for(let u=this.depth;u>=0;u--){let{type:h,match:p}=this.frontier[u],m,g=null;if(n==1&&(c?p.matchType(c.type)||(g=p.fillBefore(le.from(c),!1)):i&&h.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:u,parent:i,inject:g};if(n==2&&c&&(m=p.findWrapping(c.type)))return{sliceDepth:r,frontierDepth:u,parent:i,wrap:m};if(i&&p.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,a=jm(e,n);return!a.childCount||a.firstChild.isLeaf?!1:(this.unplaced=new pe(e,n+1,Math.max(r,a.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,a=jm(e,n);if(a.childCount<=1&&n>0){let i=e.size-n<=n+a.size;this.unplaced=new pe(_l(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new pe(_l(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:a,wrap:i}){for(;this.depth>n;)this.closeFrontierNode();if(i)for(let N=0;N<i.length;N++)this.openFrontierNode(i[N]);let c=this.unplaced,u=r?r.content:c.content,h=c.openStart-e,p=0,m=[],{match:g,type:x}=this.frontier[n];if(a){for(let N=0;N<a.childCount;N++)m.push(a.child(N));g=g.matchFragment(a)}let v=u.size+e-(c.content.size-c.openEnd);for(;p<u.childCount;){let N=u.child(p),S=g.matchType(N.type);if(!S)break;p++,(p>1||h==0||N.content.size)&&(g=S,m.push(Ik(N.mark(x.allowedMarks(N.marks)),p==1?h:0,p==u.childCount?v:-1)))}let w=p==u.childCount;w||(v=-1),this.placed=Ml(this.placed,n,le.from(m)),this.frontier[n].match=g,w&&v<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let N=0,S=u;N<v;N++){let j=S.lastChild;this.frontier.push({type:j.type,match:j.contentMatchAt(j.childCount)}),S=j.content}this.unplaced=w?e==0?pe.empty:new pe(_l(c.content,e-1,1),e-1,v<0?c.openEnd:e-1):new pe(_l(c.content,e,p),c.openStart,c.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!Cm(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,a=this.$to.after(r);for(;r>1&&a==this.$to.end(--r);)++a;return a}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:a}=this.frontier[n],i=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),c=Cm(e,n,a,r,i);if(c){for(let u=n-1;u>=0;u--){let{match:h,type:p}=this.frontier[u],m=Cm(e,u,p,h,!0);if(!m||m.childCount)continue e}return{depth:n,fit:c,move:i?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=Ml(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let a=e.node(r),i=a.type.contentMatch.fillBefore(a.content,!0,e.index(r));this.openFrontierNode(a.type,a.attrs,i)}return e}openFrontierNode(e,n=null,r){let a=this.frontier[this.depth];a.match=a.match.matchType(e),this.placed=Ml(this.placed,this.depth,le.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(le.empty,!0);n.childCount&&(this.placed=Ml(this.placed,this.frontier.length,n))}}function _l(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(_l(t.firstChild.content,e-1,n)))}function Ml(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Ml(t.lastChild.content,e-1,n)))}function jm(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function Ik(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,Ik(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(le.empty,!0)))),t.copy(r)}function Cm(t,e,n,r,a){let i=t.node(e),c=a?t.indexAfter(e):t.index(e);if(c==i.childCount&&!n.compatibleContent(i.type))return null;let u=r.fillBefore(i.content,!0,c);return u&&!_3(n,i.content,c)?u:null}function _3(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function M3(t){return t.spec.defining||t.spec.definingForContent}function O3(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let a=t.doc.resolve(e),i=t.doc.resolve(n);if(Bk(a,i,r))return t.step(new Ht(e,n,r));let c=zk(a,i);c[c.length-1]==0&&c.pop();let u=-(a.depth+1);c.unshift(u);for(let x=a.depth,v=a.pos-1;x>0;x--,v--){let w=a.node(x).type.spec;if(w.defining||w.definingAsContext||w.isolating)break;c.indexOf(x)>-1?u=x:a.before(x)==v&&c.splice(1,0,-x)}let h=c.indexOf(u),p=[],m=r.openStart;for(let x=r.content,v=0;;v++){let w=x.firstChild;if(p.push(w),v==r.openStart)break;x=w.content}for(let x=m-1;x>=0;x--){let v=p[x],w=M3(v.type);if(w&&!v.sameMarkup(a.node(Math.abs(u)-1)))m=x;else if(w||!v.type.isTextblock)break}for(let x=r.openStart;x>=0;x--){let v=(x+m+1)%(r.openStart+1),w=p[v];if(w)for(let N=0;N<c.length;N++){let S=c[(N+h)%c.length],j=!0;S<0&&(j=!1,S=-S);let A=a.node(S-1),$=a.index(S-1);if(A.canReplaceWith($,$,w.type,w.marks))return t.replace(a.before(S),j?i.after(S):n,new pe(Pk(r.content,0,r.openStart,v),v,r.openEnd))}}let g=t.steps.length;for(let x=c.length-1;x>=0&&(t.replace(e,n,r),!(t.steps.length>g));x--){let v=c[x];v<0||(e=a.before(v),n=i.after(v))}}function Pk(t,e,n,r,a){if(e<n){let i=t.firstChild;t=t.replaceChild(0,i.copy(Pk(i.content,e+1,n,r,i)))}if(e>r){let i=a.contentMatchAt(0),c=i.fillBefore(t).append(t);t=c.append(i.matchFragment(c).fillBefore(le.empty,!0))}return t}function D3(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let a=R3(t.doc,e,r.type);a!=null&&(e=n=a)}t.replaceRange(e,n,new pe(le.from(r),0,0))}function L3(t,e,n){let r=t.doc.resolve(e),a=t.doc.resolve(n),i=zk(r,a);for(let c=0;c<i.length;c++){let u=i[c],h=c==i.length-1;if(h&&u==0||r.node(u).type.contentMatch.validEnd)return t.delete(r.start(u),a.end(u));if(u>0&&(h||r.node(u-1).canReplace(r.index(u-1),a.indexAfter(u-1))))return t.delete(r.before(u),a.after(u))}for(let c=1;c<=r.depth&&c<=a.depth;c++)if(e-r.start(c)==r.depth-c&&n>r.end(c)&&a.end(c)-n!=a.depth-c&&r.start(c-1)==a.start(c-1)&&r.node(c-1).canReplace(r.index(c-1),a.index(c-1)))return t.delete(r.before(c),n);t.delete(e,n)}function zk(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let a=r;a>=0;a--){let i=t.start(a);if(i<t.pos-(t.depth-a)||e.end(a)>e.pos+(e.depth-a)||t.node(a).type.spec.isolating||e.node(a).type.spec.isolating)break;(i==e.start(a)||a==t.depth&&a==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&a&&e.start(a-1)==i-1)&&n.push(a)}return n}class co extends cn{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return Mt.fail("No node at attribute step's position");let r=Object.create(null);for(let i in n.attrs)r[i]=n.attrs[i];r[this.attr]=this.value;let a=n.type.create(r,null,n.marks);return Mt.fromReplace(e,this.pos,this.pos+1,new pe(le.from(a),0,n.isLeaf?0:1))}getMap(){return Bn.empty}invert(e){return new co(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new co(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new co(n.pos,n.attr,n.value)}}cn.jsonID("attr",co);class dc extends cn{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let a in e.attrs)n[a]=e.attrs[a];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return Mt.ok(r)}getMap(){return Bn.empty}invert(e){return new dc(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new dc(n.attr,n.value)}}cn.jsonID("docAttr",dc);let ho=class extends Error{};ho=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};ho.prototype=Object.create(Error.prototype);ho.prototype.constructor=ho;ho.prototype.name="TransformError";class Uk{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new cc}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new ho(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=pe.empty){let a=wh(this.doc,e,n,r);return a&&this.step(a),this}replaceWith(e,n,r){return this.replace(e,n,new pe(le.from(r),0,0))}delete(e,n){return this.replace(e,n,pe.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return O3(this,e,n,r),this}replaceRangeWith(e,n,r){return D3(this,e,n,r),this}deleteRange(e,n){return L3(this,e,n),this}lift(e,n){return b3(this,e,n),this}join(e,n=1){return E3(this,e,n),this}wrap(e,n){return S3(this,e,n),this}setBlockType(e,n=e,r,a=null){return N3(this,e,n,r,a),this}setNodeMarkup(e,n,r=null,a){return j3(this,e,n,r,a),this}setNodeAttribute(e,n,r){return this.step(new co(e,n,r)),this}setDocAttribute(e,n){return this.step(new dc(e,n)),this}addNodeMark(e,n){return this.step(new qs(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof st)n.isInSet(r.marks)&&this.step(new Ga(e,n));else{let a=r.marks,i,c=[];for(;i=n.isInSet(a);)c.push(new Ga(e,i)),a=i.removeFromSet(a);for(let u=c.length-1;u>=0;u--)this.step(c[u])}return this}split(e,n=1,r){return C3(this,e,n,r),this}addMark(e,n,r){return g3(this,e,n,r),this}removeMark(e,n,r){return y3(this,e,n,r),this}clearIncompatible(e,n,r){return ay(this,e,n,r),this}}const Tm=Object.create(null);class Be{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new $3(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=pe.empty){let r=n.content.lastChild,a=null;for(let u=0;u<n.openEnd;u++)a=r,r=r.lastChild;let i=e.steps.length,c=this.ranges;for(let u=0;u<c.length;u++){let{$from:h,$to:p}=c[u],m=e.mapping.slice(i);e.replaceRange(m.map(h.pos),m.map(p.pos),u?pe.empty:n),u==0&&g1(e,i,(r?r.isInline:a&&a.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,a=this.ranges;for(let i=0;i<a.length;i++){let{$from:c,$to:u}=a[i],h=e.mapping.slice(r),p=h.map(c.pos),m=h.map(u.pos);i?e.deleteRange(p,m):(e.replaceRangeWith(p,m,n),g1(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let a=e.parent.inlineContent?new _e(e):to(e.node(0),e.parent,e.pos,e.index(),n,r);if(a)return a;for(let i=e.depth-1;i>=0;i--){let c=n<0?to(e.node(0),e.node(i),e.before(i+1),e.index(i),n,r):to(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,r);if(c)return c}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new Pn(e.node(0))}static atStart(e){return to(e,e,0,0,1)||new Pn(e)}static atEnd(e){return to(e,e,e.content.size,e.childCount,-1)||new Pn(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=Tm[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in Tm)throw new RangeError("Duplicate use of selection JSON ID "+e);return Tm[e]=n,n.prototype.jsonID=e,n}getBookmark(){return _e.between(this.$anchor,this.$head).getBookmark()}}Be.prototype.visible=!0;class $3{constructor(e,n){this.$from=e,this.$to=n}}let p1=!1;function m1(t){!p1&&!t.parent.inlineContent&&(p1=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class _e extends Be{constructor(e,n=e){m1(e),m1(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return Be.near(r);let a=e.resolve(n.map(this.anchor));return new _e(a.parent.inlineContent?a:r,r)}replace(e,n=pe.empty){if(super.replace(e,n),n==pe.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof _e&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Sh(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new _e(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let a=e.resolve(n);return new this(a,r==n?a:e.resolve(r))}static between(e,n,r){let a=e.pos-n.pos;if((!r||a)&&(r=a>=0?1:-1),!n.parent.inlineContent){let i=Be.findFrom(n,r,!0)||Be.findFrom(n,-r,!0);if(i)n=i.$head;else return Be.near(n,r)}return e.parent.inlineContent||(a==0?e=n:(e=(Be.findFrom(e,-r,!0)||Be.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=a<0&&(e=n))),new _e(e,n)}}Be.jsonID("text",_e);class Sh{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Sh(e.map(this.anchor),e.map(this.head))}resolve(e){return _e.between(e.resolve(this.anchor),e.resolve(this.head))}}class Te extends Be{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:a}=n.mapResult(this.anchor),i=e.resolve(a);return r?Be.near(i):new Te(i)}content(){return new pe(le.from(this.node),0,0)}eq(e){return e instanceof Te&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new oy(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new Te(e.resolve(n.anchor))}static create(e,n){return new Te(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}Te.prototype.visible=!1;Be.jsonID("node",Te);class oy{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new Sh(r,r):new oy(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&Te.isSelectable(r)?new Te(n):Be.near(n)}}class Pn extends Be{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=pe.empty){if(n==pe.empty){e.delete(0,e.doc.content.size);let r=Be.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new Pn(e)}map(e){return new Pn(e)}eq(e){return e instanceof Pn}getBookmark(){return B3}}Be.jsonID("all",Pn);const B3={map(){return this},resolve(t){return new Pn(t)}};function to(t,e,n,r,a,i=!1){if(e.inlineContent)return _e.create(t,n);for(let c=r-(a>0?0:1);a>0?c<e.childCount:c>=0;c+=a){let u=e.child(c);if(u.isAtom){if(!i&&Te.isSelectable(u))return Te.create(t,n-(a<0?u.nodeSize:0))}else{let h=to(t,u,n+a,a<0?u.childCount:0,a,i);if(h)return h}n+=u.nodeSize*a}return null}function g1(t,e,n){let r=t.steps.length-1;if(r<e)return;let a=t.steps[r];if(!(a instanceof Ht||a instanceof Ft))return;let i=t.mapping.maps[r],c;i.forEach((u,h,p,m)=>{c==null&&(c=m)}),t.setSelection(Be.near(t.doc.resolve(c),n))}const y1=1,tu=2,x1=4;class I3 extends Uk{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|y1)&~tu,this.storedMarks=null,this}get selectionSet(){return(this.updated&y1)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=tu,this}ensureMarks(e){return st.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&tu)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~tu,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||st.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let a=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(a.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let i=this.storedMarks;if(!i){let c=this.doc.resolve(n);i=r==n?c.marks():c.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,a.text(e,i)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(Be.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=x1,this}get scrolledIntoView(){return(this.updated&x1)>0}}function b1(t,e){return!e||!t?t:t.bind(e)}class Ol{constructor(e,n,r){this.name=e,this.init=b1(n.init,r),this.apply=b1(n.apply,r)}}const P3=[new Ol("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Ol("selection",{init(t,e){return t.selection||Be.atStart(e.doc)},apply(t){return t.selection}}),new Ol("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new Ol("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class Em{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=P3.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new Ol(r.key,r.spec.state,r))})}}class oo{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let a=this.config.plugins[r];if(a.spec.filterTransaction&&!a.spec.filterTransaction.call(a,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),a=null;for(;;){let i=!1;for(let c=0;c<this.config.plugins.length;c++){let u=this.config.plugins[c];if(u.spec.appendTransaction){let h=a?a[c].n:0,p=a?a[c].state:this,m=h<n.length&&u.spec.appendTransaction.call(u,h?n.slice(h):n,p,r);if(m&&r.filterTransaction(m,c)){if(m.setMeta("appendedTransaction",e),!a){a=[];for(let g=0;g<this.config.plugins.length;g++)a.push(g<c?{state:r,n:n.length}:{state:this,n:0})}n.push(m),r=r.applyInner(m),i=!0}a&&(a[c]={state:r,n:n.length})}}if(!i)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new oo(this.config),r=this.config.fields;for(let a=0;a<r.length;a++){let i=r[a];n[i.name]=i.apply(e,this[i.name],this,n)}return n}get tr(){return new I3(this)}static create(e){let n=new Em(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new oo(n);for(let a=0;a<n.fields.length;a++)r[n.fields[a].name]=n.fields[a].init(e,r);return r}reconfigure(e){let n=new Em(this.schema,e.plugins),r=n.fields,a=new oo(n);for(let i=0;i<r.length;i++){let c=r[i].name;a[c]=this.hasOwnProperty(c)?this[c]:r[i].init(e,a)}return a}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let a=e[r],i=a.spec.state;i&&i.toJSON&&(n[r]=i.toJSON.call(a,this[a.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let a=new Em(e.schema,e.plugins),i=new oo(a);return a.fields.forEach(c=>{if(c.name=="doc")i.doc=yr.fromJSON(e.schema,n.doc);else if(c.name=="selection")i.selection=Be.fromJSON(i.doc,n.selection);else if(c.name=="storedMarks")n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let u in r){let h=r[u],p=h.spec.state;if(h.key==c.name&&p&&p.fromJSON&&Object.prototype.hasOwnProperty.call(n,u)){i[c.name]=p.fromJSON.call(h,e,n[u],i);return}}i[c.name]=c.init(e,i)}}),i}}function Hk(t,e,n){for(let r in t){let a=t[r];a instanceof Function?a=a.bind(e):r=="handleDOMEvents"&&(a=Hk(a,e,{})),n[r]=a}return n}class pt{constructor(e){this.spec=e,this.props={},e.props&&Hk(e.props,this,this.props),this.key=e.key?e.key.key:Vk("plugin")}getState(e){return e[this.key]}}const Rm=Object.create(null);function Vk(t){return t in Rm?t+"$"+ ++Rm[t]:(Rm[t]=0,t+"$")}class Pt{constructor(e="key"){this.key=Vk(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const ly=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function Fk(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const Gk=(t,e,n)=>{let r=Fk(t,n);if(!r)return!1;let a=cy(r);if(!a){let c=r.blockRange(),u=c&&jo(c);return u==null?!1:(e&&e(t.tr.lift(c,u).scrollIntoView()),!0)}let i=a.nodeBefore;if(ej(t,a,e,-1))return!0;if(r.parent.content.size==0&&(fo(i,"end")||Te.isSelectable(i)))for(let c=r.depth;;c--){let u=wh(t.doc,r.before(c),r.after(c),pe.empty);if(u&&u.slice.size<u.to-u.from){if(e){let h=t.tr.step(u);h.setSelection(fo(i,"end")?Be.findFrom(h.doc.resolve(h.mapping.map(a.pos,-1)),-1):Te.create(h.doc,a.pos-i.nodeSize)),e(h.scrollIntoView())}return!0}if(c==1||r.node(c-1).childCount>1)break}return i.isAtom&&a.depth==r.depth-1?(e&&e(t.tr.delete(a.pos-i.nodeSize,a.pos).scrollIntoView()),!0):!1},z3=(t,e,n)=>{let r=Fk(t,n);if(!r)return!1;let a=cy(r);return a?qk(t,a,e):!1},U3=(t,e,n)=>{let r=Kk(t,n);if(!r)return!1;let a=dy(r);return a?qk(t,a,e):!1};function qk(t,e,n){let r=e.nodeBefore,a=r,i=e.pos-1;for(;!a.isTextblock;i--){if(a.type.spec.isolating)return!1;let m=a.lastChild;if(!m)return!1;a=m}let c=e.nodeAfter,u=c,h=e.pos+1;for(;!u.isTextblock;h++){if(u.type.spec.isolating)return!1;let m=u.firstChild;if(!m)return!1;u=m}let p=wh(t.doc,i,h,pe.empty);if(!p||p.from!=i||p instanceof Ht&&p.slice.size>=h-i)return!1;if(n){let m=t.tr.step(p);m.setSelection(_e.create(m.doc,i)),n(m.scrollIntoView())}return!0}function fo(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const Wk=(t,e,n)=>{let{$head:r,empty:a}=t.selection,i=r;if(!a)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;i=cy(r)}let c=i&&i.nodeBefore;return!c||!Te.isSelectable(c)?!1:(e&&e(t.tr.setSelection(Te.create(t.doc,i.pos-c.nodeSize)).scrollIntoView()),!0)};function cy(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function Kk(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const Yk=(t,e,n)=>{let r=Kk(t,n);if(!r)return!1;let a=dy(r);if(!a)return!1;let i=a.nodeAfter;if(ej(t,a,e,1))return!0;if(r.parent.content.size==0&&(fo(i,"start")||Te.isSelectable(i))){let c=wh(t.doc,r.before(),r.after(),pe.empty);if(c&&c.slice.size<c.to-c.from){if(e){let u=t.tr.step(c);u.setSelection(fo(i,"start")?Be.findFrom(u.doc.resolve(u.mapping.map(a.pos)),1):Te.create(u.doc,u.mapping.map(a.pos))),e(u.scrollIntoView())}return!0}}return i.isAtom&&a.depth==r.depth-1?(e&&e(t.tr.delete(a.pos,a.pos+i.nodeSize).scrollIntoView()),!0):!1},Jk=(t,e,n)=>{let{$head:r,empty:a}=t.selection,i=r;if(!a)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;i=dy(r)}let c=i&&i.nodeAfter;return!c||!Te.isSelectable(c)?!1:(e&&e(t.tr.setSelection(Te.create(t.doc,i.pos)).scrollIntoView()),!0)};function dy(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const H3=(t,e)=>{let n=t.selection,r=n instanceof Te,a;if(r){if(n.node.isTextblock||!ta(t.doc,n.from))return!1;a=n.from}else if(a=vh(t.doc,n.from,-1),a==null)return!1;if(e){let i=t.tr.join(a);r&&i.setSelection(Te.create(i.doc,a-t.doc.resolve(a).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},V3=(t,e)=>{let n=t.selection,r;if(n instanceof Te){if(n.node.isTextblock||!ta(t.doc,n.to))return!1;r=n.to}else if(r=vh(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},F3=(t,e)=>{let{$from:n,$to:r}=t.selection,a=n.blockRange(r),i=a&&jo(a);return i==null?!1:(e&&e(t.tr.lift(a,i).scrollIntoView()),!0)},Qk=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function uy(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const G3=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let a=n.node(-1),i=n.indexAfter(-1),c=uy(a.contentMatchAt(i));if(!c||!a.canReplaceWith(i,i,c))return!1;if(e){let u=n.after(),h=t.tr.replaceWith(u,u,c.createAndFill());h.setSelection(Be.near(h.doc.resolve(u),1)),e(h.scrollIntoView())}return!0},Xk=(t,e)=>{let n=t.selection,{$from:r,$to:a}=n;if(n instanceof Pn||r.parent.inlineContent||a.parent.inlineContent)return!1;let i=uy(a.parent.contentMatchAt(a.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let c=(!r.parentOffset&&a.index()<a.parent.childCount?r:a).pos,u=t.tr.insert(c,i.createAndFill());u.setSelection(_e.create(u.doc,c+1)),e(u.scrollIntoView())}return!0},Zk=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(ts(t.doc,i))return e&&e(t.tr.split(i).scrollIntoView()),!0}let r=n.blockRange(),a=r&&jo(r);return a==null?!1:(e&&e(t.tr.lift(r,a).scrollIntoView()),!0)};function q3(t){return(e,n)=>{let{$from:r,$to:a}=e.selection;if(e.selection instanceof Te&&e.selection.node.isBlock)return!r.parentOffset||!ts(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let i=[],c,u,h=!1,p=!1;for(let v=r.depth;;v--)if(r.node(v).isBlock){h=r.end(v)==r.pos+(r.depth-v),p=r.start(v)==r.pos-(r.depth-v),u=uy(r.node(v-1).contentMatchAt(r.indexAfter(v-1))),i.unshift(h&&u?{type:u}:null),c=v;break}else{if(v==1)return!1;i.unshift(null)}let m=e.tr;(e.selection instanceof _e||e.selection instanceof Pn)&&m.deleteSelection();let g=m.mapping.map(r.pos),x=ts(m.doc,g,i.length,i);if(x||(i[0]=u?{type:u}:null,x=ts(m.doc,g,i.length,i)),!x)return!1;if(m.split(g,i.length,i),!h&&p&&r.node(c).type!=u){let v=m.mapping.map(r.before(c)),w=m.doc.resolve(v);u&&r.node(c-1).canReplaceWith(w.index(),w.index()+1,u)&&m.setNodeMarkup(m.mapping.map(r.before(c)),u)}return n&&n(m.scrollIntoView()),!0}}const W3=q3(),K3=(t,e)=>{let{$from:n,to:r}=t.selection,a,i=n.sharedDepth(r);return i==0?!1:(a=n.before(i),e&&e(t.tr.setSelection(Te.create(t.doc,a))),!0)};function Y3(t,e,n){let r=e.nodeBefore,a=e.nodeAfter,i=e.index();return!r||!a||!r.type.compatibleContent(a.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(a.isTextblock||ta(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function ej(t,e,n,r){let a=e.nodeBefore,i=e.nodeAfter,c,u,h=a.type.spec.isolating||i.type.spec.isolating;if(!h&&Y3(t,e,n))return!0;let p=!h&&e.parent.canReplace(e.index(),e.index()+1);if(p&&(c=(u=a.contentMatchAt(a.childCount)).findWrapping(i.type))&&u.matchType(c[0]||i.type).validEnd){if(n){let v=e.pos+i.nodeSize,w=le.empty;for(let j=c.length-1;j>=0;j--)w=le.from(c[j].create(null,w));w=le.from(a.copy(w));let N=t.tr.step(new Ft(e.pos-1,v,e.pos,v,new pe(w,1,0),c.length,!0)),S=N.doc.resolve(v+2*c.length);S.nodeAfter&&S.nodeAfter.type==a.type&&ta(N.doc,S.pos)&&N.join(S.pos),n(N.scrollIntoView())}return!0}let m=i.type.spec.isolating||r>0&&h?null:Be.findFrom(e,1),g=m&&m.$from.blockRange(m.$to),x=g&&jo(g);if(x!=null&&x>=e.depth)return n&&n(t.tr.lift(g,x).scrollIntoView()),!0;if(p&&fo(i,"start",!0)&&fo(a,"end")){let v=a,w=[];for(;w.push(v),!v.isTextblock;)v=v.lastChild;let N=i,S=1;for(;!N.isTextblock;N=N.firstChild)S++;if(v.canReplace(v.childCount,v.childCount,N.content)){if(n){let j=le.empty;for(let $=w.length-1;$>=0;$--)j=le.from(w[$].copy(j));let A=t.tr.step(new Ft(e.pos-w.length,e.pos+i.nodeSize,e.pos+S,e.pos+i.nodeSize-S,new pe(j,w.length,0),0,!0));n(A.scrollIntoView())}return!0}}return!1}function tj(t){return function(e,n){let r=e.selection,a=t<0?r.$from:r.$to,i=a.depth;for(;a.node(i).isInline;){if(!i)return!1;i--}return a.node(i).isTextblock?(n&&n(e.tr.setSelection(_e.create(e.doc,t<0?a.start(i):a.end(i)))),!0):!1}}const J3=tj(-1),Q3=tj(1);function X3(t,e=null){return function(n,r){let{$from:a,$to:i}=n.selection,c=a.blockRange(i),u=c&&iy(c,t,e);return u?(r&&r(n.tr.wrap(c,u).scrollIntoView()),!0):!1}}function v1(t,e=null){return function(n,r){let a=!1;for(let i=0;i<n.selection.ranges.length&&!a;i++){let{$from:{pos:c},$to:{pos:u}}=n.selection.ranges[i];n.doc.nodesBetween(c,u,(h,p)=>{if(a)return!1;if(!(!h.isTextblock||h.hasMarkup(t,e)))if(h.type==t)a=!0;else{let m=n.doc.resolve(p),g=m.index();a=m.parent.canReplaceWith(g,g+1,t)}})}if(!a)return!1;if(r){let i=n.tr;for(let c=0;c<n.selection.ranges.length;c++){let{$from:{pos:u},$to:{pos:h}}=n.selection.ranges[c];i.setBlockType(u,h,t,e)}r(i.scrollIntoView())}return!0}}function hy(...t){return function(e,n,r){for(let a=0;a<t.length;a++)if(t[a](e,n,r))return!0;return!1}}hy(ly,Gk,Wk);hy(ly,Yk,Jk);hy(Qk,Xk,Zk,W3);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function Z3(t,e=null){return function(n,r){let{$from:a,$to:i}=n.selection,c=a.blockRange(i);if(!c)return!1;let u=r?n.tr:null;return e4(u,c,t,e)?(r&&r(u.scrollIntoView()),!0):!1}}function e4(t,e,n,r=null){let a=!1,i=e,c=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let h=c.resolve(e.start-2);i=new Eu(h,h,e.depth),e.endIndex<e.parent.childCount&&(e=new Eu(e.$from,c.resolve(e.$to.end(e.depth)),e.depth)),a=!0}let u=iy(i,n,r,e);return u?(t&&t4(t,e,u,a,n),!0):!1}function t4(t,e,n,r,a){let i=le.empty;for(let m=n.length-1;m>=0;m--)i=le.from(n[m].type.create(n[m].attrs,i));t.step(new Ft(e.start-(r?2:0),e.end,e.start,e.end,new pe(i,0,0),n.length,!0));let c=0;for(let m=0;m<n.length;m++)n[m].type==a&&(c=m+1);let u=n.length-c,h=e.start+n.length-(r?2:0),p=e.parent;for(let m=e.startIndex,g=e.endIndex,x=!0;m<g;m++,x=!1)!x&&ts(t.doc,h,u)&&(t.split(h,u),h+=2*u),h+=p.child(m).nodeSize;return t}function n4(t){return function(e,n){let{$from:r,$to:a}=e.selection,i=r.blockRange(a,c=>c.childCount>0&&c.firstChild.type==t);return i?n?r.node(i.depth-1).type==t?r4(e,n,t,i):s4(e,n,i):!0:!1}}function r4(t,e,n,r){let a=t.tr,i=r.end,c=r.$to.end(r.depth);i<c&&(a.step(new Ft(i-1,c,i,c,new pe(le.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new Eu(a.doc.resolve(r.$from.pos),a.doc.resolve(c),r.depth));const u=jo(r);if(u==null)return!1;a.lift(r,u);let h=a.doc.resolve(a.mapping.map(i,-1)-1);return ta(a.doc,h.pos)&&h.nodeBefore.type==h.nodeAfter.type&&a.join(h.pos),e(a.scrollIntoView()),!0}function s4(t,e,n){let r=t.tr,a=n.parent;for(let v=n.end,w=n.endIndex-1,N=n.startIndex;w>N;w--)v-=a.child(w).nodeSize,r.delete(v-1,v+1);let i=r.doc.resolve(n.start),c=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let u=n.startIndex==0,h=n.endIndex==a.childCount,p=i.node(-1),m=i.index(-1);if(!p.canReplace(m+(u?0:1),m+1,c.content.append(h?le.empty:le.from(a))))return!1;let g=i.pos,x=g+c.nodeSize;return r.step(new Ft(g-(u?1:0),x+(h?1:0),g+1,x-1,new pe((u?le.empty:le.from(a.copy(le.empty))).append(h?le.empty:le.from(a.copy(le.empty))),u?0:1,h?0:1),u?0:1)),e(r.scrollIntoView()),!0}function a4(t){return function(e,n){let{$from:r,$to:a}=e.selection,i=r.blockRange(a,p=>p.childCount>0&&p.firstChild.type==t);if(!i)return!1;let c=i.startIndex;if(c==0)return!1;let u=i.parent,h=u.child(c-1);if(h.type!=t)return!1;if(n){let p=h.lastChild&&h.lastChild.type==u.type,m=le.from(p?t.create():null),g=new pe(le.from(t.create(null,le.from(u.type.create(null,m)))),p?3:1,0),x=i.start,v=i.end;n(e.tr.step(new Ft(x-(p?3:1),v,x,v,g,1,!0)).scrollIntoView())}return!0}}const en=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},po=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let Sg=null;const Zr=function(t,e,n){let r=Sg||(Sg=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},i4=function(){Sg=null},qa=function(t,e,n,r){return n&&(w1(t,e,n,r,-1)||w1(t,e,n,r,1))},o4=/^(img|br|input|textarea|hr)$/i;function w1(t,e,n,r,a){for(var i;;){if(t==n&&e==r)return!0;if(e==(a<0?0:nr(t))){let c=t.parentNode;if(!c||c.nodeType!=1||wc(t)||o4.test(t.nodeName)||t.contentEditable=="false")return!1;e=en(t)+(a<0?0:1),t=c}else if(t.nodeType==1){let c=t.childNodes[e+(a<0?-1:0)];if(c.nodeType==1&&c.contentEditable=="false")if(!((i=c.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=a;else return!1;else t=c,e=a<0?nr(t):0}else return!1}}function nr(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function l4(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=nr(t)}else if(t.parentNode&&!wc(t))e=en(t),t=t.parentNode;else return null}}function c4(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!wc(t))e=en(t)+1,t=t.parentNode;else return null}}function d4(t,e,n){for(let r=e==0,a=e==nr(t);r||a;){if(t==n)return!0;let i=en(t);if(t=t.parentNode,!t)return!1;r=r&&i==0,a=a&&i==nr(t)}}function wc(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Nh=function(t){return t.focusNode&&qa(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function _a(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function u4(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function h4(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(nr(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(nr(r.startContainer),r.startOffset)}}}const Cr=typeof navigator<"u"?navigator:null,S1=typeof document<"u"?document:null,na=Cr&&Cr.userAgent||"",Ng=/Edge\/(\d+)/.exec(na),nj=/MSIE \d/.exec(na),kg=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(na),Nn=!!(nj||kg||Ng),Js=nj?document.documentMode:kg?+kg[1]:Ng?+Ng[1]:0,rr=!Nn&&/gecko\/(\d+)/i.test(na);rr&&+(/Firefox\/(\d+)/.exec(na)||[0,0])[1];const jg=!Nn&&/Chrome\/(\d+)/.exec(na),Vt=!!jg,rj=jg?+jg[1]:0,ln=!Nn&&!!Cr&&/Apple Computer/.test(Cr.vendor),mo=ln&&(/Mobile\/\w+/.test(na)||!!Cr&&Cr.maxTouchPoints>2),er=mo||(Cr?/Mac/.test(Cr.platform):!1),sj=Cr?/Win/.test(Cr.platform):!1,es=/Android \d/.test(na),Sc=!!S1&&"webkitFontSmoothing"in S1.documentElement.style,f4=Sc?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function p4(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function Kr(t,e){return typeof t=="number"?t:t[e]}function m4(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function N1(t,e,n){let r=t.someProp("scrollThreshold")||0,a=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let c=n||t.dom;c;){if(c.nodeType!=1){c=po(c);continue}let u=c,h=u==i.body,p=h?p4(i):m4(u),m=0,g=0;if(e.top<p.top+Kr(r,"top")?g=-(p.top-e.top+Kr(a,"top")):e.bottom>p.bottom-Kr(r,"bottom")&&(g=e.bottom-e.top>p.bottom-p.top?e.top+Kr(a,"top")-p.top:e.bottom-p.bottom+Kr(a,"bottom")),e.left<p.left+Kr(r,"left")?m=-(p.left-e.left+Kr(a,"left")):e.right>p.right-Kr(r,"right")&&(m=e.right-p.right+Kr(a,"right")),m||g)if(h)i.defaultView.scrollBy(m,g);else{let v=u.scrollLeft,w=u.scrollTop;g&&(u.scrollTop+=g),m&&(u.scrollLeft+=m);let N=u.scrollLeft-v,S=u.scrollTop-w;e={left:e.left-N,top:e.top-S,right:e.right-N,bottom:e.bottom-S}}let x=h?"fixed":getComputedStyle(c).position;if(/^(fixed|sticky)$/.test(x))break;c=x=="absolute"?c.offsetParent:po(c)}}function g4(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,a;for(let i=(e.left+e.right)/2,c=n+1;c<Math.min(innerHeight,e.bottom);c+=5){let u=t.root.elementFromPoint(i,c);if(!u||u==t.dom||!t.dom.contains(u))continue;let h=u.getBoundingClientRect();if(h.top>=n-20){r=u,a=h.top;break}}return{refDOM:r,refTop:a,stack:aj(t.dom)}}function aj(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=po(r));return e}function y4({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;ij(n,r==0?0:r-e)}function ij(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:a,left:i}=t[n];r.scrollTop!=a+e&&(r.scrollTop=a+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let Ki=null;function x4(t){if(t.setActive)return t.setActive();if(Ki)return t.focus(Ki);let e=aj(t);t.focus(Ki==null?{get preventScroll(){return Ki={preventScroll:!0},!0}}:void 0),Ki||(Ki=!1,ij(e,0))}function oj(t,e){let n,r=2e8,a,i=0,c=e.top,u=e.top,h,p;for(let m=t.firstChild,g=0;m;m=m.nextSibling,g++){let x;if(m.nodeType==1)x=m.getClientRects();else if(m.nodeType==3)x=Zr(m).getClientRects();else continue;for(let v=0;v<x.length;v++){let w=x[v];if(w.top<=c&&w.bottom>=u){c=Math.max(w.bottom,c),u=Math.min(w.top,u);let N=w.left>e.left?w.left-e.left:w.right<e.left?e.left-w.right:0;if(N<r){n=m,r=N,a=N&&n.nodeType==3?{left:w.right<e.left?w.right:w.left,top:e.top}:e,m.nodeType==1&&N&&(i=g+(e.left>=(w.left+w.right)/2?1:0));continue}}else w.top>e.top&&!h&&w.left<=e.left&&w.right>=e.left&&(h=m,p={left:Math.max(w.left,Math.min(w.right,e.left)),top:w.top});!n&&(e.left>=w.right&&e.top>=w.top||e.left>=w.left&&e.top>=w.bottom)&&(i=g+1)}}return!n&&h&&(n=h,a=p,r=0),n&&n.nodeType==3?b4(n,a):!n||r&&n.nodeType==1?{node:t,offset:i}:oj(n,a)}function b4(t,e){let n=t.nodeValue.length,r=document.createRange(),a;for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let c=Ls(r,1);if(c.top!=c.bottom&&fy(e,c)){a={node:t,offset:i+(e.left>=(c.left+c.right)/2?1:0)};break}}return r.detach(),a||{node:t,offset:0}}function fy(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function v4(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function w4(t,e,n){let{node:r,offset:a}=oj(e,n),i=-1;if(r.nodeType==1&&!r.firstChild){let c=r.getBoundingClientRect();i=c.left!=c.right&&n.left>(c.left+c.right)/2?1:-1}return t.docView.posFromDOM(r,a,i)}function S4(t,e,n,r){let a=-1;for(let i=e,c=!1;i!=t.dom;){let u=t.docView.nearestDesc(i,!0),h;if(!u)return null;if(u.dom.nodeType==1&&(u.node.isBlock&&u.parent||!u.contentDOM)&&((h=u.dom.getBoundingClientRect()).width||h.height)&&(u.node.isBlock&&u.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(u.dom.nodeName)&&(!c&&h.left>r.left||h.top>r.top?a=u.posBefore:(!c&&h.right<r.left||h.bottom<r.top)&&(a=u.posAfter),c=!0),!u.contentDOM&&a<0&&!u.node.isText))return(u.node.isBlock?r.top<(h.top+h.bottom)/2:r.left<(h.left+h.right)/2)?u.posBefore:u.posAfter;i=u.dom.parentNode}return a>-1?a:t.docView.posFromDOM(e,n,-1)}function lj(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let a=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=a;;){let c=t.childNodes[i];if(c.nodeType==1){let u=c.getClientRects();for(let h=0;h<u.length;h++){let p=u[h];if(fy(e,p))return lj(c,e,p)}}if((i=(i+1)%r)==a)break}return t}function N4(t,e){let n=t.dom.ownerDocument,r,a=0,i=h4(n,e.left,e.top);i&&({node:r,offset:a}=i);let c=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),u;if(!c||!t.dom.contains(c.nodeType!=1?c.parentNode:c)){let p=t.dom.getBoundingClientRect();if(!fy(e,p)||(c=lj(t.dom,e,p),!c))return null}if(ln)for(let p=c;r&&p;p=po(p))p.draggable&&(r=void 0);if(c=v4(c,e),r){if(rr&&r.nodeType==1&&(a=Math.min(a,r.childNodes.length),a<r.childNodes.length)){let m=r.childNodes[a],g;m.nodeName=="IMG"&&(g=m.getBoundingClientRect()).right<=e.left&&g.bottom>e.top&&a++}let p;Sc&&a&&r.nodeType==1&&(p=r.childNodes[a-1]).nodeType==1&&p.contentEditable=="false"&&p.getBoundingClientRect().top>=e.top&&a--,r==t.dom&&a==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?u=t.state.doc.content.size:(a==0||r.nodeType!=1||r.childNodes[a-1].nodeName!="BR")&&(u=S4(t,r,a,e))}u==null&&(u=w4(t,c,e));let h=t.docView.nearestDesc(c,!0);return{pos:u,inside:h?h.posAtStart-h.border:-1}}function k1(t){return t.top<t.bottom||t.left<t.right}function Ls(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(k1(r))return r}return Array.prototype.find.call(n,k1)||t.getBoundingClientRect()}const k4=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function cj(t,e,n){let{node:r,offset:a,atom:i}=t.docView.domFromPos(e,n<0?-1:1),c=Sc||rr;if(r.nodeType==3)if(c&&(k4.test(r.nodeValue)||(n<0?!a:a==r.nodeValue.length))){let h=Ls(Zr(r,a,a),n);if(rr&&a&&/\s/.test(r.nodeValue[a-1])&&a<r.nodeValue.length){let p=Ls(Zr(r,a-1,a-1),-1);if(p.top==h.top){let m=Ls(Zr(r,a,a+1),-1);if(m.top!=h.top)return wl(m,m.left<p.left)}}return h}else{let h=a,p=a,m=n<0?1:-1;return n<0&&!a?(p++,m=-1):n>=0&&a==r.nodeValue.length?(h--,m=1):n<0?h--:p++,wl(Ls(Zr(r,h,p),m),m<0)}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&a&&(n<0||a==nr(r))){let h=r.childNodes[a-1];if(h.nodeType==1)return Am(h.getBoundingClientRect(),!1)}if(i==null&&a<nr(r)){let h=r.childNodes[a];if(h.nodeType==1)return Am(h.getBoundingClientRect(),!0)}return Am(r.getBoundingClientRect(),n>=0)}if(i==null&&a&&(n<0||a==nr(r))){let h=r.childNodes[a-1],p=h.nodeType==3?Zr(h,nr(h)-(c?0:1)):h.nodeType==1&&(h.nodeName!="BR"||!h.nextSibling)?h:null;if(p)return wl(Ls(p,1),!1)}if(i==null&&a<nr(r)){let h=r.childNodes[a];for(;h.pmViewDesc&&h.pmViewDesc.ignoreForCoords;)h=h.nextSibling;let p=h?h.nodeType==3?Zr(h,0,c?0:1):h.nodeType==1?h:null:null;if(p)return wl(Ls(p,-1),!0)}return wl(Ls(r.nodeType==3?Zr(r):r,-n),n>=0)}function wl(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function Am(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function dj(t,e,n){let r=t.state,a=t.root.activeElement;r!=e&&t.updateState(e),a!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),a!=t.dom&&a&&a.focus()}}function j4(t,e,n){let r=e.selection,a=n=="up"?r.$from:r.$to;return dj(t,e,()=>{let{node:i}=t.docView.domFromPos(a.pos,n=="up"?-1:1);for(;;){let u=t.docView.nearestDesc(i,!0);if(!u)break;if(u.node.isBlock){i=u.contentDOM||u.dom;break}i=u.dom.parentNode}let c=cj(t,a.pos,1);for(let u=i.firstChild;u;u=u.nextSibling){let h;if(u.nodeType==1)h=u.getClientRects();else if(u.nodeType==3)h=Zr(u,0,u.nodeValue.length).getClientRects();else continue;for(let p=0;p<h.length;p++){let m=h[p];if(m.bottom>m.top+1&&(n=="up"?c.top-m.top>(m.bottom-c.top)*2:m.bottom-c.bottom>(c.bottom-m.top)*2))return!1}}return!0})}const C4=/[\u0590-\u08ac]/;function T4(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let a=r.parentOffset,i=!a,c=a==r.parent.content.size,u=t.domSelection();return u?!C4.test(r.parent.textContent)||!u.modify?n=="left"||n=="backward"?i:c:dj(t,e,()=>{let{focusNode:h,focusOffset:p,anchorNode:m,anchorOffset:g}=t.domSelectionRange(),x=u.caretBidiLevel;u.modify("move",n,"character");let v=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:w,focusOffset:N}=t.domSelectionRange(),S=w&&!v.contains(w.nodeType==1?w:w.parentNode)||h==w&&p==N;try{u.collapse(m,g),h&&(h!=m||p!=g)&&u.extend&&u.extend(h,p)}catch{}return x!=null&&(u.caretBidiLevel=x),S}):r.pos==r.start()||r.pos==r.end()}let j1=null,C1=null,T1=!1;function E4(t,e,n){return j1==e&&C1==n?T1:(j1=e,C1=n,T1=n=="up"||n=="down"?j4(t,e,n):T4(t,e,n))}const sr=0,E1=1,Oa=2,Tr=3;class Nc{constructor(e,n,r,a){this.parent=e,this.children=n,this.dom=r,this.contentDOM=a,this.dirty=sr,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let a=this.children[n];if(a==e)return r;r+=a.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,c;if(e==this.contentDOM)i=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((c=i.pmViewDesc)&&c.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(c)+c.size:this.posAtStart}else{let i,c;if(e==this.contentDOM)i=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((c=i.pmViewDesc)&&c.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(c):this.posAtEnd}let a;if(e==this.dom&&this.contentDOM)a=n>en(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))a=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let i=e;;i=i.parentNode){if(i==this.dom){a=!1;break}if(i.previousSibling)break}if(a==null&&n==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){a=!0;break}if(i.nextSibling)break}}return a??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,a=e;a;a=a.parentNode){let i=this.getDesc(a),c;if(i&&(!n||i.node))if(r&&(c=i.nodeDOM)&&!(c.nodeType==1?c.contains(e.nodeType==1?e:e.parentNode):c==e))r=!1;else return i}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let a=e;a;a=a.parentNode){let i=this.getDesc(a);if(i)return i.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let a=this.children[n],i=r+a.size;if(r==e&&i!=r){for(;!a.border&&a.children.length;)for(let c=0;c<a.children.length;c++){let u=a.children[c];if(u.size){a=u;break}}return a}if(e<i)return a.descAt(e-r-a.border);r=i}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,a=0;for(let i=0;r<this.children.length;r++){let c=this.children[r],u=i+c.size;if(u>e||c instanceof hj){a=e-i;break}i=u}if(a)return this.children[r].domFromPos(a-this.children[r].border,n);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof uj&&i.side>=0;r--);if(n<=0){let i,c=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,c=!1);return i&&n&&c&&!i.border&&!i.domAtom?i.domFromPos(i.size,n):{node:this.contentDOM,offset:i?en(i.dom)+1:0}}else{let i,c=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,c=!1);return i&&c&&!i.border&&!i.domAtom?i.domFromPos(0,n):{node:this.contentDOM,offset:i?en(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let a=-1,i=-1;for(let c=r,u=0;;u++){let h=this.children[u],p=c+h.size;if(a==-1&&e<=p){let m=c+h.border;if(e>=m&&n<=p-h.border&&h.node&&h.contentDOM&&this.contentDOM.contains(h.contentDOM))return h.parseRange(e,n,m);e=c;for(let g=u;g>0;g--){let x=this.children[g-1];if(x.size&&x.dom.parentNode==this.contentDOM&&!x.emptyChildAt(1)){a=en(x.dom)+1;break}e-=x.size}a==-1&&(a=0)}if(a>-1&&(p>n||u==this.children.length-1)){n=p;for(let m=u+1;m<this.children.length;m++){let g=this.children[m];if(g.size&&g.dom.parentNode==this.contentDOM&&!g.emptyChildAt(-1)){i=en(g.dom);break}n+=g.size}i==-1&&(i=this.contentDOM.childNodes.length);break}c=p}return{node:this.contentDOM,from:e,to:n,fromOffset:a,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,a=!1){let i=Math.min(e,n),c=Math.max(e,n);for(let v=0,w=0;v<this.children.length;v++){let N=this.children[v],S=w+N.size;if(i>w&&c<S)return N.setSelection(e-w-N.border,n-w-N.border,r,a);w=S}let u=this.domFromPos(e,e?-1:1),h=n==e?u:this.domFromPos(n,n?-1:1),p=r.root.getSelection(),m=r.domSelectionRange(),g=!1;if((rr||ln)&&e==n){let{node:v,offset:w}=u;if(v.nodeType==3){if(g=!!(w&&v.nodeValue[w-1]==`
`),g&&w==v.nodeValue.length)for(let N=v,S;N;N=N.parentNode){if(S=N.nextSibling){S.nodeName=="BR"&&(u=h={node:S.parentNode,offset:en(S)+1});break}let j=N.pmViewDesc;if(j&&j.node&&j.node.isBlock)break}}else{let N=v.childNodes[w-1];g=N&&(N.nodeName=="BR"||N.contentEditable=="false")}}if(rr&&m.focusNode&&m.focusNode!=h.node&&m.focusNode.nodeType==1){let v=m.focusNode.childNodes[m.focusOffset];v&&v.contentEditable=="false"&&(a=!0)}if(!(a||g&&ln)&&qa(u.node,u.offset,m.anchorNode,m.anchorOffset)&&qa(h.node,h.offset,m.focusNode,m.focusOffset))return;let x=!1;if((p.extend||e==n)&&!(g&&rr)){p.collapse(u.node,u.offset);try{e!=n&&p.extend(h.node,h.offset),x=!0}catch{}}if(!x){if(e>n){let w=u;u=h,h=w}let v=document.createRange();v.setEnd(h.node,h.offset),v.setStart(u.node,u.offset),p.removeAllRanges(),p.addRange(v)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,a=0;a<this.children.length;a++){let i=this.children[a],c=r+i.size;if(r==c?e<=c&&n>=r:e<c&&n>r){let u=r+i.border,h=c-i.border;if(e>=u&&n<=h){this.dirty=e==r||n==c?Oa:E1,e==u&&n==h&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=Tr:i.markDirty(e-u,n-u);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?Oa:Tr}r=c}this.dirty=Oa}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?Oa:E1;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class uj extends Nc{constructor(e,n,r,a){let i,c=n.type.toDOM;if(typeof c=="function"&&(c=c(r,()=>{if(!i)return a;if(i.parent)return i.parent.posBeforeChild(i)})),!n.type.spec.raw){if(c.nodeType!=1){let u=document.createElement("span");u.appendChild(c),c=u}c.contentEditable="false",c.classList.add("ProseMirror-widget")}super(e,[],c,null),this.widget=n,this.widget=n,i=this}matchesWidget(e){return this.dirty==sr&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class R4 extends Nc{constructor(e,n,r,a){super(e,[],n,null),this.textDOM=r,this.text=a}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Wa extends Nc{constructor(e,n,r,a,i){super(e,[],r,a),this.mark=n,this.spec=i}static create(e,n,r,a){let i=a.nodeViews[n.type.name],c=i&&i(n,a,r);return(!c||!c.dom)&&(c=Xa.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new Wa(e,n,c.dom,c.contentDOM||c.dom,c)}parseRule(){return this.dirty&Tr||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Tr&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=sr){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=sr}}slice(e,n,r){let a=Wa.create(this.parent,this.mark,!0,r),i=this.children,c=this.size;n<c&&(i=Tg(i,n,c,r)),e>0&&(i=Tg(i,0,e,r));for(let u=0;u<i.length;u++)i[u].parent=a;return a.children=i,a}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class Qs extends Nc{constructor(e,n,r,a,i,c,u,h,p){super(e,[],i,c),this.node=n,this.outerDeco=r,this.innerDeco=a,this.nodeDOM=u}static create(e,n,r,a,i,c){let u=i.nodeViews[n.type.name],h,p=u&&u(n,i,()=>{if(!h)return c;if(h.parent)return h.parent.posBeforeChild(h)},r,a),m=p&&p.dom,g=p&&p.contentDOM;if(n.isText){if(!m)m=document.createTextNode(n.text);else if(m.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else m||({dom:m,contentDOM:g}=Xa.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!g&&!n.isText&&m.nodeName!="BR"&&(m.hasAttribute("contenteditable")||(m.contentEditable="false"),n.type.spec.draggable&&(m.draggable=!0));let x=m;return m=mj(m,r,n),p?h=new A4(e,n,r,a,m,g||null,x,p,i,c+1):n.isText?new kh(e,n,r,a,m,x,i):new Qs(e,n,r,a,m,g||null,x,i,c+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>le.empty)}return e}matchesNode(e,n,r){return this.dirty==sr&&e.eq(this.node)&&Au(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,a=n,i=e.composing?this.localCompositionInfo(e,n):null,c=i&&i.pos>-1?i:null,u=i&&i.pos<0,h=new M4(this,c&&c.node,e);L4(this.node,this.innerDeco,(p,m,g)=>{p.spec.marks?h.syncToMarks(p.spec.marks,r,e):p.type.side>=0&&!g&&h.syncToMarks(m==this.node.childCount?st.none:this.node.child(m).marks,r,e),h.placeWidget(p,e,a)},(p,m,g,x)=>{h.syncToMarks(p.marks,r,e);let v;h.findNodeMatch(p,m,g,x)||u&&e.state.selection.from>a&&e.state.selection.to<a+p.nodeSize&&(v=h.findIndexWithChild(i.node))>-1&&h.updateNodeAt(p,m,g,v,e)||h.updateNextNode(p,m,g,e,x,a)||h.addNode(p,m,g,e,a),a+=p.nodeSize}),h.syncToMarks([],r,e),this.node.isTextblock&&h.addTextblockHacks(),h.destroyRest(),(h.changed||this.dirty==Oa)&&(c&&this.protectLocalComposition(e,c),fj(this.contentDOM,this.children,e),mo&&$4(this.dom))}localCompositionInfo(e,n){let{from:r,to:a}=e.state.selection;if(!(e.state.selection instanceof _e)||r<n||a>n+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let c=i.nodeValue,u=B4(this.node.content,c,r-n,a-n);return u<0?null:{node:i,pos:u,text:c}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:a}){if(this.getDesc(n))return;let i=n;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let c=new R4(this,i,n,a);e.input.compositionNodes.push(c),this.children=Tg(this.children,r,r+a.length,e,c)}update(e,n,r,a){return this.dirty==Tr||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,a),!0)}updateInner(e,n,r,a){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(a,this.posAtStart),this.dirty=sr}updateOuterDeco(e){if(Au(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=pj(this.dom,this.nodeDOM,Cg(this.outerDeco,this.node,n),Cg(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function R1(t,e,n,r,a){mj(r,e,t);let i=new Qs(void 0,t,e,n,r,r,r,a,0);return i.contentDOM&&i.updateChildren(a,0),i}class kh extends Qs{constructor(e,n,r,a,i,c,u){super(e,n,r,a,i,null,c,u,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,a){return this.dirty==Tr||this.dirty!=sr&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=sr||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,a.trackWrites==this.nodeDOM&&(a.trackWrites=null)),this.node=e,this.dirty=sr,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let a=this.node.cut(e,n),i=document.createTextNode(a.text);return new kh(this.parent,a,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=Tr)}get domAtom(){return!1}isText(e){return this.node.text==e}}class hj extends Nc{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==sr&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class A4 extends Qs{constructor(e,n,r,a,i,c,u,h,p,m){super(e,n,r,a,i,c,u,p,m),this.spec=h}update(e,n,r,a){if(this.dirty==Tr)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,a),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,a)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,a){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,a)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function fj(t,e,n){let r=t.firstChild,a=!1;for(let i=0;i<e.length;i++){let c=e[i],u=c.dom;if(u.parentNode==t){for(;u!=r;)r=A1(r),a=!0;r=r.nextSibling}else a=!0,t.insertBefore(u,r);if(c instanceof Wa){let h=r?r.previousSibling:t.lastChild;fj(c.contentDOM,c.children,n),r=h?h.nextSibling:t.firstChild}}for(;r;)r=A1(r),a=!0;a&&n.trackWrites==t&&(n.trackWrites=null)}const zl=function(t){t&&(this.nodeName=t)};zl.prototype=Object.create(null);const Da=[new zl];function Cg(t,e,n){if(t.length==0)return Da;let r=n?Da[0]:new zl,a=[r];for(let i=0;i<t.length;i++){let c=t[i].type.attrs;if(c){c.nodeName&&a.push(r=new zl(c.nodeName));for(let u in c){let h=c[u];h!=null&&(n&&a.length==1&&a.push(r=new zl(e.isInline?"span":"div")),u=="class"?r.class=(r.class?r.class+" ":"")+h:u=="style"?r.style=(r.style?r.style+";":"")+h:u!="nodeName"&&(r[u]=h))}}}return a}function pj(t,e,n,r){if(n==Da&&r==Da)return e;let a=e;for(let i=0;i<r.length;i++){let c=r[i],u=n[i];if(i){let h;u&&u.nodeName==c.nodeName&&a!=t&&(h=a.parentNode)&&h.nodeName.toLowerCase()==c.nodeName||(h=document.createElement(c.nodeName),h.pmIsDeco=!0,h.appendChild(a),u=Da[0]),a=h}_4(a,u||Da[0],c)}return a}function _4(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],a=n.class?n.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)a.indexOf(r[i])==-1&&t.classList.remove(r[i]);for(let i=0;i<a.length;i++)r.indexOf(a[i])==-1&&t.classList.add(a[i]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,a;for(;a=r.exec(e.style);)t.style.removeProperty(a[1])}n.style&&(t.style.cssText+=n.style)}}function mj(t,e,n){return pj(t,t,Da,Cg(e,n,t.nodeType!=1))}function Au(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function A1(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class M4{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=O4(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let a=0,i=this.stack.length>>1,c=Math.min(i,e.length);for(;a<c&&(a==i-1?this.top:this.stack[a+1<<1]).matchesMark(e[a])&&e[a].type.spec.spanning!==!1;)a++;for(;a<i;)this.destroyRest(),this.top.dirty=sr,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let u=-1;for(let h=this.index;h<Math.min(this.index+3,this.top.children.length);h++){let p=this.top.children[h];if(p.matchesMark(e[i])&&!this.isLocked(p.dom)){u=h;break}}if(u>-1)u>this.index&&(this.changed=!0,this.destroyBetween(this.index,u)),this.top=this.top.children[this.index];else{let h=Wa.create(this.top,e[i],n,r);this.top.children.splice(this.index,0,h),this.top=h,this.changed=!0}this.index=0,i++}}findNodeMatch(e,n,r,a){let i=-1,c;if(a>=this.preMatch.index&&(c=this.preMatch.matches[a-this.preMatch.index]).parent==this.top&&c.matchesNode(e,n,r))i=this.top.children.indexOf(c,this.index);else for(let u=this.index,h=Math.min(this.top.children.length,u+5);u<h;u++){let p=this.top.children[u];if(p.matchesNode(e,n,r)&&!this.preMatch.matched.has(p)){i=u;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,n,r,a,i){let c=this.top.children[a];return c.dirty==Tr&&c.dom==c.contentDOM&&(c.dirty=Oa),c.update(e,n,r,i)?(this.destroyBetween(this.index,a),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let a=this.index;a<this.top.children.length;a++)if(this.top.children[a]==r)return a}return-1}e=n}}updateNextNode(e,n,r,a,i,c){for(let u=this.index;u<this.top.children.length;u++){let h=this.top.children[u];if(h instanceof Qs){let p=this.preMatch.matched.get(h);if(p!=null&&p!=i)return!1;let m=h.dom,g,x=this.isLocked(m)&&!(e.isText&&h.node&&h.node.isText&&h.nodeDOM.nodeValue==e.text&&h.dirty!=Tr&&Au(n,h.outerDeco));if(!x&&h.update(e,n,r,a))return this.destroyBetween(this.index,u),h.dom!=m&&(this.changed=!0),this.index++,!0;if(!x&&(g=this.recreateWrapper(h,e,n,r,a,c)))return this.destroyBetween(this.index,u),this.top.children[this.index]=g,g.contentDOM&&(g.dirty=Oa,g.updateChildren(a,c+1),g.dirty=sr),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,a,i,c){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!Au(r,e.outerDeco)||!a.eq(e.innerDeco))return null;let u=Qs.create(this.top,n,r,a,i,c);if(u.contentDOM){u.children=e.children,e.children=[];for(let h of u.children)h.parent=u}return e.destroy(),u}addNode(e,n,r,a,i){let c=Qs.create(this.top,e,n,r,a,i);c.contentDOM&&c.updateChildren(a,i+1),this.top.children.splice(this.index++,0,c),this.changed=!0}placeWidget(e,n,r){let a=this.index<this.top.children.length?this.top.children[this.index]:null;if(a&&a.matchesWidget(e)&&(e==a.widget||!a.widget.type.toDOM.parentNode))this.index++;else{let i=new uj(this.top,e,n,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof Wa;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof kh)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((ln||Vt)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let a=new hj(this.top,[],r,null);n!=this.top?n.children.push(a):n.children.splice(this.index++,0,a),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function O4(t,e){let n=e,r=n.children.length,a=t.childCount,i=new Map,c=[];e:for(;a>0;){let u;for(;;)if(r){let p=n.children[r-1];if(p instanceof Wa)n=p,r=p.children.length;else{u=p,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let h=u.node;if(h){if(h!=t.child(a-1))break;--a,i.set(u,a),c.push(u)}}return{index:a,matched:i,matches:c.reverse()}}function D4(t,e){return t.type.side-e.type.side}function L4(t,e,n,r){let a=e.locals(t),i=0;if(a.length==0){for(let p=0;p<t.childCount;p++){let m=t.child(p);r(m,a,e.forChild(i,m),p),i+=m.nodeSize}return}let c=0,u=[],h=null;for(let p=0;;){let m,g;for(;c<a.length&&a[c].to==i;){let S=a[c++];S.widget&&(m?(g||(g=[m])).push(S):m=S)}if(m)if(g){g.sort(D4);for(let S=0;S<g.length;S++)n(g[S],p,!!h)}else n(m,p,!!h);let x,v;if(h)v=-1,x=h,h=null;else if(p<t.childCount)v=p,x=t.child(p++);else break;for(let S=0;S<u.length;S++)u[S].to<=i&&u.splice(S--,1);for(;c<a.length&&a[c].from<=i&&a[c].to>i;)u.push(a[c++]);let w=i+x.nodeSize;if(x.isText){let S=w;c<a.length&&a[c].from<S&&(S=a[c].from);for(let j=0;j<u.length;j++)u[j].to<S&&(S=u[j].to);S<w&&(h=x.cut(S-i),x=x.cut(0,S-i),w=S,v=-1)}else for(;c<a.length&&a[c].to<w;)c++;let N=x.isInline&&!x.isLeaf?u.filter(S=>!S.inline):u.slice();r(x,N,e.forChild(i,x),v),i=w}}function $4(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function B4(t,e,n,r){for(let a=0,i=0;a<t.childCount&&i<=r;){let c=t.child(a++),u=i;if(i+=c.nodeSize,!c.isText)continue;let h=c.text;for(;a<t.childCount;){let p=t.child(a++);if(i+=p.nodeSize,!p.isText)break;h+=p.text}if(i>=n){if(i>=r&&h.slice(r-e.length-u,r-u)==e)return r-e.length;let p=u<r?h.lastIndexOf(e,r-u-1):-1;if(p>=0&&p+e.length+u>=n)return u+p;if(n==r&&h.length>=r+e.length-u&&h.slice(r-u,r-u+e.length)==e)return r}}return-1}function Tg(t,e,n,r,a){let i=[];for(let c=0,u=0;c<t.length;c++){let h=t[c],p=u,m=u+=h.size;p>=n||m<=e?i.push(h):(p<e&&i.push(h.slice(0,e-p,r)),a&&(i.push(a),a=void 0),m>n&&i.push(h.slice(n-p,h.size,r)))}return i}function py(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let a=t.docView.nearestDesc(n.focusNode),i=a&&a.size==0,c=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(c<0)return null;let u=r.resolve(c),h,p;if(Nh(n)){for(h=c;a&&!a.node;)a=a.parent;let g=a.node;if(a&&g.isAtom&&Te.isSelectable(g)&&a.parent&&!(g.isInline&&d4(n.focusNode,n.focusOffset,a.dom))){let x=a.posBefore;p=new Te(c==x?u:r.resolve(x))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let g=c,x=c;for(let v=0;v<n.rangeCount;v++){let w=n.getRangeAt(v);g=Math.min(g,t.docView.posFromDOM(w.startContainer,w.startOffset,1)),x=Math.max(x,t.docView.posFromDOM(w.endContainer,w.endOffset,-1))}if(g<0)return null;[h,c]=x==t.state.selection.anchor?[x,g]:[g,x],u=r.resolve(c)}else h=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(h<0)return null}let m=r.resolve(h);if(!p){let g=e=="pointer"||t.state.selection.head<u.pos&&!i?1:-1;p=my(t,m,u,g)}return p}function gj(t){return t.editable?t.hasFocus():xj(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function ns(t,e=!1){let n=t.state.selection;if(yj(t,n),!!gj(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&Vt){let r=t.domSelectionRange(),a=t.domObserver.currentSelection;if(r.anchorNode&&a.anchorNode&&qa(r.anchorNode,r.anchorOffset,a.anchorNode,a.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)P4(t);else{let{anchor:r,head:a}=n,i,c;_1&&!(n instanceof _e)&&(n.$from.parent.inlineContent||(i=M1(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(c=M1(t,n.to))),t.docView.setSelection(r,a,t,e),_1&&(i&&O1(i),c&&O1(c)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&I4(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const _1=ln||Vt&&rj<63;function M1(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),a=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(ln&&a&&a.contentEditable=="false")return _m(a);if((!a||a.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(a)return _m(a);if(i)return _m(i)}}function _m(t){return t.contentEditable="true",ln&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function O1(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function I4(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,a=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=a)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!gj(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function P4(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,en(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&Nn&&Js<=11&&(n.disabled=!0,n.disabled=!1)}function yj(t,e){if(e instanceof Te){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(D1(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else D1(t)}function D1(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function my(t,e,n,r){return t.someProp("createSelectionBetween",a=>a(t,e,n))||_e.between(e,n,r)}function L1(t){return t.editable&&!t.hasFocus()?!1:xj(t)}function xj(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function z4(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return qa(e.node,e.offset,n.anchorNode,n.anchorOffset)}function Eg(t,e){let{$anchor:n,$head:r}=t.selection,a=e>0?n.max(r):n.min(r),i=a.parent.inlineContent?a.depth?t.doc.resolve(e>0?a.after():a.before()):null:a;return i&&Be.findFrom(i,e)}function Bs(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function $1(t,e,n){let r=t.state.selection;if(r instanceof _e)if(n.indexOf("s")>-1){let{$head:a}=r,i=a.textOffset?null:e<0?a.nodeBefore:a.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let c=t.state.doc.resolve(a.pos+i.nodeSize*(e<0?-1:1));return Bs(t,new _e(r.$anchor,c))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let a=Eg(t.state,e);return a&&a instanceof Te?Bs(t,a):!1}else if(!(er&&n.indexOf("m")>-1)){let a=r.$head,i=a.textOffset?null:e<0?a.nodeBefore:a.nodeAfter,c;if(!i||i.isText)return!1;let u=e<0?a.pos-i.nodeSize:a.pos;return i.isAtom||(c=t.docView.descAt(u))&&!c.contentDOM?Te.isSelectable(i)?Bs(t,new Te(e<0?t.state.doc.resolve(a.pos-i.nodeSize):a)):Sc?Bs(t,new _e(t.state.doc.resolve(e<0?u:u+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof Te&&r.node.isInline)return Bs(t,new _e(e>0?r.$to:r.$from));{let a=Eg(t.state,e);return a?Bs(t,a):!1}}}function _u(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Ul(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function Yi(t,e){return e<0?U4(t):H4(t)}function U4(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let a,i,c=!1;for(rr&&n.nodeType==1&&r<_u(n)&&Ul(n.childNodes[r],-1)&&(c=!0);;)if(r>0){if(n.nodeType!=1)break;{let u=n.childNodes[r-1];if(Ul(u,-1))a=n,i=--r;else if(u.nodeType==3)n=u,r=n.nodeValue.length;else break}}else{if(bj(n))break;{let u=n.previousSibling;for(;u&&Ul(u,-1);)a=n.parentNode,i=en(u),u=u.previousSibling;if(u)n=u,r=_u(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}c?Rg(t,n,r):a&&Rg(t,a,i)}function H4(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let a=_u(n),i,c;for(;;)if(r<a){if(n.nodeType!=1)break;let u=n.childNodes[r];if(Ul(u,1))i=n,c=++r;else break}else{if(bj(n))break;{let u=n.nextSibling;for(;u&&Ul(u,1);)i=u.parentNode,c=en(u)+1,u=u.nextSibling;if(u)n=u,r=0,a=_u(n);else{if(n=n.parentNode,n==t.dom)break;r=a=0}}}i&&Rg(t,i,c)}function bj(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function V4(t,e){for(;t&&e==t.childNodes.length&&!wc(t);)e=en(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function F4(t,e){for(;t&&!e&&!wc(t);)e=en(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function Rg(t,e,n){if(e.nodeType!=3){let i,c;(c=V4(e,n))?(e=c,n=0):(i=F4(e,n))&&(e=i,n=i.nodeValue.length)}let r=t.domSelection();if(!r)return;if(Nh(r)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:a}=t;setTimeout(()=>{t.state==a&&ns(t)},50)}function B1(t,e){let n=t.state.doc.resolve(e);if(!(Vt||sj)&&n.parent.inlineContent){let a=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),c=(i.top+i.bottom)/2;if(c>a.top&&c<a.bottom&&Math.abs(i.left-a.left)>1)return i.left<a.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),c=(i.top+i.bottom)/2;if(c>a.top&&c<a.bottom&&Math.abs(i.left-a.left)>1)return i.left>a.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function I1(t,e,n){let r=t.state.selection;if(r instanceof _e&&!r.empty||n.indexOf("s")>-1||er&&n.indexOf("m")>-1)return!1;let{$from:a,$to:i}=r;if(!a.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let c=Eg(t.state,e);if(c&&c instanceof Te)return Bs(t,c)}if(!a.parent.inlineContent){let c=e<0?a:i,u=r instanceof Pn?Be.near(c,e):Be.findFrom(c,e);return u?Bs(t,u):!1}return!1}function P1(t,e){if(!(t.state.selection instanceof _e))return!0;let{$head:n,$anchor:r,empty:a}=t.state.selection;if(!n.sameParent(r))return!0;if(!a)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let c=t.state.tr;return e<0?c.delete(n.pos-i.nodeSize,n.pos):c.delete(n.pos,n.pos+i.nodeSize),t.dispatch(c),!0}return!1}function z1(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function G4(t){if(!ln||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;z1(t,r,"true"),setTimeout(()=>z1(t,r,"false"),20)}return!1}function q4(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function W4(t,e){let n=e.keyCode,r=q4(e);if(n==8||er&&n==72&&r=="c")return P1(t,-1)||Yi(t,-1);if(n==46&&!e.shiftKey||er&&n==68&&r=="c")return P1(t,1)||Yi(t,1);if(n==13||n==27)return!0;if(n==37||er&&n==66&&r=="c"){let a=n==37?B1(t,t.state.selection.from)=="ltr"?-1:1:-1;return $1(t,a,r)||Yi(t,a)}else if(n==39||er&&n==70&&r=="c"){let a=n==39?B1(t,t.state.selection.from)=="ltr"?1:-1:1;return $1(t,a,r)||Yi(t,a)}else{if(n==38||er&&n==80&&r=="c")return I1(t,-1,r)||Yi(t,-1);if(n==40||er&&n==78&&r=="c")return G4(t)||I1(t,1,r)||Yi(t,1);if(r==(er?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function gy(t,e){t.someProp("transformCopied",v=>{e=v(e,t)});let n=[],{content:r,openStart:a,openEnd:i}=e;for(;a>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){a--,i--;let v=r.firstChild;n.push(v.type.name,v.attrs!=v.type.defaultAttrs?v.attrs:null),r=v.content}let c=t.someProp("clipboardSerializer")||Xa.fromSchema(t.state.schema),u=jj(),h=u.createElement("div");h.appendChild(c.serializeFragment(r,{document:u}));let p=h.firstChild,m,g=0;for(;p&&p.nodeType==1&&(m=kj[p.nodeName.toLowerCase()]);){for(let v=m.length-1;v>=0;v--){let w=u.createElement(m[v]);for(;h.firstChild;)w.appendChild(h.firstChild);h.appendChild(w),g++}p=h.firstChild}p&&p.nodeType==1&&p.setAttribute("data-pm-slice",`${a} ${i}${g?` -${g}`:""} ${JSON.stringify(n)}`);let x=t.someProp("clipboardTextSerializer",v=>v(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:h,text:x,slice:e}}function vj(t,e,n,r,a){let i=a.parent.type.spec.code,c,u;if(!n&&!e)return null;let h=!!e&&(r||i||!n);if(h){if(t.someProp("transformPastedText",x=>{e=x(e,i||r,t)}),i)return u=new pe(le.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",x=>{u=x(u,t,!0)}),u;let g=t.someProp("clipboardTextParser",x=>x(e,a,r,t));if(g)u=g;else{let x=a.marks(),{schema:v}=t.state,w=Xa.fromSchema(v);c=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(N=>{let S=c.appendChild(document.createElement("p"));N&&S.appendChild(w.serializeNode(v.text(N,x)))})}}else t.someProp("transformPastedHTML",g=>{n=g(n,t)}),c=Q4(n),Sc&&X4(c);let p=c&&c.querySelector("[data-pm-slice]"),m=p&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(p.getAttribute("data-pm-slice")||"");if(m&&m[3])for(let g=+m[3];g>0;g--){let x=c.firstChild;for(;x&&x.nodeType!=1;)x=x.nextSibling;if(!x)break;c=x}if(u||(u=(t.someProp("clipboardParser")||t.someProp("domParser")||Ys.fromSchema(t.state.schema)).parseSlice(c,{preserveWhitespace:!!(h||m),context:a,ruleFromNode(x){return x.nodeName=="BR"&&!x.nextSibling&&x.parentNode&&!K4.test(x.parentNode.nodeName)?{ignore:!0}:null}})),m)u=Z4(U1(u,+m[1],+m[2]),m[4]);else if(u=pe.maxOpen(Y4(u.content,a),!0),u.openStart||u.openEnd){let g=0,x=0;for(let v=u.content.firstChild;g<u.openStart&&!v.type.spec.isolating;g++,v=v.firstChild);for(let v=u.content.lastChild;x<u.openEnd&&!v.type.spec.isolating;x++,v=v.lastChild);u=U1(u,g,x)}return t.someProp("transformPasted",g=>{u=g(u,t,h)}),u}const K4=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Y4(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let a=e.node(n).contentMatchAt(e.index(n)),i,c=[];if(t.forEach(u=>{if(!c)return;let h=a.findWrapping(u.type),p;if(!h)return c=null;if(p=c.length&&i.length&&Sj(h,i,u,c[c.length-1],0))c[c.length-1]=p;else{c.length&&(c[c.length-1]=Nj(c[c.length-1],i.length));let m=wj(u,h);c.push(m),a=a.matchType(m.type),i=h}}),c)return le.from(c)}return t}function wj(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,le.from(t));return t}function Sj(t,e,n,r,a){if(a<t.length&&a<e.length&&t[a]==e[a]){let i=Sj(t,e,n,r.lastChild,a+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(a==t.length-1?n.type:t[a+1]))return r.copy(r.content.append(le.from(wj(n,t,a+1))))}}function Nj(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,Nj(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(le.empty,!0);return t.copy(n.append(r))}function Ag(t,e,n,r,a,i){let c=e<0?t.firstChild:t.lastChild,u=c.content;return t.childCount>1&&(i=0),a<r-1&&(u=Ag(u,e,n,r,a+1,i)),a>=n&&(u=e<0?c.contentMatchAt(0).fillBefore(u,i<=a).append(u):u.append(c.contentMatchAt(c.childCount).fillBefore(le.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,c.copy(u))}function U1(t,e,n){return e<t.openStart&&(t=new pe(Ag(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new pe(Ag(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const kj={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let H1=null;function jj(){return H1||(H1=document.implementation.createHTMLDocument("title"))}let Mm=null;function J4(t){let e=window.trustedTypes;return e?(Mm||(Mm=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),Mm.createHTML(t)):t}function Q4(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=jj().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),a;if((a=r&&kj[r[1].toLowerCase()])&&(t=a.map(i=>"<"+i+">").join("")+t+a.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=J4(t),a)for(let i=0;i<a.length;i++)n=n.querySelector(a[i])||n;return n}function X4(t){let e=t.querySelectorAll(Vt?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function Z4(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:a,openStart:i,openEnd:c}=t;for(let u=r.length-2;u>=0;u-=2){let h=n.nodes[r[u]];if(!h||h.hasRequiredAttrs())break;a=le.from(h.create(r[u+1],a)),i++,c++}return new pe(a,i,c)}const hn={},fn={},e5={touchstart:!0,touchmove:!0};class t5{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function n5(t){for(let e in hn){let n=hn[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{s5(t,r)&&!yy(t,r)&&(t.editable||!(r.type in fn))&&n(t,r)},e5[e]?{passive:!0}:void 0)}ln&&t.dom.addEventListener("input",()=>null),_g(t)}function Ws(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function r5(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function _g(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>yy(t,r))})}function yy(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function s5(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function a5(t,e){!yy(t,e)&&hn[e.type]&&(t.editable||!(e.type in fn))&&hn[e.type](t,e)}fn.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!Tj(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(es&&Vt&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),mo&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",a=>a(t,_a(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||W4(t,n)?n.preventDefault():Ws(t,"key")};fn.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};fn.keypress=(t,e)=>{let n=e;if(Tj(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||er&&n.metaKey)return;if(t.someProp("handleKeyPress",a=>a(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof _e)||!r.$from.sameParent(r.$to)){let a=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(a).scrollIntoView();!/[\r\n]/.test(a)&&!t.someProp("handleTextInput",c=>c(t,r.$from.pos,r.$to.pos,a,i))&&t.dispatch(i()),n.preventDefault()}};function jh(t){return{left:t.clientX,top:t.clientY}}function i5(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function xy(t,e,n,r,a){if(r==-1)return!1;let i=t.state.doc.resolve(r);for(let c=i.depth+1;c>0;c--)if(t.someProp(e,u=>c>i.depth?u(t,n,i.nodeAfter,i.before(c),a,!0):u(t,n,i.node(c),i.before(c),a,!1)))return!0;return!1}function uo(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function o5(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&Te.isSelectable(r)?(uo(t,new Te(n)),!0):!1}function l5(t,e){if(e==-1)return!1;let n=t.state.selection,r,a;n instanceof Te&&(r=n.node);let i=t.state.doc.resolve(e);for(let c=i.depth+1;c>0;c--){let u=c>i.depth?i.nodeAfter:i.node(c);if(Te.isSelectable(u)){r&&n.$from.depth>0&&c>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?a=i.before(n.$from.depth):a=i.before(c);break}}return a!=null?(uo(t,Te.create(t.state.doc,a)),!0):!1}function c5(t,e,n,r,a){return xy(t,"handleClickOn",e,n,r)||t.someProp("handleClick",i=>i(t,e,r))||(a?l5(t,n):o5(t,n))}function d5(t,e,n,r){return xy(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",a=>a(t,e,r))}function u5(t,e,n,r){return xy(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",a=>a(t,e,r))||h5(t,n,r)}function h5(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(uo(t,_e.create(r,0,r.content.size)),!0):!1;let a=r.resolve(e);for(let i=a.depth+1;i>0;i--){let c=i>a.depth?a.nodeAfter:a.node(i),u=a.before(i);if(c.inlineContent)uo(t,_e.create(r,u+1,u+1+c.content.size));else if(Te.isSelectable(c))uo(t,Te.create(r,u));else continue;return!0}}function by(t){return Mu(t)}const Cj=er?"metaKey":"ctrlKey";hn.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=by(t),a=Date.now(),i="singleClick";a-t.input.lastClick.time<500&&i5(n,t.input.lastClick)&&!n[Cj]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:a,x:n.clientX,y:n.clientY,type:i,button:n.button};let c=t.posAtCoords(jh(n));c&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new f5(t,c,n,!!r)):(i=="doubleClick"?d5:u5)(t,c.pos,c.inside,n)?n.preventDefault():Ws(t,"pointer"))};class f5{constructor(e,n,r,a){this.view=e,this.pos=n,this.event=r,this.flushed=a,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[Cj],this.allowDefault=r.shiftKey;let i,c;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),c=n.inside;else{let m=e.state.doc.resolve(n.pos);i=m.parent,c=m.depth?m.before():0}const u=a?null:r.target,h=u?e.docView.nearestDesc(u,!0):null;this.target=h&&h.nodeDOM.nodeType==1?h.nodeDOM:null;let{selection:p}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||p instanceof Te&&p.from<=c&&p.to>c)&&(this.mightDrag={node:i,pos:c,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&rr&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Ws(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>ns(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(jh(e))),this.updateAllowDefault(e),this.allowDefault||!n?Ws(this.view,"pointer"):c5(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||ln&&this.mightDrag&&!this.mightDrag.node.isAtom||Vt&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(uo(this.view,Be.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):Ws(this.view,"pointer")}move(e){this.updateAllowDefault(e),Ws(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}hn.touchstart=t=>{t.input.lastTouch=Date.now(),by(t),Ws(t,"pointer")};hn.touchmove=t=>{t.input.lastTouch=Date.now(),Ws(t,"pointer")};hn.contextmenu=t=>by(t);function Tj(t,e){return t.composing?!0:ln&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const p5=es?5e3:-1;fn.compositionstart=fn.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof _e&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||Vt&&sj&&m5(t)))t.markCursor=t.state.storedMarks||n.marks(),Mu(t,!0),t.markCursor=null;else if(Mu(t,!e.selection.empty),rr&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let a=r.focusNode,i=r.focusOffset;a&&a.nodeType==1&&i!=0;){let c=i<0?a.lastChild:a.childNodes[i-1];if(!c)break;if(c.nodeType==3){let u=t.domSelection();u&&u.collapse(c,c.nodeValue.length);break}else a=c,i=-1}}t.input.composing=!0}Ej(t,p5)};function m5(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}fn.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,Ej(t,20))};function Ej(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>Mu(t),e))}function Rj(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=y5());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function g5(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=l4(e.focusNode,e.focusOffset),r=c4(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let a=r.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!a||!a.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let c=n.pmViewDesc;if(!(!c||!c.isText(n.nodeValue)))return r}}return n||r}function y5(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function Mu(t,e=!1){if(!(es&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),Rj(t),e||t.docView&&t.docView.dirty){let n=py(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function x5(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),a=document.createRange();a.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(a),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const uc=Nn&&Js<15||mo&&f4<604;hn.copy=fn.cut=(t,e)=>{let n=e,r=t.state.selection,a=n.type=="cut";if(r.empty)return;let i=uc?null:n.clipboardData,c=r.content(),{dom:u,text:h}=gy(t,c);i?(n.preventDefault(),i.clearData(),i.setData("text/html",u.innerHTML),i.setData("text/plain",h)):x5(t,u),a&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function b5(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function v5(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let a=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?hc(t,r.value,null,a,e):hc(t,r.textContent,r.innerHTML,a,e)},50)}function hc(t,e,n,r,a){let i=vj(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",h=>h(t,a,i||pe.empty)))return!0;if(!i)return!1;let c=b5(i),u=c?t.state.tr.replaceSelectionWith(c,r):t.state.tr.replaceSelection(i);return t.dispatch(u.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Aj(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}fn.paste=(t,e)=>{let n=e;if(t.composing&&!es)return;let r=uc?null:n.clipboardData,a=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&hc(t,Aj(r),r.getData("text/html"),a,n)?n.preventDefault():v5(t,n)};class _j{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const w5=er?"altKey":"ctrlKey";function Mj(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[w5]}hn.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let a=t.state.selection,i=a.empty?null:t.posAtCoords(jh(n)),c;if(!(i&&i.pos>=a.from&&i.pos<=(a instanceof Te?a.to-1:a.to))){if(r&&r.mightDrag)c=Te.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let g=t.docView.nearestDesc(n.target,!0);g&&g.node.type.spec.draggable&&g!=t.docView&&(c=Te.create(t.state.doc,g.posBefore))}}let u=(c||t.state.selection).content(),{dom:h,text:p,slice:m}=gy(t,u);(!n.dataTransfer.files.length||!Vt||rj>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(uc?"Text":"text/html",h.innerHTML),n.dataTransfer.effectAllowed="copyMove",uc||n.dataTransfer.setData("text/plain",p),t.dragging=new _j(m,Mj(t,n),c)};hn.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};fn.dragover=fn.dragenter=(t,e)=>e.preventDefault();fn.drop=(t,e)=>{try{S5(t,e,t.dragging)}finally{t.dragging=null}};function S5(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(jh(e));if(!r)return;let a=t.state.doc.resolve(r.pos),i=n&&n.slice;i?t.someProp("transformPasted",v=>{i=v(i,t,!1)}):i=vj(t,Aj(e.dataTransfer),uc?null:e.dataTransfer.getData("text/html"),!1,a);let c=!!(n&&Mj(t,e));if(t.someProp("handleDrop",v=>v(t,e,i||pe.empty,c))){e.preventDefault();return}if(!i)return;e.preventDefault();let u=i?$k(t.state.doc,a.pos,i):a.pos;u==null&&(u=a.pos);let h=t.state.tr;if(c){let{node:v}=n;v?v.replace(h):h.deleteSelection()}let p=h.mapping.map(u),m=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,g=h.doc;if(m?h.replaceRangeWith(p,p,i.content.firstChild):h.replaceRange(p,p,i),h.doc.eq(g))return;let x=h.doc.resolve(p);if(m&&Te.isSelectable(i.content.firstChild)&&x.nodeAfter&&x.nodeAfter.sameMarkup(i.content.firstChild))h.setSelection(new Te(x));else{let v=h.mapping.map(u);h.mapping.maps[h.mapping.maps.length-1].forEach((w,N,S,j)=>v=j),h.setSelection(my(t,x,h.doc.resolve(v)))}t.focus(),t.dispatch(h.setMeta("uiEvent","drop"))}hn.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&ns(t)},20))};hn.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};hn.beforeinput=(t,e)=>{if(Vt&&es&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,_a(8,"Backspace")))))return;let{$cursor:a}=t.state.selection;a&&a.pos>0&&t.dispatch(t.state.tr.delete(a.pos-1,a.pos).scrollIntoView())},50)}};for(let t in fn)hn[t]=fn[t];function fc(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Ou{constructor(e,n){this.toDOM=e,this.spec=n||Pa,this.side=this.spec.side||0}map(e,n,r,a){let{pos:i,deleted:c}=e.mapResult(n.from+a,this.side<0?-1:1);return c?null:new un(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Ou&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&fc(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class Xs{constructor(e,n){this.attrs=e,this.spec=n||Pa}map(e,n,r,a){let i=e.map(n.from+a,this.spec.inclusiveStart?-1:1)-r,c=e.map(n.to+a,this.spec.inclusiveEnd?1:-1)-r;return i>=c?null:new un(i,c,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof Xs&&fc(this.attrs,e.attrs)&&fc(this.spec,e.spec)}static is(e){return e.type instanceof Xs}destroy(){}}class vy{constructor(e,n){this.attrs=e,this.spec=n||Pa}map(e,n,r,a){let i=e.mapResult(n.from+a,1);if(i.deleted)return null;let c=e.mapResult(n.to+a,-1);return c.deleted||c.pos<=i.pos?null:new un(i.pos-r,c.pos-r,this)}valid(e,n){let{index:r,offset:a}=e.content.findIndex(n.from),i;return a==n.from&&!(i=e.child(r)).isText&&a+i.nodeSize==n.to}eq(e){return this==e||e instanceof vy&&fc(this.attrs,e.attrs)&&fc(this.spec,e.spec)}destroy(){}}class un{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new un(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new un(e,e,new Ou(n,r))}static inline(e,n,r,a){return new un(e,n,new Xs(r,a))}static node(e,n,r,a){return new un(e,n,new vy(r,a))}get spec(){return this.type.spec}get inline(){return this.type instanceof Xs}get widget(){return this.type instanceof Ou}}const no=[],Pa={};class ft{constructor(e,n){this.local=e.length?e:no,this.children=n.length?n:no}static create(e,n){return n.length?Du(n,e,0,Pa):rn}find(e,n,r){let a=[];return this.findInner(e??0,n??1e9,a,0,r),a}findInner(e,n,r,a,i){for(let c=0;c<this.local.length;c++){let u=this.local[c];u.from<=n&&u.to>=e&&(!i||i(u.spec))&&r.push(u.copy(u.from+a,u.to+a))}for(let c=0;c<this.children.length;c+=3)if(this.children[c]<n&&this.children[c+1]>e){let u=this.children[c]+1;this.children[c+2].findInner(e-u,n-u,r,a+u,i)}}map(e,n,r){return this==rn||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Pa)}mapInner(e,n,r,a,i){let c;for(let u=0;u<this.local.length;u++){let h=this.local[u].map(e,r,a);h&&h.type.valid(n,h)?(c||(c=[])).push(h):i.onRemove&&i.onRemove(this.local[u].spec)}return this.children.length?N5(this.children,c||[],e,n,r,a,i):c?new ft(c.sort(za),no):rn}add(e,n){return n.length?this==rn?ft.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let a,i=0;e.forEach((u,h)=>{let p=h+r,m;if(m=Dj(n,u,p)){for(a||(a=this.children.slice());i<a.length&&a[i]<h;)i+=3;a[i]==h?a[i+2]=a[i+2].addInner(u,m,p+1):a.splice(i,0,h,h+u.nodeSize,Du(m,u,p+1,Pa)),i+=3}});let c=Oj(i?Lj(n):n,-r);for(let u=0;u<c.length;u++)c[u].type.valid(e,c[u])||c.splice(u--,1);return new ft(c.length?this.local.concat(c).sort(za):this.local,a||this.children)}remove(e){return e.length==0||this==rn?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,a=this.local;for(let i=0;i<r.length;i+=3){let c,u=r[i]+n,h=r[i+1]+n;for(let m=0,g;m<e.length;m++)(g=e[m])&&g.from>u&&g.to<h&&(e[m]=null,(c||(c=[])).push(g));if(!c)continue;r==this.children&&(r=this.children.slice());let p=r[i+2].removeInner(c,u+1);p!=rn?r[i+2]=p:(r.splice(i,3),i-=3)}if(a.length){for(let i=0,c;i<e.length;i++)if(c=e[i])for(let u=0;u<a.length;u++)a[u].eq(c,n)&&(a==this.local&&(a=this.local.slice()),a.splice(u--,1))}return r==this.children&&a==this.local?this:a.length||r.length?new ft(a,r):rn}forChild(e,n){if(this==rn)return this;if(n.isLeaf)return ft.empty;let r,a;for(let u=0;u<this.children.length;u+=3)if(this.children[u]>=e){this.children[u]==e&&(r=this.children[u+2]);break}let i=e+1,c=i+n.content.size;for(let u=0;u<this.local.length;u++){let h=this.local[u];if(h.from<c&&h.to>i&&h.type instanceof Xs){let p=Math.max(i,h.from)-i,m=Math.min(c,h.to)-i;p<m&&(a||(a=[])).push(h.copy(p,m))}}if(a){let u=new ft(a.sort(za),no);return r?new Hs([u,r]):u}return r||rn}eq(e){if(this==e)return!0;if(!(e instanceof ft)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return wy(this.localsInner(e))}localsInner(e){if(this==rn)return no;if(e.inlineContent||!this.local.some(Xs.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof Xs||n.push(this.local[r]);return n}forEachSet(e){e(this)}}ft.empty=new ft([],[]);ft.removeOverlap=wy;const rn=ft.empty;class Hs{constructor(e){this.members=e}map(e,n){const r=this.members.map(a=>a.map(e,n,Pa));return Hs.from(r)}forChild(e,n){if(n.isLeaf)return ft.empty;let r=[];for(let a=0;a<this.members.length;a++){let i=this.members[a].forChild(e,n);i!=rn&&(i instanceof Hs?r=r.concat(i.members):r.push(i))}return Hs.from(r)}eq(e){if(!(e instanceof Hs)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let a=0;a<this.members.length;a++){let i=this.members[a].localsInner(e);if(i.length)if(!n)n=i;else{r&&(n=n.slice(),r=!1);for(let c=0;c<i.length;c++)n.push(i[c])}}return n?wy(r?n:n.sort(za)):no}static from(e){switch(e.length){case 0:return rn;case 1:return e[0];default:return new Hs(e.every(n=>n instanceof ft)?e:e.reduce((n,r)=>n.concat(r instanceof ft?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function N5(t,e,n,r,a,i,c){let u=t.slice();for(let p=0,m=i;p<n.maps.length;p++){let g=0;n.maps[p].forEach((x,v,w,N)=>{let S=N-w-(v-x);for(let j=0;j<u.length;j+=3){let A=u[j+1];if(A<0||x>A+m-g)continue;let $=u[j]+m-g;v>=$?u[j+1]=x<=$?-2:-1:x>=m&&S&&(u[j]+=S,u[j+1]+=S)}g+=S}),m=n.maps[p].map(m,-1)}let h=!1;for(let p=0;p<u.length;p+=3)if(u[p+1]<0){if(u[p+1]==-2){h=!0,u[p+1]=-1;continue}let m=n.map(t[p]+i),g=m-a;if(g<0||g>=r.content.size){h=!0;continue}let x=n.map(t[p+1]+i,-1),v=x-a,{index:w,offset:N}=r.content.findIndex(g),S=r.maybeChild(w);if(S&&N==g&&N+S.nodeSize==v){let j=u[p+2].mapInner(n,S,m+1,t[p]+i+1,c);j!=rn?(u[p]=g,u[p+1]=v,u[p+2]=j):(u[p+1]=-2,h=!0)}else h=!0}if(h){let p=k5(u,t,e,n,a,i,c),m=Du(p,r,0,c);e=m.local;for(let g=0;g<u.length;g+=3)u[g+1]<0&&(u.splice(g,3),g-=3);for(let g=0,x=0;g<m.children.length;g+=3){let v=m.children[g];for(;x<u.length&&u[x]<v;)x+=3;u.splice(x,0,m.children[g],m.children[g+1],m.children[g+2])}}return new ft(e.sort(za),u)}function Oj(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let a=t[r];n.push(new un(a.from+e,a.to+e,a.type))}return n}function k5(t,e,n,r,a,i,c){function u(h,p){for(let m=0;m<h.local.length;m++){let g=h.local[m].map(r,a,p);g?n.push(g):c.onRemove&&c.onRemove(h.local[m].spec)}for(let m=0;m<h.children.length;m+=3)u(h.children[m+2],h.children[m]+p+1)}for(let h=0;h<t.length;h+=3)t[h+1]==-1&&u(t[h+2],e[h]+i+1);return n}function Dj(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,a=null;for(let i=0,c;i<t.length;i++)(c=t[i])&&c.from>n&&c.to<r&&((a||(a=[])).push(c),t[i]=null);return a}function Lj(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function Du(t,e,n,r){let a=[],i=!1;e.forEach((u,h)=>{let p=Dj(t,u,h+n);if(p){i=!0;let m=Du(p,u,n+h+1,r);m!=rn&&a.push(h,h+u.nodeSize,m)}});let c=Oj(i?Lj(t):t,-n).sort(za);for(let u=0;u<c.length;u++)c[u].type.valid(e,c[u])||(r.onRemove&&r.onRemove(c[u].spec),c.splice(u--,1));return c.length||a.length?new ft(c,a):rn}function za(t,e){return t.from-e.from||t.to-e.to}function wy(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let a=n+1;a<e.length;a++){let i=e[a];if(i.from==r.from){i.to!=r.to&&(e==t&&(e=t.slice()),e[a]=i.copy(i.from,r.to),V1(e,a+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),V1(e,a,r.copy(i.from,r.to)));break}}}return e}function V1(t,e,n){for(;e<t.length&&za(n,t[e])>0;)e++;t.splice(e,0,n)}function Om(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=rn&&e.push(r)}),t.cursorWrapper&&e.push(ft.create(t.state.doc,[t.cursorWrapper.deco])),Hs.from(e)}const j5={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},C5=Nn&&Js<=11;class T5{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class E5{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new T5,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let a=0;a<r.length;a++)this.queue.push(r[a]);Nn&&Js<=11&&r.some(a=>a.type=="childList"&&a.removedNodes.length||a.type=="characterData"&&a.oldValue.length>a.target.nodeValue.length)?this.flushSoon():this.flush()}),C5&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,j5)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(L1(this.view)){if(this.suppressingSelectionUpdates)return ns(this.view);if(Nn&&Js<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&qa(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let i=e.focusNode;i;i=po(i))n.add(i);for(let i=e.anchorNode;i;i=po(i))if(n.has(i)){r=i;break}let a=r&&this.view.docView.nearestDesc(r);if(a&&a.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),a=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&L1(e)&&!this.ignoreSelectionChange(r),i=-1,c=-1,u=!1,h=[];if(e.editable)for(let m=0;m<n.length;m++){let g=this.registerMutation(n[m],h);g&&(i=i<0?g.from:Math.min(g.from,i),c=c<0?g.to:Math.max(g.to,c),g.typeOver&&(u=!0))}if(rr&&h.length){let m=h.filter(g=>g.nodeName=="BR");if(m.length==2){let[g,x]=m;g.parentNode&&g.parentNode.parentNode==x.parentNode?x.remove():g.remove()}else{let{focusNode:g}=this.currentSelection;for(let x of m){let v=x.parentNode;v&&v.nodeName=="LI"&&(!g||_5(e,g)!=v)&&x.remove()}}}else if((Vt||ln)&&h.some(m=>m.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let m of h)if(m.nodeName=="BR"&&m.parentNode){let g=m.nextSibling;g&&g.nodeType==1&&g.contentEditable=="false"&&m.parentNode.removeChild(m)}}let p=null;i<0&&a&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Nh(r)&&(p=py(e))&&p.eq(Be.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,ns(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||a)&&(i>-1&&(e.docView.markDirty(i,c),R5(e)),this.handleDOMChange(i,c,u,h),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||ns(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let m=0;m<e.addedNodes.length;m++){let g=e.addedNodes[m];n.push(g),g.nodeType==3&&(this.lastChangedTextNode=g)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let a=e.previousSibling,i=e.nextSibling;if(Nn&&Js<=11&&e.addedNodes.length)for(let m=0;m<e.addedNodes.length;m++){let{previousSibling:g,nextSibling:x}=e.addedNodes[m];(!g||Array.prototype.indexOf.call(e.addedNodes,g)<0)&&(a=g),(!x||Array.prototype.indexOf.call(e.addedNodes,x)<0)&&(i=x)}let c=a&&a.parentNode==e.target?en(a)+1:0,u=r.localPosFromDOM(e.target,c,-1),h=i&&i.parentNode==e.target?en(i):e.target.childNodes.length,p=r.localPosFromDOM(e.target,h,1);return{from:u,to:p}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let F1=new WeakMap,G1=!1;function R5(t){if(!F1.has(t)&&(F1.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=rr,G1)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),G1=!0}}function q1(t,e){let n=e.startContainer,r=e.startOffset,a=e.endContainer,i=e.endOffset,c=t.domAtPos(t.state.selection.anchor);return qa(c.node,c.offset,a,i)&&([n,r,a,i]=[a,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:a,focusOffset:i}}function A5(t,e){if(e.getComposedRanges){let a=e.getComposedRanges(t.root)[0];if(a)return q1(t,a)}let n;function r(a){a.preventDefault(),a.stopImmediatePropagation(),n=a.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?q1(t,n):null}function _5(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function M5(t,e,n){let{node:r,fromOffset:a,toOffset:i,from:c,to:u}=t.docView.parseRange(e,n),h=t.domSelectionRange(),p,m=h.anchorNode;if(m&&t.dom.contains(m.nodeType==1?m:m.parentNode)&&(p=[{node:m,offset:h.anchorOffset}],Nh(h)||p.push({node:h.focusNode,offset:h.focusOffset})),Vt&&t.input.lastKeyCode===8)for(let S=i;S>a;S--){let j=r.childNodes[S-1],A=j.pmViewDesc;if(j.nodeName=="BR"&&!A){i=S;break}if(!A||A.size)break}let g=t.state.doc,x=t.someProp("domParser")||Ys.fromSchema(t.state.schema),v=g.resolve(c),w=null,N=x.parse(r,{topNode:v.parent,topMatch:v.parent.contentMatchAt(v.index()),topOpen:!0,from:a,to:i,preserveWhitespace:v.parent.type.whitespace=="pre"?"full":!0,findPositions:p,ruleFromNode:O5,context:v});if(p&&p[0].pos!=null){let S=p[0].pos,j=p[1]&&p[1].pos;j==null&&(j=S),w={anchor:S+c,head:j+c}}return{doc:N,sel:w,from:c,to:u}}function O5(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(ln&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||ln&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const D5=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function L5(t,e,n,r,a){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let D=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,I=py(t,D);if(I&&!t.state.selection.eq(I)){if(Vt&&es&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",ue=>ue(t,_a(13,"Enter"))))return;let W=t.state.tr.setSelection(I);D=="pointer"?W.setMeta("pointer",!0):D=="key"&&W.scrollIntoView(),i&&W.setMeta("composition",i),t.dispatch(W)}return}let c=t.state.doc.resolve(e),u=c.sharedDepth(n);e=c.before(u+1),n=t.state.doc.resolve(n).after(u+1);let h=t.state.selection,p=M5(t,e,n),m=t.state.doc,g=m.slice(p.from,p.to),x,v;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(x=t.state.selection.to,v="end"):(x=t.state.selection.from,v="start"),t.input.lastKeyCode=null;let w=I5(g.content,p.doc.content,p.from,x,v);if(w&&t.input.domChangeCount++,(mo&&t.input.lastIOSEnter>Date.now()-225||es)&&a.some(D=>D.nodeType==1&&!D5.test(D.nodeName))&&(!w||w.endA>=w.endB)&&t.someProp("handleKeyDown",D=>D(t,_a(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!w)if(r&&h instanceof _e&&!h.empty&&h.$head.sameParent(h.$anchor)&&!t.composing&&!(p.sel&&p.sel.anchor!=p.sel.head))w={start:h.from,endA:h.to,endB:h.to};else{if(p.sel){let D=W1(t,t.state.doc,p.sel);if(D&&!D.eq(t.state.selection)){let I=t.state.tr.setSelection(D);i&&I.setMeta("composition",i),t.dispatch(I)}}return}t.state.selection.from<t.state.selection.to&&w.start==w.endB&&t.state.selection instanceof _e&&(w.start>t.state.selection.from&&w.start<=t.state.selection.from+2&&t.state.selection.from>=p.from?w.start=t.state.selection.from:w.endA<t.state.selection.to&&w.endA>=t.state.selection.to-2&&t.state.selection.to<=p.to&&(w.endB+=t.state.selection.to-w.endA,w.endA=t.state.selection.to)),Nn&&Js<=11&&w.endB==w.start+1&&w.endA==w.start&&w.start>p.from&&p.doc.textBetween(w.start-p.from-1,w.start-p.from+1)==" "&&(w.start--,w.endA--,w.endB--);let N=p.doc.resolveNoCache(w.start-p.from),S=p.doc.resolveNoCache(w.endB-p.from),j=m.resolve(w.start),A=N.sameParent(S)&&N.parent.inlineContent&&j.end()>=w.endA;if((mo&&t.input.lastIOSEnter>Date.now()-225&&(!A||a.some(D=>D.nodeName=="DIV"||D.nodeName=="P"))||!A&&N.pos<p.doc.content.size&&(!N.sameParent(S)||!N.parent.inlineContent)&&N.pos<S.pos&&!/\S/.test(p.doc.textBetween(N.pos,S.pos,"","")))&&t.someProp("handleKeyDown",D=>D(t,_a(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>w.start&&B5(m,w.start,w.endA,N,S)&&t.someProp("handleKeyDown",D=>D(t,_a(8,"Backspace")))){es&&Vt&&t.domObserver.suppressSelectionUpdates();return}Vt&&w.endB==w.start&&(t.input.lastChromeDelete=Date.now()),es&&!A&&N.start()!=S.start()&&S.parentOffset==0&&N.depth==S.depth&&p.sel&&p.sel.anchor==p.sel.head&&p.sel.head==w.endA&&(w.endB-=2,S=p.doc.resolveNoCache(w.endB-p.from),setTimeout(()=>{t.someProp("handleKeyDown",function(D){return D(t,_a(13,"Enter"))})},20));let $=w.start,L=w.endA,R=D=>{let I=D||t.state.tr.replace($,L,p.doc.slice(w.start-p.from,w.endB-p.from));if(p.sel){let W=W1(t,I.doc,p.sel);W&&!(Vt&&t.composing&&W.empty&&(w.start!=w.endB||t.input.lastChromeDelete<Date.now()-100)&&(W.head==$||W.head==I.mapping.map(L)-1)||Nn&&W.empty&&W.head==$)&&I.setSelection(W)}return i&&I.setMeta("composition",i),I.scrollIntoView()},M;if(A)if(N.pos==S.pos){Nn&&Js<=11&&N.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>ns(t),20));let D=R(t.state.tr.delete($,L)),I=m.resolve(w.start).marksAcross(m.resolve(w.endA));I&&D.ensureMarks(I),t.dispatch(D)}else if(w.endA==w.endB&&(M=$5(N.parent.content.cut(N.parentOffset,S.parentOffset),j.parent.content.cut(j.parentOffset,w.endA-j.start())))){let D=R(t.state.tr);M.type=="add"?D.addMark($,L,M.mark):D.removeMark($,L,M.mark),t.dispatch(D)}else if(N.parent.child(N.index()).isText&&N.index()==S.index()-(S.textOffset?0:1)){let D=N.parent.textBetween(N.parentOffset,S.parentOffset),I=()=>R(t.state.tr.insertText(D,$,L));t.someProp("handleTextInput",W=>W(t,$,L,D,I))||t.dispatch(I())}else t.dispatch(R());else t.dispatch(R())}function W1(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:my(t,e.resolve(n.anchor),e.resolve(n.head))}function $5(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,a=n,i=r,c,u,h;for(let m=0;m<r.length;m++)a=r[m].removeFromSet(a);for(let m=0;m<n.length;m++)i=n[m].removeFromSet(i);if(a.length==1&&i.length==0)u=a[0],c="add",h=m=>m.mark(u.addToSet(m.marks));else if(a.length==0&&i.length==1)u=i[0],c="remove",h=m=>m.mark(u.removeFromSet(m.marks));else return null;let p=[];for(let m=0;m<e.childCount;m++)p.push(h(e.child(m)));if(le.from(p).eq(t))return{mark:u,type:c}}function B5(t,e,n,r,a){if(n-e<=a.pos-r.pos||Dm(r,!0,!1)<a.pos)return!1;let i=t.resolve(e);if(!r.parent.isTextblock){let u=i.nodeAfter;return u!=null&&n==e+u.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let c=t.resolve(Dm(i,!0,!0));return!c.parent.isTextblock||c.pos>n||Dm(c,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(c.parent.content)}function Dm(t,e,n){let r=t.depth,a=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,a++,e=!1;if(n){let i=t.node(r).maybeChild(t.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,a++}return a}function I5(t,e,n,r,a){let i=t.findDiffStart(e,n);if(i==null)return null;let{a:c,b:u}=t.findDiffEnd(e,n+t.size,n+e.size);if(a=="end"){let h=Math.max(0,i-Math.min(c,u));r-=c+h-i}if(c<i&&t.size<e.size){let h=r<=i&&r>=c?i-r:0;i-=h,i&&i<e.size&&K1(e.textBetween(i-1,i+1))&&(i+=h?1:-1),u=i+(u-c),c=i}else if(u<i){let h=r<=i&&r>=u?i-r:0;i-=h,i&&i<t.size&&K1(t.textBetween(i-1,i+1))&&(i+=h?1:-1),c=i+(c-u),u=i}return{start:i,endA:c,endB:u}}function K1(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class $j{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new t5,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(Z1),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=Q1(this),J1(this),this.nodeViews=X1(this),this.docView=R1(this.state.doc,Y1(this),Om(this),this.dom,this),this.domObserver=new E5(this,(r,a,i,c)=>L5(this,r,a,i,c)),this.domObserver.start(),n5(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&_g(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(Z1),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let a=this.state,i=!1,c=!1;e.storedMarks&&this.composing&&(Rj(this),c=!0),this.state=e;let u=a.plugins!=e.plugins||this._props.plugins!=n.plugins;if(u||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let v=X1(this);z5(v,this.nodeViews)&&(this.nodeViews=v,i=!0)}(u||n.handleDOMEvents!=this._props.handleDOMEvents)&&_g(this),this.editable=Q1(this),J1(this);let h=Om(this),p=Y1(this),m=a.plugins!=e.plugins&&!a.doc.eq(e.doc)?"reset":e.scrollToSelection>a.scrollToSelection?"to selection":"preserve",g=i||!this.docView.matchesNode(e.doc,p,h);(g||!e.selection.eq(a.selection))&&(c=!0);let x=m=="preserve"&&c&&this.dom.style.overflowAnchor==null&&g4(this);if(c){this.domObserver.stop();let v=g&&(Nn||Vt)&&!this.composing&&!a.selection.empty&&!e.selection.empty&&P5(a.selection,e.selection);if(g){let w=Vt?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=g5(this)),(i||!this.docView.update(e.doc,p,h,this))&&(this.docView.updateOuterDeco(p),this.docView.destroy(),this.docView=R1(e.doc,p,h,this.dom,this)),w&&!this.trackWrites&&(v=!0)}v||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&z4(this))?ns(this,v):(yj(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(a),!((r=this.dragging)===null||r===void 0)&&r.node&&!a.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,a),m=="reset"?this.dom.scrollTop=0:m=="to selection"?this.scrollToSelection():x&&y4(x)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof Te){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&N1(this,n.getBoundingClientRect(),e)}else N1(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,a=-1;if(this.state.doc.nodeAt(r.from)==r.node)a=r.from;else{let i=r.from+(this.state.doc.content.size-n.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(a=i)}this.dragging=new _j(e.slice,e.move,a<0?void 0:Te.create(this.state.doc,a))}someProp(e,n){let r=this._props&&this._props[e],a;if(r!=null&&(a=n?n(r):r))return a;for(let c=0;c<this.directPlugins.length;c++){let u=this.directPlugins[c].props[e];if(u!=null&&(a=n?n(u):u))return a}let i=this.state.plugins;if(i)for(let c=0;c<i.length;c++){let u=i[c].props[e];if(u!=null&&(a=n?n(u):u))return a}}hasFocus(){if(Nn){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&x4(this.dom),ns(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return N4(this,e)}coordsAtPos(e,n=1){return cj(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let a=this.docView.posFromDOM(e,n,r);if(a==null)throw new RangeError("DOM position not inside the editor");return a}endOfTextblock(e,n){return E4(this,n||this.state,e)}pasteHTML(e,n){return hc(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return hc(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return gy(this,e)}destroy(){this.docView&&(r5(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Om(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,i4())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return a5(this,e)}domSelectionRange(){let e=this.domSelection();return e?ln&&this.root.nodeType===11&&u4(this.dom.ownerDocument)==this.dom&&A5(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}$j.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function Y1(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[un.node(0,t.state.doc.content.size,e)]}function J1(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:un.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function Q1(t){return!t.someProp("editable",e=>e(t.state)===!1)}function P5(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function X1(t){let e=Object.create(null);function n(r){for(let a in r)Object.prototype.hasOwnProperty.call(e,a)||(e[a]=r[a])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function z5(t,e){let n=0,r=0;for(let a in t){if(t[a]!=e[a])return!0;n++}for(let a in e)r++;return n!=r}function Z1(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Zs={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Lu={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},U5=typeof navigator<"u"&&/Mac/.test(navigator.platform),H5=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var tn=0;tn<10;tn++)Zs[48+tn]=Zs[96+tn]=String(tn);for(var tn=1;tn<=24;tn++)Zs[tn+111]="F"+tn;for(var tn=65;tn<=90;tn++)Zs[tn]=String.fromCharCode(tn+32),Lu[tn]=String.fromCharCode(tn);for(var Lm in Zs)Lu.hasOwnProperty(Lm)||(Lu[Lm]=Zs[Lm]);function V5(t){var e=U5&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||H5&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Lu:Zs)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const F5=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),G5=typeof navigator<"u"&&/Win/.test(navigator.platform);function q5(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,a,i,c;for(let u=0;u<e.length-1;u++){let h=e[u];if(/^(cmd|meta|m)$/i.test(h))c=!0;else if(/^a(lt)?$/i.test(h))r=!0;else if(/^(c|ctrl|control)$/i.test(h))a=!0;else if(/^s(hift)?$/i.test(h))i=!0;else if(/^mod$/i.test(h))F5?c=!0:a=!0;else throw new Error("Unrecognized modifier name: "+h)}return r&&(n="Alt-"+n),a&&(n="Ctrl-"+n),c&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function W5(t){let e=Object.create(null);for(let n in t)e[q5(n)]=t[n];return e}function $m(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function K5(t){return new pt({props:{handleKeyDown:Bj(t)}})}function Bj(t){let e=W5(t);return function(n,r){let a=V5(r),i,c=e[$m(a,r)];if(c&&c(n.state,n.dispatch,n))return!0;if(a.length==1&&a!=" "){if(r.shiftKey){let u=e[$m(a,r,!1)];if(u&&u(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(G5&&r.ctrlKey&&r.altKey)&&(i=Zs[r.keyCode])&&i!=a){let u=e[$m(i,r)];if(u&&u(n.state,n.dispatch,n))return!0}}return!1}}var Y5=Object.defineProperty,Sy=(t,e)=>{for(var n in e)Y5(t,n,{get:e[n],enumerable:!0})};function Ch(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:a}=n,{storedMarks:i}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return a},get tr(){return r=n.selection,a=n.doc,i=n.storedMarks,n}}}var Th=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:n}=this,{view:r}=e,{tr:a}=n,i=this.buildProps(a);return Object.fromEntries(Object.entries(t).map(([c,u])=>[c,(...p)=>{const m=u(...p)(i);return!a.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(a),m}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:n,editor:r,state:a}=this,{view:i}=r,c=[],u=!!t,h=t||a.tr,p=()=>(!u&&e&&!h.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(h),c.every(g=>g===!0)),m={...Object.fromEntries(Object.entries(n).map(([g,x])=>[g,(...w)=>{const N=this.buildProps(h,e),S=x(...w)(N);return c.push(S),m}])),run:p};return m}createCan(t){const{rawCommands:e,state:n}=this,r=!1,a=t||n.tr,i=this.buildProps(a,r);return{...Object.fromEntries(Object.entries(e).map(([u,h])=>[u,(...p)=>h(...p)({...i,dispatch:void 0})])),chain:()=>this.createChain(a,r)}}buildProps(t,e=!0){const{rawCommands:n,editor:r,state:a}=this,{view:i}=r,c={tr:t,editor:r,view:i,state:Ch({state:a,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map(([u,h])=>[u,(...p)=>h(...p)(c)]))}};return c}},Ij={};Sy(Ij,{blur:()=>J5,clearContent:()=>Q5,clearNodes:()=>X5,command:()=>Z5,createParagraphNear:()=>eL,cut:()=>tL,deleteCurrentNode:()=>nL,deleteNode:()=>rL,deleteRange:()=>sL,deleteSelection:()=>aL,enter:()=>iL,exitCode:()=>oL,extendMarkRange:()=>lL,first:()=>cL,focus:()=>uL,forEach:()=>hL,insertContent:()=>fL,insertContentAt:()=>gL,joinBackward:()=>bL,joinDown:()=>xL,joinForward:()=>vL,joinItemBackward:()=>wL,joinItemForward:()=>SL,joinTextblockBackward:()=>NL,joinTextblockForward:()=>kL,joinUp:()=>yL,keyboardShortcut:()=>CL,lift:()=>TL,liftEmptyBlock:()=>EL,liftListItem:()=>RL,newlineInCode:()=>AL,resetAttributes:()=>_L,scrollIntoView:()=>ML,selectAll:()=>OL,selectNodeBackward:()=>DL,selectNodeForward:()=>LL,selectParentNode:()=>$L,selectTextblockEnd:()=>BL,selectTextblockStart:()=>IL,setContent:()=>PL,setMark:()=>a$,setMeta:()=>i$,setNode:()=>o$,setNodeSelection:()=>l$,setTextDirection:()=>c$,setTextSelection:()=>d$,sinkListItem:()=>u$,splitBlock:()=>h$,splitListItem:()=>f$,toggleList:()=>p$,toggleMark:()=>m$,toggleNode:()=>g$,toggleWrap:()=>y$,undoInputRule:()=>x$,unsetAllMarks:()=>b$,unsetMark:()=>v$,unsetTextDirection:()=>w$,updateAttributes:()=>S$,wrapIn:()=>N$,wrapInList:()=>k$});var J5=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window?.getSelection())==null||n.removeAllRanges())}),!0),Q5=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),X5=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:a}=r;return n&&a.forEach(({$from:i,$to:c})=>{t.doc.nodesBetween(i.pos,c.pos,(u,h)=>{if(u.type.isText)return;const{doc:p,mapping:m}=e,g=p.resolve(m.map(h)),x=p.resolve(m.map(h+u.nodeSize)),v=g.blockRange(x);if(!v)return;const w=jo(v);if(u.type.isTextblock){const{defaultType:N}=g.parent.contentMatchAt(g.index());e.setNodeMarkup(v.start,N)}(w||w===0)&&e.lift(v,w)})}),!0},Z5=t=>e=>t(e),eL=()=>({state:t,dispatch:e})=>Xk(t,e),tL=(t,e)=>({editor:n,tr:r})=>{const{state:a}=n,i=a.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const c=r.mapping.map(e);return r.insert(c,i.content),r.setSelection(new _e(r.doc.resolve(Math.max(c-1,0)))),!0},nL=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const a=t.selection.$anchor;for(let i=a.depth;i>0;i-=1)if(a.node(i).type===r.type){if(e){const u=a.before(i),h=a.after(i);t.delete(u,h).scrollIntoView()}return!0}return!1};function Ot(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var rL=t=>({tr:e,state:n,dispatch:r})=>{const a=Ot(t,n.schema),i=e.selection.$anchor;for(let c=i.depth;c>0;c-=1)if(i.node(c).type===a){if(r){const h=i.before(c),p=i.after(c);e.delete(h,p).scrollIntoView()}return!0}return!1},sL=t=>({tr:e,dispatch:n})=>{const{from:r,to:a}=t;return n&&e.delete(r,a),!0},aL=()=>({state:t,dispatch:e})=>ly(t,e),iL=()=>({commands:t})=>t.keyboardShortcut("Enter"),oL=()=>({state:t,dispatch:e})=>G3(t,e);function Ny(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function $u(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(a=>n.strict?e[a]===t[a]:Ny(e[a])?e[a].test(t[a]):e[a]===t[a]):!0}function Pj(t,e,n={}){return t.find(r=>r.type===e&&$u(Object.fromEntries(Object.keys(n).map(a=>[a,r.attrs[a]])),n))}function eS(t,e,n={}){return!!Pj(t,e,n)}function ky(t,e,n){var r;if(!t||!e)return;let a=t.parent.childAfter(t.parentOffset);if((!a.node||!a.node.marks.some(m=>m.type===e))&&(a=t.parent.childBefore(t.parentOffset)),!a.node||!a.node.marks.some(m=>m.type===e)||(n=n||((r=a.node.marks[0])==null?void 0:r.attrs),!Pj([...a.node.marks],e,n)))return;let c=a.index,u=t.start()+a.offset,h=c+1,p=u+a.node.nodeSize;for(;c>0&&eS([...t.parent.child(c-1).marks],e,n);)c-=1,u-=t.parent.child(c).nodeSize;for(;h<t.parent.childCount&&eS([...t.parent.child(h).marks],e,n);)p+=t.parent.child(h).nodeSize,h+=1;return{from:u,to:p}}function is(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var lL=(t,e={})=>({tr:n,state:r,dispatch:a})=>{const i=is(t,r.schema),{doc:c,selection:u}=n,{$from:h,from:p,to:m}=u;if(a){const g=ky(h,i,e);if(g&&g.from<=p&&g.to>=m){const x=_e.create(c,g.from,g.to);n.setSelection(x)}}return!0},cL=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function zj(t){return t instanceof _e}function La(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function Uj(t,e=null){if(!e)return null;const n=Be.atStart(t),r=Be.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const a=n.from,i=r.to;return e==="all"?_e.create(t,La(0,a,i),La(t.content.size,a,i)):_e.create(t,La(e,a,i),La(e,a,i))}function dL(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function jy(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var uL=(t=null,e={})=>({editor:n,view:r,tr:a,dispatch:i})=>{e={scrollIntoView:!0,...e};const c=()=>{(jy()||dL())&&r.dom.focus(),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e?.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(i&&t===null&&!zj(n.state.selection))return c(),!0;const u=Uj(a.doc,t)||n.state.selection,h=n.state.selection.eq(u);return i&&(h||a.setSelection(u),h&&a.storedMarks&&a.setStoredMarks(a.storedMarks),c()),!0},hL=(t,e)=>n=>t.every((r,a)=>e(r,{...n,index:a})),fL=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),Hj=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&Hj(r)}return t};function nu(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return Hj(n)}function pc(t,e,n){if(t instanceof yr||t instanceof le)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,a=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return le.fromArray(t.map(u=>e.nodeFromJSON(u)));const c=e.nodeFromJSON(t);return n.errorOnInvalidContent&&c.check(),c}catch(i){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",i),pc("",e,n)}if(a){if(n.errorOnInvalidContent){let c=!1,u="";const h=new jk({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:p=>(c=!0,u=typeof p=="string"?p:p.outerHTML,null)}]}})});if(n.slice?Ys.fromSchema(h).parseSlice(nu(t),n.parseOptions):Ys.fromSchema(h).parse(nu(t),n.parseOptions),n.errorOnInvalidContent&&c)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${u}`)})}const i=Ys.fromSchema(e);return n.slice?i.parseSlice(nu(t),n.parseOptions).content:i.parse(nu(t),n.parseOptions)}return pc("",e,n)}function pL(t,e,n){const r=t.steps.length-1;if(r<e)return;const a=t.steps[r];if(!(a instanceof Ht||a instanceof Ft))return;const i=t.mapping.maps[r];let c=0;i.forEach((u,h,p,m)=>{c===0&&(c=m)}),t.setSelection(Be.near(t.doc.resolve(c),n))}var mL=t=>!("type"in t),gL=(t,e,n)=>({tr:r,dispatch:a,editor:i})=>{var c;if(a){n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let u;const h=S=>{i.emit("contentError",{editor:i,error:S,disableCollaboration:()=>{"collaboration"in i.storage&&typeof i.storage.collaboration=="object"&&i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},p={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{pc(e,i.schema,{parseOptions:p,errorOnInvalidContent:!0})}catch(S){h(S)}try{u=pc(e,i.schema,{parseOptions:p,errorOnInvalidContent:(c=n.errorOnInvalidContent)!=null?c:i.options.enableContentCheck})}catch(S){return h(S),!1}let{from:m,to:g}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},x=!0,v=!0;if((mL(u)?u:[u]).forEach(S=>{S.check(),x=x?S.isText&&S.marks.length===0:!1,v=v?S.isBlock:!1}),m===g&&v){const{parent:S}=r.doc.resolve(m);S.isTextblock&&!S.type.spec.code&&!S.childCount&&(m-=1,g+=1)}let N;if(x){if(Array.isArray(e))N=e.map(S=>S.text||"").join("");else if(e instanceof le){let S="";e.forEach(j=>{j.text&&(S+=j.text)}),N=S}else typeof e=="object"&&e&&e.text?N=e.text:N=e;r.insertText(N,m,g)}else{N=u;const S=r.doc.resolve(m),j=S.node(),A=S.parentOffset===0,$=j.isText||j.isTextblock,L=j.content.size>0;A&&$&&L&&(m=Math.max(0,m-1)),r.replaceWith(m,g,N)}n.updateSelection&&pL(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:m,text:N}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:m,text:N})}return!0},yL=()=>({state:t,dispatch:e})=>H3(t,e),xL=()=>({state:t,dispatch:e})=>V3(t,e),bL=()=>({state:t,dispatch:e})=>Gk(t,e),vL=()=>({state:t,dispatch:e})=>Yk(t,e),wL=()=>({state:t,dispatch:e,tr:n})=>{try{const r=vh(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},SL=()=>({state:t,dispatch:e,tr:n})=>{try{const r=vh(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},NL=()=>({state:t,dispatch:e})=>z3(t,e),kL=()=>({state:t,dispatch:e})=>U3(t,e);function Vj(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function jL(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,a,i,c;for(let u=0;u<e.length-1;u+=1){const h=e[u];if(/^(cmd|meta|m)$/i.test(h))c=!0;else if(/^a(lt)?$/i.test(h))r=!0;else if(/^(c|ctrl|control)$/i.test(h))a=!0;else if(/^s(hift)?$/i.test(h))i=!0;else if(/^mod$/i.test(h))jy()||Vj()?c=!0:a=!0;else throw new Error(`Unrecognized modifier name: ${h}`)}return r&&(n=`Alt-${n}`),a&&(n=`Ctrl-${n}`),c&&(n=`Meta-${n}`),i&&(n=`Shift-${n}`),n}var CL=t=>({editor:e,view:n,tr:r,dispatch:a})=>{const i=jL(t).split(/-(?!$)/),c=i.find(p=>!["Alt","Ctrl","Meta","Shift"].includes(p)),u=new KeyboardEvent("keydown",{key:c==="Space"?" ":c,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),h=e.captureTransaction(()=>{n.someProp("handleKeyDown",p=>p(n,u))});return h?.steps.forEach(p=>{const m=p.map(r.mapping);m&&a&&r.maybeStep(m)}),!0};function ea(t,e,n={}){const{from:r,to:a,empty:i}=t.selection,c=e?Ot(e,t.schema):null,u=[];t.doc.nodesBetween(r,a,(g,x)=>{if(g.isText)return;const v=Math.max(r,x),w=Math.min(a,x+g.nodeSize);u.push({node:g,from:v,to:w})});const h=a-r,p=u.filter(g=>c?c.name===g.node.type.name:!0).filter(g=>$u(g.node.attrs,n,{strict:!1}));return i?!!p.length:p.reduce((g,x)=>g+x.to-x.from,0)>=h}var TL=(t,e={})=>({state:n,dispatch:r})=>{const a=Ot(t,n.schema);return ea(n,a,e)?F3(n,r):!1},EL=()=>({state:t,dispatch:e})=>Zk(t,e),RL=t=>({state:e,dispatch:n})=>{const r=Ot(t,e.schema);return n4(r)(e,n)},AL=()=>({state:t,dispatch:e})=>Qk(t,e);function Eh(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function tS(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,a)=>(n.includes(a)||(r[a]=t[a]),r),{})}var _L=(t,e)=>({tr:n,state:r,dispatch:a})=>{let i=null,c=null;const u=Eh(typeof t=="string"?t:t.name,r.schema);if(!u)return!1;u==="node"&&(i=Ot(t,r.schema)),u==="mark"&&(c=is(t,r.schema));let h=!1;return n.selection.ranges.forEach(p=>{r.doc.nodesBetween(p.$from.pos,p.$to.pos,(m,g)=>{i&&i===m.type&&(h=!0,a&&n.setNodeMarkup(g,void 0,tS(m.attrs,e))),c&&m.marks.length&&m.marks.forEach(x=>{c===x.type&&(h=!0,a&&n.addMark(g,g+m.nodeSize,c.create(tS(x.attrs,e))))})})}),h},ML=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),OL=()=>({tr:t,dispatch:e})=>{if(e){const n=new Pn(t.doc);t.setSelection(n)}return!0},DL=()=>({state:t,dispatch:e})=>Wk(t,e),LL=()=>({state:t,dispatch:e})=>Jk(t,e),$L=()=>({state:t,dispatch:e})=>K3(t,e),BL=()=>({state:t,dispatch:e})=>Q3(t,e),IL=()=>({state:t,dispatch:e})=>J3(t,e);function Mg(t,e,n={},r={}){return pc(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}var PL=(t,{errorOnInvalidContent:e,emitUpdate:n=!0,parseOptions:r={}}={})=>({editor:a,tr:i,dispatch:c,commands:u})=>{const{doc:h}=i;if(r.preserveWhitespace!=="full"){const p=Mg(t,a.schema,r,{errorOnInvalidContent:e??a.options.enableContentCheck});return c&&i.replaceWith(0,h.content.size,p).setMeta("preventUpdate",!n),!0}return c&&i.setMeta("preventUpdate",!n),u.insertContentAt({from:0,to:h.content.size},t,{parseOptions:r,errorOnInvalidContent:e??a.options.enableContentCheck})};function Fj(t,e){const n=is(e,t.schema),{from:r,to:a,empty:i}=t.selection,c=[];i?(t.storedMarks&&c.push(...t.storedMarks),c.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,a,h=>{c.push(...h.marks)});const u=c.find(h=>h.type.name===n.name);return u?{...u.attrs}:{}}function Gj(t,e){const n=new Uk(t);return e.forEach(r=>{r.steps.forEach(a=>{n.step(a)})}),n}function zL(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function UL(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(a,i)=>{n(a)&&r.push({node:a,pos:i})}),r}function HL(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Rh(t){return e=>HL(e.$from,t)}function Ce(t,e,n){return t.config[e]===void 0&&t.parent?Ce(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?Ce(t.parent,e,n):null}):t.config[e]}function Cy(t){return t.map(e=>{const n={name:e.name,options:e.options,storage:e.storage},r=Ce(e,"addExtensions",n);return r?[e,...Cy(r())]:e}).flat(10)}function Ty(t,e){const n=Xa.fromSchema(e).serializeFragment(t),a=document.implementation.createHTMLDocument().createElement("div");return a.appendChild(n),a.innerHTML}function qj(t){return typeof t=="function"}function Qe(t,e=void 0,...n){return qj(t)?e?t.bind(e)(...n):t(...n):t}function VL(t={}){return Object.keys(t).length===0&&t.constructor===Object}function go(t){const e=t.filter(a=>a.type==="extension"),n=t.filter(a=>a.type==="node"),r=t.filter(a=>a.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function Wj(t){const e=[],{nodeExtensions:n,markExtensions:r}=go(t),a=[...n,...r],i={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(c=>{const u={name:c.name,options:c.options,storage:c.storage,extensions:a},h=Ce(c,"addGlobalAttributes",u);if(!h)return;h().forEach(m=>{m.types.forEach(g=>{Object.entries(m.attributes).forEach(([x,v])=>{e.push({type:g,name:x,attribute:{...i,...v}})})})})}),a.forEach(c=>{const u={name:c.name,options:c.options,storage:c.storage},h=Ce(c,"addAttributes",u);if(!h)return;const p=h();Object.entries(p).forEach(([m,g])=>{const x={...i,...g};typeof x?.default=="function"&&(x.default=x.default()),x?.isRequired&&x?.default===void 0&&delete x.default,e.push({type:c.name,name:m,attribute:x})})}),e}function Dt(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([a,i])=>{if(!r[a]){r[a]=i;return}if(a==="class"){const u=i?String(i).split(" "):[],h=r[a]?r[a].split(" "):[],p=u.filter(m=>!h.includes(m));r[a]=[...h,...p].join(" ")}else if(a==="style"){const u=i?i.split(";").map(m=>m.trim()).filter(Boolean):[],h=r[a]?r[a].split(";").map(m=>m.trim()).filter(Boolean):[],p=new Map;h.forEach(m=>{const[g,x]=m.split(":").map(v=>v.trim());p.set(g,x)}),u.forEach(m=>{const[g,x]=m.split(":").map(v=>v.trim());p.set(g,x)}),r[a]=Array.from(p.entries()).map(([m,g])=>`${m}: ${g}`).join("; ")}else r[a]=i}),r},{})}function Bu(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>Dt(n,r),{})}function FL(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function nS(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const a=e.reduce((i,c)=>{const u=c.attribute.parseHTML?c.attribute.parseHTML(n):FL(n.getAttribute(c.name));return u==null?i:{...i,[c.name]:u}},{});return{...r,...a}}}}function rS(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&VL(n)?!1:n!=null))}function sS(t){var e,n;const r={};return!((e=t?.attribute)!=null&&e.isRequired)&&"default"in(t?.attribute||{})&&(r.default=t.attribute.default),((n=t?.attribute)==null?void 0:n.validate)!==void 0&&(r.validate=t.attribute.validate),[t.name,r]}function GL(t,e){var n;const r=Wj(t),{nodeExtensions:a,markExtensions:i}=go(t),c=(n=a.find(p=>Ce(p,"topNode")))==null?void 0:n.name,u=Object.fromEntries(a.map(p=>{const m=r.filter(j=>j.type===p.name),g={name:p.name,options:p.options,storage:p.storage,editor:e},x=t.reduce((j,A)=>{const $=Ce(A,"extendNodeSchema",g);return{...j,...$?$(p):{}}},{}),v=rS({...x,content:Qe(Ce(p,"content",g)),marks:Qe(Ce(p,"marks",g)),group:Qe(Ce(p,"group",g)),inline:Qe(Ce(p,"inline",g)),atom:Qe(Ce(p,"atom",g)),selectable:Qe(Ce(p,"selectable",g)),draggable:Qe(Ce(p,"draggable",g)),code:Qe(Ce(p,"code",g)),whitespace:Qe(Ce(p,"whitespace",g)),linebreakReplacement:Qe(Ce(p,"linebreakReplacement",g)),defining:Qe(Ce(p,"defining",g)),isolating:Qe(Ce(p,"isolating",g)),attrs:Object.fromEntries(m.map(sS))}),w=Qe(Ce(p,"parseHTML",g));w&&(v.parseDOM=w.map(j=>nS(j,m)));const N=Ce(p,"renderHTML",g);N&&(v.toDOM=j=>N({node:j,HTMLAttributes:Bu(j,m)}));const S=Ce(p,"renderText",g);return S&&(v.toText=S),[p.name,v]})),h=Object.fromEntries(i.map(p=>{const m=r.filter(S=>S.type===p.name),g={name:p.name,options:p.options,storage:p.storage,editor:e},x=t.reduce((S,j)=>{const A=Ce(j,"extendMarkSchema",g);return{...S,...A?A(p):{}}},{}),v=rS({...x,inclusive:Qe(Ce(p,"inclusive",g)),excludes:Qe(Ce(p,"excludes",g)),group:Qe(Ce(p,"group",g)),spanning:Qe(Ce(p,"spanning",g)),code:Qe(Ce(p,"code",g)),attrs:Object.fromEntries(m.map(sS))}),w=Qe(Ce(p,"parseHTML",g));w&&(v.parseDOM=w.map(S=>nS(S,m)));const N=Ce(p,"renderHTML",g);return N&&(v.toDOM=S=>N({mark:S,HTMLAttributes:Bu(S,m)})),[p.name,v]}));return new jk({topNode:c,nodes:u,marks:h})}function qL(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}function Ey(t){return t.sort((n,r)=>{const a=Ce(n,"priority")||100,i=Ce(r,"priority")||100;return a>i?-1:a<i?1:0})}function Kj(t){const e=Ey(Cy(t)),n=qL(e.map(r=>r.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(r=>`'${r}'`).join(", ")}]. This can lead to issues.`),e}function Yj(t,e,n){const{from:r,to:a}=e,{blockSeparator:i=`

`,textSerializers:c={}}=n||{};let u="";return t.nodesBetween(r,a,(h,p,m,g)=>{var x;h.isBlock&&p>r&&(u+=i);const v=c?.[h.type.name];if(v)return m&&(u+=v({node:h,pos:p,parent:m,index:g,range:e})),!1;h.isText&&(u+=(x=h?.text)==null?void 0:x.slice(Math.max(r,p)-p,a-p))}),u}function WL(t,e){const n={from:0,to:t.content.size};return Yj(t,n,e)}function Jj(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}function KL(t,e){const n=Ot(e,t.schema),{from:r,to:a}=t.selection,i=[];t.doc.nodesBetween(r,a,u=>{i.push(u)});const c=i.reverse().find(u=>u.type.name===n.name);return c?{...c.attrs}:{}}function Qj(t,e){const n=Eh(typeof e=="string"?e:e.name,t.schema);return n==="node"?KL(t,e):n==="mark"?Fj(t,e):{}}function YL(t,e=JSON.stringify){const n={};return t.filter(r=>{const a=e(r);return Object.prototype.hasOwnProperty.call(n,a)?!1:n[a]=!0})}function JL(t){const e=YL(t);return e.length===1?e:e.filter((n,r)=>!e.filter((i,c)=>c!==r).some(i=>n.oldRange.from>=i.oldRange.from&&n.oldRange.to<=i.oldRange.to&&n.newRange.from>=i.newRange.from&&n.newRange.to<=i.newRange.to))}function Xj(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((a,i)=>{const c=[];if(a.ranges.length)a.forEach((u,h)=>{c.push({from:u,to:h})});else{const{from:u,to:h}=n[i];if(u===void 0||h===void 0)return;c.push({from:u,to:h})}c.forEach(({from:u,to:h})=>{const p=e.slice(i).map(u,-1),m=e.slice(i).map(h),g=e.invert().map(p,-1),x=e.invert().map(m);r.push({oldRange:{from:g,to:x},newRange:{from:p,to:m}})})}),JL(r)}function Ry(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(a=>{const i=n.resolve(t),c=ky(i,a.type);c&&r.push({mark:a,...c})}):n.nodesBetween(t,e,(a,i)=>{!a||a?.nodeSize===void 0||r.push(...a.marks.map(c=>({from:i,to:i+a.nodeSize,mark:c})))}),r}var QL=(t,e,n,r=20)=>{const a=t.doc.resolve(n);let i=r,c=null;for(;i>0&&c===null;){const u=a.node(i);u?.type.name===e?c=u:i-=1}return[c,i]};function Bm(t,e){return e.nodes[t]||e.marks[t]||null}function mu(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const a=t.find(i=>i.type===e&&i.name===r);return a?a.attribute.keepOnSplit:!1}))}var XL=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(a,i,c,u)=>{var h,p;const m=((p=(h=a.type.spec).toText)==null?void 0:p.call(h,{node:a,pos:i,parent:c,index:u}))||a.textContent||"%leaf%";n+=a.isAtom&&!a.isText?m:m.slice(0,Math.max(0,r-i))}),n};function Og(t,e,n={}){const{empty:r,ranges:a}=t.selection,i=e?is(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(g=>i?i.name===g.type.name:!0).find(g=>$u(g.attrs,n,{strict:!1}));let c=0;const u=[];if(a.forEach(({$from:g,$to:x})=>{const v=g.pos,w=x.pos;t.doc.nodesBetween(v,w,(N,S)=>{if(!N.isText&&!N.marks.length)return;const j=Math.max(v,S),A=Math.min(w,S+N.nodeSize),$=A-j;c+=$,u.push(...N.marks.map(L=>({mark:L,from:j,to:A})))})}),c===0)return!1;const h=u.filter(g=>i?i.name===g.mark.type.name:!0).filter(g=>$u(g.mark.attrs,n,{strict:!1})).reduce((g,x)=>g+x.to-x.from,0),p=u.filter(g=>i?g.mark.type!==i&&g.mark.type.excludes(i):!0).reduce((g,x)=>g+x.to-x.from,0);return(h>0?h+p:h)>=c}function ZL(t,e,n={}){if(!e)return ea(t,null,n)||Og(t,null,n);const r=Eh(e,t.schema);return r==="node"?ea(t,e,n):r==="mark"?Og(t,e,n):!1}var e$=(t,e)=>{const{$from:n,$to:r,$anchor:a}=t.selection;if(e){const i=Rh(u=>u.type.name===e)(t.selection);if(!i)return!1;const c=t.doc.resolve(i.pos+1);return a.pos+1===c.end()}return!(r.parentOffset<r.parent.nodeSize-2||n.pos!==r.pos)},t$=t=>{const{$from:e,$to:n}=t.selection;return!(e.parentOffset>0||e.pos!==n.pos)};function aS(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function iS(t,e){const{nodeExtensions:n}=go(e),r=n.find(c=>c.name===t);if(!r)return!1;const a={name:r.name,options:r.options,storage:r.storage},i=Qe(Ce(r,"group",a));return typeof i!="string"?!1:i.split(" ").includes("list")}function Ah(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!=null?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let a=!0;return t.content.forEach(i=>{a!==!1&&(Ah(i,{ignoreWhitespace:n,checkChildren:e})||(a=!1))}),a}return!1}function Zj(t){return t instanceof Te}var e2=class t2{constructor(e){this.position=e}static fromJSON(e){return new t2(e.position)}toJSON(){return{position:this.position}}};function n$(t,e){const n=e.mapping.mapResult(t.position);return{position:new e2(n.pos),mapResult:n}}function r$(t){return new e2(t)}function s$(t,e,n){var r;const{selection:a}=e;let i=null;if(zj(a)&&(i=a.$cursor),i){const u=(r=t.storedMarks)!=null?r:i.marks();return i.parent.type.allowsMarkType(n)&&(!!n.isInSet(u)||!u.some(p=>p.type.excludes(n)))}const{ranges:c}=a;return c.some(({$from:u,$to:h})=>{let p=u.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(u.pos,h.pos,(m,g,x)=>{if(p)return!1;if(m.isInline){const v=!x||x.type.allowsMarkType(n),w=!!n.isInSet(m.marks)||!m.marks.some(N=>N.type.excludes(n));p=v&&w}return!p}),p})}var a$=(t,e={})=>({tr:n,state:r,dispatch:a})=>{const{selection:i}=n,{empty:c,ranges:u}=i,h=is(t,r.schema);if(a)if(c){const p=Fj(r,h);n.addStoredMark(h.create({...p,...e}))}else u.forEach(p=>{const m=p.$from.pos,g=p.$to.pos;r.doc.nodesBetween(m,g,(x,v)=>{const w=Math.max(v,m),N=Math.min(v+x.nodeSize,g);x.marks.find(j=>j.type===h)?x.marks.forEach(j=>{h===j.type&&n.addMark(w,N,h.create({...j.attrs,...e}))}):n.addMark(w,N,h.create(e))})});return s$(r,n,h)},i$=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),o$=(t,e={})=>({state:n,dispatch:r,chain:a})=>{const i=Ot(t,n.schema);let c;return n.selection.$anchor.sameParent(n.selection.$head)&&(c=n.selection.$anchor.parent.attrs),i.isTextblock?a().command(({commands:u})=>v1(i,{...c,...e})(n)?!0:u.clearNodes()).command(({state:u})=>v1(i,{...c,...e})(u,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},l$=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,a=La(t,0,r.content.size),i=Te.create(r,a);e.setSelection(i)}return!0},c$=(t,e)=>({tr:n,state:r,dispatch:a})=>{const{selection:i}=r;let c,u;return typeof e=="number"?(c=e,u=e):e&&"from"in e&&"to"in e?(c=e.from,u=e.to):(c=i.from,u=i.to),a&&n.doc.nodesBetween(c,u,(h,p)=>{h.isText||n.setNodeMarkup(p,void 0,{...h.attrs,dir:t})}),!0},d$=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:a,to:i}=typeof t=="number"?{from:t,to:t}:t,c=_e.atStart(r).from,u=_e.atEnd(r).to,h=La(a,c,u),p=La(i,c,u),m=_e.create(r,h,p);e.setSelection(m)}return!0},u$=t=>({state:e,dispatch:n})=>{const r=Ot(t,e.schema);return a4(r)(e,n)};function oS(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(a=>e?.includes(a.type.name));t.tr.ensureMarks(r)}}var h$=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:a})=>{const{selection:i,doc:c}=e,{$from:u,$to:h}=i,p=a.extensionManager.attributes,m=mu(p,u.node().type.name,u.node().attrs);if(i instanceof Te&&i.node.isBlock)return!u.parentOffset||!ts(c,u.pos)?!1:(r&&(t&&oS(n,a.extensionManager.splittableMarks),e.split(u.pos).scrollIntoView()),!0);if(!u.parent.isBlock)return!1;const g=h.parentOffset===h.parent.content.size,x=u.depth===0?void 0:zL(u.node(-1).contentMatchAt(u.indexAfter(-1)));let v=g&&x?[{type:x,attrs:m}]:void 0,w=ts(e.doc,e.mapping.map(u.pos),1,v);if(!v&&!w&&ts(e.doc,e.mapping.map(u.pos),1,x?[{type:x}]:void 0)&&(w=!0,v=x?[{type:x,attrs:m}]:void 0),r){if(w&&(i instanceof _e&&e.deleteSelection(),e.split(e.mapping.map(u.pos),1,v),x&&!g&&!u.parentOffset&&u.parent.type!==x)){const N=e.mapping.map(u.before()),S=e.doc.resolve(N);u.node(-1).canReplaceWith(S.index(),S.index()+1,x)&&e.setNodeMarkup(e.mapping.map(u.before()),x)}t&&oS(n,a.extensionManager.splittableMarks),e.scrollIntoView()}return w},f$=(t,e={})=>({tr:n,state:r,dispatch:a,editor:i})=>{var c;const u=Ot(t,r.schema),{$from:h,$to:p}=r.selection,m=r.selection.node;if(m&&m.isBlock||h.depth<2||!h.sameParent(p))return!1;const g=h.node(-1);if(g.type!==u)return!1;const x=i.extensionManager.attributes;if(h.parent.content.size===0&&h.node(-1).childCount===h.indexAfter(-1)){if(h.depth===2||h.node(-3).type!==u||h.index(-2)!==h.node(-2).childCount-1)return!1;if(a){let j=le.empty;const A=h.index(-1)?1:h.index(-2)?2:3;for(let I=h.depth-A;I>=h.depth-3;I-=1)j=le.from(h.node(I).copy(j));const $=h.indexAfter(-1)<h.node(-2).childCount?1:h.indexAfter(-2)<h.node(-3).childCount?2:3,L={...mu(x,h.node().type.name,h.node().attrs),...e},R=((c=u.contentMatch.defaultType)==null?void 0:c.createAndFill(L))||void 0;j=j.append(le.from(u.createAndFill(null,R)||void 0));const M=h.before(h.depth-(A-1));n.replace(M,h.after(-$),new pe(j,4-A,0));let D=-1;n.doc.nodesBetween(M,n.doc.content.size,(I,W)=>{if(D>-1)return!1;I.isTextblock&&I.content.size===0&&(D=W+1)}),D>-1&&n.setSelection(_e.near(n.doc.resolve(D))),n.scrollIntoView()}return!0}const v=p.pos===h.end()?g.contentMatchAt(0).defaultType:null,w={...mu(x,g.type.name,g.attrs),...e},N={...mu(x,h.node().type.name,h.node().attrs),...e};n.delete(h.pos,p.pos);const S=v?[{type:u,attrs:w},{type:v,attrs:N}]:[{type:u,attrs:w}];if(!ts(n.doc,h.pos,2))return!1;if(a){const{selection:j,storedMarks:A}=r,{splittableMarks:$}=i.extensionManager,L=A||j.$to.parentOffset&&j.$from.marks();if(n.split(h.pos,2,S).scrollIntoView(),!L||!a)return!0;const R=L.filter(M=>$.includes(M.type.name));n.ensureMarks(R)}return!0},Im=(t,e)=>{const n=Rh(c=>c.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const a=t.doc.nodeAt(r);return n.node.type===a?.type&&ta(t.doc,n.pos)&&t.join(n.pos),!0},Pm=(t,e)=>{const n=Rh(c=>c.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const a=t.doc.nodeAt(r);return n.node.type===a?.type&&ta(t.doc,r)&&t.join(r),!0},p$=(t,e,n,r={})=>({editor:a,tr:i,state:c,dispatch:u,chain:h,commands:p,can:m})=>{const{extensions:g,splittableMarks:x}=a.extensionManager,v=Ot(t,c.schema),w=Ot(e,c.schema),{selection:N,storedMarks:S}=c,{$from:j,$to:A}=N,$=j.blockRange(A),L=S||N.$to.parentOffset&&N.$from.marks();if(!$)return!1;const R=Rh(M=>iS(M.type.name,g))(N);if($.depth>=1&&R&&$.depth-R.depth<=1){if(R.node.type===v)return p.liftListItem(w);if(iS(R.node.type.name,g)&&v.validContent(R.node.content)&&u)return h().command(()=>(i.setNodeMarkup(R.pos,v),!0)).command(()=>Im(i,v)).command(()=>Pm(i,v)).run()}return!n||!L||!u?h().command(()=>m().wrapInList(v,r)?!0:p.clearNodes()).wrapInList(v,r).command(()=>Im(i,v)).command(()=>Pm(i,v)).run():h().command(()=>{const M=m().wrapInList(v,r),D=L.filter(I=>x.includes(I.type.name));return i.ensureMarks(D),M?!0:p.clearNodes()}).wrapInList(v,r).command(()=>Im(i,v)).command(()=>Pm(i,v)).run()},m$=(t,e={},n={})=>({state:r,commands:a})=>{const{extendEmptyMarkRange:i=!1}=n,c=is(t,r.schema);return Og(r,c,e)?a.unsetMark(c,{extendEmptyMarkRange:i}):a.setMark(c,e)},g$=(t,e,n={})=>({state:r,commands:a})=>{const i=Ot(t,r.schema),c=Ot(e,r.schema),u=ea(r,i,n);let h;return r.selection.$anchor.sameParent(r.selection.$head)&&(h=r.selection.$anchor.parent.attrs),u?a.setNode(c,h):a.setNode(i,{...h,...n})},y$=(t,e={})=>({state:n,commands:r})=>{const a=Ot(t,n.schema);return ea(n,a,e)?r.lift(a):r.wrapIn(a,e)},x$=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const a=n[r];let i;if(a.spec.isInputRules&&(i=a.getState(t))){if(e){const c=t.tr,u=i.transform;for(let h=u.steps.length-1;h>=0;h-=1)c.step(u.steps[h].invert(u.docs[h]));if(i.text){const h=c.doc.resolve(i.from).marks();c.replaceWith(i.from,i.to,t.schema.text(i.text,h))}else c.delete(i.from,i.to)}return!0}}return!1},b$=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:a}=n;return r||e&&a.forEach(i=>{t.removeMark(i.$from.pos,i.$to.pos)}),!0},v$=(t,e={})=>({tr:n,state:r,dispatch:a})=>{var i;const{extendEmptyMarkRange:c=!1}=e,{selection:u}=n,h=is(t,r.schema),{$from:p,empty:m,ranges:g}=u;if(!a)return!0;if(m&&c){let{from:x,to:v}=u;const w=(i=p.marks().find(S=>S.type===h))==null?void 0:i.attrs,N=ky(p,h,w);N&&(x=N.from,v=N.to),n.removeMark(x,v,h)}else g.forEach(x=>{n.removeMark(x.$from.pos,x.$to.pos,h)});return n.removeStoredMark(h),!0},w$=t=>({tr:e,state:n,dispatch:r})=>{const{selection:a}=n;let i,c;return typeof t=="number"?(i=t,c=t):t&&"from"in t&&"to"in t?(i=t.from,c=t.to):(i=a.from,c=a.to),r&&e.doc.nodesBetween(i,c,(u,h)=>{if(u.isText)return;const p={...u.attrs};delete p.dir,e.setNodeMarkup(h,void 0,p)}),!0},S$=(t,e={})=>({tr:n,state:r,dispatch:a})=>{let i=null,c=null;const u=Eh(typeof t=="string"?t:t.name,r.schema);if(!u)return!1;u==="node"&&(i=Ot(t,r.schema)),u==="mark"&&(c=is(t,r.schema));let h=!1;return n.selection.ranges.forEach(p=>{const m=p.$from.pos,g=p.$to.pos;let x,v,w,N;n.selection.empty?r.doc.nodesBetween(m,g,(S,j)=>{i&&i===S.type&&(h=!0,w=Math.max(j,m),N=Math.min(j+S.nodeSize,g),x=j,v=S)}):r.doc.nodesBetween(m,g,(S,j)=>{j<m&&i&&i===S.type&&(h=!0,w=Math.max(j,m),N=Math.min(j+S.nodeSize,g),x=j,v=S),j>=m&&j<=g&&(i&&i===S.type&&(h=!0,a&&n.setNodeMarkup(j,void 0,{...S.attrs,...e})),c&&S.marks.length&&S.marks.forEach(A=>{if(c===A.type&&(h=!0,a)){const $=Math.max(j,m),L=Math.min(j+S.nodeSize,g);n.addMark($,L,c.create({...A.attrs,...e}))}}))}),v&&(x!==void 0&&a&&n.setNodeMarkup(x,void 0,{...v.attrs,...e}),c&&v.marks.length&&v.marks.forEach(S=>{c===S.type&&a&&n.addMark(w,N,c.create({...S.attrs,...e}))}))}),h},N$=(t,e={})=>({state:n,dispatch:r})=>{const a=Ot(t,n.schema);return X3(a,e)(n,r)},k$=(t,e={})=>({state:n,dispatch:r})=>{const a=Ot(t,n.schema);return Z3(a,e)(n,r)},j$=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach(r=>r.apply(this,e)),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(r=>r!==e):delete this.callbacks[t]),this}once(t,e){const n=(...r)=>{this.off(t,n),e.apply(this,r)};return this.on(t,n)}removeAllListeners(){this.callbacks={}}},_h=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},C$=(t,e)=>{if(Ny(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function ru(t){var e;const{editor:n,from:r,to:a,text:i,rules:c,plugin:u}=t,{view:h}=n;if(h.composing)return!1;const p=h.state.doc.resolve(r);if(p.parent.type.spec.code||(e=p.nodeBefore||p.nodeAfter)!=null&&e.marks.find(x=>x.type.spec.code))return!1;let m=!1;const g=XL(p)+i;return c.forEach(x=>{if(m)return;const v=C$(g,x.find);if(!v)return;const w=h.state.tr,N=Ch({state:h.state,transaction:w}),S={from:r-(v[0].length-i.length),to:a},{commands:j,chain:A,can:$}=new Th({editor:n,state:N});x.handler({state:N,range:S,match:v,commands:j,chain:A,can:$})===null||!w.steps.length||(x.undoable&&w.setMeta(u,{transform:w,from:r,to:a,text:i}),h.dispatch(w),m=!0)}),m}function T$(t){const{editor:e,rules:n}=t,r=new pt({state:{init(){return null},apply(a,i,c){const u=a.getMeta(r);if(u)return u;const h=a.getMeta("applyInputRules");return h&&setTimeout(()=>{let{text:m}=h;typeof m=="string"?m=m:m=Ty(le.from(m),c.schema);const{from:g}=h,x=g+m.length;ru({editor:e,from:g,to:x,text:m,rules:n,plugin:r})}),a.selectionSet||a.docChanged?null:i}},props:{handleTextInput(a,i,c,u){return ru({editor:e,from:i,to:c,text:u,rules:n,plugin:r})},handleDOMEvents:{compositionend:a=>(setTimeout(()=>{const{$cursor:i}=a.state.selection;i&&ru({editor:e,from:i.pos,to:i.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(a,i){if(i.key!=="Enter")return!1;const{$cursor:c}=a.state.selection;return c?ru({editor:e,from:c.pos,to:c.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function E$(t){return Object.prototype.toString.call(t).slice(8,-1)}function su(t){return E$(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function n2(t,e){const n={...t};return su(t)&&su(e)&&Object.keys(e).forEach(r=>{su(e[r])&&su(t[r])?n[r]=n2(t[r],e[r]):n[r]=e[r]}),n}var Ay=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...Qe(Ce(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...Qe(Ce(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>n2(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},Za=class r2 extends Ay{constructor(){super(...arguments),this.type="mark"}static create(e={}){const n=typeof e=="function"?e():e;return new r2(n)}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,a=e.state.selection.$from;if(a.pos===a.end()){const c=a.marks();if(!!!c.find(p=>p?.type.name===n.name))return!1;const h=c.find(p=>p?.type.name===n.name);return h&&r.removeStoredMark(h),r.insertText(" ",a.pos),e.view.dispatch(r),!0}return!1}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function R$(t){return typeof t=="number"}var A$=class{constructor(t){this.find=t.find,this.handler=t.handler}},_$=(t,e,n)=>{if(Ny(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(a=>{const i=[a.text];return i.index=a.index,i.input=t,i.data=a.data,a.replaceWith&&(a.text.includes(a.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(a.replaceWith)),i}):[]};function M$(t){const{editor:e,state:n,from:r,to:a,rule:i,pasteEvent:c,dropEvent:u}=t,{commands:h,chain:p,can:m}=new Th({editor:e,state:n}),g=[];return n.doc.nodesBetween(r,a,(v,w)=>{var N,S,j,A,$;if((S=(N=v.type)==null?void 0:N.spec)!=null&&S.code||!(v.isText||v.isTextblock||v.isInline))return;const L=($=(A=(j=v.content)==null?void 0:j.size)!=null?A:v.nodeSize)!=null?$:0,R=Math.max(r,w),M=Math.min(a,w+L);if(R>=M)return;const D=v.isText?v.text||"":v.textBetween(R-w,M-w,void 0,"");_$(D,i.find,c).forEach(W=>{if(W.index===void 0)return;const ue=R+W.index+1,he=ue+W[0].length,J={from:n.tr.mapping.map(ue),to:n.tr.mapping.map(he)},_=i.handler({state:n,range:J,match:W,commands:h,chain:p,can:m,pasteEvent:c,dropEvent:u});g.push(_)})}),g.every(v=>v!==null)}var au=null,O$=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)==null||e.setData("text/html",t),n};function D$(t){const{editor:e,rules:n}=t;let r=null,a=!1,i=!1,c=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,u;try{u=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{u=null}const h=({state:m,from:g,to:x,rule:v,pasteEvt:w})=>{const N=m.tr,S=Ch({state:m,transaction:N});if(!(!M$({editor:e,state:S,from:Math.max(g-1,0),to:x.b-1,rule:v,pasteEvent:w,dropEvent:u})||!N.steps.length)){try{u=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{u=null}return c=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,N}};return n.map(m=>new pt({view(g){const x=w=>{var N;r=(N=g.dom.parentElement)!=null&&N.contains(w.target)?g.dom.parentElement:null,r&&(au=e)},v=()=>{au&&(au=null)};return window.addEventListener("dragstart",x),window.addEventListener("dragend",v),{destroy(){window.removeEventListener("dragstart",x),window.removeEventListener("dragend",v)}}},props:{handleDOMEvents:{drop:(g,x)=>{if(i=r===g.dom.parentElement,u=x,!i){const v=au;v?.isEditable&&setTimeout(()=>{const w=v.state.selection;w&&v.commands.deleteRange({from:w.from,to:w.to})},10)}return!1},paste:(g,x)=>{var v;const w=(v=x.clipboardData)==null?void 0:v.getData("text/html");return c=x,a=!!w?.includes("data-pm-slice"),!1}}},appendTransaction:(g,x,v)=>{const w=g[0],N=w.getMeta("uiEvent")==="paste"&&!a,S=w.getMeta("uiEvent")==="drop"&&!i,j=w.getMeta("applyPasteRules"),A=!!j;if(!N&&!S&&!A)return;if(A){let{text:R}=j;typeof R=="string"?R=R:R=Ty(le.from(R),v.schema);const{from:M}=j,D=M+R.length,I=O$(R);return h({rule:m,state:v,from:M,to:{b:D},pasteEvt:I})}const $=x.doc.content.findDiffStart(v.doc.content),L=x.doc.content.findDiffEnd(v.doc.content);if(!(!R$($)||!L||$===L.b))return h({rule:m,state:v,from:$,to:L,pasteEvt:c})}}))}var Mh=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=Kj(t),this.schema=GL(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Bm(e.name,this.schema)},r=Ce(e,"addCommands",n);return r?{...t,...r()}:t},{})}get plugins(){const{editor:t}=this;return Ey([...this.extensions].reverse()).flatMap(r=>{const a={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:Bm(r.name,this.schema)},i=[],c=Ce(r,"addKeyboardShortcuts",a);let u={};if(r.type==="mark"&&Ce(r,"exitable",a)&&(u.ArrowRight=()=>Za.handleExit({editor:t,mark:r})),c){const x=Object.fromEntries(Object.entries(c()).map(([v,w])=>[v,()=>w({editor:t})]));u={...u,...x}}const h=K5(u);i.push(h);const p=Ce(r,"addInputRules",a);if(aS(r,t.options.enableInputRules)&&p){const x=p();if(x&&x.length){const v=T$({editor:t,rules:x}),w=Array.isArray(v)?v:[v];i.push(...w)}}const m=Ce(r,"addPasteRules",a);if(aS(r,t.options.enablePasteRules)&&m){const x=m();if(x&&x.length){const v=D$({editor:t,rules:x});i.push(...v)}}const g=Ce(r,"addProseMirrorPlugins",a);if(g){const x=g();i.push(...x)}return i})}get attributes(){return Wj(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=go(this.extensions);return Object.fromEntries(e.filter(n=>!!Ce(n,"addNodeView")).map(n=>{const r=this.attributes.filter(h=>h.type===n.name),a={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:Ot(n.name,this.schema)},i=Ce(n,"addNodeView",a);if(!i)return[];const c=i();if(!c)return[];const u=(h,p,m,g,x)=>{const v=Bu(h,r);return c({node:h,view:p,getPos:m,decorations:g,innerDecorations:x,editor:t,extension:n,HTMLAttributes:v})};return[n.name,u]}))}get markViews(){const{editor:t}=this,{markExtensions:e}=go(this.extensions);return Object.fromEntries(e.filter(n=>!!Ce(n,"addMarkView")).map(n=>{const r=this.attributes.filter(u=>u.type===n.name),a={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:is(n.name,this.schema)},i=Ce(n,"addMarkView",a);if(!i)return[];const c=(u,h,p)=>{const m=Bu(u,r);return i()({mark:u,view:h,inline:p,editor:t,extension:n,HTMLAttributes:m,updateAttributes:g=>{K$(u,t,g)}})};return[n.name,c]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var n;const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Bm(e.name,this.schema)};e.type==="mark"&&((n=Qe(Ce(e,"keepOnSplit",r)))==null||n)&&this.splittableMarks.push(e.name);const a=Ce(e,"onBeforeCreate",r),i=Ce(e,"onCreate",r),c=Ce(e,"onUpdate",r),u=Ce(e,"onSelectionUpdate",r),h=Ce(e,"onTransaction",r),p=Ce(e,"onFocus",r),m=Ce(e,"onBlur",r),g=Ce(e,"onDestroy",r);a&&this.editor.on("beforeCreate",a),i&&this.editor.on("create",i),c&&this.editor.on("update",c),u&&this.editor.on("selectionUpdate",u),h&&this.editor.on("transaction",h),p&&this.editor.on("focus",p),m&&this.editor.on("blur",m),g&&this.editor.on("destroy",g)})}};Mh.resolve=Kj;Mh.sort=Ey;Mh.flatten=Cy;var L$={};Sy(L$,{ClipboardTextSerializer:()=>a2,Commands:()=>i2,Delete:()=>o2,Drop:()=>l2,Editable:()=>c2,FocusEvents:()=>u2,Keymap:()=>h2,Paste:()=>f2,Tabindex:()=>p2,TextDirection:()=>m2,focusEventsPluginKey:()=>d2});var Ct=class s2 extends Ay{constructor(){super(...arguments),this.type="extension"}static create(e={}){const n=typeof e=="function"?e():e;return new s2(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},a2=Ct.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new pt({key:new Pt("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:a}=e,{ranges:i}=a,c=Math.min(...i.map(m=>m.$from.pos)),u=Math.max(...i.map(m=>m.$to.pos)),h=Jj(n);return Yj(r,{from:c,to:u},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:h})}}})]}}),i2=Ct.create({name:"commands",addCommands(){return{...Ij}}}),o2=Ct.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var n,r,a;const i=()=>{var c,u,h,p;if((p=(h=(u=(c=this.editor.options.coreExtensionOptions)==null?void 0:c.delete)==null?void 0:u.filterTransaction)==null?void 0:h.call(u,t))!=null?p:t.getMeta("y-sync$"))return;const m=Gj(t.before,[t,...e]);Xj(m).forEach(v=>{m.mapping.mapResult(v.oldRange.from).deletedAfter&&m.mapping.mapResult(v.oldRange.to).deletedBefore&&m.before.nodesBetween(v.oldRange.from,v.oldRange.to,(w,N)=>{const S=N+w.nodeSize-2,j=v.oldRange.from<=N&&S<=v.oldRange.to;this.editor.emit("delete",{type:"node",node:w,from:N,to:S,newFrom:m.mapping.map(N),newTo:m.mapping.map(S),deletedRange:v.oldRange,newRange:v.newRange,partial:!j,editor:this.editor,transaction:t,combinedTransform:m})})});const x=m.mapping;m.steps.forEach((v,w)=>{var N,S;if(v instanceof gr){const j=x.slice(w).map(v.from,-1),A=x.slice(w).map(v.to),$=x.invert().map(j,-1),L=x.invert().map(A),R=(N=m.doc.nodeAt(j-1))==null?void 0:N.marks.some(D=>D.eq(v.mark)),M=(S=m.doc.nodeAt(A))==null?void 0:S.marks.some(D=>D.eq(v.mark));this.editor.emit("delete",{type:"mark",mark:v.mark,from:v.from,to:v.to,deletedRange:{from:$,to:L},newRange:{from:j,to:A},partial:!!(M||R),editor:this.editor,transaction:t,combinedTransform:m})}})};(a=(r=(n=this.editor.options.coreExtensionOptions)==null?void 0:n.delete)==null?void 0:r.async)==null||a?setTimeout(i,0):i()}}),l2=Ct.create({name:"drop",addProseMirrorPlugins(){return[new pt({key:new Pt("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),c2=Ct.create({name:"editable",addProseMirrorPlugins(){return[new pt({key:new Pt("editable"),props:{editable:()=>this.editor.options.editable}})]}}),d2=new Pt("focusEvents"),u2=Ct.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new pt({key:d2,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),h2=Ct.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:c})=>[()=>c.undoInputRule(),()=>c.command(({tr:u})=>{const{selection:h,doc:p}=u,{empty:m,$anchor:g}=h,{pos:x,parent:v}=g,w=g.parent.isTextblock&&x>0?u.doc.resolve(x-1):g,N=w.parent.type.spec.isolating,S=g.pos-g.parentOffset,j=N&&w.parent.childCount===1?S===g.pos:Be.atStart(p).from===x;return!m||!v.type.isTextblock||v.textContent.length||!j||j&&g.parent.type.name==="paragraph"?!1:c.clearNodes()}),()=>c.deleteSelection(),()=>c.joinBackward(),()=>c.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:c})=>[()=>c.deleteSelection(),()=>c.deleteCurrentNode(),()=>c.joinForward(),()=>c.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:c})=>[()=>c.newlineInCode(),()=>c.createParagraphNear(),()=>c.liftEmptyBlock(),()=>c.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},a={...r},i={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return jy()||Vj()?i:a},addProseMirrorPlugins(){return[new pt({key:new Pt("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(N=>N.getMeta("composition")))return;const r=t.some(N=>N.docChanged)&&!e.doc.eq(n.doc),a=t.some(N=>N.getMeta("preventClearDocument"));if(!r||a)return;const{empty:i,from:c,to:u}=e.selection,h=Be.atStart(e.doc).from,p=Be.atEnd(e.doc).to;if(i||!(c===h&&u===p)||!Ah(n.doc))return;const x=n.tr,v=Ch({state:n,transaction:x}),{commands:w}=new Th({editor:this.editor,state:v});if(w.clearNodes(),!!x.steps.length)return x}})]}}),f2=Ct.create({name:"paste",addProseMirrorPlugins(){return[new pt({key:new Pt("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),p2=Ct.create({name:"tabindex",addProseMirrorPlugins(){return[new pt({key:new Pt("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),m2=Ct.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=go(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const n=e.getAttribute("dir");return n&&(n==="ltr"||n==="rtl"||n==="auto")?n:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new pt({key:new Pt("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}}),$$=class ro{constructor(e,n,r=!1,a=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=a}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new ro(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new ro(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new ro(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const a=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,c=this.pos+r+(i?0:1);if(c<0||c>this.resolvedPos.doc.nodeSize-2)return;const u=this.resolvedPos.doc.resolve(c);if(!a&&u.depth<=this.depth)return;const h=new ro(u,this.editor,a,a?n:null);a&&(h.actualDepth=this.depth+1),e.push(new ro(u,this.editor,a,a?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,a=this.parent;for(;a&&!r;){if(a.node.type.name===e)if(Object.keys(n).length>0){const i=a.node.attrs,c=Object.keys(n);for(let u=0;u<c.length;u+=1){const h=c[u];if(i[h]!==n[h])break}}else r=a;a=a.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let a=[];if(!this.children||this.children.length===0)return a;const i=Object.keys(n);return this.children.forEach(c=>{r&&a.length>0||(c.node.type.name===e&&i.every(h=>n[h]===c.node.attrs[h])&&a.push(c),!(r&&a.length>0)&&(a=a.concat(c.querySelectorAll(e,n,r))))}),a}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}},B$=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function I$(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const a=document.createElement("style");return e&&a.setAttribute("nonce",e),a.setAttribute("data-tiptap-style",""),a.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(a),a}var P$=class extends j${constructor(t={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:r})=>{throw r},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:n$,createMappablePosition:r$},this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:r,slice:a,moved:i})=>this.options.onDrop(r,a,i)),this.on("paste",({event:r,slice:a})=>this.options.onPaste(r,a)),this.on("delete",this.options.onDelete);const e=this.createDoc(),n=Uj(e,this.options.autofocus);this.editorState=oo.create({doc:e,schema:this.schema,selection:n||void 0}),this.options.element&&this.mount(this.options.element)}mount(t){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const t=this.editorView.dom;t?.editor&&delete t.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(t){console.warn("Failed to remove CSS element:",t)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=I$(B$,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:t=>{this.editorState=t},dispatch:t=>{this.dispatchTransaction(t)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(t,e)=>{if(this.editorView)return this.editorView[e];if(e==="state")return this.editorState;if(e in t)return Reflect.get(t,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(t,e){const n=qj(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let n=e;if([].concat(t).forEach(a=>{const i=typeof a=="string"?`${a}$`:a.key;n=n.filter(c=>!c.key.startsWith(i))}),e.length===n.length)return;const r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}createExtensionManager(){var t,e;const r=[...this.options.enableCoreExtensions?[c2,a2.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)==null?void 0:t.clipboardTextSerializer)==null?void 0:e.blockSeparator}),i2,u2,h2,p2,l2,f2,o2,m2.configure({direction:this.options.textDirection})].filter(a=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[a.name]!==!1:!0):[],...this.options.extensions].filter(a=>["extension","node","mark"].includes(a?.type));this.extensionManager=new Mh(r,this)}createCommandManager(){this.commandManager=new Th({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let t;try{t=Mg(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(n=>n.name!=="collaboration"),this.createExtensionManager()}}),t=Mg(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t}createView(t){var e;this.editorView=new $j(t,{...this.options.editorProps,attributes:{role:"textbox",...(e=this.options.editorProps)==null?void 0:e.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.prependClass(),this.injectCSS();const r=this.view.dom;r.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(p=>{var m;return(m=this.capturedTransaction)==null?void 0:m.step(p)});return}const{state:e,transactions:n}=this.state.applyTransaction(t),r=!this.state.selection.eq(e.selection),a=n.includes(t),i=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),!a)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:n.slice(1)}),r&&this.emit("selectionUpdate",{editor:this,transaction:t});const c=n.findLast(p=>p.getMeta("focus")||p.getMeta("blur")),u=c?.getMeta("focus"),h=c?.getMeta("blur");u&&this.emit("focus",{editor:this,event:u.event,transaction:c}),h&&this.emit("blur",{editor:this,event:h.event,transaction:c}),!(t.getMeta("preventUpdate")||!n.some(p=>p.docChanged)||i.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:t,appendedTransactions:n.slice(1)})}getAttributes(t){return Qj(this.state,t)}isActive(t,e){const n=typeof t=="string"?t:null,r=typeof t=="string"?e:t;return ZL(this.state,n,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Ty(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:n={}}=t||{};return WL(this.state.doc,{blockSeparator:e,textSerializers:{...Jj(this.schema),...n}})}get isEmpty(){return Ah(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var t,e;return(e=(t=this.editorView)==null?void 0:t.isDestroyed)!=null?e:!0}$node(t,e){var n;return((n=this.$doc)==null?void 0:n.querySelector(t,e))||null}$nodes(t,e){var n;return((n=this.$doc)==null?void 0:n.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new $$(e,this)}get $doc(){return this.$pos(0)}};function yo(t){return new _h({find:t.find,handler:({state:e,range:n,match:r})=>{const a=Qe(t.getAttributes,void 0,r);if(a===!1||a===null)return null;const{tr:i}=e,c=r[r.length-1],u=r[0];if(c){const h=u.search(/\S/),p=n.from+u.indexOf(c),m=p+c.length;if(Ry(n.from,n.to,e.doc).filter(v=>v.mark.type.excluded.find(N=>N===t.type&&N!==v.mark.type)).filter(v=>v.to>p).length)return null;m<n.to&&i.delete(m,n.to),p>n.from&&i.delete(n.from+h,p);const x=n.from+h+c.length;i.addMark(n.from+h,x,t.type.create(a||{})),i.removeStoredMark(t.type)}},undoable:t.undoable})}function z$(t){return new _h({find:t.find,handler:({state:e,range:n,match:r})=>{const a=Qe(t.getAttributes,void 0,r)||{},{tr:i}=e,c=n.from;let u=n.to;const h=t.type.create(a);if(r[1]){const p=r[0].lastIndexOf(r[1]);let m=c+p;m>u?m=u:u=m+r[1].length;const g=r[0][r[0].length-1];i.insertText(g,c+r[0].length-1),i.replaceWith(m,u,h)}else if(r[0]){const p=t.type.isInline?c:c-1;i.insert(p,t.type.create(a)).delete(i.mapping.map(c),i.mapping.map(u))}i.scrollIntoView()},undoable:t.undoable})}function Dg(t){return new _h({find:t.find,handler:({state:e,range:n,match:r})=>{const a=e.doc.resolve(n.from),i=Qe(t.getAttributes,void 0,r)||{};if(!a.node(-1).canReplaceWith(a.index(-1),a.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,i)},undoable:t.undoable})}function xo(t){return new _h({find:t.find,handler:({state:e,range:n,match:r,chain:a})=>{const i=Qe(t.getAttributes,void 0,r)||{},c=e.tr.delete(n.from,n.to),h=c.doc.resolve(n.from).blockRange(),p=h&&iy(h,t.type,i);if(!p)return null;if(c.wrap(h,p),t.keepMarks&&t.editor){const{selection:g,storedMarks:x}=e,{splittableMarks:v}=t.editor.extensionManager,w=x||g.$to.parentOffset&&g.$from.marks();if(w){const N=w.filter(S=>v.includes(S.type.name));c.ensureMarks(N)}}if(t.keepAttributes){const g=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";a().updateAttributes(g,i).run()}const m=c.doc.resolve(n.from-1).nodeBefore;m&&m.type===t.type&&ta(c.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,m))&&c.join(n.from-1)},undoable:t.undoable})}function U$(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof Te){const i=r.index();return r.parent.canReplaceWith(i,i+1,e)}let a=r.depth;for(;a>=0;){const i=r.index(a);if(r.node(a).contentMatchAt(i).matchType(e))return!0;a-=1}return!1}var H$={};Sy(H$,{createAtomBlockMarkdownSpec:()=>V$,createBlockMarkdownSpec:()=>F$,createInlineMarkdownSpec:()=>W$,parseAttributes:()=>_y,parseIndentedBlocks:()=>Lg,renderNestedMarkdownContent:()=>Oy,serializeAttributes:()=>My});function _y(t){if(!t?.trim())return{};const e={},n=[],r=t.replace(/["']([^"']*)["']/g,p=>(n.push(p),`__QUOTED_${n.length-1}__`)),a=r.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(a){const p=a.map(m=>m.trim().slice(1));e.class=p.join(" ")}const i=r.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);i&&(e.id=i[1]);const c=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(r.matchAll(c)).forEach(([,p,m])=>{var g;const x=parseInt(((g=m.match(/__QUOTED_(\d+)__/))==null?void 0:g[1])||"0",10),v=n[x];v&&(e[p]=v.slice(1,-1))});const h=r.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return h&&h.split(/\s+/).filter(Boolean).forEach(m=>{m.match(/^[a-zA-Z][\w-]*$/)&&(e[m]=!0)}),e}function My(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(r=>e.push(`.${r}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([n,r])=>{n==="class"||n==="id"||(r===!0?e.push(n):r!==!1&&r!=null&&e.push(`${n}="${String(r)}"`))}),e.join(" ")}function V$(t){const{nodeName:e,name:n,parseAttributes:r=_y,serializeAttributes:a=My,defaultAttributes:i={},requiredAttributes:c=[],allowedAttributes:u}=t,h=n||e,p=m=>{if(!u)return m;const g={};return u.forEach(x=>{x in m&&(g[x]=m[x])}),g};return{parseMarkdown:(m,g)=>{const x={...i,...m.attributes};return g.createNode(e,x,[])},markdownTokenizer:{name:e,level:"block",start(m){var g;const x=new RegExp(`^:::${h}(?:\\s|$)`,"m"),v=(g=m.match(x))==null?void 0:g.index;return v!==void 0?v:-1},tokenize(m,g,x){const v=new RegExp(`^:::${h}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),w=m.match(v);if(!w)return;const N=w[1]||"",S=r(N);if(!c.find(A=>!(A in S)))return{type:e,raw:w[0],attributes:S}}},renderMarkdown:m=>{const g=p(m.attrs||{}),x=a(g),v=x?` {${x}}`:"";return`:::${h}${v} :::`}}}function F$(t){const{nodeName:e,name:n,getContent:r,parseAttributes:a=_y,serializeAttributes:i=My,defaultAttributes:c={},content:u="block",allowedAttributes:h}=t,p=n||e,m=g=>{if(!h)return g;const x={};return h.forEach(v=>{v in g&&(x[v]=g[v])}),x};return{parseMarkdown:(g,x)=>{let v;if(r){const N=r(g);v=typeof N=="string"?[{type:"text",text:N}]:N}else u==="block"?v=x.parseChildren(g.tokens||[]):v=x.parseInline(g.tokens||[]);const w={...c,...g.attributes};return x.createNode(e,w,v)},markdownTokenizer:{name:e,level:"block",start(g){var x;const v=new RegExp(`^:::${p}`,"m"),w=(x=g.match(v))==null?void 0:x.index;return w!==void 0?w:-1},tokenize(g,x,v){var w;const N=new RegExp(`^:::${p}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),S=g.match(N);if(!S)return;const[j,A=""]=S,$=a(A);let L=1;const R=j.length;let M="";const D=/^:::([\w-]*)(\s.*)?/gm,I=g.slice(R);for(D.lastIndex=0;;){const W=D.exec(I);if(W===null)break;const ue=W.index,he=W[1];if(!((w=W[2])!=null&&w.endsWith(":::"))){if(he)L+=1;else if(L-=1,L===0){const J=I.slice(0,ue);M=J.trim();const _=g.slice(0,R+ue+W[0].length);let V=[];if(M)if(u==="block")for(V=v.blockTokens(J),V.forEach(F=>{F.text&&(!F.tokens||F.tokens.length===0)&&(F.tokens=v.inlineTokens(F.text))});V.length>0;){const F=V[V.length-1];if(F.type==="paragraph"&&(!F.text||F.text.trim()===""))V.pop();else break}else V=v.inlineTokens(M);return{type:e,raw:_,attributes:$,content:M,tokens:V}}}}}},renderMarkdown:(g,x)=>{const v=m(g.attrs||{}),w=i(v),N=w?` {${w}}`:"",S=x.renderChildren(g.content||[],`

`);return`:::${p}${N}

${S}

:::`}}}function G$(t){if(!t.trim())return{};const e={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let r=n.exec(t);for(;r!==null;){const[,a,i,c]=r;e[a]=i||c,r=n.exec(t)}return e}function q$(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>`${e}="${n}"`).join(" ")}function W$(t){const{nodeName:e,name:n,getContent:r,parseAttributes:a=G$,serializeAttributes:i=q$,defaultAttributes:c={},selfClosing:u=!1,allowedAttributes:h}=t,p=n||e,m=x=>{if(!h)return x;const v={};return h.forEach(w=>{const N=typeof w=="string"?w:w.name,S=typeof w=="string"?void 0:w.skipIfDefault;if(N in x){const j=x[N];if(S!==void 0&&j===S)return;v[N]=j}}),v},g=p.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(x,v)=>{const w={...c,...x.attributes};if(u)return v.createNode(e,w);const N=r?r(x):x.content||"";return N?v.createNode(e,w,[v.createTextNode(N)]):v.createNode(e,w,[])},markdownTokenizer:{name:e,level:"inline",start(x){const v=u?new RegExp(`\\[${g}\\s*[^\\]]*\\]`):new RegExp(`\\[${g}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${g}\\]`),w=x.match(v),N=w?.index;return N!==void 0?N:-1},tokenize(x,v,w){const N=u?new RegExp(`^\\[${g}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${g}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${g}\\]`),S=x.match(N);if(!S)return;let j="",A="";if(u){const[,L]=S;A=L}else{const[,L,R]=S;A=L,j=R||""}const $=a(A.trim());return{type:e,raw:S[0],content:j.trim(),attributes:$}}},renderMarkdown:x=>{let v="";r?v=r(x):x.content&&x.content.length>0&&(v=x.content.filter(j=>j.type==="text").map(j=>j.text).join(""));const w=m(x.attrs||{}),N=i(w),S=N?` ${N}`:"";return u?`[${p}${S}]`:`[${p}${S}]${v}[/${p}]`}}}function Lg(t,e,n){var r,a,i,c;const u=t.split(`
`),h=[];let p="",m=0;const g=e.baseIndentSize||2;for(;m<u.length;){const x=u[m],v=x.match(e.itemPattern);if(!v){if(h.length>0)break;if(x.trim()===""){m+=1,p=`${p}${x}
`;continue}else return}const w=e.extractItemData(v),{indentLevel:N,mainContent:S}=w;p=`${p}${x}
`;const j=[S];for(m+=1;m<u.length;){const R=u[m];if(R.trim()===""){const D=u.slice(m+1).findIndex(ue=>ue.trim()!=="");if(D===-1)break;if((((a=(r=u[m+1+D].match(/^(\s*)/))==null?void 0:r[1])==null?void 0:a.length)||0)>N){j.push(R),p=`${p}${R}
`,m+=1;continue}else break}if((((c=(i=R.match(/^(\s*)/))==null?void 0:i[1])==null?void 0:c.length)||0)>N)j.push(R),p=`${p}${R}
`,m+=1;else break}let A;const $=j.slice(1);if($.length>0){const R=$.map(M=>M.slice(N+g)).join(`
`);R.trim()&&(e.customNestedParser?A=e.customNestedParser(R):A=n.blockTokens(R))}const L=e.createToken(w,A);h.push(L)}if(h.length!==0)return{items:h,raw:p}}function Oy(t,e,n,r){if(!t||!Array.isArray(t.content))return"";const a=typeof n=="function"?n(r):n,[i,...c]=t.content,u=e.renderChildren([i]),h=[`${a}${u}`];return c&&c.length>0&&c.forEach(p=>{const m=e.renderChildren([p]);if(m){const g=m.split(`
`).map(x=>x?e.indent(x):"").join(`
`);h.push(g)}}),h.join(`
`)}function K$(t,e,n={}){const{state:r}=e,{doc:a,tr:i}=r,c=t;a.descendants((u,h)=>{const p=i.mapping.map(h),m=i.mapping.map(h)+u.nodeSize;let g=null;if(u.marks.forEach(v=>{if(v!==c)return!1;g=v}),!g)return;let x=!1;if(Object.keys(n).forEach(v=>{n[v]!==g.attrs[v]&&(x=!0)}),x){const v=t.type.create({...t.attrs,...n});i.removeMark(p,m,t.type),i.addMark(p,m,v)}}),i.docChanged&&e.view.dispatch(i)}var zn=class g2 extends Ay{constructor(){super(...arguments),this.type="node"}static create(e={}){const n=typeof e=="function"?e():e;return new g2(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function Ka(t){return new A$({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:a})=>{const i=Qe(t.getAttributes,void 0,r,a);if(i===!1||i===null)return null;const{tr:c}=e,u=r[r.length-1],h=r[0];let p=n.to;if(u){const m=h.search(/\S/),g=n.from+h.indexOf(u),x=g+u.length;if(Ry(n.from,n.to,e.doc).filter(w=>w.mark.type.excluded.find(S=>S===t.type&&S!==w.mark.type)).filter(w=>w.to>g).length)return null;x<n.to&&c.delete(x,n.to),g>n.from&&c.delete(n.from+m,g),p=n.from+m+u.length,c.addMark(n.from+m,p,t.type.create(i||{})),c.removeStoredMark(t.type)}}})}const{getOwnPropertyNames:Y$,getOwnPropertySymbols:J$}=Object,{hasOwnProperty:Q$}=Object.prototype;function zm(t,e){return function(r,a,i){return t(r,a,i)&&e(r,a,i)}}function iu(t){return function(n,r,a){if(!n||!r||typeof n!="object"||typeof r!="object")return t(n,r,a);const{cache:i}=a,c=i.get(n),u=i.get(r);if(c&&u)return c===r&&u===n;i.set(n,r),i.set(r,n);const h=t(n,r,a);return i.delete(n),i.delete(r),h}}function X$(t){return t?.[Symbol.toStringTag]}function lS(t){return Y$(t).concat(J$(t))}const Z$=Object.hasOwn||((t,e)=>Q$.call(t,e));function ei(t,e){return t===e||!t&&!e&&t!==t&&e!==e}const eB="__v",tB="__o",nB="_owner",{getOwnPropertyDescriptor:cS,keys:dS}=Object;function rB(t,e){return t.byteLength===e.byteLength&&Iu(new Uint8Array(t),new Uint8Array(e))}function sB(t,e,n){let r=t.length;if(e.length!==r)return!1;for(;r-- >0;)if(!n.equals(t[r],e[r],r,r,t,e,n))return!1;return!0}function aB(t,e){return t.byteLength===e.byteLength&&Iu(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function iB(t,e){return ei(t.getTime(),e.getTime())}function oB(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function lB(t,e){return t===e}function uS(t,e,n){const r=t.size;if(r!==e.size)return!1;if(!r)return!0;const a=new Array(r),i=t.entries();let c,u,h=0;for(;(c=i.next())&&!c.done;){const p=e.entries();let m=!1,g=0;for(;(u=p.next())&&!u.done;){if(a[g]){g++;continue}const x=c.value,v=u.value;if(n.equals(x[0],v[0],h,g,t,e,n)&&n.equals(x[1],v[1],x[0],v[0],t,e,n)){m=a[g]=!0;break}g++}if(!m)return!1;h++}return!0}const cB=ei;function dB(t,e,n){const r=dS(t);let a=r.length;if(dS(e).length!==a)return!1;for(;a-- >0;)if(!y2(t,e,n,r[a]))return!1;return!0}function Sl(t,e,n){const r=lS(t);let a=r.length;if(lS(e).length!==a)return!1;let i,c,u;for(;a-- >0;)if(i=r[a],!y2(t,e,n,i)||(c=cS(t,i),u=cS(e,i),(c||u)&&(!c||!u||c.configurable!==u.configurable||c.enumerable!==u.enumerable||c.writable!==u.writable)))return!1;return!0}function uB(t,e){return ei(t.valueOf(),e.valueOf())}function hB(t,e){return t.source===e.source&&t.flags===e.flags}function hS(t,e,n){const r=t.size;if(r!==e.size)return!1;if(!r)return!0;const a=new Array(r),i=t.values();let c,u;for(;(c=i.next())&&!c.done;){const h=e.values();let p=!1,m=0;for(;(u=h.next())&&!u.done;){if(!a[m]&&n.equals(c.value,u.value,c.value,u.value,t,e,n)){p=a[m]=!0;break}m++}if(!p)return!1}return!0}function Iu(t,e){let n=t.byteLength;if(e.byteLength!==n||t.byteOffset!==e.byteOffset)return!1;for(;n-- >0;)if(t[n]!==e[n])return!1;return!0}function fB(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function y2(t,e,n,r){return(r===nB||r===tB||r===eB)&&(t.$$typeof||e.$$typeof)?!0:Z$(e,r)&&n.equals(t[r],e[r],r,r,t,e,n)}const pB="[object ArrayBuffer]",mB="[object Arguments]",gB="[object Boolean]",yB="[object DataView]",xB="[object Date]",bB="[object Error]",vB="[object Map]",wB="[object Number]",SB="[object Object]",NB="[object RegExp]",kB="[object Set]",jB="[object String]",CB={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float16Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0,"[object BigInt64Array]":!0,"[object BigUint64Array]":!0},TB="[object URL]",EB=Object.prototype.toString;function RB({areArrayBuffersEqual:t,areArraysEqual:e,areDataViewsEqual:n,areDatesEqual:r,areErrorsEqual:a,areFunctionsEqual:i,areMapsEqual:c,areNumbersEqual:u,areObjectsEqual:h,arePrimitiveWrappersEqual:p,areRegExpsEqual:m,areSetsEqual:g,areTypedArraysEqual:x,areUrlsEqual:v,unknownTagComparators:w}){return function(S,j,A){if(S===j)return!0;if(S==null||j==null)return!1;const $=typeof S;if($!==typeof j)return!1;if($!=="object")return $==="number"?u(S,j,A):$==="function"?i(S,j,A):!1;const L=S.constructor;if(L!==j.constructor)return!1;if(L===Object)return h(S,j,A);if(Array.isArray(S))return e(S,j,A);if(L===Date)return r(S,j,A);if(L===RegExp)return m(S,j,A);if(L===Map)return c(S,j,A);if(L===Set)return g(S,j,A);const R=EB.call(S);if(R===xB)return r(S,j,A);if(R===NB)return m(S,j,A);if(R===vB)return c(S,j,A);if(R===kB)return g(S,j,A);if(R===SB)return typeof S.then!="function"&&typeof j.then!="function"&&h(S,j,A);if(R===TB)return v(S,j,A);if(R===bB)return a(S,j,A);if(R===mB)return h(S,j,A);if(CB[R])return x(S,j,A);if(R===pB)return t(S,j,A);if(R===yB)return n(S,j,A);if(R===gB||R===wB||R===jB)return p(S,j,A);if(w){let M=w[R];if(!M){const D=X$(S);D&&(M=w[D])}if(M)return M(S,j,A)}return!1}}function AB({circular:t,createCustomConfig:e,strict:n}){let r={areArrayBuffersEqual:rB,areArraysEqual:n?Sl:sB,areDataViewsEqual:aB,areDatesEqual:iB,areErrorsEqual:oB,areFunctionsEqual:lB,areMapsEqual:n?zm(uS,Sl):uS,areNumbersEqual:cB,areObjectsEqual:n?Sl:dB,arePrimitiveWrappersEqual:uB,areRegExpsEqual:hB,areSetsEqual:n?zm(hS,Sl):hS,areTypedArraysEqual:n?zm(Iu,Sl):Iu,areUrlsEqual:fB,unknownTagComparators:void 0};if(e&&(r=Object.assign({},r,e(r))),t){const a=iu(r.areArraysEqual),i=iu(r.areMapsEqual),c=iu(r.areObjectsEqual),u=iu(r.areSetsEqual);r=Object.assign({},r,{areArraysEqual:a,areMapsEqual:i,areObjectsEqual:c,areSetsEqual:u})}return r}function _B(t){return function(e,n,r,a,i,c,u){return t(e,n,u)}}function MB({circular:t,comparator:e,createState:n,equals:r,strict:a}){if(n)return function(u,h){const{cache:p=t?new WeakMap:void 0,meta:m}=n();return e(u,h,{cache:p,equals:r,meta:m,strict:a})};if(t)return function(u,h){return e(u,h,{cache:new WeakMap,equals:r,meta:void 0,strict:a})};const i={cache:void 0,equals:r,meta:void 0,strict:a};return function(u,h){return e(u,h,i)}}const OB=ra();ra({strict:!0});ra({circular:!0});ra({circular:!0,strict:!0});ra({createInternalComparator:()=>ei});ra({strict:!0,createInternalComparator:()=>ei});ra({circular:!0,createInternalComparator:()=>ei});ra({circular:!0,createInternalComparator:()=>ei,strict:!0});function ra(t={}){const{circular:e=!1,createInternalComparator:n,createState:r,strict:a=!1}=t,i=AB(t),c=RB(i),u=n?n(c):_B(c);return MB({circular:e,comparator:c,createState:r,equals:u,strict:a})}var Um={exports:{}},Hm={};var fS;function DB(){if(fS)return Hm;fS=1;var t=yc(),e=lk();function n(p,m){return p===m&&(p!==0||1/p===1/m)||p!==p&&m!==m}var r=typeof Object.is=="function"?Object.is:n,a=e.useSyncExternalStore,i=t.useRef,c=t.useEffect,u=t.useMemo,h=t.useDebugValue;return Hm.useSyncExternalStoreWithSelector=function(p,m,g,x,v){var w=i(null);if(w.current===null){var N={hasValue:!1,value:null};w.current=N}else N=w.current;w=u(function(){function j(M){if(!A){if(A=!0,$=M,M=x(M),v!==void 0&&N.hasValue){var D=N.value;if(v(D,M))return L=D}return L=M}if(D=L,r($,M))return D;var I=x(M);return v!==void 0&&v(D,I)?($=M,D):($=M,L=I)}var A=!1,$,L,R=g===void 0?null:g;return[function(){return j(m())},R===null?void 0:function(){return j(R())}]},[m,g,x,v]);var S=a(p,w[0],w[1]);return c(function(){N.hasValue=!0,N.value=S},[S]),h(S),S},Hm}var pS;function LB(){return pS||(pS=1,Um.exports=DB()),Um.exports}var $B=LB(),BB=(...t)=>e=>{t.forEach(n=>{typeof n=="function"?n(e):n&&(n.current=e)})},IB=({contentComponent:t})=>{const e=ck.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return l.jsx(l.Fragment,{children:Object.values(e)})};function PB(){const t=new Set;let e={};return{subscribe(n){return t.add(n),()=>{t.delete(n)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(n,r){e={...e,[n]:cD.createPortal(r.reactElement,r.element,n)},t.forEach(a=>a())},removeRenderer(n){const r={...e};delete r[n],e=r,t.forEach(a=>a())}}}var zB=class extends Ha.Component{constructor(t){var e;super(t),this.editorContentRef=Ha.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((e=t.editor)!=null&&e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){var t;const e=this.props.editor;if(e&&!e.isDestroyed&&((t=e.view.dom)!=null&&t.parentNode)){if(e.contentComponent)return;const n=this.editorContentRef.current;n.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:n}),e.contentComponent=PB(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(r=>r.hasContentComponentInitialized?r:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var t;const e=this.props.editor;if(e){this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null;try{if(!((t=e.view.dom)!=null&&t.parentNode))return;const n=document.createElement("div");n.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:n})}catch{}}}render(){const{editor:t,innerRef:e,...n}=this.props;return l.jsxs(l.Fragment,{children:[l.jsx("div",{ref:BB(e,this.editorContentRef),...n}),t?.contentComponent&&l.jsx(IB,{contentComponent:t.contentComponent})]})}},UB=E.forwardRef((t,e)=>{const n=Ha.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return Ha.createElement(zB,{key:n,innerRef:e,...t})}),x2=Ha.memo(UB),HB=typeof window<"u"?E.useLayoutEffect:E.useEffect,VB=class{constructor(t){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=t,this.lastSnapshot={editor:t,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(t){return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}watch(t){if(this.editor=t,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(r=>r())},n=this.editor;return n.on("transaction",e),()=>{n.off("transaction",e)}}}};function FB(t){var e;const[n]=E.useState(()=>new VB(t.editor)),r=$B.useSyncExternalStoreWithSelector(n.subscribe,n.getSnapshot,n.getServerSnapshot,t.selector,(e=t.equalityFn)!=null?e:OB);return HB(()=>n.watch(t.editor),[t.editor,n]),E.useDebugValue(r),r}var GB=!1,$g=typeof window>"u",qB=$g||!!(typeof window<"u"&&window.next),WB=class b2{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(n=>n())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?$g||qB?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...r)=>{var a,i;return(i=(a=this.options.current).onBeforeCreate)==null?void 0:i.call(a,...r)},onBlur:(...r)=>{var a,i;return(i=(a=this.options.current).onBlur)==null?void 0:i.call(a,...r)},onCreate:(...r)=>{var a,i;return(i=(a=this.options.current).onCreate)==null?void 0:i.call(a,...r)},onDestroy:(...r)=>{var a,i;return(i=(a=this.options.current).onDestroy)==null?void 0:i.call(a,...r)},onFocus:(...r)=>{var a,i;return(i=(a=this.options.current).onFocus)==null?void 0:i.call(a,...r)},onSelectionUpdate:(...r)=>{var a,i;return(i=(a=this.options.current).onSelectionUpdate)==null?void 0:i.call(a,...r)},onTransaction:(...r)=>{var a,i;return(i=(a=this.options.current).onTransaction)==null?void 0:i.call(a,...r)},onUpdate:(...r)=>{var a,i;return(i=(a=this.options.current).onUpdate)==null?void 0:i.call(a,...r)},onContentError:(...r)=>{var a,i;return(i=(a=this.options.current).onContentError)==null?void 0:i.call(a,...r)},onDrop:(...r)=>{var a,i;return(i=(a=this.options.current).onDrop)==null?void 0:i.call(a,...r)},onPaste:(...r)=>{var a,i;return(i=(a=this.options.current).onPaste)==null?void 0:i.call(a,...r)},onDelete:(...r)=>{var a,i;return(i=(a=this.options.current).onDelete)==null?void 0:i.call(a,...r)}};return new P$(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,n){return Object.keys(e).every(r=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(r)?!0:r==="extensions"&&e.extensions&&n.extensions?e.extensions.length!==n.extensions.length?!1:e.extensions.every((a,i)=>{var c;return a===((c=n.extensions)==null?void 0:c[i])}):e[r]===n[r])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?b2.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((r,a)=>r===e[a]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,n=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){n&&n.setOptions(this.options.current);return}n&&!n.isDestroyed&&(n.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function v2(t={},e=[]){const n=E.useRef(t);n.current=t;const[r]=E.useState(()=>new WB(n)),a=ck.useSyncExternalStore(r.subscribe,r.getEditor,r.getServerSnapshot);return E.useDebugValue(a),E.useEffect(r.onRender(e)),FB({editor:a,selector:({transactionNumber:i})=>t.shouldRerenderOnTransaction===!1||t.shouldRerenderOnTransaction===void 0?null:t.immediatelyRender&&i===0?0:i+1}),a}var KB=E.createContext({editor:null});KB.Consumer;var YB=E.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),JB=()=>E.useContext(YB);Ha.forwardRef((t,e)=>{const{onDragStart:n}=JB(),r=t.as||"div";return l.jsx(r,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...t.style}})});Ha.createContext({markViewContentRef:()=>{}});var Pu=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:n,...r}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,r,n]},QB=/^\s*>\s$/,XB=zn.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return Pu("blockquote",{...Dt(this.options.HTMLAttributes,t),children:Pu("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const n=">",r=[];return t.content.forEach(a=>{const u=e.renderChildren([a]).split(`
`).map(h=>h.trim()===""?n:`${n} ${h}`);r.push(u.join(`
`))}),r.join(`
${n}
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[xo({find:QB,type:this.type})]}}),ZB=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,e6=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,t6=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,n6=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,r6=Za.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return Pu("strong",{...Dt(this.options.HTMLAttributes,t),children:Pu("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[yo({find:ZB,type:this.type}),yo({find:t6,type:this.type})]},addPasteRules(){return[Ka({find:e6,type:this.type}),Ka({find:n6,type:this.type})]}}),s6=/(^|[^`])`([^`]+)`(?!`)$/,a6=/(^|[^`])`([^`]+)`(?!`)/g,i6=Za.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",Dt(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[yo({find:s6,type:this.type})]},addPasteRules(){return[Ka({find:a6,type:this.type})]}}),Vm=4,o6=/^```([a-z]+)?[\s\n]$/,l6=/^~~~([a-z]+)?[\s\n]$/,c6=zn.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:Vm,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options;if(!n)return null;const i=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(c=>c.startsWith(n)).map(c=>c.replace(n,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",Dt(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var n;return((n=t.raw)==null?void 0:n.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var n;let r="";const a=((n=t.attrs)==null?void 0:n.language)||"";return t.content?r=[`\`\`\`${a}`,e.renderChildren(t.content),"```"].join(`
`):r=`\`\`\`${a}

\`\`\``,r},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:Vm,{state:r}=t,{selection:a}=r,{$from:i,empty:c}=a;if(i.parent.type!==this.type)return!1;const u=" ".repeat(n);return c?t.commands.insertContent(u):t.commands.command(({tr:h})=>{const{from:p,to:m}=a,v=r.doc.textBetween(p,m,`
`,`
`).split(`
`).map(w=>u+w).join(`
`);return h.replaceWith(p,m,r.schema.text(v)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:Vm,{state:r}=t,{selection:a}=r,{$from:i,empty:c}=a;return i.parent.type!==this.type?!1:c?t.commands.command(({tr:u})=>{var h;const{pos:p}=i,m=i.start(),g=i.end(),v=r.doc.textBetween(m,g,`
`,`
`).split(`
`);let w=0,N=0;const S=p-m;for(let M=0;M<v.length;M+=1){if(N+v[M].length>=S){w=M;break}N+=v[M].length+1}const A=((h=v[w].match(/^ */))==null?void 0:h[0])||"",$=Math.min(A.length,n);if($===0)return!0;let L=m;for(let M=0;M<w;M+=1)L+=v[M].length+1;return u.delete(L,L+$),p-L<=$&&u.setSelection(_e.create(u.doc,L)),!0}):t.commands.command(({tr:u})=>{const{from:h,to:p}=a,x=r.doc.textBetween(h,p,`
`,`
`).split(`
`).map(v=>{var w;const N=((w=v.match(/^ */))==null?void 0:w[0])||"",S=Math.min(N.length,n);return v.slice(S)}).join(`
`);return u.replaceWith(h,p,r.schema.text(x)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:a}=n;if(!a||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,c=r.parent.textContent.endsWith(`

`);return!i||!c?!1:t.chain().command(({tr:u})=>(u.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:a,empty:i}=n;if(!i||a.parent.type!==this.type||!(a.parentOffset===a.parent.nodeSize-2))return!1;const u=a.after();return u===void 0?!1:r.nodeAt(u)?t.commands.command(({tr:p})=>(p.setSelection(Be.near(r.resolve(u))),!0)):t.commands.exitCode()}}},addInputRules(){return[Dg({find:o6,type:this.type,getAttributes:t=>({language:t[1]})}),Dg({find:l6,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new pt({key:new Pt("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),a=r?JSON.parse(r):void 0,i=a?.mode;if(!n||!i)return!1;const{tr:c,schema:u}=t.state,h=u.text(n.replace(/\r\n?/g,`
`));return c.replaceSelectionWith(this.type.create({language:i},h)),c.selection.$from.parent.type!==this.type&&c.setSelection(_e.near(c.doc.resolve(Math.max(0,c.selection.from-2)))),c.setMeta("paste",!0),t.dispatch(c),!0}}})]}}),d6=zn.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),u6=zn.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",Dt(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:a,storedMarks:i}=n;if(a.$from.parent.type.spec.isolating)return!1;const{keepMarks:c}=this.options,{splittableMarks:u}=r.extensionManager,h=i||a.$to.parentOffset&&a.$from.marks();return e().insertContent({type:this.name}).command(({tr:p,dispatch:m})=>{if(m&&h&&c){const g=h.filter(x=>u.includes(x.type.name));p.ensureMarks(g)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),h6=zn.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,Dt(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var n;const r=(n=t.attrs)!=null&&n.level?parseInt(t.attrs.level,10):1,a="#".repeat(r);return t.content?`${a} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Dg({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),f6=zn.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",Dt(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!U$(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$to:r}=n,a=t();return Zj(n)?a.insertContentAt(r.pos,{type:this.name}):a.insertContent({type:this.name}),a.command(({state:i,tr:c,dispatch:u})=>{if(u){const{$to:h}=c.selection,p=h.end();if(h.nodeAfter)h.nodeAfter.isTextblock?c.setSelection(_e.create(c.doc,h.pos+1)):h.nodeAfter.isBlock?c.setSelection(Te.create(c.doc,h.pos)):c.setSelection(_e.create(c.doc,h.pos));else{const m=i.schema.nodes[this.options.nextNodeType]||h.parent.type.contentMatch.defaultType,g=m?.create();g&&(c.insert(p,g),c.setSelection(_e.create(c.doc,p+1)))}c.scrollIntoView()}return!0}).run()}}},addInputRules(){return[z$({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),p6=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,m6=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,g6=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,y6=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,x6=Za.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",Dt(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[yo({find:p6,type:this.type}),yo({find:g6,type:this.type})]},addPasteRules(){return[Ka({find:m6,type:this.type}),Ka({find:y6,type:this.type})]}});const b6="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",v6="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Bg="numeric",Ig="ascii",Pg="alpha",Hl="asciinumeric",Dl="alphanumeric",zg="domain",w2="emoji",w6="scheme",S6="slashscheme",Fm="whitespace";function N6(t,e){return t in e||(e[t]=[]),e[t]}function $a(t,e,n){e[Bg]&&(e[Hl]=!0,e[Dl]=!0),e[Ig]&&(e[Hl]=!0,e[Pg]=!0),e[Hl]&&(e[Dl]=!0),e[Pg]&&(e[Dl]=!0),e[Dl]&&(e[zg]=!0),e[w2]&&(e[zg]=!0);for(const r in e){const a=N6(r,n);a.indexOf(t)<0&&a.push(t)}}function k6(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function Sn(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Sn.groups={};Sn.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const a=e.jr[r][0],i=e.jr[r][1];if(i&&a.test(t))return i}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let a=0;a<t.length;a++)this.tt(t[a],e,n,r)},tr(t,e,n,r){r=r||Sn.groups;let a;return e&&e.j?a=e:(a=new Sn(e),n&&r&&$a(e,n,r)),this.jr.push([t,a]),a},ts(t,e,n,r){let a=this;const i=t.length;if(!i)return a;for(let c=0;c<i-1;c++)a=a.tt(t[c]);return a.tt(t[i-1],e,n,r)},tt(t,e,n,r){r=r||Sn.groups;const a=this;if(e&&e.j)return a.j[t]=e,e;const i=e;let c,u=a.go(t);if(u?(c=new Sn,Object.assign(c.j,u.j),c.jr.push.apply(c.jr,u.jr),c.jd=u.jd,c.t=u.t):c=new Sn,i){if(r)if(c.t&&typeof c.t=="string"){const h=Object.assign(k6(c.t,r),n);$a(i,h,r)}else n&&$a(i,n,r);c.t=i}return a.j[t]=c,c}};const $e=(t,e,n,r,a)=>t.ta(e,n,r,a),bt=(t,e,n,r,a)=>t.tr(e,n,r,a),mS=(t,e,n,r,a)=>t.ts(e,n,r,a),ce=(t,e,n,r,a)=>t.tt(e,n,r,a),Qr="WORD",Ug="UWORD",S2="ASCIINUMERICAL",N2="ALPHANUMERICAL",mc="LOCALHOST",Hg="TLD",Vg="UTLD",gu="SCHEME",so="SLASH_SCHEME",Dy="NUM",Fg="WS",Ly="NL",Vl="OPENBRACE",Fl="CLOSEBRACE",zu="OPENBRACKET",Uu="CLOSEBRACKET",Hu="OPENPAREN",Vu="CLOSEPAREN",Fu="OPENANGLEBRACKET",Gu="CLOSEANGLEBRACKET",qu="FULLWIDTHLEFTPAREN",Wu="FULLWIDTHRIGHTPAREN",Ku="LEFTCORNERBRACKET",Yu="RIGHTCORNERBRACKET",Ju="LEFTWHITECORNERBRACKET",Qu="RIGHTWHITECORNERBRACKET",Xu="FULLWIDTHLESSTHAN",Zu="FULLWIDTHGREATERTHAN",eh="AMPERSAND",th="APOSTROPHE",nh="ASTERISK",Is="AT",rh="BACKSLASH",sh="BACKTICK",ah="CARET",Vs="COLON",$y="COMMA",ih="DOLLAR",Nr="DOT",oh="EQUALS",By="EXCLAMATION",Zn="HYPHEN",Gl="PERCENT",lh="PIPE",ch="PLUS",dh="POUND",ql="QUERY",Iy="QUOTE",k2="FULLWIDTHMIDDLEDOT",Py="SEMI",kr="SLASH",Wl="TILDE",uh="UNDERSCORE",j2="EMOJI",hh="SYM";var C2=Object.freeze({__proto__:null,ALPHANUMERICAL:N2,AMPERSAND:eh,APOSTROPHE:th,ASCIINUMERICAL:S2,ASTERISK:nh,AT:Is,BACKSLASH:rh,BACKTICK:sh,CARET:ah,CLOSEANGLEBRACKET:Gu,CLOSEBRACE:Fl,CLOSEBRACKET:Uu,CLOSEPAREN:Vu,COLON:Vs,COMMA:$y,DOLLAR:ih,DOT:Nr,EMOJI:j2,EQUALS:oh,EXCLAMATION:By,FULLWIDTHGREATERTHAN:Zu,FULLWIDTHLEFTPAREN:qu,FULLWIDTHLESSTHAN:Xu,FULLWIDTHMIDDLEDOT:k2,FULLWIDTHRIGHTPAREN:Wu,HYPHEN:Zn,LEFTCORNERBRACKET:Ku,LEFTWHITECORNERBRACKET:Ju,LOCALHOST:mc,NL:Ly,NUM:Dy,OPENANGLEBRACKET:Fu,OPENBRACE:Vl,OPENBRACKET:zu,OPENPAREN:Hu,PERCENT:Gl,PIPE:lh,PLUS:ch,POUND:dh,QUERY:ql,QUOTE:Iy,RIGHTCORNERBRACKET:Yu,RIGHTWHITECORNERBRACKET:Qu,SCHEME:gu,SEMI:Py,SLASH:kr,SLASH_SCHEME:so,SYM:hh,TILDE:Wl,TLD:Hg,UNDERSCORE:uh,UTLD:Vg,UWORD:Ug,WORD:Qr,WS:Fg});const Yr=/[a-z]/,Nl=new RegExp("\\p{L}","u"),Gm=new RegExp("\\p{Emoji}","u"),Jr=/\d/,qm=/\s/,gS="\r",Wm=`
`,j6="",C6="",Km="";let ou=null,lu=null;function T6(t=[]){const e={};Sn.groups=e;const n=new Sn;ou==null&&(ou=yS(b6)),lu==null&&(lu=yS(v6)),ce(n,"'",th),ce(n,"{",Vl),ce(n,"}",Fl),ce(n,"[",zu),ce(n,"]",Uu),ce(n,"(",Hu),ce(n,")",Vu),ce(n,"<",Fu),ce(n,">",Gu),ce(n,"",qu),ce(n,"",Wu),ce(n,"",Ku),ce(n,"",Yu),ce(n,"",Ju),ce(n,"",Qu),ce(n,"",Xu),ce(n,"",Zu),ce(n,"&",eh),ce(n,"*",nh),ce(n,"@",Is),ce(n,"`",sh),ce(n,"^",ah),ce(n,":",Vs),ce(n,",",$y),ce(n,"$",ih),ce(n,".",Nr),ce(n,"=",oh),ce(n,"!",By),ce(n,"-",Zn),ce(n,"%",Gl),ce(n,"|",lh),ce(n,"+",ch),ce(n,"#",dh),ce(n,"?",ql),ce(n,'"',Iy),ce(n,"/",kr),ce(n,";",Py),ce(n,"~",Wl),ce(n,"_",uh),ce(n,"\\",rh),ce(n,"",k2);const r=bt(n,Jr,Dy,{[Bg]:!0});bt(r,Jr,r);const a=bt(r,Yr,S2,{[Hl]:!0}),i=bt(r,Nl,N2,{[Dl]:!0}),c=bt(n,Yr,Qr,{[Ig]:!0});bt(c,Jr,a),bt(c,Yr,c),bt(a,Jr,a),bt(a,Yr,a);const u=bt(n,Nl,Ug,{[Pg]:!0});bt(u,Yr),bt(u,Jr,i),bt(u,Nl,u),bt(i,Jr,i),bt(i,Yr),bt(i,Nl,i);const h=ce(n,Wm,Ly,{[Fm]:!0}),p=ce(n,gS,Fg,{[Fm]:!0}),m=bt(n,qm,Fg,{[Fm]:!0});ce(n,Km,m),ce(p,Wm,h),ce(p,Km,m),bt(p,qm,m),ce(m,gS),ce(m,Wm),bt(m,qm,m),ce(m,Km,m);const g=bt(n,Gm,j2,{[w2]:!0});ce(g,"#"),bt(g,Gm,g),ce(g,j6,g);const x=ce(g,C6);ce(x,"#"),bt(x,Gm,g);const v=[[Yr,c],[Jr,a]],w=[[Yr,null],[Nl,u],[Jr,i]];for(let N=0;N<ou.length;N++)Ds(n,ou[N],Hg,Qr,v);for(let N=0;N<lu.length;N++)Ds(n,lu[N],Vg,Ug,w);$a(Hg,{tld:!0,ascii:!0},e),$a(Vg,{utld:!0,alpha:!0},e),Ds(n,"file",gu,Qr,v),Ds(n,"mailto",gu,Qr,v),Ds(n,"http",so,Qr,v),Ds(n,"https",so,Qr,v),Ds(n,"ftp",so,Qr,v),Ds(n,"ftps",so,Qr,v),$a(gu,{scheme:!0,ascii:!0},e),$a(so,{slashscheme:!0,ascii:!0},e),t=t.sort((N,S)=>N[0]>S[0]?1:-1);for(let N=0;N<t.length;N++){const S=t[N][0],A=t[N][1]?{[w6]:!0}:{[S6]:!0};S.indexOf("-")>=0?A[zg]=!0:Yr.test(S)?Jr.test(S)?A[Hl]=!0:A[Ig]=!0:A[Bg]=!0,mS(n,S,S,A)}return mS(n,"localhost",mc,{ascii:!0}),n.jd=new Sn(hh),{start:n,tokens:Object.assign({groups:e},C2)}}function T2(t,e){const n=E6(e.replace(/[A-Z]/g,u=>u.toLowerCase())),r=n.length,a=[];let i=0,c=0;for(;c<r;){let u=t,h=null,p=0,m=null,g=-1,x=-1;for(;c<r&&(h=u.go(n[c]));)u=h,u.accepts()?(g=0,x=0,m=u):g>=0&&(g+=n[c].length,x++),p+=n[c].length,i+=n[c].length,c++;i-=g,c-=x,p-=g,a.push({t:m.t,v:e.slice(i-p,i),s:i-p,e:i})}return a}function E6(t){const e=[],n=t.length;let r=0;for(;r<n;){let a=t.charCodeAt(r),i,c=a<55296||a>56319||r+1===n||(i=t.charCodeAt(r+1))<56320||i>57343?t[r]:t.slice(r,r+2);e.push(c),r+=c.length}return e}function Ds(t,e,n,r,a){let i;const c=e.length;for(let u=0;u<c-1;u++){const h=e[u];t.j[h]?i=t.j[h]:(i=new Sn(r),i.jr=a.slice(),t.j[h]=i),t=i}return i=new Sn(n),i.jr=a.slice(),t.j[e[c-1]]=i,i}function yS(t){const e=[],n=[];let r=0,a="0123456789";for(;r<t.length;){let i=0;for(;a.indexOf(t[r+i])>=0;)i++;if(i>0){e.push(n.join(""));for(let c=parseInt(t.substring(r,r+i),10);c>0;c--)n.pop();r+=i}else n.push(t[r]),r++}return e}const gc={defaultProtocol:"http",events:null,format:xS,formatHref:xS,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function zy(t,e=null){let n=Object.assign({},gc);t&&(n=Object.assign(n,t instanceof zy?t.o:t));const r=n.ignoreTags,a=[];for(let i=0;i<r.length;i++)a.push(r[i].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=a}zy.prototype={o:gc,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let a=this.o[t];return a&&(typeof a=="object"?(a=n.t in a?a[n.t]:gc[t],typeof a=="function"&&r&&(a=a(e,n))):typeof a=="function"&&r&&(a=a(e,n.t,n)),a)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function xS(t){return t}function E2(t,e){this.t="token",this.v=t,this.tk=e}E2.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=gc.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),a=t.get("tagName",n,e),i=this.toFormattedString(t),c={},u=t.get("className",n,e),h=t.get("target",n,e),p=t.get("rel",n,e),m=t.getObj("attributes",n,e),g=t.getObj("events",n,e);return c.href=r,u&&(c.class=u),h&&(c.target=h),p&&(c.rel=p),m&&Object.assign(c,m),{tagName:a,attributes:c,content:i,eventListeners:g}}};function Oh(t,e){class n extends E2{constructor(a,i){super(a,i),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const bS=Oh("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),vS=Oh("text"),R6=Oh("nl"),cu=Oh("url",{isLink:!0,toHref(t=gc.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==mc&&t[1].t===Vs}}),Xn=t=>new Sn(t);function A6({groups:t}){const e=t.domain.concat([eh,nh,Is,rh,sh,ah,ih,oh,Zn,Dy,Gl,lh,ch,dh,kr,hh,Wl,uh]),n=[th,Vs,$y,Nr,By,Gl,ql,Iy,Py,Fu,Gu,Vl,Fl,Uu,zu,Hu,Vu,qu,Wu,Ku,Yu,Ju,Qu,Xu,Zu],r=[eh,th,nh,rh,sh,ah,ih,oh,Zn,Vl,Fl,Gl,lh,ch,dh,ql,kr,hh,Wl,uh],a=Xn(),i=ce(a,Wl);$e(i,r,i),$e(i,t.domain,i);const c=Xn(),u=Xn(),h=Xn();$e(a,t.domain,c),$e(a,t.scheme,u),$e(a,t.slashscheme,h),$e(c,r,i),$e(c,t.domain,c);const p=ce(c,Is);ce(i,Is,p),ce(u,Is,p),ce(h,Is,p);const m=ce(i,Nr);$e(m,r,i),$e(m,t.domain,i);const g=Xn();$e(p,t.domain,g),$e(g,t.domain,g);const x=ce(g,Nr);$e(x,t.domain,g);const v=Xn(bS);$e(x,t.tld,v),$e(x,t.utld,v),ce(p,mc,v);const w=ce(g,Zn);ce(w,Zn,w),$e(w,t.domain,g),$e(v,t.domain,g),ce(v,Nr,x),ce(v,Zn,w);const N=ce(v,Vs);$e(N,t.numeric,bS);const S=ce(c,Zn),j=ce(c,Nr);ce(S,Zn,S),$e(S,t.domain,c),$e(j,r,i),$e(j,t.domain,c);const A=Xn(cu);$e(j,t.tld,A),$e(j,t.utld,A),$e(A,t.domain,c),$e(A,r,i),ce(A,Nr,j),ce(A,Zn,S),ce(A,Is,p);const $=ce(A,Vs),L=Xn(cu);$e($,t.numeric,L);const R=Xn(cu),M=Xn();$e(R,e,R),$e(R,n,M),$e(M,e,R),$e(M,n,M),ce(A,kr,R),ce(L,kr,R);const D=ce(u,Vs),I=ce(h,Vs),W=ce(I,kr),ue=ce(W,kr);$e(u,t.domain,c),ce(u,Nr,j),ce(u,Zn,S),$e(h,t.domain,c),ce(h,Nr,j),ce(h,Zn,S),$e(D,t.domain,R),ce(D,kr,R),ce(D,ql,R),$e(ue,t.domain,R),$e(ue,e,R),ce(ue,kr,R);const he=[[Vl,Fl],[zu,Uu],[Hu,Vu],[Fu,Gu],[qu,Wu],[Ku,Yu],[Ju,Qu],[Xu,Zu]];for(let J=0;J<he.length;J++){const[_,V]=he[J],F=ce(R,_);ce(M,_,F),ce(F,V,R);const O=Xn(cu);$e(F,e,O);const K=Xn();$e(F,n),$e(O,e,O),$e(O,n,K),$e(K,e,O),$e(K,n,K),ce(O,V,R),ce(K,V,R)}return ce(a,mc,A),ce(a,Ly,R6),{start:a,tokens:C2}}function _6(t,e,n){let r=n.length,a=0,i=[],c=[];for(;a<r;){let u=t,h=null,p=null,m=0,g=null,x=-1;for(;a<r&&!(h=u.go(n[a].t));)c.push(n[a++]);for(;a<r&&(p=h||u.go(n[a].t));)h=null,u=p,u.accepts()?(x=0,g=u):x>=0&&x++,a++,m++;if(x<0)a-=m,a<r&&(c.push(n[a]),a++);else{c.length>0&&(i.push(Ym(vS,e,c)),c=[]),a-=x,m-=x;const v=g.t,w=n.slice(a-m,a);i.push(Ym(v,e,w))}}return c.length>0&&i.push(Ym(vS,e,c)),i}function Ym(t,e,n){const r=n[0].s,a=n[n.length-1].e,i=e.slice(r,a);return new t(i,n)}const M6=typeof console<"u"&&console&&console.warn||(()=>{}),O6="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",lt={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function D6(){return Sn.groups={},lt.scanner=null,lt.parser=null,lt.tokenQueue=[],lt.pluginQueue=[],lt.customSchemes=[],lt.initialized=!1,lt}function wS(t,e=!1){if(lt.initialized&&M6(`linkifyjs: already initialized - will not register custom scheme "${t}" ${O6}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);lt.customSchemes.push([t,e])}function L6(){lt.scanner=T6(lt.customSchemes);for(let t=0;t<lt.tokenQueue.length;t++)lt.tokenQueue[t][1]({scanner:lt.scanner});lt.parser=A6(lt.scanner.tokens);for(let t=0;t<lt.pluginQueue.length;t++)lt.pluginQueue[t][1]({scanner:lt.scanner,parser:lt.parser});return lt.initialized=!0,lt}function Uy(t){return lt.initialized||L6(),_6(lt.parser.start,t,T2(lt.scanner.start,t))}Uy.scan=T2;function R2(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new zy(n),a=Uy(t),i=[];for(let c=0;c<a.length;c++){const u=a[c];u.isLink&&(!e||u.t===e)&&r.check(u)&&i.push(u.toFormattedObject(r))}return i}var Hy="[\0- -\u2029]",$6=new RegExp(Hy),B6=new RegExp(`${Hy}$`),I6=new RegExp(Hy,"g");function P6(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function z6(t){return new pt({key:new Pt("autolink"),appendTransaction:(e,n,r)=>{const a=e.some(p=>p.docChanged)&&!n.doc.eq(r.doc),i=e.some(p=>p.getMeta("preventAutolink"));if(!a||i)return;const{tr:c}=r,u=Gj(n.doc,[...e]);if(Xj(u).forEach(({newRange:p})=>{const m=UL(r.doc,p,v=>v.isTextblock);let g,x;if(m.length>1)g=m[0],x=r.doc.textBetween(g.pos,g.pos+g.node.nodeSize,void 0," ");else if(m.length){const v=r.doc.textBetween(p.from,p.to," "," ");if(!B6.test(v))return;g=m[0],x=r.doc.textBetween(g.pos,p.to,void 0," ")}if(g&&x){const v=x.split($6).filter(Boolean);if(v.length<=0)return!1;const w=v[v.length-1],N=g.pos+x.lastIndexOf(w);if(!w)return!1;const S=Uy(w).map(j=>j.toObject(t.defaultProtocol));if(!P6(S))return!1;S.filter(j=>j.isLink).map(j=>({...j,from:N+j.start+1,to:N+j.end+1})).filter(j=>r.schema.marks.code?!r.doc.rangeHasMark(j.from,j.to,r.schema.marks.code):!0).filter(j=>t.validate(j.value)).filter(j=>t.shouldAutoLink(j.value)).forEach(j=>{Ry(j.from,j.to,r.doc).some(A=>A.mark.type===t.type)||c.addMark(j.from,j.to,t.type.create({href:j.href}))})}}),!!c.steps.length)return c}})}function U6(t){return new pt({key:new Pt("handleClickLink"),props:{handleClick:(e,n,r)=>{var a,i;if(r.button!==0||!e.editable)return!1;let c=!1;if(t.enableClickSelection&&(c=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){let u=null;if(r.target instanceof HTMLAnchorElement)u=r.target;else{let g=r.target;const x=[];for(;g.nodeName!=="DIV";)x.push(g),g=g.parentNode;u=x.find(v=>v.nodeName==="A")}if(!u)return c;const h=Qj(e.state,t.type.name),p=(a=u?.href)!=null?a:h.href,m=(i=u?.target)!=null?i:h.target;u&&p&&(window.open(p,m),c=!0)}return c}}})}function H6(t){return new pt({key:new Pt("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{shouldAutoLink:a}=t,{state:i}=e,{selection:c}=i,{empty:u}=c;if(u)return!1;let h="";r.content.forEach(m=>{h+=m.textContent});const p=R2(h,{defaultProtocol:t.defaultProtocol}).find(m=>m.isLink&&m.value===h);return!h||!p||a!==void 0&&!a(p.href)?!1:t.editor.commands.setMark(t.type,{href:p.href})}}})}function Ta(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const a=typeof r=="string"?r:r.scheme;a&&n.push(a)}),!t||t.replace(I6,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var V6=Za.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){wS(t);return}wS(t.scheme,t.optionalSlashes)})},onDestroy(){D6()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!Ta(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>!!t}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!Ta(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!Ta(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",Dt(this.options.HTMLAttributes,t),0]:["a",Dt(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var n;const r=((n=t.attrs)==null?void 0:n.href)||"";return`[${e.renderChildren(t)}](${r})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!Ta(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t||{};return n&&!this.options.isAllowedUri(n,{defaultValidate:r=>!!Ta(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Ka({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,a=R2(t).filter(i=>i.isLink&&this.options.isAllowedUri(i.value,{defaultValidate:c=>!!Ta(c,n),protocols:n,defaultProtocol:r}));a.length&&a.forEach(i=>{this.options.shouldAutoLink(i.value)&&e.push({text:i.value,data:{href:i.href},index:i.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(z6({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:a=>!!Ta(a,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),t.push(U6({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(H6({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),F6=Object.defineProperty,G6=(t,e)=>{for(var n in e)F6(t,n,{get:e[n],enumerable:!0})},q6="listItem",SS="textStyle",NS=/^\s*([-+*])\s$/,A2=zn.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",Dt(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(q6,this.editor.getAttributes(SS)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=xo({find:NS,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=xo({find:NS,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(SS),editor:this.editor})),[t]}}),_2=zn.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",Dt(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let n=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(a=>a.type==="paragraph"))n=e.parseChildren(t.tokens);else{const a=t.tokens[0];if(a&&a.type==="text"&&a.tokens&&a.tokens.length>0){if(n=[{type:"paragraph",content:e.parseInline(a.tokens)}],t.tokens.length>1){const c=t.tokens.slice(1),u=e.parseChildren(c);n.push(...u)}}else n=e.parseChildren(t.tokens)}return n.length===0&&(n=[{type:"paragraph",content:[]}]),{type:"listItem",content:n}},renderMarkdown:(t,e,n)=>Oy(t,e,r=>r.parentType==="bulletList"?"- ":r.parentType==="orderedList"?`${r.index+1}. `:"- ",n),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),W6={};G6(W6,{findListItemPos:()=>kc,getNextListDepth:()=>Vy,handleBackspace:()=>Gg,handleDelete:()=>qg,hasListBefore:()=>M2,hasListItemAfter:()=>K6,hasListItemBefore:()=>O2,listItemHasSubList:()=>D2,nextListIsDeeper:()=>L2,nextListIsHigher:()=>$2});var kc=(t,e)=>{const{$from:n}=e.selection,r=Ot(t,e.schema);let a=null,i=n.depth,c=n.pos,u=null;for(;i>0&&u===null;)a=n.node(i),a.type===r?u=i:(i-=1,c-=1);return u===null?null:{$pos:e.doc.resolve(c),depth:u}},Vy=(t,e)=>{const n=kc(t,e);if(!n)return!1;const[,r]=QL(e,t,n.$pos.pos+4);return r},M2=(t,e,n)=>{const{$anchor:r}=t.selection,a=Math.max(0,r.pos-2),i=t.doc.resolve(a).node();return!(!i||!n.includes(i.type.name))},O2=(t,e)=>{var n;const{$anchor:r}=e.selection,a=e.doc.resolve(r.pos-2);return!(a.index()===0||((n=a.nodeBefore)==null?void 0:n.type.name)!==t)},D2=(t,e,n)=>{if(!n)return!1;const r=Ot(t,e.schema);let a=!1;return n.descendants(i=>{i.type===r&&(a=!0)}),a},Gg=(t,e,n)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!ea(t.state,e)&&M2(t.state,e,n)){const{$anchor:u}=t.state.selection,h=t.state.doc.resolve(u.before()-1),p=[];h.node().descendants((x,v)=>{x.type.name===e&&p.push({node:x,pos:v})});const m=p.at(-1);if(!m)return!1;const g=t.state.doc.resolve(h.start()+m.pos+1);return t.chain().cut({from:u.start()-1,to:u.end()+1},g.end()).joinForward().run()}if(!ea(t.state,e)||!t$(t.state))return!1;const r=kc(e,t.state);if(!r)return!1;const i=t.state.doc.resolve(r.$pos.pos-2).node(r.depth),c=D2(e,t.state,i);return O2(e,t.state)&&!c?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},L2=(t,e)=>{const n=Vy(t,e),r=kc(t,e);return!r||!n?!1:n>r.depth},$2=(t,e)=>{const n=Vy(t,e),r=kc(t,e);return!r||!n?!1:n<r.depth},qg=(t,e)=>{if(!ea(t.state,e)||!e$(t.state,e))return!1;const{selection:n}=t.state,{$from:r,$to:a}=n;return!n.empty&&r.sameParent(a)?!1:L2(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():$2(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},K6=(t,e)=>{var n;const{$anchor:r}=e.selection,a=e.doc.resolve(r.pos-r.parentOffset-2);return!(a.index()===a.parent.childCount-1||((n=a.nodeAfter)==null?void 0:n.type.name)!==t)},B2=Ct.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&qg(t,n)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&qg(t,n)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&Gg(t,n,r)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&Gg(t,n,r)&&(e=!0)}),e}}}}),kS=/^(\s*)(\d+)\.\s+(.*)$/,Y6=/^\s/;function J6(t){const e=[];let n=0,r=0;for(;n<t.length;){const a=t[n],i=a.match(kS);if(!i)break;const[,c,u,h]=i,p=c.length;let m=h,g=n+1;const x=[a];for(;g<t.length;){const v=t[g];if(v.match(kS))break;if(v.trim()==="")x.push(v),m+=`
`,g+=1;else if(v.match(Y6))x.push(v),m+=`
${v.slice(p+2)}`,g+=1;else break}e.push({indent:p,number:parseInt(u,10),content:m.trim(),raw:x.join(`
`)}),r=g,n=g}return[e,r]}function I2(t,e,n){var r;const a=[];let i=0;for(;i<t.length;){const c=t[i];if(c.indent===e){const u=c.content.split(`
`),h=((r=u[0])==null?void 0:r.trim())||"",p=[];h&&p.push({type:"paragraph",raw:h,tokens:n.inlineTokens(h)});const m=u.slice(1).join(`
`).trim();if(m){const v=n.blockTokens(m);p.push(...v)}let g=i+1;const x=[];for(;g<t.length&&t[g].indent>e;)x.push(t[g]),g+=1;if(x.length>0){const v=Math.min(...x.map(N=>N.indent)),w=I2(x,v,n);p.push({type:"list",ordered:!0,start:x[0].number,items:w,raw:x.map(N=>N.raw).join(`
`)})}a.push({type:"list_item",raw:c.raw,tokens:p}),i=g}else i+=1}return a}function Q6(t,e){return t.map(n=>{if(n.type!=="list_item")return e.parseChildren([n])[0];const r=[];return n.tokens&&n.tokens.length>0&&n.tokens.forEach(a=>{if(a.type==="paragraph"||a.type==="list"||a.type==="blockquote"||a.type==="code")r.push(...e.parseChildren([a]));else if(a.type==="text"&&a.tokens){const i=e.parseChildren([a]);r.push({type:"paragraph",content:i})}else{const i=e.parseChildren([a]);i.length>0&&r.push(...i)}}),{type:"listItem",content:r}})}var X6="listItem",jS="textStyle",CS=/^(\d+)\.\s$/,P2=zn.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",Dt(this.options.HTMLAttributes,n),0]:["ol",Dt(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const n=t.start||1,r=t.items?Q6(t.items,e):[];return n!==1?{type:"orderedList",attrs:{start:n},content:r}:{type:"orderedList",content:r}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),n=e?.index;return n!==void 0?n:-1},tokenize:(t,e,n)=>{var r;const a=t.split(`
`),[i,c]=J6(a);if(i.length===0)return;const u=I2(i,0,n);return u.length===0?void 0:{type:"list",ordered:!0,start:((r=i[0])==null?void 0:r.number)||1,items:u,raw:a.slice(0,c).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(X6,this.editor.getAttributes(jS)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=xo({find:CS,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=xo({find:CS,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(jS)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),Z6=/^\s*(\[([( |x])?\])\s$/,eI=zn.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",Dt(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const n=[];if(t.tokens&&t.tokens.length>0?n.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?n.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):n.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const r=e.parseChildren(t.nestedTokens);n.push(...r)}return e.createNode("taskItem",{checked:t.checked||!1},n)},renderMarkdown:(t,e)=>{var n;const a=`- [${(n=t.attrs)!=null&&n.checked?"x":" "}] `;return Oy(t,e,a)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const a=document.createElement("li"),i=document.createElement("label"),c=document.createElement("span"),u=document.createElement("input"),h=document.createElement("div"),p=m=>{var g,x;u.ariaLabel=((x=(g=this.options.a11y)==null?void 0:g.checkboxLabel)==null?void 0:x.call(g,m,u.checked))||`Task item checkbox for ${m.textContent||"empty task item"}`};return p(t),i.contentEditable="false",u.type="checkbox",u.addEventListener("mousedown",m=>m.preventDefault()),u.addEventListener("change",m=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){u.checked=!u.checked;return}const{checked:g}=m.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:x})=>{const v=n();if(typeof v!="number")return!1;const w=x.doc.nodeAt(v);return x.setNodeMarkup(v,void 0,{...w?.attrs,checked:g}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,g)||(u.checked=!u.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([m,g])=>{a.setAttribute(m,g)}),a.dataset.checked=t.attrs.checked,u.checked=t.attrs.checked,i.append(u,c),a.append(i,h),Object.entries(e).forEach(([m,g])=>{a.setAttribute(m,g)}),{dom:a,contentDOM:h,update:m=>m.type!==this.type?!1:(a.dataset.checked=m.attrs.checked,u.checked=m.attrs.checked,p(m),!0)}}},addInputRules(){return[xo({find:Z6,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),tI=zn.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",Dt(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const n=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return n!==void 0?n:-1},tokenize(t,e,n){const r=i=>{const c=Lg(i,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:u=>({indentLevel:u[1].length,mainContent:u[4],checked:u[3].toLowerCase()==="x"}),createToken:(u,h)=>({type:"taskItem",raw:"",mainContent:u.mainContent,indentLevel:u.indentLevel,checked:u.checked,text:u.mainContent,tokens:n.inlineTokens(u.mainContent),nestedTokens:h}),customNestedParser:r},n);return c?[{type:"taskList",raw:c.raw,items:c.items}]:n.blockTokens(i)},a=Lg(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:i=>({indentLevel:i[1].length,mainContent:i[4],checked:i[3].toLowerCase()==="x"}),createToken:(i,c)=>({type:"taskItem",raw:"",mainContent:i.mainContent,indentLevel:i.indentLevel,checked:i.checked,text:i.mainContent,tokens:n.inlineTokens(i.mainContent),nestedTokens:c}),customNestedParser:r},n);if(a)return{type:"taskList",raw:a.raw,items:a.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Ct.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(A2.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(_2.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(B2.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(P2.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(eI.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(tI.configure(this.options.taskList)),t}});var nI=zn.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",Dt(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const n=t.tokens||[];return n.length===1&&n[0].type==="image"?e.parseChildren([n[0]]):e.createNode("paragraph",void 0,e.parseInline(n))},renderMarkdown:(t,e)=>!t||!Array.isArray(t.content)?"":e.renderChildren(t.content),addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),rI=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,sI=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,aI=Za.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",Dt(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[yo({find:rI,type:this.type})]},addPasteRules(){return[Ka({find:sI,type:this.type})]}}),iI=zn.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),z2=Za.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",Dt(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,n){const a=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!a)return;const i=a[2].trim();return{type:"underline",raw:a[0],text:i,tokens:n.inlineTokens(i)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),U2=z2;function oI(t={}){return new pt({view(e){return new lI(e,t)}})}class lI{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(a=>{let i=c=>{this[a](c)};return e.dom.addEventListener(a,i),{name:a,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,a=this.editorView.dom,i=a.getBoundingClientRect(),c=i.width/a.offsetWidth,u=i.height/a.offsetHeight;if(n){let g=e.nodeBefore,x=e.nodeAfter;if(g||x){let v=this.editorView.nodeDOM(this.cursorPos-(g?g.nodeSize:0));if(v){let w=v.getBoundingClientRect(),N=g?w.bottom:w.top;g&&x&&(N=(N+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let S=this.width/2*u;r={left:w.left,right:w.right,top:N-S,bottom:N+S}}}}if(!r){let g=this.editorView.coordsAtPos(this.cursorPos),x=this.width/2*c;r={left:g.left-x,right:g.left+x,top:g.top,bottom:g.bottom}}let h=this.editorView.dom.offsetParent;this.element||(this.element=h.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let p,m;if(!h||h==document.body&&getComputedStyle(h).position=="static")p=-pageXOffset,m=-pageYOffset;else{let g=h.getBoundingClientRect(),x=g.width/h.offsetWidth,v=g.height/h.offsetHeight;p=g.left-h.scrollLeft*x,m=g.top-h.scrollTop*v}this.element.style.left=(r.left-p)/c+"px",this.element.style.top=(r.top-m)/u+"px",this.element.style.width=(r.right-r.left)/c+"px",this.element.style.height=(r.bottom-r.top)/u+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),a=r&&r.type.spec.disableDropCursor,i=typeof a=="function"?a(this.editorView,n,e):a;if(n&&!i){let c=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let u=$k(this.editorView.state.doc,c,this.editorView.dragging.slice);u!=null&&(c=u)}this.setCursor(c),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class St extends Be{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return St.valid(r)?new St(r):Be.near(r)}content(){return pe.empty}eq(e){return e instanceof St&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new St(e.resolve(n.pos))}getBookmark(){return new Fy(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!cI(e)||!dI(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let a=n.contentMatchAt(e.index()).defaultType;return a&&a.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&St.valid(e))return e;let a=e.pos,i=null;for(let c=e.depth;;c--){let u=e.node(c);if(n>0?e.indexAfter(c)<u.childCount:e.index(c)>0){i=u.child(n>0?e.indexAfter(c):e.index(c)-1);break}else if(c==0)return null;a+=n;let h=e.doc.resolve(a);if(St.valid(h))return h}for(;;){let c=n>0?i.firstChild:i.lastChild;if(!c){if(i.isAtom&&!i.isText&&!Te.isSelectable(i)){e=e.doc.resolve(a+i.nodeSize*n),r=!1;continue e}break}i=c,a+=n;let u=e.doc.resolve(a);if(St.valid(u))return u}return null}}}St.prototype.visible=!1;St.findFrom=St.findGapCursorFrom;Be.jsonID("gapcursor",St);class Fy{constructor(e){this.pos=e}map(e){return new Fy(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return St.valid(n)?new St(n):Be.near(n)}}function H2(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function cI(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let a=r.child(n-1);;a=a.lastChild){if(a.childCount==0&&!a.inlineContent||H2(a.type))return!0;if(a.inlineContent)return!1}}return!0}function dI(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let a=r.child(n);;a=a.firstChild){if(a.childCount==0&&!a.inlineContent||H2(a.type))return!0;if(a.inlineContent)return!1}}return!0}function uI(){return new pt({props:{decorations:mI,createSelectionBetween(t,e,n){return e.pos==n.pos&&St.valid(n)?new St(n):null},handleClick:fI,handleKeyDown:hI,handleDOMEvents:{beforeinput:pI}}})}const hI=Bj({ArrowLeft:du("horiz",-1),ArrowRight:du("horiz",1),ArrowUp:du("vert",-1),ArrowDown:du("vert",1)});function du(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,a,i){let c=r.selection,u=e>0?c.$to:c.$from,h=c.empty;if(c instanceof _e){if(!i.endOfTextblock(n)||u.depth==0)return!1;h=!1,u=r.doc.resolve(e>0?u.after():u.before())}let p=St.findGapCursorFrom(u,e,h);return p?(a&&a(r.tr.setSelection(new St(p))),!0):!1}}function fI(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!St.valid(r))return!1;let a=t.posAtCoords({left:n.clientX,top:n.clientY});return a&&a.inside>-1&&Te.isSelectable(t.state.doc.nodeAt(a.inside))?!1:(t.dispatch(t.state.tr.setSelection(new St(r))),!0)}function pI(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof St))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let a=le.empty;for(let c=r.length-1;c>=0;c--)a=le.from(r[c].createAndFill(null,a));let i=t.state.tr.replace(n.pos,n.pos,new pe(a,0,0));return i.setSelection(_e.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function mI(t){if(!(t.selection instanceof St))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",ft.create(t.doc,[un.widget(t.selection.head,e,{key:"gapcursor"})])}var fh=200,Gt=function(){};Gt.prototype.append=function(e){return e.length?(e=Gt.from(e),!this.length&&e||e.length<fh&&this.leafAppend(e)||this.length<fh&&e.leafPrepend(this)||this.appendInner(e)):this};Gt.prototype.prepend=function(e){return e.length?Gt.from(e).append(this):this};Gt.prototype.appendInner=function(e){return new gI(this,e)};Gt.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?Gt.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};Gt.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Gt.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};Gt.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var a=[];return this.forEach(function(i,c){return a.push(e(i,c))},n,r),a};Gt.from=function(e){return e instanceof Gt?e:e&&e.length?new V2(e):Gt.empty};var V2=(function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(a,i){return a==0&&i==this.length?this:new e(this.values.slice(a,i))},e.prototype.getInner=function(a){return this.values[a]},e.prototype.forEachInner=function(a,i,c,u){for(var h=i;h<c;h++)if(a(this.values[h],u+h)===!1)return!1},e.prototype.forEachInvertedInner=function(a,i,c,u){for(var h=i-1;h>=c;h--)if(a(this.values[h],u+h)===!1)return!1},e.prototype.leafAppend=function(a){if(this.length+a.length<=fh)return new e(this.values.concat(a.flatten()))},e.prototype.leafPrepend=function(a){if(this.length+a.length<=fh)return new e(a.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e})(Gt);Gt.empty=new V2([]);var gI=(function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,a,i,c){var u=this.left.length;if(a<u&&this.left.forEachInner(r,a,Math.min(i,u),c)===!1||i>u&&this.right.forEachInner(r,Math.max(a-u,0),Math.min(this.length,i)-u,c+u)===!1)return!1},e.prototype.forEachInvertedInner=function(r,a,i,c){var u=this.left.length;if(a>u&&this.right.forEachInvertedInner(r,a-u,Math.max(i,u)-u,c+u)===!1||i<u&&this.left.forEachInvertedInner(r,Math.min(a,u),i,c)===!1)return!1},e.prototype.sliceInner=function(r,a){if(r==0&&a==this.length)return this;var i=this.left.length;return a<=i?this.left.slice(r,a):r>=i?this.right.slice(r-i,a-i):this.left.slice(r,i).append(this.right.slice(0,a-i))},e.prototype.leafAppend=function(r){var a=this.right.leafAppend(r);if(a)return new e(this.left,a)},e.prototype.leafPrepend=function(r){var a=this.left.leafPrepend(r);if(a)return new e(a,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e})(Gt);const yI=500;class fr{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let a,i;n&&(a=this.remapping(r,this.items.length),i=a.maps.length);let c=e.tr,u,h,p=[],m=[];return this.items.forEach((g,x)=>{if(!g.step){a||(a=this.remapping(r,x+1),i=a.maps.length),i--,m.push(g);return}if(a){m.push(new jr(g.map));let v=g.step.map(a.slice(i)),w;v&&c.maybeStep(v).doc&&(w=c.mapping.maps[c.mapping.maps.length-1],p.push(new jr(w,void 0,void 0,p.length+m.length))),i--,w&&a.appendMap(w,i)}else c.maybeStep(g.step);if(g.selection)return u=a?g.selection.map(a.slice(i)):g.selection,h=new fr(this.items.slice(0,r).append(m.reverse().concat(p)),this.eventCount-1),!1},this.items.length,0),{remaining:h,transform:c,selection:u}}addTransform(e,n,r,a){let i=[],c=this.eventCount,u=this.items,h=!a&&u.length?u.get(u.length-1):null;for(let m=0;m<e.steps.length;m++){let g=e.steps[m].invert(e.docs[m]),x=new jr(e.mapping.maps[m],g,n),v;(v=h&&h.merge(x))&&(x=v,m?i.pop():u=u.slice(0,u.length-1)),i.push(x),n&&(c++,n=void 0),a||(h=x)}let p=c-r.depth;return p>bI&&(u=xI(u,p),c-=p),new fr(u.append(i),c)}remapping(e,n){let r=new cc;return this.items.forEach((a,i)=>{let c=a.mirrorOffset!=null&&i-a.mirrorOffset>=e?r.maps.length-a.mirrorOffset:void 0;r.appendMap(a.map,c)},e,n),r}addMaps(e){return this.eventCount==0?this:new fr(this.items.append(e.map(n=>new jr(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],a=Math.max(0,this.items.length-n),i=e.mapping,c=e.steps.length,u=this.eventCount;this.items.forEach(x=>{x.selection&&u--},a);let h=n;this.items.forEach(x=>{let v=i.getMirror(--h);if(v==null)return;c=Math.min(c,v);let w=i.maps[v];if(x.step){let N=e.steps[v].invert(e.docs[v]),S=x.selection&&x.selection.map(i.slice(h+1,v));S&&u++,r.push(new jr(w,N,S))}else r.push(new jr(w))},a);let p=[];for(let x=n;x<c;x++)p.push(new jr(i.maps[x]));let m=this.items.slice(0,a).append(p).append(r),g=new fr(m,u);return g.emptyItemCount()>yI&&(g=g.compress(this.items.length-r.length)),g}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,a=[],i=0;return this.items.forEach((c,u)=>{if(u>=e)a.push(c),c.selection&&i++;else if(c.step){let h=c.step.map(n.slice(r)),p=h&&h.getMap();if(r--,p&&n.appendMap(p,r),h){let m=c.selection&&c.selection.map(n.slice(r));m&&i++;let g=new jr(p.invert(),h,m),x,v=a.length-1;(x=a.length&&a[v].merge(g))?a[v]=x:a.push(g)}}else c.map&&r--},this.items.length,0),new fr(Gt.from(a.reverse()),i)}}fr.empty=new fr(Gt.empty,0);function xI(t,e){let n;return t.forEach((r,a)=>{if(r.selection&&e--==0)return n=a,!1}),t.slice(n)}class jr{constructor(e,n,r,a){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=a}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new jr(n.getMap().invert(),n,this.selection)}}}class Ps{constructor(e,n,r,a,i){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=a,this.prevComposition=i}}const bI=20;function vI(t,e,n,r){let a=n.getMeta(Ua),i;if(a)return a.historyState;n.getMeta(NI)&&(t=new Ps(t.done,t.undone,null,0,-1));let c=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(c&&c.getMeta(Ua))return c.getMeta(Ua).redo?new Ps(t.done.addTransform(n,void 0,r,yu(e)),t.undone,TS(n.mapping.maps),t.prevTime,t.prevComposition):new Ps(t.done,t.undone.addTransform(n,void 0,r,yu(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(c&&c.getMeta("addToHistory")===!1)){let u=n.getMeta("composition"),h=t.prevTime==0||!c&&t.prevComposition!=u&&(t.prevTime<(n.time||0)-r.newGroupDelay||!wI(n,t.prevRanges)),p=c?Jm(t.prevRanges,n.mapping):TS(n.mapping.maps);return new Ps(t.done.addTransform(n,h?e.selection.getBookmark():void 0,r,yu(e)),fr.empty,p,n.time,u??t.prevComposition)}else return(i=n.getMeta("rebased"))?new Ps(t.done.rebased(n,i),t.undone.rebased(n,i),Jm(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new Ps(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),Jm(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function wI(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,a)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&a>=e[i]&&(n=!0)}),n}function TS(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,a,i,c)=>e.push(i,c));return e}function Jm(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let a=e.map(t[r],1),i=e.map(t[r+1],-1);a<=i&&n.push(a,i)}return n}function SI(t,e,n){let r=yu(e),a=Ua.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;let c=i.selection.resolve(i.transform.doc),u=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),a,r),h=new Ps(n?u:i.remaining,n?i.remaining:u,null,0,-1);return i.transform.setSelection(c).setMeta(Ua,{redo:n,historyState:h})}let Qm=!1,ES=null;function yu(t){let e=t.plugins;if(ES!=e){Qm=!1,ES=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){Qm=!0;break}}return Qm}const Ua=new Pt("history"),NI=new Pt("closeHistory");function kI(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new pt({key:Ua,state:{init(){return new Ps(fr.empty,fr.empty,null,0,-1)},apply(e,n,r){return vI(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,a=r=="historyUndo"?G2:r=="historyRedo"?q2:null;return!a||!e.editable?!1:(n.preventDefault(),a(e.state,e.dispatch))}}}})}function F2(t,e){return(n,r)=>{let a=Ua.getState(n);if(!a||(t?a.undone:a.done).eventCount==0)return!1;if(r){let i=SI(a,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}const G2=F2(!1,!0),q2=F2(!0,!0);Ct.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=t?.node||this.editor.state.doc;if((t?.mode||this.options.mode)==="textSize"){const r=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(r)}return e.nodeSize},this.storage.words=t=>{const e=t?.node||this.editor.state.doc,n=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let t=!1;return[new pt({key:new Pt("characterCount"),appendTransaction:(e,n,r)=>{if(t)return;const a=this.options.limit;if(a==null||a===0){t=!0;return}const i=this.storage.characters({node:r.doc});if(i>a){const c=i-a,u=0,h=c;console.warn(`[CharacterCount] Initial content exceeded limit of ${a} characters. Content was automatically trimmed.`);const p=r.tr.deleteRange(u,h);return t=!0,p}t=!0},filterTransaction:(e,n)=>{const r=this.options.limit;if(!e.docChanged||r===0||r===null||r===void 0)return!0;const a=this.storage.characters({node:n.doc}),i=this.storage.characters({node:e.doc});if(i<=r||a>r&&i>r&&i<=a)return!0;if(a>r&&i>r&&i>a||!e.getMeta("paste"))return!1;const u=e.selection.$head.pos,h=i-r,p=u-h,m=u;return e.deleteRange(p,m),!(this.storage.characters({node:e.doc})>r)}})]}});var jI=Ct.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[oI(this.options)]}});Ct.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new pt({key:new Pt("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:n,isFocused:r}=this.editor,{anchor:a}=e,i=[];if(!n||!r)return ft.create(t,[]);let c=0;this.options.mode==="deepest"&&t.descendants((h,p)=>{if(h.isText)return;if(!(a>=p&&a<=p+h.nodeSize-1))return!1;c+=1});let u=0;return t.descendants((h,p)=>{if(h.isText||!(a>=p&&a<=p+h.nodeSize-1))return!1;if(u+=1,this.options.mode==="deepest"&&c-u>0||this.options.mode==="shallowest"&&u>1)return this.options.mode==="deepest";i.push(un.node(p,p+h.nodeSize,{class:this.options.className}))}),ft.create(t,i)}}})]}});var CI=Ct.create({name:"gapCursor",addProseMirrorPlugins(){return[uI()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=Qe(Ce(t,"allowGapCursor",n)))!=null?e:null}}});Ct.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new pt({key:new Pt("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,a=[];if(!n)return null;const i=this.editor.isEmpty;return t.descendants((c,u)=>{const h=r>=u&&r<=u+c.nodeSize,p=!c.isLeaf&&Ah(c);if((h||!this.options.showOnlyCurrent)&&p){const m=[this.options.emptyNodeClass];i&&m.push(this.options.emptyEditorClass);const g=un.node(u,u+c.nodeSize,{class:m.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:c,pos:u,hasAnchor:h}):this.options.placeholder});a.push(g)}return this.options.includeChildren}),ft.create(t,a)}}})]}});Ct.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new pt({key:new Pt("selection"),props:{decorations(n){return n.selection.empty||t.isFocused||!t.isEditable||Zj(n.selection)||t.view.dragging?null:ft.create(n.doc,[un.inline(n.selection.from,n.selection.to,{class:e.className})])}}})]}});function RS({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||e?.type===t}var TI=Ct.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new Pt(this.name),n=this.options.node||((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||"paragraph",r=Object.entries(this.editor.schema.nodes).map(([,a])=>a).filter(a=>(this.options.notAfter||[]).concat(n).includes(a.name));return[new pt({key:e,appendTransaction:(a,i,c)=>{const{doc:u,tr:h,schema:p}=c,m=e.getState(c),g=u.content.size,x=p.nodes[n];if(m)return h.insert(g,x.create())},state:{init:(a,i)=>{const c=i.tr.doc.lastChild;return!RS({node:c,types:r})},apply:(a,i)=>{if(!a.docChanged||a.getMeta("__uniqueIDTransaction"))return i;const c=a.doc.lastChild;return!RS({node:c,types:r})}}})]}}),EI=Ct.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>G2(t,e),redo:()=>({state:t,dispatch:e})=>q2(t,e)}},addProseMirrorPlugins(){return[kI(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),RI=Ct.create({name:"starterKit",addExtensions(){var t,e,n,r;const a=[];return this.options.bold!==!1&&a.push(r6.configure(this.options.bold)),this.options.blockquote!==!1&&a.push(XB.configure(this.options.blockquote)),this.options.bulletList!==!1&&a.push(A2.configure(this.options.bulletList)),this.options.code!==!1&&a.push(i6.configure(this.options.code)),this.options.codeBlock!==!1&&a.push(c6.configure(this.options.codeBlock)),this.options.document!==!1&&a.push(d6.configure(this.options.document)),this.options.dropcursor!==!1&&a.push(jI.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&a.push(CI.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&a.push(u6.configure(this.options.hardBreak)),this.options.heading!==!1&&a.push(h6.configure(this.options.heading)),this.options.undoRedo!==!1&&a.push(EI.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&a.push(f6.configure(this.options.horizontalRule)),this.options.italic!==!1&&a.push(x6.configure(this.options.italic)),this.options.listItem!==!1&&a.push(_2.configure(this.options.listItem)),this.options.listKeymap!==!1&&a.push(B2.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&a.push(V6.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&a.push(P2.configure(this.options.orderedList)),this.options.paragraph!==!1&&a.push(nI.configure(this.options.paragraph)),this.options.strike!==!1&&a.push(aI.configure(this.options.strike)),this.options.text!==!1&&a.push(iI.configure(this.options.text)),this.options.underline!==!1&&a.push(z2.configure((n=this.options)==null?void 0:n.underline)),this.options.trailingNode!==!1&&a.push(TI.configure((r=this.options)==null?void 0:r.trailingNode)),a}}),W2=RI;function K2(t,e,n="Anonymous"){const[r,a]=E.useState({}),[i,c]=E.useState([]),u=E.useRef(null),h=E.useRef(new Set),p=E.useRef("dashboard");E.useEffect(()=>{if(!t||!e)return;const S=Fe.channel(`presence:${t}`,{config:{presence:{key:e}}});return S.on("presence",{event:"sync"},()=>{const j=S.presenceState(),A=Object.values(j).flat();c(A);const $={};A.forEach(L=>{L.editing&&Array.isArray(L.editing)&&L.editing.forEach(R=>{$[R]||($[R]=[]),$[R].push({userId:L.user_id,userName:L.user_name})})}),a($)}).on("presence",{event:"join"},()=>{}).on("presence",{event:"leave"},()=>{}).subscribe(async j=>{j==="SUBSCRIBED"&&await S.track({user_id:e,user_name:n,online_at:new Date().toISOString(),editing:[],current_view:"dashboard"})}),u.current=S,()=>{S.unsubscribe(),u.current=null}},[t,e,n]);const m=E.useCallback(async S=>{!u.current||!S||(p.current=S,await u.current.track({user_id:e,user_name:n,online_at:new Date().toISOString(),editing:Array.from(h.current),current_view:S}))},[e,n]),g=E.useCallback(async S=>{!u.current||!S||(h.current.add(S),await u.current.track({user_id:e,user_name:n,online_at:new Date().toISOString(),editing:Array.from(h.current),current_view:p.current}))},[e,n]),x=E.useCallback(async S=>{!u.current||!S||(h.current.delete(S),await u.current.track({user_id:e,user_name:n,online_at:new Date().toISOString(),editing:Array.from(h.current),current_view:p.current}))},[e,n]),v=E.useCallback(S=>(r[S]||[]).some(A=>A.userId!==e),[r,e]),w=E.useCallback(S=>(r[S]||[]).find(A=>A.userId!==e),[r,e]),N=E.useCallback(S=>Array.isArray(i)?i.filter(j=>j.current_view===S&&j.user_id!==e).map(j=>({userId:j.user_id,userName:j.user_name})):[],[i,e]);return{presenceState:r,onlineUsers:i,trackEditing:g,stopEditing:x,isFieldLocked:v,getFieldEditor:w,updateCurrentView:m,getUsersInView:N}}function Y2(t,e=500){const[n,r]=E.useState(t);return E.useEffect(()=>{const a=setTimeout(()=>{r(t)},e);return()=>{clearTimeout(a)}},[t,e]),n}const kl=({onClick:t,active:e,children:n,title:r,disabled:a})=>l.jsx("button",{onClick:t,title:r,disabled:a,className:oe("p-1.5 transition-all duration-200 border border-accent-yellow",a&&"opacity-40 cursor-not-allowed",e?"bg-accent-yellow text-bg-primary":"bg-bg-secondary text-accent-yellow hover:bg-accent-yellow hover:bg-opacity-20",a&&"hover:bg-bg-secondary hover:bg-opacity-100"),children:n});function AS({roomCode:t}){const{gameState:e,updateGameState:n}=Ge(),{session:r}=Ya(),{character:a}=as(),[i,c]=E.useState(e.journal||""),u=Y2(i,2e3),{trackEditing:h,stopEditing:p,getFieldEditor:m}=K2(t,r?.user?.id,a?.name||"Unknown Rebel"),g=m("sessionJournal"),x=g&&g.userId!==r?.user?.id,v=v2({extensions:[W2.configure({heading:!1,code:!1,codeBlock:!1,blockquote:!1,horizontalRule:!1}),U2],content:e.journal||"<p>>> MISSION LOG: Document your journey, decisions, and discoveries...</p>",editable:!x,editorProps:{attributes:{class:"prose prose-invert max-w-none focus:outline-none min-h-0 h-full px-3 py-2 text-sm font-mono"}},onUpdate:({editor:w})=>{const N=w.getHTML();c(N)}});return E.useEffect(()=>{v&&v.setEditable(!x)},[v,x]),E.useEffect(()=>{v&&e.journal!==i&&e.journal!==u&&(v.commands.setContent(e.journal||""),c(e.journal))},[e.journal,v]),E.useEffect(()=>{u!==e.journal&&n({journal:u})},[u]),v?l.jsxs("div",{className:"relative lg:absolute lg:inset-0 flex flex-col gap-2",children:[x&&l.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-accent-yellow/20 border border-accent-yellow/50 rounded text-accent-yellow text-xs shrink-0",children:[l.jsx(Fs,{className:"w-3 h-3"}),l.jsxs("span",{children:[g.userName," is editing the session journal..."]})]}),l.jsxs("div",{className:"flex items-center gap-1 shrink-0 p-2 bg-bg-primary border-2 border-accent-yellow",children:[l.jsx(kl,{onClick:()=>v.chain().focus().toggleBold().run(),active:v.isActive("bold"),disabled:x,title:"Bold",children:l.jsx(hg,{className:"w-4 h-4"})}),l.jsx(kl,{onClick:()=>v.chain().focus().toggleItalic().run(),active:v.isActive("italic"),disabled:x,title:"Italic",children:l.jsx(BN,{className:"w-4 h-4"})}),l.jsx(kl,{onClick:()=>v.chain().focus().toggleUnderline().run(),active:v.isActive("underline"),disabled:x,title:"Underline",children:l.jsx(FN,{className:"w-4 h-4"})}),l.jsx(kl,{onClick:()=>v.chain().focus().toggleStrike().run(),active:v.isActive("strike"),disabled:x,title:"Strikethrough",children:l.jsx(VN,{className:"w-4 h-4"})}),l.jsx("div",{className:"w-px h-6 bg-accent-yellow opacity-30 mx-1"}),l.jsx(kl,{onClick:()=>v.chain().focus().toggleBulletList().run(),active:v.isActive("bulletList"),disabled:x,title:"Bullet List",children:l.jsx(IN,{className:"w-4 h-4"})})]}),l.jsx("div",{className:"h-[240px] lg:flex-1 lg:h-auto lg:min-h-0 bg-bg-primary border-2 border-accent-yellow text-text-primary focus-within:border-accent-cyan focus-within:shadow-[0_0_15px_rgba(0,240,255,0.4)] transition-all duration-300 overflow-auto",children:l.jsx(x2,{editor:v,className:"h-full",onFocus:()=>h("sessionJournal"),onBlur:()=>p("sessionJournal")})}),l.jsx("div",{className:"text-xs text-gray-500 font-orbitron shrink-0",children:i!==e.journal?l.jsx("span",{className:"text-accent-yellow animate-pulse",children:" Saving..."}):l.jsx("span",{className:"text-accent-cyan",children:" Synced"})})]}):null}const AI={4:l.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[l.jsx("polygon",{points:"50,15 85,85 15,85",fill:"#0a0a0a",fillOpacity:"0.9",stroke:"currentColor",strokeWidth:"2"}),l.jsx("text",{x:"50",y:"70",textAnchor:"middle",fill:"#ffffff",style:{fontSize:"28px",fontWeight:900},children:"4"})]}),6:l.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[l.jsx("rect",{x:"20",y:"20",width:"60",height:"60",fill:"#0a0a0a",fillOpacity:"0.9",stroke:"currentColor",strokeWidth:"2",rx:"4"}),l.jsx("text",{x:"50",y:"58",textAnchor:"middle",fill:"#ffffff",style:{fontSize:"28px",fontWeight:900},children:"6"})]}),8:l.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[l.jsx("polygon",{points:"25,50 50,15 75,50 50,85",fill:"#0a0a0a",fillOpacity:"0.9",stroke:"currentColor",strokeWidth:"2"}),l.jsx("text",{x:"50",y:"58",textAnchor:"middle",fill:"#ffffff",style:{fontSize:"28px",fontWeight:900},children:"8"})]}),10:l.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[l.jsx("polygon",{points:"50,10 80,35 80,65 50,90 20,65 20,35",fill:"#0a0a0a",fillOpacity:"0.9",stroke:"currentColor",strokeWidth:"2"}),l.jsx("text",{x:"50",y:"58",textAnchor:"middle",fill:"#ffffff",style:{fontSize:"24px",fontWeight:900},children:"10"})]}),12:l.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[l.jsx("polygon",{points:"50,10 70,20 82,35 82,65 70,80 50,90 30,80 18,65 18,35 30,20",fill:"#0a0a0a",fillOpacity:"0.9",stroke:"currentColor",strokeWidth:"2"}),l.jsx("text",{x:"50",y:"58",textAnchor:"middle",fill:"#ffffff",style:{fontSize:"24px",fontWeight:900},children:"12"})]}),20:l.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[l.jsx("polygon",{points:"50,8 82,25 82,70 50,87 18,70 18,25",fill:"#0a0a0a",fillOpacity:"0.9",stroke:"currentColor",strokeWidth:"2"}),l.jsx("polygon",{points:"50,8 18,25 82,25",fill:"none",stroke:"currentColor",strokeWidth:"2"}),l.jsx("polygon",{points:"50,32 25,65 75,65",fill:"#0a0a0a",fillOpacity:"0.95",stroke:"currentColor",strokeWidth:"2"}),l.jsx("polygon",{points:"18,25 18,70 25,65",fill:"none",stroke:"currentColor",strokeWidth:"2"}),l.jsx("polygon",{points:"82,25 75,65 82,70",fill:"none",stroke:"currentColor",strokeWidth:"2"}),l.jsx("line",{x1:"50",y1:"32",x2:"50",y2:"8",stroke:"currentColor",strokeWidth:"2"}),l.jsx("line",{x1:"25",y1:"65",x2:"18",y2:"25",stroke:"currentColor",strokeWidth:"2"}),l.jsx("line",{x1:"75",y1:"65",x2:"82",y2:"25",stroke:"currentColor",strokeWidth:"2"}),l.jsx("line",{x1:"25",y1:"65",x2:"50",y2:"87",stroke:"currentColor",strokeWidth:"2"}),l.jsx("line",{x1:"75",y1:"65",x2:"50",y2:"87",stroke:"currentColor",strokeWidth:"2"}),l.jsx("line",{x1:"18",y1:"70",x2:"25",y2:"65",stroke:"currentColor",strokeWidth:"2"}),l.jsx("line",{x1:"82",y1:"70",x2:"75",y2:"65",stroke:"currentColor",strokeWidth:"2"}),l.jsx("text",{x:"50",y:"56",textAnchor:"middle",fill:"#ffffff",style:{fontSize:"24px",fontWeight:900},children:"20"})]}),100:l.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[l.jsx("circle",{cx:"50",cy:"50",r:"40",fill:"#0a0a0a",fillOpacity:"0.9",stroke:"currentColor",strokeWidth:"2"}),l.jsx("text",{x:"50",y:"58",textAnchor:"middle",fill:"#ffffff",style:{fontSize:"22px",fontWeight:900},children:"100"})]}),"2d6":l.jsxs("svg",{viewBox:"0 0 100 100",className:"w-full h-full",children:[l.jsx("rect",{x:"15",y:"25",width:"32",height:"32",fill:"#0a0a0a",fillOpacity:"0.9",stroke:"currentColor",strokeWidth:"2",rx:"3"}),l.jsx("rect",{x:"53",y:"43",width:"32",height:"32",fill:"#0a0a0a",fillOpacity:"0.9",stroke:"currentColor",strokeWidth:"2",rx:"3"}),l.jsx("text",{x:"31",y:"48",textAnchor:"middle",fill:"#ffffff",style:{fontSize:"18px",fontWeight:900},children:"6"}),l.jsx("text",{x:"69",y:"66",textAnchor:"middle",fill:"#ffffff",style:{fontSize:"18px",fontWeight:900},children:"6"})]})};function _S({sides:t,variant:e="cyan",isRolling:n=!1,onClick:r,className:a,index:i=0}){const c={cyan:"text-accent-cyan",yellow:"text-accent-yellow",red:"text-accent-red"},u=`${i*.4%3}s`,h=i*3%9-4;return l.jsx("button",{onClick:r,disabled:n,className:oe("relative aspect-square bg-transparent","transition-all duration-300 ease-out","hover:scale-110 active:scale-95","disabled:opacity-50 disabled:cursor-not-allowed","group",c[e],n&&"dice-rolling",!n&&"dice-idle",a),style:{"--dice-delay":u,"--dice-rotation":`${h}deg`},children:l.jsx("div",{className:"absolute inset-0 flex items-center justify-center p-2",children:AI[t]})})}function _I({result:t,diceType:e,sides:n,rolls:r,rollMode:a,onComplete:i}){const[c,u]=E.useState(!0),[h,p]=E.useState(!1),[m,g]=E.useState(!1),x=n===20&&t===20,v=n===20&&t===1,w=t>n*.75,N=t<=n*.25,S=a==="advantage"||a==="disadvantage",j=n===100;E.useEffect(()=>{const R=setTimeout(()=>{u(!1),(x||v)&&(p(!0),g(!0),setTimeout(()=>g(!1),400))},j?400:300),M=setTimeout(()=>{i&&i()},2500);return()=>{clearTimeout(R),clearTimeout(M)}},[t,x,v,j,i]);const A=()=>x?"text-accent-yellow":v?"text-accent-red":w?"text-accent-cyan":N?"text-gray-400":"text-accent-cyan",$=()=>x?"text-glow-yellow":v?"text-glow-red":"text-glow-cyan",L=j?t.toString().padStart(3,"0").split(""):[t.toString()];return l.jsxs("div",{className:"relative w-full py-3 px-3 bg-bg-secondary/30 backdrop-blur-sm border-2 border-accent-cyan/50 overflow-hidden",children:[m&&l.jsx("div",{className:oe("fixed inset-0 pointer-events-none z-50",x?"bg-accent-yellow screen-flash-yellow":"bg-accent-red screen-flash-red")}),l.jsx("div",{className:oe("absolute inset-0 opacity-30 transition-opacity duration-500",x&&"bg-gradient-radial from-accent-yellow/40 to-transparent animate-pulse",v&&"bg-gradient-radial from-accent-red/40 to-transparent",!x&&!v&&"bg-gradient-radial from-accent-cyan/20 to-transparent")}),h&&x&&l.jsx("div",{className:"absolute inset-0 crit-burst pointer-events-none"}),l.jsxs("div",{className:oe("relative z-10",h&&v&&"fumble-shake"),children:[l.jsx("div",{className:"text-center mb-0.5",children:l.jsxs("span",{className:oe("text-xs font-orbitron uppercase tracking-wider opacity-70",A()),children:[e,S&&l.jsxs("span",{className:oe("ml-1",a==="advantage"?"text-accent-yellow":"text-accent-red"),children:["(",a==="advantage"?"ADV":"DIS",")"]})]})}),l.jsxs("div",{className:"text-center",children:[j&&!c?l.jsx("span",{className:oe("font-orbitron font-black text-5xl",A(),$()),children:L.map((R,M)=>l.jsx("span",{className:`inline-block digit-reveal-${M+1}`,children:R},M))}):l.jsx("span",{className:oe("font-orbitron font-black transition-all duration-300","inline-block",c?"text-4xl scale-0 opacity-0":"text-5xl scale-100 opacity-100 result-reveal",A(),$()),children:t}),!c&&S&&r&&r.length===2&&l.jsxs("span",{className:oe("ml-2 text-2xl font-orbitron font-bold opacity-50",A()),children:["[",r[0]===t?r[1]:r[0],"]"]})]}),!c&&(x||v)&&l.jsx("div",{className:oe("text-center mt-0.5 slide-up","text-xs font-orbitron uppercase tracking-widest",x?"text-accent-yellow":"text-accent-red"),children:x?" CRITICAL ":" FUMBLE "})]}),l.jsx("div",{className:"absolute inset-0 pointer-events-none scan-effect opacity-30"})]})}function MS(){const{addLog:t}=Ge(),[e,n]=E.useState(null),[r,a]=E.useState(null),[i,c]=E.useState([]),[u,h]=E.useState("normal"),p=[{sides:4,label:"D4"},{sides:6,label:"D6"},{sides:8,label:"D8"},{sides:10,label:"D10"},{sides:12,label:"D12"},{sides:20,label:"D20"},{sides:100,label:"D100"}],m=(x,v)=>{e||(n(v),setTimeout(()=>{let w,N,S;if(u==="advantage"||u==="disadvantage"){const j=ie(x),A=ie(x);N=[j,A],w=u==="advantage"?Math.max(j,A):Math.min(j,A),S=`Rolled ${v} (${u==="advantage"?"ADV":"DIS"}): [${N.join(", ")}] = ${w}`}else w=ie(x),S=`Rolled ${v}: ${w}`;a({result:w,diceType:v,sides:x,rolls:N,rollMode:u}),t(S,"roll"),c(j=>[{label:v,result:w},...j.slice(0,4)]),n(null)},600))},g=()=>{e||(n("2D6"),setTimeout(()=>{const x=[ie(6),ie(6)],v=x.reduce((w,N)=>w+N,0);a({result:v,diceType:"2D6",sides:12,isMultiple:!0}),t(`Rolled 2D6: [${x.join(", ")}] = ${v}`,"roll"),c(w=>[{label:"2D6",result:v},...w.slice(0,4)]),n(null)},600))};return l.jsxs("div",{className:"space-y-2",children:[r&&l.jsx(_I,{result:r.result,diceType:r.diceType,sides:r.sides,rolls:r.rolls,rollMode:r.rollMode,onComplete:()=>{}}),l.jsxs("div",{className:"flex gap-1 justify-center",children:[l.jsx("button",{onClick:()=>h("normal"),className:`px-3 py-1 font-orbitron font-bold uppercase text-xs border-2 transition-all ${u==="normal"?"bg-accent-cyan text-bg-primary border-accent-cyan":"bg-transparent text-accent-cyan border-accent-cyan hover:bg-accent-cyan/20"}`,children:"Normal"}),l.jsx("button",{onClick:()=>h("advantage"),className:`px-3 py-1 font-orbitron font-bold uppercase text-xs border-2 transition-all ${u==="advantage"?"bg-accent-yellow text-bg-primary border-accent-yellow":"bg-transparent text-accent-yellow border-accent-yellow hover:bg-accent-yellow/20"}`,children:"Advantage"}),l.jsx("button",{onClick:()=>h("disadvantage"),className:`px-3 py-1 font-orbitron font-bold uppercase text-xs border-2 transition-all ${u==="disadvantage"?"bg-accent-red text-bg-primary border-accent-red":"bg-transparent text-accent-red border-accent-red hover:bg-accent-red/20"}`,children:"Disadvantage"})]}),l.jsxs("div",{className:"grid grid-cols-4 gap-2 max-w-lg mx-auto",children:[p.map(({sides:x,label:v},w)=>l.jsx(_S,{sides:x,label:v,variant:"cyan",isRolling:e===v,onClick:()=>m(x,v),index:w},x)),l.jsx(_S,{sides:"2d6",label:"2D6",variant:"cyan",isRolling:e==="2D6",onClick:g,index:7})]}),i.length>0&&l.jsx("div",{className:"pt-2 border-t border-accent-cyan/30",children:l.jsxs("div",{className:"flex items-center justify-between text-xs",children:[l.jsx("span",{className:"text-accent-cyan/70 font-orbitron uppercase text-xs",children:"Recent:"}),l.jsx("div",{className:"flex gap-1",children:i.map((x,v)=>l.jsxs("span",{className:"text-accent-cyan font-mono font-bold text-xs slide-in-recent",children:[x.label.replace("D",""),":",x.result,v<i.length-1&&l.jsx("span",{className:"text-accent-cyan/40 mx-1",children:""})]},`${x.label}-${x.result}-${v}`))})]})})]})}function MI(t=10){const[e,n]=E.useState([]),[r,a]=E.useState(0),[i,c]=E.useState(0),u=E.useCallback(g=>{n(x=>[g,...x].slice(0,t)),a(0)},[t]),h=E.useCallback(g=>{a(Math.max(0,Math.min(g,e.length-1)))},[e.length]),p=E.useCallback(()=>{n([]),a(0),c(g=>g+1)},[]),m=e[r]||null;return{resultHistory:e,currentIndex:r,currentResult:m,addResult:u,navigateTo:h,clearHistory:p,clearVersion:i,totalResults:e.length}}const J2=E.createContext(null);function jl({children:t}){const e=MI(10);return l.jsx(J2.Provider,{value:e,children:t})}function Un(){return E.useContext(J2)}function OI(){const{addLog:t,gameState:e}=Ge(),n=Un(),[r,a]=E.useState("normal"),i=()=>{let h,p;if(r==="advantage"||r==="disadvantage"){const m=uu(),g=uu(),x=r==="advantage"?m.roll>g.roll?m:g:m.roll<g.roll?m:g;h={...x,rolls:[m.roll,g.roll],rollMode:r},p=`Oracle (${r==="advantage"?"ADV":"DIS"}) [${m.roll}, ${g.roll}] = ${x.roll}: ${x.result} - ${x.detail}`}else h=uu(),p=`Oracle (${h.roll}): ${h.result} - ${h.detail}`;n&&n.addResult(h),t(p,"roll")},c=()=>{const h=e.threatDie||1,p=JN(h);if(p.success){const m={roll:p.total,result:"Scene Shakeup",detail:p.shakeup.result,checkRoll:p.checkRoll,threatDie:h,shakeupD20:p.shakeup.d20,shakeupRoll:p.shakeup.roll};n&&n.addResult(m),t(`Scene Shakeup Check [${p.checkRoll}] + [${h}] = ${p.total}   Shakeup [${p.shakeup.d20}] + [${h}] = ${p.shakeup.roll}: ${p.shakeup.result}`,"roll")}else{const m={roll:p.total,result:"No Scene Shakeup",detail:`Rolled [${p.checkRoll}] + [${h}] = ${p.total}, need 15+`,checkRoll:p.checkRoll,threatDie:h,success:!1};n&&n.addResult(m),t(`Scene Shakeup Check [${p.checkRoll}] + [${h}] = ${p.total}  No shakeup`,"roll")}},u=()=>{const h=YN();n&&n.addResult(h),t(`Event (${h.roll}): ${h.verb} ${h.subject} - ${h.specific}`,"roll")};return l.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[l.jsxs("div",{className:"space-y-1",children:[l.jsx("button",{onClick:i,className:"w-full px-3 py-2 bg-accent-cyan text-bg-primary border-2 border-accent-cyan hover:bg-transparent hover:text-accent-cyan transition-all font-orbitron font-bold uppercase text-xs",children:"Ask Oracle"}),l.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[l.jsxs("button",{onClick:()=>a("normal"),className:`px-1 py-1 min-w-[32px] font-orbitron font-bold uppercase text-[10px] sm:text-xs border-2 transition-all ${r==="normal"?"bg-accent-cyan text-bg-primary border-accent-cyan":"bg-transparent text-accent-cyan border-accent-cyan hover:bg-accent-cyan/20"}`,children:[l.jsx("span",{className:"sm:hidden",children:"N"}),l.jsx("span",{className:"hidden sm:inline",children:"Norm"})]}),l.jsxs("button",{onClick:()=>a("advantage"),className:`px-1 py-1 min-w-[32px] font-orbitron font-bold uppercase text-[10px] sm:text-xs border-2 transition-all ${r==="advantage"?"bg-accent-yellow text-bg-primary border-accent-yellow":"bg-transparent text-accent-yellow border-accent-yellow hover:bg-accent-yellow/20"}`,children:[l.jsx("span",{className:"sm:hidden",children:"A"}),l.jsx("span",{className:"hidden sm:inline",children:"Adv"})]}),l.jsxs("button",{onClick:()=>a("disadvantage"),className:`px-1 py-1 min-w-[32px] font-orbitron font-bold uppercase text-[10px] sm:text-xs border-2 transition-all ${r==="disadvantage"?"bg-accent-red text-bg-primary border-accent-red":"bg-transparent text-accent-red border-accent-red hover:bg-accent-red/20"}`,children:[l.jsx("span",{className:"sm:hidden",children:"D"}),l.jsx("span",{className:"hidden sm:inline",children:"Dis"})]})]})]}),l.jsx("button",{onClick:c,className:"px-3 py-2 bg-accent-yellow text-bg-primary border-2 border-accent-yellow hover:bg-transparent hover:text-accent-yellow transition-all font-orbitron font-bold uppercase text-xs",children:"Shakeup"}),l.jsx("button",{onClick:u,className:"px-3 py-2 bg-accent-red text-bg-primary border-2 border-accent-red hover:bg-transparent hover:text-accent-red transition-all font-orbitron font-bold uppercase text-xs",children:"Event"})]})}function DI(t,e){if(typeof e=="string")return`${t}: ${e}`;if(typeof e!="object"||e===null)return`${t}: ${e}`;if(e.ship&&e.base){let r=`${t}: ${e.ship} | ${e.base}`;return e.obstacleTriggered&&e.obstacle&&(r+=` | ${e.obstacle}`),e.search&&(r+=` | ${e.search}`),r}if(e.species||e.role||e.demeanor){const r=[];return e.species&&r.push(e.species),e.role&&r.push(e.role),e.demeanor&&r.push(e.demeanor),`${t}: ${r.join(" - ")}`}if(e.type&&e.goods)return`${t}: ${e.type} ${e.goods} at ${e.spot||"location"} for ${e.reward||"reward"}`;if(e.name&&e.terrain)return`${t}: ${e.name} - ${e.terrain}, ${e.weather||""}`;if(e.name&&e.beast)return`${t}: ${e.name} - ${e.beast}`;if(e.location&&e.tone&&e.obstacle){const r=[e.locationRoll,e.toneRoll,e.obstacleRoll].filter(i=>i!==void 0);return`Scene${r.length>0?` [${r.join(", ")}]`:""}: ${e.location} - ${e.tone} - ${e.obstacle}`}if(e.titleType&&e.col1&&e.col2&&e.col3&&e.col4){const r=e.titleType==="epic"?"Epic Title":"Episode Title",a=[e.col1Roll,e.col2Roll,e.col3Roll,e.col4Roll].filter(c=>c!==void 0),i=a.length>0?` [${a.join(", ")}]`:"";return`${r}${i}: ${e.col1} ${e.col2} ${e.col3} ${e.col4}`}if(e.result&&e.detail)return`${t}: ${e.result} - ${e.detail}`;if(e.result)return`${t}: ${e.result}`;const n=Object.keys(e).filter(r=>!r.includes("Roll")&&!r.includes("Triggered")&&typeof e[r]=="string");if(n.length>0){const r=n.map(a=>e[a]).filter(a=>a);return`${t}: ${r.join(" | ")}`}return`${t}: ${JSON.stringify(e)}`}function rt({title:t,table:e,variant:n="cyan",diceType:r="d6",rollFunction:a=null,formatResult:i=null,setOracleResult:c=null}){const{addLog:u}=Ge(),h=Un(),p=()=>{let m;a?m=a():Array.isArray(e)?m=on(e):m="Error: Invalid table";const g=i?i(m):m;h&&h.addResult(g),c&&c(g);const x=DI(t,g);u(x,"oracle")};return l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-0.5 sm:gap-0",children:[l.jsx("span",{className:"text-[10px] sm:text-sm font-orbitron uppercase text-gray-300 leading-tight",children:t}),l.jsx("span",{className:"text-[9px] sm:text-xs font-orbitron text-gray-500 leading-tight",children:r})]}),l.jsx(ge,{onClick:p,variant:n==="cyan"?"ghost":n==="yellow"?"secondary":"danger",className:"w-full",children:"ROLL"})]})}function LI({onSwipeLeft:t,onSwipeRight:e,threshold:n=50}){const r=E.useRef(null),a=E.useRef(null),i=E.useRef(!1),c=E.useCallback(m=>{r.current=m.clientX,a.current=m.clientY,i.current=!0},[]),u=E.useCallback(m=>{i.current&&m.preventDefault()},[]),h=E.useCallback(m=>{if(!i.current||r.current===null)return;const g=m.clientX-r.current,x=m.clientY-a.current;Math.abs(g)>Math.abs(x)&&Math.abs(g)>=n&&(g>0&&e?e():g<0&&t&&t()),r.current=null,a.current=null,i.current=!1},[t,e,n]),p=E.useCallback(()=>{r.current=null,a.current=null,i.current=!1},[]);return{onPointerDown:c,onPointerMove:u,onPointerUp:h,onPointerCancel:p,style:{touchAction:"pan-y"}}}function $I(t){if(!t)return"";const e=[];if(e.push(" ORACLE RESULT "),e.push(""),t.roll!==void 0)if(t.rolls&&t.rollMode){const n=t.rollMode==="advantage"?"ADV":"DIS";e.push(`ROLL (${n}): [${t.rolls.join(", ")}] = [${t.roll}]`)}else e.push(`ROLL: [${t.roll}]`);if(t.result&&e.push(`RESULT: ${t.result}`),t.detail&&!t.weather&&!t.size&&e.push(`DETAIL: ${t.detail}`),t.detail&&t.size&&t.weather&&t.npcReaction&&(e.push(`DETAIL: ${t.detail}`),e.push(`SIZE: ${t.size}`),e.push(`WEATHER: ${t.weather}`),e.push(`NPC REACTION: ${t.npcReaction}`)),t.action&&t.target&&(e.push(`ACTION${t.actionRoll?` [${t.actionRoll}]`:""}: ${t.action}`),e.push(`TARGET${t.targetRoll?` [${t.targetRoll}]`:""}: ${t.target}`)),t.location&&t.tone&&t.obstacle&&(e.push(`LOCATION${t.locationRoll?` [${t.locationRoll}]`:""}: ${t.location}`),e.push(`TONE${t.toneRoll?` [${t.toneRoll}]`:""}: ${t.tone}`),e.push(`OBSTACLE${t.obstacleRoll?` [${t.obstacleRoll}]`:""}: ${t.obstacle}`)),t.theme&&t.actor&&!t.role&&(e.push(`THEME${t.themeRoll?` [${t.themeRoll}]`:""}: ${t.theme}`),e.push(`ACTOR${t.actorRoll?` [${t.actorRoll}]`:""}: ${t.actor}`)),t.ship&&t.base&&t.obstacle&&t.search&&t.shipRoll&&(e.push(`SHIP [${t.shipRoll}]: ${t.ship}`),e.push(`BASE [${t.baseRoll}]: ${t.base}`),t.threatRoll!==void 0&&e.push(`THREAT [${t.threatRoll}] + [${t.threatDie}] = ${t.threatTotal}: ${t.obstacleTriggered?" OBSTACLE TRIGGERED":"Safe"}`),e.push(`OBSTACLE [${t.obstacleRoll}]: ${t.obstacle}`),e.push(`SEARCH [${t.searchRoll}]: ${t.search}`)),t.type&&t.typeRoll&&(e.push(`TYPE [${t.typeRoll}]: ${t.type}`),e.push(`GOODS [${t.goodsRoll}]: ${t.goods}`),e.push(`SPOT [${t.spotRoll}]: ${t.spot}`),e.push(`REWARD [${t.rewardRoll}]: ${t.reward}`)),t.verb&&t.verbRoll&&(e.push(`VERB [${t.verbRoll}]: ${t.verb}`),e.push(`SUBJECT [${t.subjectRoll}]: ${t.subject}`),e.push(`DESC [${t.descRoll}]: ${t.description}`),e.push(`ACTIVITY [${t.activityRoll}]: ${t.activity}`),e.push(`OMEN [${t.omenRoll}]: ${t.omen}`),e.push(`SPECIFIC [${t.specificRoll}]: ${t.specific}`)),t.role&&t.roleRoll&&(t.name&&e.push(`NPC NAME: ${t.name}`),e.push(`ROLE [${t.roleRoll}]: ${t.role}`),e.push(`SPECIES [${t.speciesRoll}]: ${t.species}`),e.push(`MOTIVATION [${t.motivationRoll}]: ${t.motivation}`),e.push(`SECRET [${t.secretRoll}]: ${t.secret}`),e.push(`TRAIT [${t.traitRoll}]: ${t.trait}`),e.push(`DEMEANOR [${t.demeanorRoll}]: ${t.demeanor}`)),t.terrain&&(t.name&&e.push(`PLANET NAME${t.nameRoll?` [${t.nameRoll}]`:""}: ${t.name}`),e.push(`TERRAIN${t.terrainRoll?` [${t.terrainRoll}]`:""}: ${t.terrain}`),e.push(`WEATHER${t.weatherRoll?` [${t.weatherRoll}]`:""}: ${t.weather}`),e.push(`COLOR${t.colorRoll?` [${t.colorRoll}]`:""}: ${t.color}`),e.push(`POPULATION${t.populationRoll?` [${t.populationRoll}]`:""}: ${t.population}`),e.push(`CONTROL${t.controlRoll?` [${t.controlRoll}]`:""}: ${t.control}`)),t.appearance&&(t.name&&e.push(`SETTLEMENT NAME${t.nameRoll?` [${t.nameRoll}]`:""}: ${t.name}`),e.push(`APPEARANCE${t.appearanceRoll?` [${t.appearanceRoll}]`:""}: ${t.appearance}`),e.push(`KNOWN FOR${t.knownForRoll?` [${t.knownForRoll}]`:""}: ${t.knownFor}`),e.push(`STATE${t.currentStateRoll?` [${t.currentStateRoll}]`:""}: ${t.currentState}`),e.push(`COMPLICATION${t.complicationRoll?` [${t.complicationRoll}]`:""}: ${t.complication}`),t.leader&&e.push(`LEADER${t.leaderRoll?` [${t.leaderRoll}]`:""}: ${t.leader}`),t.landmark&&e.push(`LANDMARK${t.landmarkRoll?` [${t.landmarkRoll}]`:""}: ${t.landmark}`),t.rumors&&e.push(`RUMORS${t.rumorsRoll?` [${t.rumorsRoll}]`:""}: ${t.rumors}`),t.hookups&&e.push(`NPC HOOK-UPS${t.hookupsRoll?` [${t.hookupsRoll}]`:""}: ${t.hookups}`)),t.villain&&!t.visage&&(e.push(`VILLAIN${t.villainRoll?` [${t.villainRoll}]`:""}: ${t.villain}`),e.push(`GOAL${t.goalRoll?` [${t.goalRoll}]`:""}: ${t.goal}`),e.push(`PLAN${t.planRoll?` [${t.planRoll}]`:""}: ${t.plan}`),e.push(`MEANS${t.meansRoll?` [${t.meansRoll}]`:""}: ${t.means}`)),t.visage&&t.visageRoll&&(t.name&&e.push(`NAME [${t.nameRoll}]: ${t.name}`),e.push(`VISAGE [${t.visageRoll}]: ${t.visage}`),e.push(`WEAPON [${t.weaponRoll}]: ${t.weapon}`),e.push(`BASE [${t.baseRoll}]: ${t.base}`)),t.beast&&t.monstrosity&&t.weakSpot&&t.beastRoll&&(t.name&&e.push(`MONSTER NAME: ${t.name}`),e.push(`BEAST ADAPTATION [d6: ${t.beastRoll}]: ${t.beast}`),e.push(`MONSTROSITY [d6: ${t.monstrosityRoll}]: ${t.monstrosity}`),e.push(`WEAK SPOT [d6: ${t.weakSpotRoll}]: ${t.weakSpot}`)),t.incident&&(e.push(`INCIDENT: ${t.incident}`),t.followUpQuestions&&t.followUpQuestions.length>0&&(e.push("FOLLOW-UP QUESTIONS:"),t.followUpQuestions.forEach(n=>e.push(`  - ${n}`)))),t.titleType&&t.col1&&t.col2&&t.col3&&t.col4&&(e.push(`TITLE TYPE: ${t.titleType==="epic"?"Campaign Title":"Episode Title"}`),e.push(`[${t.col1Roll}] ${t.col1}`),e.push(`[${t.col2Roll}] ${t.col2}`),e.push(`[${t.col3Roll}] ${t.col3}`),e.push(`[${t.col4Roll}] ${t.col4}`),e.push(""),e.push(`FULL TITLE: ${t.col1} ${t.col2} ${t.col3} ${t.col4}`)),(t.fullName||t.fullSurname)&&t.firstRoll&&t.secondRoll&&!t.nameFirstRoll&&(e.push(`1ST PART [d100: ${t.firstRoll}]: ${t.firstName||t.firstPart}`),e.push(`2ND PART [d100: ${t.secondRoll}]: ${t.secondPart}`),e.push(""),e.push(`FULL NAME: ${t.fullName||t.fullSurname}`)),t.nameFirstRoll&&t.nameSecondRoll&&t.surnameFirstRoll&&t.surnameSecondRoll&&(e.push(`NAME 1ST [d100: ${t.nameFirstRoll}]: ${t.firstName.split(" ")[0]}`),e.push(`NAME 2ND [d100: ${t.nameSecondRoll}]: (combined in first name)`),e.push(`SURNAME 1ST [d100: ${t.surnameFirstRoll}]: ${t.surname.split("")[0]}`),e.push(`SURNAME 2ND [d100: ${t.surnameSecondRoll}]: (combined in surname)`),e.push(""),e.push(`FULL NAME: ${t.fullName}`)),t.template&&t.templateRoll&&t.fullName){if(e.push(`TEMPLATE [d100: ${t.templateRoll}]: ${t.template}`),t.quality&&e.push(`QUALITY [${t.qualityRoll}]: ${t.quality}`),t.adjective){let n=`ADJECTIVE [${t.adjectiveRoll}]: ${t.adjective}`;t.adjectiveIsNPCName&&(n+=" (NPC Name)"),t.adjectiveIsNPCSurname&&(n+=" (NPC Surname)"),t.adjectiveIsPlaceName&&(n+=" (Place)"),e.push(n)}t.form&&e.push(`FORM [${t.formRoll}]: ${t.form}`),t.number!==void 0&&e.push(`NUMBER [3d10: ${t.numberRolls?.join(", ")}]: ${t.number}`),t.structure&&e.push(`STRUCTURE [${t.structureRoll}]: ${t.structure}`),t.noun&&e.push(`NOUN [${t.nounRoll}]: ${t.noun}`),e.push(""),e.push(`GENERATED NAME: ${t.fullName}`)}return typeof t=="string"&&e.push(t),e.push(""),e.push(""),e.join(`
`)}function jc({result:t,variant:e="cyan",className:n,currentIndex:r=0,totalResults:a=0,onNavigate:i,onClear:c}){const[u,h]=E.useState(!1),[p,m]=E.useState(!1),[g,x]=E.useState("none");E.useEffect(()=>{t&&(h(!1),setTimeout(()=>h(!0),50))},[t]);const v=E.useCallback(()=>{r<a-1&&i&&(x("right"),setTimeout(()=>{i(r+1),x("none")},150))},[r,a,i]),w=E.useCallback(()=>{r>0&&i&&(x("left"),setTimeout(()=>{i(r-1),x("none")},150))},[r,i]);E.useEffect(()=>{const D=I=>{!i||a<=1||(I.key==="ArrowLeft"?(I.preventDefault(),v()):I.key==="ArrowRight"&&(I.preventDefault(),w()))};return window.addEventListener("keydown",D),()=>window.removeEventListener("keydown",D)},[r,a,i,v,w]);const N=LI({onSwipeLeft:v,onSwipeRight:w,threshold:50}),S=E.useCallback(async()=>{try{const D=$I(t);await navigator.clipboard.writeText(D),m(!0),setTimeout(()=>m(!1),2e3)}catch(D){console.error("Failed to copy:",D)}},[t]);if(!t)return null;const j=r>0,A=a>1,$={cyan:"border-accent-cyan",yellow:"border-accent-yellow",red:"border-accent-red"},L={cyan:"text-accent-cyan",yellow:"text-accent-yellow",red:"text-accent-red"},R={cyan:"glow-pulse-cyan",yellow:"glow-pulse-yellow",red:"glow-pulse-red"},M={cyan:"text-glow-cyan",yellow:"text-glow-yellow",red:"text-glow-red"};return l.jsxs("div",{className:oe("border-3 bg-bg-secondary scan-effect relative overflow-hidden",$[e],R[e],u?"fade-in":"opacity-0",n),children:[j&&l.jsx("div",{className:"absolute inset-0 bg-accent-yellow/5 pointer-events-none z-0"}),l.jsx("div",{...N,className:oe("p-4 relative z-10 transition-transform duration-150",g==="left"&&"-translate-x-2 opacity-80",g==="right"&&"translate-x-2 opacity-80"),children:l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-between gap-2",children:[l.jsx("div",{className:oe("text-xs font-orbitron uppercase tracking-wider flicker",L[e]),children:" TRANSMISSION RECEIVED "}),j&&l.jsx("div",{className:"text-xs font-orbitron uppercase tracking-wider text-accent-yellow/80 bg-accent-yellow/10 px-2 py-1 border border-accent-yellow/30",children:"HISTORY"})]}),t.roll!==void 0&&l.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[l.jsx("span",{className:"text-gray-400 text-sm font-orbitron",children:"ROLL:"}),t.rolls&&t.rollMode?l.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[l.jsx("span",{className:oe("text-sm font-orbitron",t.rollMode==="advantage"?"text-accent-yellow":"text-accent-red"),children:t.rollMode==="advantage"?"ADV":"DIS"}),l.jsxs("span",{className:"text-base sm:text-lg font-orbitron text-gray-500",children:["[",t.rolls.join(", "),"]"]}),l.jsx("span",{className:"text-gray-500",children:"="}),l.jsxs("span",{className:oe("text-xl sm:text-2xl font-orbitron font-bold",L[e],M[e]),children:["[",t.roll,"]"]})]}):l.jsxs("span",{className:oe("text-xl sm:text-2xl font-orbitron font-bold",L[e],M[e]),children:["[",t.roll,"]"]})]}),l.jsx("div",{className:oe("h-px",$[e]),style:{opacity:.3}}),t.result&&l.jsxs("div",{className:"space-y-1",children:[l.jsx("div",{className:oe("text-sm font-orbitron uppercase text-gray-400"),children:"RESULT:"}),l.jsx("div",{className:oe("text-base sm:text-xl font-orbitron font-bold typewriter break-words",L[e],M[e]),children:t.result})]}),t.detail&&t.size&&t.weather&&t.npcReaction&&l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-3",children:[l.jsxs("div",{className:"space-y-1",children:[l.jsx("div",{className:"text-sm font-orbitron uppercase text-gray-400",children:"DETAIL:"}),l.jsx("div",{className:"text-base text-text-primary terminal-text break-words",children:t.detail})]}),l.jsxs("div",{className:"space-y-1",children:[l.jsx("div",{className:"text-sm font-orbitron uppercase text-gray-400",children:"SIZE:"}),l.jsx("div",{className:"text-base text-text-primary terminal-text break-words",children:t.size})]}),l.jsxs("div",{className:"space-y-1",children:[l.jsx("div",{className:"text-sm font-orbitron uppercase text-gray-400",children:"WEATHER:"}),l.jsx("div",{className:"text-base text-text-primary terminal-text break-words",children:t.weather})]}),l.jsxs("div",{className:"space-y-1",children:[l.jsx("div",{className:"text-sm font-orbitron uppercase text-gray-400",children:"NPC REACTION:"}),l.jsx("div",{className:"text-base text-text-primary terminal-text break-words",children:t.npcReaction})]})]}),t.detail&&!t.weather&&l.jsxs("div",{className:"space-y-1",children:[l.jsx("div",{className:"text-sm font-orbitron uppercase text-gray-400",children:"DETAIL:"}),l.jsx("div",{className:"text-base sm:text-lg text-text-primary terminal-text break-words",children:t.detail})]}),t.size&&!t.weather&&l.jsxs("div",{className:"space-y-1",children:[l.jsx("div",{className:"text-sm font-orbitron uppercase text-gray-400",children:"SIZE:"}),l.jsx("div",{className:"text-base sm:text-lg text-text-primary terminal-text break-words",children:t.size})]}),t.action&&t.target&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[70px] sm:min-w-[100px]",children:["ACTION",t.actionRoll?` [${t.actionRoll}]`:"",":"]}),l.jsx("span",{className:oe("text-base font-bold terminal-text break-words",L[e]),children:t.action})]}),l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[70px] sm:min-w-[100px]",children:["TARGET",t.targetRoll?` [${t.targetRoll}]`:"",":"]}),l.jsx("span",{className:oe("text-base font-bold terminal-text break-words",L[e]),children:t.target})]})]}),t.location&&t.tone&&t.obstacle&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[70px] sm:min-w-[100px]",children:["LOCATION",t.locationRoll?` [${t.locationRoll}]`:"",":"]}),l.jsx("span",{className:oe("text-base font-bold terminal-text break-words",L[e]),children:t.location})]}),l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[70px] sm:min-w-[100px]",children:["TONE",t.toneRoll?` [${t.toneRoll}]`:"",":"]}),l.jsx("span",{className:oe("text-base terminal-text break-words",L[e]),children:t.tone})]}),l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[70px] sm:min-w-[100px]",children:["OBSTACLE",t.obstacleRoll?` [${t.obstacleRoll}]`:"",":"]}),l.jsx("span",{className:oe("text-base text-accent-red terminal-text break-words"),children:t.obstacle})]})]}),t.theme&&t.actor&&!t.role&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[70px] sm:min-w-[100px]",children:["THEME",t.themeRoll?` [${t.themeRoll}]`:"",":"]}),l.jsx("span",{className:oe("text-base font-bold terminal-text break-words",L[e]),children:t.theme})]}),l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[70px] sm:min-w-[100px]",children:["ACTOR",t.actorRoll?` [${t.actorRoll}]`:"",":"]}),l.jsx("span",{className:oe("text-base terminal-text break-words",L[e]),children:t.actor})]})]}),t.ship&&t.base&&t.obstacle&&t.search&&t.shipRoll&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[80px] sm:min-w-[120px]",children:["SHIP [",t.shipRoll,"]:"]}),l.jsx("span",{className:oe("text-base font-bold terminal-text break-words",L[e]),children:t.ship})]}),l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[80px] sm:min-w-[120px]",children:["BASE [",t.baseRoll,"]:"]}),l.jsx("span",{className:oe("text-base font-bold terminal-text break-words",L[e]),children:t.base})]}),t.threatRoll!==void 0&&l.jsxs("div",{className:"flex gap-2 items-center flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[80px] sm:min-w-[120px]",children:["THREAT [",t.threatRoll,"] + [",t.threatDie,"] = ",t.threatTotal,":"]}),l.jsx("span",{className:oe("text-base font-bold break-words",t.obstacleTriggered?"text-accent-red":"text-gray-500"),children:t.obstacleTriggered?" OBSTACLE TRIGGERED":"Safe"})]}),l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[80px] sm:min-w-[120px]",children:["OBSTACLE [",t.obstacleRoll,"]:"]}),l.jsx("span",{className:oe("text-base font-bold terminal-text break-words",t.obstacleTriggered?"text-accent-red text-glow-red":"text-gray-500"),children:t.obstacle})]}),l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[80px] sm:min-w-[120px]",children:["SEARCH [",t.searchRoll,"]:"]}),l.jsx("span",{className:oe("text-base text-accent-yellow terminal-text break-words"),children:t.search})]})]}),t.type&&t.typeRoll&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[70px] sm:min-w-[100px]",children:["TYPE [",t.typeRoll,"]:"]}),l.jsx("span",{className:oe("text-base terminal-text font-bold break-words",L[e]),children:t.type})]}),l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[70px] sm:min-w-[100px]",children:["GOODS [",t.goodsRoll,"]:"]}),l.jsx("span",{className:oe("text-base terminal-text break-words",L[e]),children:t.goods})]}),l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[70px] sm:min-w-[100px]",children:["SPOT [",t.spotRoll,"]:"]}),l.jsx("span",{className:oe("text-base terminal-text break-words",L[e]),children:t.spot})]}),l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[70px] sm:min-w-[100px]",children:["REWARD [",t.rewardRoll,"]:"]}),l.jsx("span",{className:oe("text-base terminal-text text-accent-yellow break-words"),children:t.reward})]})]}),t.type&&!t.typeRoll&&l.jsx("div",{className:"space-y-2",children:Object.entries(t).map(([D,I])=>D==="roll"?null:l.jsxs("div",{className:"flex gap-2 flex-wrap",children:[l.jsxs("span",{className:"text-sm font-orbitron uppercase text-gray-400 min-w-[70px] sm:min-w-[100px]",children:[D,":"]}),l.jsx("span",{className:oe("text-base terminal-text break-words",L[e]),children:I})]},D))}),t.verb&&t.verbRoll&&l.jsx("div",{className:"space-y-2",children:l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["VERB [",t.verbRoll,"]:"]}),l.jsx("div",{className:oe("text-base font-bold break-words",L[e]),children:t.verb})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["SUBJECT [",t.subjectRoll,"]:"]}),l.jsx("div",{className:oe("text-base font-bold break-words",L[e]),children:t.subject})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["DESC [",t.descRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.description})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["ACTIVITY [",t.activityRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.activity})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["OMEN [",t.omenRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.omen})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["SPECIFIC [",t.specificRoll,"]:"]}),l.jsx("div",{className:oe("text-base font-bold break-words",L[e],M[e]),children:t.specific})]})]})}),t.role&&t.roleRoll&&l.jsxs("div",{className:"space-y-3",children:[t.name&&l.jsxs("div",{className:"space-y-1",children:[l.jsx("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:"NPC NAME:"}),l.jsx("div",{className:oe("text-base sm:text-xl font-bold break-words",L[e],M[e]),children:t.name})]}),l.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["ROLE [",t.roleRoll,"]:"]}),l.jsx("div",{className:oe("text-base font-bold break-words",L[e]),children:t.role})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["SPECIES [",t.speciesRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.species})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["MOTIVATION [",t.motivationRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.motivation})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["SECRET [",t.secretRoll,"]:"]}),l.jsx("div",{className:"text-base text-accent-yellow break-words",children:t.secret})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["TRAIT [",t.traitRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.trait})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["DEMEANOR [",t.demeanorRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.demeanor})]})]})]}),t.terrain&&l.jsxs("div",{className:"space-y-3",children:[t.name&&l.jsxs("div",{className:"space-y-1",children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["PLANET NAME",t.nameRoll?` [${t.nameRoll}]`:"",":"]}),l.jsx("div",{className:oe("text-base sm:text-xl font-bold break-words",L[e],M[e]),children:t.name})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["TERRAIN",t.terrainRoll?` [${t.terrainRoll}]`:"",":"]}),l.jsx("div",{className:oe("text-base break-words",L[e]),children:t.terrain})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["WEATHER",t.weatherRoll?` [${t.weatherRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.weather})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["COLOR",t.colorRoll?` [${t.colorRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.color})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["POPULATION",t.populationRoll?` [${t.populationRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.population})]}),l.jsxs("div",{className:"sm:col-span-2",children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["CONTROL",t.controlRoll?` [${t.controlRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.control})]})]})]}),t.appearance&&l.jsxs("div",{className:"space-y-3",children:[t.name&&l.jsxs("div",{className:"space-y-1",children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["SETTLEMENT NAME",t.nameRoll?` [${t.nameRoll}]`:"",":"]}),l.jsx("div",{className:oe("text-base sm:text-xl font-bold break-words",L[e],M[e]),children:t.name})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["APPEARANCE",t.appearanceRoll?` [${t.appearanceRoll}]`:"",":"]}),l.jsx("div",{className:oe("text-base break-words",L[e]),children:t.appearance})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["KNOWN FOR",t.knownForRoll?` [${t.knownForRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.knownFor})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["STATE",t.currentStateRoll?` [${t.currentStateRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.currentState})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["COMPLICATION",t.complicationRoll?` [${t.complicationRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-accent-red break-words",children:t.complication})]}),t.leader&&l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["LEADER",t.leaderRoll?` [${t.leaderRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.leader})]}),t.landmark&&l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["LANDMARK",t.landmarkRoll?` [${t.landmarkRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.landmark})]}),t.rumors&&l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["RUMORS",t.rumorsRoll?` [${t.rumorsRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-accent-yellow break-words",children:t.rumors})]}),t.hookups&&l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["NPC HOOK-UPS",t.hookupsRoll?` [${t.hookupsRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-accent-cyan break-words",children:t.hookups})]})]})]}),t.villain&&!t.visage&&l.jsx("div",{className:"space-y-2",children:l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[l.jsxs("div",{className:"sm:col-span-2",children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["VILLAIN",t.villainRoll?` [${t.villainRoll}]`:"",":"]}),l.jsx("div",{className:oe("text-base sm:text-lg font-bold break-words",L[e],M[e]),children:t.villain})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["GOAL",t.goalRoll?` [${t.goalRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.goal})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["PLAN",t.planRoll?` [${t.planRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.plan})]}),l.jsxs("div",{className:"sm:col-span-2",children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["MEANS",t.meansRoll?` [${t.meansRoll}]`:"",":"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.means})]})]})}),t.visage&&t.visageRoll&&l.jsx("div",{className:"space-y-2",children:l.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[t.name&&l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["NAME [",t.nameRoll,"]:"]}),l.jsx("div",{className:oe("text-base sm:text-lg font-bold break-words",L[e],M[e]),children:t.name})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["VISAGE [",t.visageRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.visage})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["WEAPON [",t.weaponRoll,"]:"]}),l.jsx("div",{className:"text-base text-accent-red break-words",children:t.weapon})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["BASE [",t.baseRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.base})]})]})}),t.beast&&t.monstrosity&&t.weakSpot&&t.beastRoll&&l.jsxs("div",{className:"space-y-2",children:[t.name&&l.jsxs("div",{children:[l.jsx("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:"MONSTER NAME:"}),l.jsx("div",{className:oe("text-base sm:text-lg font-bold break-words",L[e],M[e]),children:t.name})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["BEAST ADAPTATION [d6: ",t.beastRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.beast})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["MONSTROSITY [d6: ",t.monstrosityRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.monstrosity})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["WEAK SPOT [d6: ",t.weakSpotRoll,"]:"]}),l.jsx("div",{className:"text-base text-accent-yellow break-words",children:t.weakSpot})]})]}),t.incident&&l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"space-y-1",children:[l.jsx("div",{className:"text-sm font-orbitron uppercase text-gray-400",children:"INCIDENT:"}),l.jsx("div",{className:oe("text-base sm:text-lg font-bold break-words",L[e],M[e]),children:t.incident})]}),t.followUpQuestions&&l.jsxs("div",{className:"space-y-2",children:[l.jsx("div",{className:"text-sm font-orbitron uppercase text-gray-400",children:"FOLLOW-UP QUESTIONS:"}),l.jsx("ul",{className:"list-disc list-inside space-y-1 text-sm text-text-primary italic",children:t.followUpQuestions.map((D,I)=>l.jsx("li",{className:"break-words",children:D},I))})]})]}),t.titleType&&t.col1&&t.col2&&t.col3&&t.col4&&l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["[",t.col1Roll,"]"]}),l.jsx("div",{className:oe("text-base font-bold break-words",L[e]),children:t.col1})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["[",t.col2Roll,"]"]}),l.jsx("div",{className:oe("text-base font-bold break-words",L[e]),children:t.col2})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["[",t.col3Roll,"]"]}),l.jsx("div",{className:oe("text-base font-bold break-words",L[e]),children:t.col3})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["[",t.col4Roll,"]"]}),l.jsx("div",{className:oe("text-base font-bold break-words",L[e]),children:t.col4})]})]}),l.jsxs("div",{className:"pt-2 border-t border-accent-cyan/30",children:[l.jsx("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:"FULL TITLE:"}),l.jsxs("div",{className:oe("text-base sm:text-xl font-bold break-words",L[e],M[e]),children:[t.col1," ",t.col2," ",t.col3," ",t.col4]})]})]}),(t.fullName||t.fullSurname)&&t.firstRoll&&t.secondRoll&&!t.nameFirstRoll&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["1ST PART [d100: ",t.firstRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.firstName||t.firstPart})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["2ND PART [d100: ",t.secondRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.secondPart})]})]}),l.jsxs("div",{className:"pt-2 border-t border-accent-cyan/30",children:[l.jsx("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:"FULL NAME:"}),l.jsx("div",{className:oe("text-base sm:text-xl font-bold break-words",L[e],M[e]),children:t.fullName||t.fullSurname})]})]}),t.nameFirstRoll&&t.nameSecondRoll&&t.surnameFirstRoll&&t.surnameSecondRoll&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["NAME 1ST [d100: ",t.nameFirstRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.firstName.split(" ")[0]})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["NAME 2ND [d100: ",t.nameSecondRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:"(combined in first name)"})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["SURNAME 1ST [d100: ",t.surnameFirstRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.surname.split("")[0]})]}),l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["SURNAME 2ND [d100: ",t.surnameSecondRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:"(combined in surname)"})]})]}),l.jsxs("div",{className:"pt-2 border-t border-accent-cyan/30",children:[l.jsx("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:"FULL NAME:"}),l.jsx("div",{className:oe("text-base sm:text-xl font-bold break-words",L[e],M[e]),children:t.fullName})]})]}),t.template&&t.templateRoll&&t.fullName&&l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["TEMPLATE [d100: ",t.templateRoll,"]:"]}),l.jsx("div",{className:"text-sm text-gray-400 break-words font-mono",children:t.template})]}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[t.quality&&l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["QUALITY [",t.qualityRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.quality})]}),t.adjective&&l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["ADJECTIVE [",t.adjectiveRoll,"]:"]}),l.jsxs("div",{className:"text-base text-text-primary break-words",children:[t.adjective,t.adjectiveIsNPCName&&l.jsx("span",{className:"text-xs text-gray-500",children:" (NPC Name)"}),t.adjectiveIsNPCSurname&&l.jsx("span",{className:"text-xs text-gray-500",children:" (NPC Surname)"}),t.adjectiveIsPlaceName&&l.jsx("span",{className:"text-xs text-gray-500",children:" (Place)"})]})]}),t.form&&l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["FORM [",t.formRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.form})]}),t.number!==void 0&&l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["NUMBER [3d10: ",t.numberRolls?.join(", "),"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.number})]}),t.structure&&l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["STRUCTURE [",t.structureRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.structure})]}),t.noun&&l.jsxs("div",{children:[l.jsxs("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:["NOUN [",t.nounRoll,"]:"]}),l.jsx("div",{className:"text-base text-text-primary break-words",children:t.noun})]})]}),l.jsxs("div",{className:"pt-2 border-t border-accent-cyan/30",children:[l.jsx("span",{className:"text-xs font-orbitron uppercase text-gray-400",children:"GENERATED NAME:"}),l.jsx("div",{className:oe("text-base sm:text-xl font-bold break-words",L[e],M[e]),children:t.fullName})]})]}),typeof t=="string"&&l.jsx("div",{className:oe("text-base sm:text-lg terminal-text break-words",L[e]),children:t}),l.jsxs("div",{className:"flex items-center justify-between gap-4 pt-3 mt-3 border-t border-gray-700/50",children:[A?l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("button",{onClick:v,disabled:r>=a-1,className:oe("p-1.5 sm:p-2 border-2 transition-all",r>=a-1?"border-gray-700 text-gray-700 cursor-not-allowed":"border-accent-cyan text-accent-cyan hover:bg-accent-cyan hover:text-bg-primary"),"aria-label":"Previous result",children:l.jsx($M,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),l.jsx("div",{className:"flex items-center gap-1.5 px-2",children:Array.from({length:Math.min(a,10)}).map((D,I)=>{const W=a-1-I;return l.jsx("button",{onClick:()=>i&&i(W),className:oe("w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full transition-all border",W===r?`${$[e]} bg-current scale-125`:"border-gray-600 bg-gray-600 hover:bg-gray-400"),"aria-label":`Go to result ${W+1}`},I)})}),l.jsx("button",{onClick:w,disabled:r<=0,className:oe("p-1.5 sm:p-2 border-2 transition-all",r<=0?"border-gray-700 text-gray-700 cursor-not-allowed":"border-accent-cyan text-accent-cyan hover:bg-accent-cyan hover:text-bg-primary"),"aria-label":"Next result",children:l.jsx(ny,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]}):l.jsx("div",{}),l.jsxs("div",{className:"flex items-center gap-2",children:[c&&l.jsxs("button",{onClick:c,className:oe("flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1 sm:py-1.5 text-xs font-orbitron uppercase border-2 transition-all whitespace-nowrap","bg-transparent border-accent-red text-accent-red hover:bg-accent-red hover:text-bg-primary"),"aria-label":"Clear all results",children:[l.jsx(rs,{className:"w-3 h-3"}),l.jsx("span",{className:"hidden sm:inline",children:"CLEAR"})]}),l.jsx("button",{onClick:S,className:oe("flex items-center gap-1.5 sm:gap-2 px-2 sm:px-3 py-1 sm:py-1.5 text-xs font-orbitron uppercase border-2 transition-all whitespace-nowrap",p?"bg-accent-yellow/20 border-accent-yellow text-accent-yellow":"bg-transparent border-accent-cyan text-accent-cyan hover:bg-accent-cyan hover:text-bg-primary"),disabled:p,children:p?l.jsxs(l.Fragment,{children:[l.jsx(Ks,{className:"w-3 h-3"}),l.jsx("span",{className:"hidden sm:inline",children:"COPIED"})]}):l.jsxs(l.Fragment,{children:[l.jsx(LN,{className:"w-3 h-3"}),l.jsx("span",{className:"hidden sm:inline",children:"COPY"})]})})]})]})]})})]})}function BI(){const{addLog:t,gameState:e}=Ge(),n=Un(),[r,a]=E.useState("detailed"),i=()=>{const g=QN();n&&n.addResult(g),t(`Mission: ${g.type} ${g.goods} at ${g.spot} for ${g.reward}`,"mission")},c=()=>{const g=TD();n&&n.addResult(g),t(`Quick Mission: ${g.action} ${g.target}`,"mission")},u=()=>{const g=XN();n&&n.addResult(g),t(`Villain: ${g.villain} wants to ${g.goal} via ${g.plan} using ${g.means}`,"mission")},h=()=>{const g=on(wt.scenarios),x={result:g.title,detail:g.desc};n&&n.addResult(x),t(`Scenario: ${g.title}`,"mission")},p=()=>{const g=ok(e.includePVOracles,e.includeStarforgedOracles);if(!g){const x={result:"No inciting incident sources enabled. Enable Perilous Void or Starforged in Settings (gear icon in the header)."};n&&n.addResult(x);return}n&&n.addResult(g),t(`Inciting Incident [${g.diceType} ${g.roll}]: ${g.incident}`,"mission")},m=e.includePVOracles||e.includeStarforgedOracles;return l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:`grid gap-1 sm:gap-2 ${m?"grid-cols-5":"grid-cols-4"}`,children:[l.jsx("button",{onClick:()=>a("detailed"),className:`px-1 sm:px-2 py-1 text-[10px] sm:text-xs font-orbitron uppercase border-2 transition-colors leading-tight ${r==="detailed"?"bg-accent-cyan text-bg-primary border-accent-cyan":"bg-transparent text-accent-cyan border-accent-cyan hover:bg-accent-cyan hover:text-bg-primary"}`,children:"Detailed"}),l.jsx("button",{onClick:()=>a("quick"),className:`px-1 sm:px-2 py-1 text-[10px] sm:text-xs font-orbitron uppercase border-2 transition-colors leading-tight ${r==="quick"?"bg-accent-cyan text-bg-primary border-accent-cyan":"bg-transparent text-accent-cyan border-accent-cyan hover:bg-accent-cyan hover:text-bg-primary"}`,children:"Quick"}),l.jsx("button",{onClick:()=>a("plot"),className:`px-1 sm:px-2 py-1 text-[10px] sm:text-xs font-orbitron uppercase border-2 transition-colors leading-tight ${r==="plot"?"bg-accent-red text-bg-primary border-accent-red":"bg-transparent text-accent-red border-accent-red hover:bg-accent-red hover:text-bg-primary"}`,children:"Plot"}),m&&l.jsx("button",{onClick:()=>a("inciting"),className:`px-1 sm:px-2 py-1 text-[10px] sm:text-xs font-orbitron uppercase border-2 transition-colors leading-tight ${r==="inciting"?"bg-accent-yellow text-bg-primary border-accent-yellow":"bg-transparent text-accent-yellow border-accent-yellow hover:bg-accent-yellow hover:text-bg-primary"}`,children:"Inciting"}),l.jsx("button",{onClick:()=>a("scenario"),className:`px-1 sm:px-2 py-1 text-[10px] sm:text-xs font-orbitron uppercase border-2 transition-colors leading-tight ${r==="scenario"?"bg-accent-yellow text-bg-primary border-accent-yellow":"bg-transparent text-accent-yellow border-accent-yellow hover:bg-accent-yellow hover:text-bg-primary"}`,children:"Scenario"})]}),r==="detailed"&&l.jsx(ge,{onClick:i,variant:"primary",className:"w-full",children:"Generate Detailed Mission"}),r==="quick"&&l.jsx(ge,{onClick:c,variant:"primary",className:"w-full",children:"Generate Quick Mission"}),r==="plot"&&l.jsx(ge,{onClick:u,variant:"danger",className:"w-full",children:"Generate Villain Plot"}),r==="inciting"&&l.jsx(ge,{onClick:p,variant:"secondary",className:"w-full",children:"Generate Inciting Incident"}),r==="scenario"&&l.jsx(ge,{onClick:h,variant:"secondary",className:"w-full",children:"Generate Campaign Scenario"})]})}function II(){const{addLog:t,gameState:e}=Ge(),n=Un(),r=()=>{const h=ZN(e.includePVOracles);n&&n.addResult(h),t(`NPC: ${h.name} - ${h.species} ${h.role} - ${h.demeanor}`,"mission")},a=()=>{const h=e.threatDie||1,p=RD(h);if(p.success){const m={theme:p.encounter.theme,actor:p.encounter.actor,themeRoll:p.encounter.themeRoll,actorRoll:p.encounter.actorRoll,checkRoll:p.checkRoll,total:p.total};n&&n.addResult(m),t(`Travel Encounter Check [${p.checkRoll}] + [${h}] = ${p.total}   ${p.encounter.theme} - ${p.encounter.actor}`,"mission")}else{const m={result:"No Travel Encounter",detail:`Rolled [${p.checkRoll}] + [${h}] = ${p.total}, need 12+`,checkRoll:p.checkRoll,threatDie:h,total:p.total,success:!1};n&&n.addResult(m),t(`Travel Encounter Check [${p.checkRoll}] + [${h}] = ${p.total}  No encounter`,"roll")}},i=()=>{const h=on(It.rebelContacts),p={result:"Rebel Contact",detail:h};n&&n.addResult(p),t(`Rebel Contact: ${h}`,"mission")},c=()=>{const h=on(It.weirdoAliens),p={result:"Weirdo Alien",detail:h};n&&n.addResult(p),t(`Weirdo Alien: ${h}`,"mission")},u=()=>{const h=on(It.reactions),p={result:"NPC Reaction",detail:h};n&&n.addResult(p),t(`Reaction: ${h}`,"roll")};return l.jsxs("div",{className:"space-y-4",children:[l.jsx(ge,{onClick:r,variant:"primary",className:"w-full text-base py-3",children:"GENERATE FULL NPC"}),l.jsx("div",{className:"text-xs text-gray-400 text-center font-orbitron -mt-2",children:"Name  Role  Species  Motivation  Secret  Trait  Demeanor"}),l.jsxs("div",{className:"pt-2 border-t border-accent-yellow/30",children:[l.jsx("div",{className:"text-xs text-gray-400 font-orbitron uppercase mb-2",children:"Quick Generators:"}),l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsx(ge,{onClick:a,variant:"ghost",className:"text-xs py-2",children:"Travel Encounter"}),l.jsx(ge,{onClick:u,variant:"ghost",className:"text-xs py-2",children:"Reaction"}),l.jsx(ge,{onClick:i,variant:"secondary",className:"text-xs py-2",children:"Rebel Contact"}),l.jsx(ge,{onClick:c,variant:"secondary",className:"text-xs py-2",children:"Weirdo Alien"})]})]})]})}function PI(){const{addLog:t,gameState:e}=Ge(),n=Un(),[r,a]=E.useState("planet"),i=()=>{const x=ek();n&&n.addResult(x),t(`Planet: ${x.name} - ${x.terrain}, ${x.weather}`,"mission")},c=()=>{const x=ED(e.includePVOracles);n&&n.addResult(x),t(`Settlement: ${x.name} (Leader: ${x.leader}) - ${x.knownFor}`,"mission")},u=()=>{const x=on(Le.planetFeatures),v={result:"Planet Feature",detail:x};n&&n.addResult(v),t(`Planet Feature: ${x}`,"mission")},h=()=>{const x=on(Le.backwaters),v={result:"Backwater Location",detail:x};n&&n.addResult(v),t(`Backwater: ${x}`,"mission")},p=()=>{const x=on(Le.backalleys),v={result:"Back Alley Detail",detail:x};n&&n.addResult(v),t(`Back Alley: ${x}`,"mission")},m=()=>{const x=on(Le.hiddenFeatures),v={result:"Hidden Feature",detail:x};n&&n.addResult(v),t(`Hidden Feature: ${x}`,"mission")},g=()=>{const x=on(Le.locationDangers),v={result:"Location Danger",detail:x};n&&n.addResult(v),t(`Danger: ${x}`,"mission")};return l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsx("button",{onClick:()=>a("planet"),className:`px-1 sm:px-2 py-1 text-[10px] sm:text-xs font-orbitron uppercase border-2 transition-colors leading-tight ${r==="planet"?"bg-accent-cyan text-bg-primary border-accent-cyan":"bg-transparent text-accent-cyan border-accent-cyan hover:bg-accent-cyan hover:text-bg-primary"}`,children:"Planet"}),l.jsx("button",{onClick:()=>a("settlement"),className:`px-1 sm:px-2 py-1 text-[10px] sm:text-xs font-orbitron uppercase border-2 transition-colors leading-tight ${r==="settlement"?"bg-accent-cyan text-bg-primary border-accent-cyan":"bg-transparent text-accent-cyan border-accent-cyan hover:bg-accent-cyan hover:text-bg-primary"}`,children:"Settlement"})]}),r==="planet"&&l.jsx(ge,{onClick:i,variant:"primary",className:"w-full",children:"Generate Planet"}),r==="settlement"&&l.jsx(ge,{onClick:c,variant:"primary",className:"w-full",children:"Generate Settlement"}),l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsx(ge,{onClick:u,variant:"ghost",className:"text-[10px] sm:text-xs py-2 px-2 leading-tight",children:"Planet Feature"}),l.jsx(ge,{onClick:h,variant:"ghost",className:"text-[10px] sm:text-xs py-2 px-2 leading-tight",children:"Backwater"}),l.jsx(ge,{onClick:p,variant:"ghost",className:"text-[10px] sm:text-xs py-2 px-2 leading-tight",children:"Back Alley"}),l.jsx(ge,{onClick:m,variant:"secondary",className:"text-[10px] sm:text-xs py-2 px-2 leading-tight whitespace-nowrap overflow-hidden text-ellipsis",children:"Hidden Feature"}),l.jsx(ge,{onClick:g,variant:"danger",className:"text-[10px] sm:text-xs py-2 px-2 col-span-2 leading-tight",children:"Location Danger"})]})]})}function zI(){const{addLog:t}=Ge(),e=Un(),n=()=>{const r=AD();e&&e.addResult(r),t(`Monster: ${r.name} - ${r.beast}`,"mission")};return l.jsx("div",{className:"space-y-4",children:l.jsx(ge,{onClick:n,variant:"danger",className:"w-full",children:"GENERATE MONSTER"})})}function UI(){const{addLog:t}=Ge(),e=Un(),n=()=>{const r=_D();e&&e.addResult(r),t(`Crime Lord: ${r.name}`,"mission")};return l.jsx("div",{className:"space-y-4",children:l.jsx(ge,{onClick:n,variant:"danger",className:"w-full",children:"GENERATE CRIME LORD"})})}function HI(){const{addLog:t,gameState:e}=Ge(),[n,r]=E.useState(null),[a,i]=E.useState(0),[c,u]=E.useState([]),[h,p]=E.useState(!1),m=()=>{const N=ie(20);let S,j,A;N<=10?(S="Small",j=ie(6)+2,A="d6+2"):N<=16?(S="Medium",j=ie(6)+5,A="d6+5"):(S="Large",j=ie(12)+5,A="d12+5");const $=j+1;r({size:S,sizeRoll:N,diceFormula:A,totalZones:$,baseZones:j}),i(1),u([]),p(!1),t(`Site generated: ${S} (${$} zones including Objective)`,"mission")},g=()=>{if(!n||h)return;const N=e.threatDie||1,S=hu(N),j={number:a,ship:S.ship,base:S.base,obstacleTriggered:S.obstacleTriggered,obstacle:S.obstacleTriggered?S.obstacle:null,threatRoll:S.threatRoll,threatTotal:S.threatTotal};u([...c,j]),a===n.totalZones?t(`OBJECTIVE ZONE reached! ${S.ship} / ${S.base}${S.obstacleTriggered?` - OBSTACLE: ${S.obstacle}`:""}`,"success"):t(`Zone ${a}: ${S.ship} / ${S.base}${S.obstacleTriggered?` - OBSTACLE: ${S.obstacle}`:""}`,"mission")},x=()=>{a<n.totalZones?i(a+1):(p(!0),t("Site exploration complete! Roll Escape Obstacle.","success"))},v=N=>{if(!n)return;const S=ie(N==="strong"?20:10),j=e.threatDie||1,A=hu(j);t(`Search (${N} hit) [${S}]: ${A.search}`,"roll")},w=()=>{const N=e.threatDie||1,S=hu(N);S.obstacleTriggered?t(`ESCAPE OBSTACLE: ${S.obstacle}`,"danger"):t("Escape: Clear path, no obstacles!","success")};return l.jsxs("div",{className:"space-y-4",children:[!n&&l.jsxs("div",{className:"text-center py-8 space-y-4",children:[l.jsx("div",{className:"text-accent-cyan/30 text-4xl mb-2",children:""}),l.jsx("p",{className:"text-gray-500 font-orbitron text-sm",children:"DANGEROUS LOCATION EXPLORER"}),l.jsx("p",{className:"text-gray-600 text-xs mb-4",children:"Procedurally explore ships, bases, and installations"}),l.jsxs(ge,{onClick:m,variant:"primary",className:"flex items-center gap-2 mx-auto",children:[l.jsx(PN,{className:"w-4 h-4"}),"Generate Site"]})]}),n&&l.jsxs("div",{className:"border-3 border-accent-cyan bg-bg-secondary p-4",children:[l.jsxs("div",{className:"flex items-center justify-between mb-3",children:[l.jsxs("div",{children:[l.jsxs("h3",{className:"font-orbitron font-bold text-accent-cyan text-lg",children:[n.size," Site"]}),l.jsxs("p",{className:"text-gray-400 text-xs",children:[n.totalZones," total zones (",n.diceFormula," + 1 Objective)"]})]}),l.jsx(ge,{onClick:m,variant:"ghost",className:"text-xs",children:"New Site"})]}),l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx(zw,{className:"w-4 h-4 text-accent-cyan"}),l.jsx("div",{className:"flex-1 flex gap-1",children:Array.from({length:n.totalZones}).map((N,S)=>{const j=S+1,A=c.some(R=>R.number===j),$=j===a,L=j===n.totalZones;return l.jsx("div",{className:`flex-1 h-2 border transition-all ${A?"bg-accent-cyan border-accent-cyan":$?"bg-accent-yellow border-accent-yellow animate-pulse":"bg-transparent border-accent-cyan/30"} ${L?"border-2":"border"}`},S)})}),l.jsxs("span",{className:"text-accent-cyan font-orbitron font-bold text-sm",children:[a,"/",n.totalZones]})]}),!h&&l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsxs(ge,{onClick:g,variant:"primary",className:"flex items-center gap-2 justify-center text-sm",disabled:c.some(N=>N.number===a),children:[l.jsx(zw,{className:"w-4 h-4"}),"Explore Zone ",a]}),l.jsxs(ge,{onClick:x,variant:"secondary",className:"flex items-center gap-2 justify-center text-sm",disabled:!c.some(N=>N.number===a),children:["Next Zone",l.jsx(ty,{className:"w-4 h-4"})]})]}),h&&l.jsxs(ge,{onClick:w,variant:"danger",className:"w-full flex items-center gap-2 justify-center",children:[l.jsx(ar,{className:"w-4 h-4"}),"Roll Escape Obstacle"]})]}),n&&c.some(N=>N.number===a)&&l.jsxs("div",{className:"border-2 border-accent-cyan bg-bg-primary p-4",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[l.jsx(JO,{className:`w-5 h-5 ${a===n.totalZones?"text-accent-yellow":"text-accent-cyan"}`}),l.jsx("h4",{className:"font-orbitron font-bold text-accent-cyan",children:a===n.totalZones?"OBJECTIVE ZONE":`Zone ${a}`})]}),c.filter(N=>N.number===a).map((N,S)=>l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Ship Feature:"}),l.jsx("p",{className:"text-text-primary font-orbitron",children:N.ship})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-400",children:"Base Feature:"}),l.jsx("p",{className:"text-text-primary font-orbitron",children:N.base})]})]}),l.jsxs("div",{className:`border-2 p-2 ${N.obstacleTriggered?"border-accent-red bg-accent-red/10":"border-accent-cyan/30"}`,children:[l.jsx("div",{className:"flex items-center gap-2 mb-1",children:l.jsxs("span",{className:"text-xs text-gray-400",children:["Obstacle Check: [",N.threatRoll,"] + Threat = ",N.threatTotal]})}),N.obstacleTriggered?l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(ar,{className:"w-4 h-4 text-accent-red"}),l.jsx("span",{className:"font-orbitron font-bold text-accent-red uppercase text-sm",children:N.obstacle})]}):l.jsx("p",{className:"text-gray-400 text-sm",children:"No obstacle (need 12+)"})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-gray-400 text-xs mb-2",children:"Search Zone:"}),l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsxs("button",{onClick:()=>v("strong"),className:"px-3 py-2 bg-transparent border-2 border-accent-cyan text-accent-cyan hover:bg-accent-cyan hover:text-bg-primary transition-all font-orbitron text-xs flex items-center gap-1 justify-center",children:[l.jsx(Hw,{className:"w-3 h-3"}),"Strong Hit (d20)"]}),l.jsxs("button",{onClick:()=>v("weak"),className:"px-3 py-2 bg-transparent border-2 border-accent-yellow text-accent-yellow hover:bg-accent-yellow hover:text-bg-primary transition-all font-orbitron text-xs flex items-center gap-1 justify-center",children:[l.jsx(Hw,{className:"w-3 h-3"}),"Weak Hit (d10)"]})]})]})]},S))]}),c.length>1&&l.jsxs("div",{className:"border-t-2 border-accent-cyan/30 pt-3",children:[l.jsx("h4",{className:"text-accent-cyan/70 font-orbitron text-xs uppercase mb-2",children:"Previous Zones:"}),l.jsx("div",{className:"space-y-1",children:c.filter(N=>N.number!==a).map(N=>l.jsxs("div",{className:"text-xs text-gray-500 font-orbitron",children:["Zone ",N.number,": ",N.ship," / ",N.base,N.obstacleTriggered&&l.jsxs("span",{className:"text-accent-red ml-2",children:["(",N.obstacle,")"]})]},N.number))})]})]})}function Q2(t){return`/star-dashborg/${t.startsWith("/")?t.slice(1):t}`}function VI(){const{addLog:t}=Ge(),e=Un(),[n,r]=E.useState(null),[a,i]=E.useState(!1),[c,u]=E.useState(null),h=KN.boost;E.useEffect(()=>{e&&e.clearVersion>0&&r(null)},[e?.clearVersion]);const p=()=>{if(a)return;i(!0),r(null);const m=ie(20),g=m-1;let x=0;const v=10,w=setInterval(()=>{const N=Math.floor(Math.random()*20);u(N),x++,x>=v&&(clearInterval(w),setTimeout(()=>{u(null),r(g),i(!1);const S={roll:m,result:"Visual Oracle",detail:h[g]};e&&e.addResult(S),t(`Visual Oracle (${m}): ${h[g]}`,"oracle")},200))},150)};return l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-5 gap-2 sm:gap-3",children:h.map((m,g)=>{const x=n===g,w=x||c===g,N=n!==null&&!x;return l.jsxs("div",{className:`relative border-2 p-2 sm:p-3 transition-all duration-200 ${w?"border-accent-cyan bg-accent-cyan/10 scale-105 glow-cyan":N?"border-gray-700 opacity-30":"border-gray-600 hover:border-accent-cyan/50"}`,children:[l.jsx("div",{className:"absolute top-0 left-0 text-[10px] sm:text-xs text-gray-500 font-orbitron px-1",children:g+1}),l.jsx("div",{className:"flex items-center justify-center",children:l.jsx("img",{src:Q2(`images/boost/icon_${String(g+1).padStart(2,"0")}.png`),alt:`Boost Oracle ${g+1}`,className:"w-full h-auto",style:{imageRendering:"crisp-edges"}})}),x&&l.jsx("div",{className:"absolute inset-0 border-2 border-accent-cyan animate-pulse pointer-events-none"})]},g)})}),l.jsx(ge,{onClick:p,disabled:a,variant:"primary",className:"w-full",children:a?"ROLLING...":"ROLL d20"}),n!==null&&l.jsxs("div",{className:"border-2 border-accent-cyan bg-bg-primary p-4 mt-4",children:[l.jsxs("div",{className:"text-accent-cyan font-orbitron text-sm uppercase mb-2",children:["Result #",n+1]}),l.jsx("div",{className:"typewriter text-accent-cyan text-base sm:text-lg",children:h[n]})]})]})}function FI(){const[t,e]=E.useState("core"),n=[{id:"core",label:"Core",color:"cyan"},{id:"story",label:"Story",color:"yellow"},{id:"world",label:"World",color:"cyan"},{id:"characters",label:"Characters",color:"yellow"},{id:"combat",label:"Combat",color:"red"}],r={cyan:{active:"bg-accent-cyan text-bg-primary border-accent-cyan",inactive:"bg-transparent text-accent-cyan border-accent-cyan hover:bg-accent-cyan hover:text-bg-primary"},yellow:{active:"bg-accent-yellow text-bg-primary border-accent-yellow",inactive:"bg-transparent text-accent-yellow border-accent-yellow hover:bg-accent-yellow hover:text-bg-primary"},red:{active:"bg-accent-red text-bg-primary border-accent-red",inactive:"bg-transparent text-accent-red border-accent-red hover:bg-accent-red hover:text-bg-primary"}};return l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-5 gap-1",children:n.map(a=>l.jsx("button",{onClick:()=>e(a.id),className:oe("px-1 sm:px-2 py-2 border-2 transition-all font-orbitron font-bold uppercase text-[10px] sm:text-xs leading-tight",t===a.id?r[a.color].active:r[a.color].inactive),children:a.label},a.id))}),l.jsxs("div",{className:"border-3 border-accent-yellow bg-bg-secondary p-4 overflow-y-auto flex-1",children:[t==="core"&&l.jsx(jl,{children:l.jsx(GI,{})}),t==="story"&&l.jsx(jl,{children:l.jsx(qI,{})}),t==="world"&&l.jsx(jl,{children:l.jsx(WI,{})}),t==="characters"&&l.jsx(jl,{children:l.jsx(KI,{})}),t==="combat"&&l.jsx(jl,{children:l.jsx(YI,{})})]})]})}function Cl({morale:t,label:e,onCheck:n}){const[r,a]=E.useState(null),i=()=>{const c=n(t);a(c),setTimeout(()=>a(null),3e3)};return l.jsxs("button",{onClick:i,className:"w-full px-3 py-2 bg-transparent border-2 border-accent-red text-accent-red hover:bg-accent-red hover:text-bg-primary transition-all font-orbitron text-sm flex items-center justify-between",children:[l.jsx("span",{children:e}),r&&l.jsx("span",{className:r.success?"text-accent-yellow font-bold":"text-accent-cyan",children:r.success?r.result:"HOLDS"})]})}function GI(){const t=Un();return l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"text-accent-cyan font-orbitron text-lg font-bold uppercase mb-4",children:"Core Solo Play Oracles"}),l.jsx("div",{className:"border-2 border-accent-cyan bg-bg-primary p-3",children:l.jsx(OI,{})}),t&&t.currentResult&&l.jsx(jc,{result:t.currentResult,variant:t.currentResult.result==="Scene Shakeup"?"yellow":t.currentResult.verb?"red":"cyan",currentIndex:t.currentIndex,totalResults:t.totalResults,onNavigate:t.navigateTo,onClear:t.clearHistory}),l.jsx(jt,{title:"Crit & Blunder (d4)",defaultOpen:!1,children:l.jsxs("div",{className:"space-y-4",children:[l.jsx(rt,{title:"Critical Hit Effect",table:dt.critBlunder.crit,variant:"cyan",diceType:"d4"}),l.jsx(rt,{title:"Blunder Effect",table:dt.critBlunder.blunder,variant:"red",diceType:"d4"})]})}),l.jsx(jt,{title:"Broken (When HP Hits 0)",defaultOpen:!1,children:l.jsx(rt,{title:"Roll D4 When Broken",table:Us.broken.map(e=>e.result),variant:"red",diceType:"d4"})}),l.jsx(jt,{title:"Visual Oracle / Boost (d20)",defaultOpen:!1,children:l.jsx(VI,{})})]})}function qI(){const{gameState:t}=Ge(),e=Un(),n=t.includePVOracles?"d30":"d20",r=()=>{const c=tk();return{result:"Scene",location:c.location,tone:c.tone,obstacle:c.obstacle,locationRoll:c.locationRoll,toneRoll:c.toneRoll,obstacleRoll:c.obstacleRoll}},a=()=>({result:"Campaign Title",titleType:"epic",...nk()}),i=()=>({result:"Episode Title",titleType:"episode",...rk()});return l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"text-accent-yellow font-orbitron text-lg font-bold uppercase mb-4",children:"Story & Plot Generators"}),e&&e.currentResult&&l.jsx(jc,{result:e.currentResult,variant:"yellow",currentIndex:e.currentIndex,totalResults:e.totalResults,onNavigate:e.navigateTo,onClear:e.clearHistory}),l.jsx(jt,{title:"Scene Generator (3d6)",defaultOpen:!0,children:l.jsx(rt,{title:"Generate Scene",table:[],variant:"cyan",diceType:"3d6",rollFunction:r})}),l.jsxs(jt,{title:`Opening Scene (${n})`,defaultOpen:!1,children:[l.jsx(rt,{title:"Opening Scene",table:dt.openingScene,variant:"cyan",diceType:n}),t.includePVOracles&&l.jsxs("div",{className:"mt-4 p-3 border-2 border-accent-yellow bg-bg-secondary",children:[l.jsx("div",{className:"text-accent-yellow font-orbitron text-xs uppercase mb-2",children:"Perilous Void Entries (21-30)"}),l.jsx("p",{className:"text-gray-300 text-sm",children:"Rolls 21-30 use structured incidents with follow-up questions from The Perilous Void."})]})]}),l.jsx(jt,{title:"Mission Generator",defaultOpen:!1,children:l.jsx(BI,{})}),l.jsx(jt,{title:"Title Generators",defaultOpen:!1,children:l.jsxs("div",{className:"space-y-4",children:[l.jsx(rt,{title:"Epic Campaign Title",table:[],variant:"yellow",diceType:"4d6",rollFunction:a}),l.jsx(rt,{title:"Episode/Session Title",table:[],variant:"cyan",diceType:"4d6",rollFunction:i})]})}),l.jsx(jt,{title:"Pre-Made Scenarios (d6)",defaultOpen:!1,children:l.jsx(rt,{title:"Campaign Scenario",table:wt.scenarios,variant:"yellow",diceType:"d6",formatResult:c=>({result:c.title,detail:c.desc})})})]})}function WI(){const{gameState:t}=Ge(),e=Un();return l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"text-accent-cyan font-orbitron text-lg font-bold uppercase mb-4",children:"World Building & Locations"}),e&&e.currentResult&&l.jsx(jc,{result:e.currentResult,variant:"cyan",currentIndex:e.currentIndex,totalResults:e.totalResults,onNavigate:e.navigateTo,onClear:e.clearHistory}),l.jsx(jt,{title:"World Generator",defaultOpen:!0,children:l.jsx(PI,{})}),l.jsx(jt,{title:"Obstacles & Mishaps",defaultOpen:!1,children:l.jsxs("div",{className:"space-y-4",children:[l.jsx(rt,{title:"Urgent Obstacle",table:Le.urgentObstacles,variant:"red",diceType:"d6"}),l.jsx(rt,{title:"General Mishap",table:Le.generalMishaps,variant:"yellow",diceType:"d6",formatResult:n=>({roll:n.roll,result:n.title,detail:n.desc})}),l.jsx(rt,{title:"Space Obstacle",table:Le.spaceObstacles,variant:"cyan",diceType:"d6"}),l.jsx(rt,{title:"Hyperspace Mishap",table:Le.hyperspaceMishaps,variant:"red",diceType:"d6"})]})}),l.jsx(jt,{title:"Site Explorer (Dangerous Locations)",defaultOpen:!1,children:l.jsx(HI,{})}),l.jsx(jt,{title:"Dangerous Location Quick Roll",defaultOpen:!1,children:l.jsx(rt,{title:"Ship/Base Location",table:[],variant:"cyan",diceType:"d20",rollFunction:()=>hu(t.threatDie||1)})})]})}function KI(){const{addLog:t,gameState:e}=Ge(),n=()=>{if(e.includePVOracles&&ie(2)===2){const c=xh();return t(`Family Name (PV) [${c.firstRoll}, ${c.secondRoll}]: ${c.fullSurname}`,"roll"),{result:"Family Name",detail:c.fullSurname,source:"perilousVoid",firstRoll:c.firstRoll,secondRoll:c.secondRoll}}else{const c=on(ut.familyNames);return t(`Family Name: ${c}`,"roll"),{result:"Family Name",detail:c}}},r=()=>{const c=OD();return t(`Space Opera Name [${c.firstRoll}, ${c.secondRoll}]: ${c.fullName}`,"roll"),c},a=()=>{const c=DD();return t(`PV Faction Name: ${c.fullName}`,"roll"),c},i=Un();return l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"text-accent-yellow font-orbitron text-lg font-bold uppercase mb-4",children:"Characters & Names"}),i&&i.currentResult&&l.jsx(jc,{result:i.currentResult,variant:"yellow",currentIndex:i.currentIndex,totalResults:i.totalResults,onNavigate:i.navigateTo,onClear:i.clearHistory}),l.jsx(jt,{title:"NPC Generator",defaultOpen:!0,children:l.jsx(II,{})}),l.jsx(jt,{title:"Name Generators",defaultOpen:!1,children:l.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[l.jsx(rt,{title:"Baseline Name",table:ut.baselineFirst,variant:"yellow",diceType:"d10"}),l.jsx(rt,{title:"Family Name",table:[],variant:"yellow",diceType:e.includePVOracles?"d10/2d100":"d10",rollFunction:n}),l.jsx(rt,{title:"Bot Name",table:ut.botNames,variant:"cyan",diceType:"d10"}),l.jsx(rt,{title:"Ship Name",table:ut.shipNames,variant:"cyan",diceType:"d10"}),l.jsx(rt,{title:"Legionary Name",table:ut.legionaryNames,variant:"red",diceType:"d10"}),l.jsx(rt,{title:"Bounty Hunter",table:ut.bountyHunterNames,variant:"red",diceType:"d8"}),l.jsx(rt,{title:"Crime Lord",table:ut.crimeLordNames,variant:"red",diceType:"d10"}),l.jsx(rt,{title:"Pirate Crew",table:ut.pirateCrewNames,variant:"red",diceType:"d10"}),e.includePVOracles&&l.jsxs(l.Fragment,{children:[l.jsx(rt,{title:"Space Opera",table:[],variant:"cyan",diceType:"2d100",rollFunction:r}),l.jsx(rt,{title:"PV Faction",table:[],variant:"cyan",diceType:"Template",rollFunction:a})]})]})})]})}function YI(){const{addLog:t}=Ge(),e=Un(),n=r=>{const a=ie(6),i=ie(6),c=a+i;if(c>r){const p=ie(6)<=4?"FLEES":"SURRENDERS";return t(`Morale Check [${a}, ${i}] = ${c} vs ${r}  FAIL! Enemy ${p}`,"danger"),{success:!0,total:c,result:p}}else return t(`Morale Check [${a}, ${i}] = ${c} vs ${r}  Holds firm`,"roll"),{success:!1,total:c}};return l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"text-accent-red font-orbitron text-lg font-bold uppercase mb-4",children:"Combat & Enemies"}),e&&e.currentResult&&l.jsx(jc,{result:e.currentResult,variant:"red",currentIndex:e.currentIndex,totalResults:e.totalResults,onNavigate:e.navigateTo,onClear:e.clearHistory}),l.jsx(jt,{title:"Morale Check (2D6)",defaultOpen:!1,children:l.jsxs("div",{className:"space-y-3",children:[l.jsx("p",{className:"text-gray-300 text-sm mb-3",children:"Roll when: Leader killed, Half group eliminated, or Single enemy at 1/3 HP"}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(Cl,{morale:6,label:"MRL 6 (Foot Soldiers)",onCheck:n}),l.jsx(Cl,{morale:7,label:"MRL 7 (Pirates, Minions)",onCheck:n}),l.jsx(Cl,{morale:8,label:"MRL 8 (Squad, Gangsters)",onCheck:n}),l.jsx(Cl,{morale:9,label:"MRL 9 (Officer, Beasts)",onCheck:n}),l.jsx(Cl,{morale:10,label:"MRL 10 (Elite, Leaders)",onCheck:n})]}),l.jsx("p",{className:"text-gray-400 text-xs mt-3",children:"Success (roll > MRL): Roll d6  1-4 Flees, 5-6 Surrenders"})]})}),l.jsx(jt,{title:"Enemy Generators",defaultOpen:!0,children:l.jsxs("div",{className:"space-y-4",children:[l.jsx(zI,{}),l.jsx("div",{className:"border-t-2 border-accent-red/30"}),l.jsx(UI,{})]})}),l.jsx(jt,{title:"Enemy Reference",defaultOpen:!1,children:l.jsxs("div",{className:"space-y-3",children:[l.jsx("div",{className:"text-sm font-orbitron text-accent-cyan uppercase mb-2",children:"Personnel"}),Fw.personnel.map((r,a)=>l.jsxs("div",{className:"border-2 border-accent-red p-2 bg-bg-primary",children:[l.jsx("div",{className:"text-accent-red font-orbitron font-bold",children:r.name}),l.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs text-gray-300 mt-1",children:[l.jsxs("div",{children:["HP: ",r.hp]}),l.jsxs("div",{children:["Morale: ",r.morale]}),l.jsxs("div",{children:["Armor: ",r.armor]}),l.jsxs("div",{children:["Weapon: ",r.weapon]}),l.jsx("div",{className:"col-span-2 text-gray-400",children:r.notes})]})]},a)),l.jsx("div",{className:"text-sm font-orbitron text-accent-cyan uppercase mt-4 mb-2",children:"Monsters"}),Fw.monsters.map((r,a)=>l.jsxs("div",{className:"border-2 border-accent-red p-2 bg-bg-primary",children:[l.jsx("div",{className:"text-accent-red font-orbitron font-bold",children:r.name}),l.jsxs("div",{className:"grid grid-cols-2 gap-1 text-xs text-gray-300 mt-1",children:[l.jsxs("div",{children:["HP: ",r.hp]}),l.jsxs("div",{children:["Morale: ",r.morale]}),l.jsxs("div",{children:["Armor: ",r.armor]}),l.jsxs("div",{children:["Weapon: ",r.weapon]}),l.jsx("div",{className:"col-span-2 text-gray-400",children:r.notes})]})]},a))]})}),l.jsx(jt,{title:"Equipment & Loot",defaultOpen:!1,children:l.jsxs("div",{className:"space-y-4",children:[l.jsx(rt,{title:"Melee Weapon",table:bm.meleeWeapons,variant:"cyan",diceType:"d10"}),l.jsx(rt,{title:"Ranged Weapon",table:bm.rangedWeapons,variant:"cyan",diceType:"d6"}),l.jsx(rt,{title:"General Gear",table:bm.gear,variant:"cyan",diceType:"d8"}),l.jsx(rt,{title:"Space Junk",table:jD.spaceJunk,variant:"yellow",diceType:"d8"})]})})]})}function OS(){return l.jsx(FI,{})}const JI={threatDie:{title:"Threat Die",description:"The Threat Die (TD) is used to ramp up the general sense of 'heat' or 'pressure' against your Rebel. Use a D6 (preferably of a different color from your other dice) to represent your TD. It starts at 1 and can increase to 6.",sections:[{heading:"Increase the Threat Die When...",type:"info",items:["A new threat presents itself or you begin a new Danger Clock.","Roll a Blunder.","Begin an Escape from a Dangerous Location."]},{heading:"Decrease the Threat Die When...",type:"success",items:["Complete a Mission Track or Resolve a Danger Clock.","Roll a Critical.","Your Rebel has a moment to catch their breath in a safe or hidden location."]},{heading:"When the Threat Die Reaches 6...",type:"danger",items:["Advance all Danger Clocks by one.","Or completely fill a single Danger Clock."],note:"This is a critical moment! The pressure has built to maximum. Choose one of the two options above, then reset the Threat Die as appropriate."}]},missionTracks:{title:"Mission Tracks",description:"Mission Tracks are a helpful way of keeping track of your Rebel's progress on their current missions. Some tracks will be long-term, some average length, and others very short. Each has a number of tracking boxes and a Difficulty Rating (DR).",sections:[{heading:"Setting Up a Mission",type:"info",items:["Decide on length/difficulty of the mission and draw the check boxes.","SHORT / EASY - four boxes - DR10","AVERAGE / NORMAL - six boxes - DR12","LONG / DIFFICULT - eight boxes - DR14","GALAXY SAVING - ten boxes - DR16"]},{heading:"Making Progress",type:"info",items:["Each time you make progress in the mission, check off one box.","It is up to you as the Player/GM to decide what constitutes progress.","If you've rolled a Strong Hit in a relevant Test, filling in two progress boxes would be appropriate."]},{heading:"Completing Missions",type:"success",content:"You may attempt to complete a mission at any point (even before the track is filled) by making a Progress Test: Roll D20 + Current Progress against the Mission's DR.",items:["SUCCESS - You've completed the mission.","FAIL - You're not done yet. Remove 1 progress and increase TD by 1."]},{heading:"Example Missions",type:"info",examples:[{type:"Long",description:"Revenge on the one who killed your family; re-stealing the ship you gambled away; corrupting a government official; building a hidden base."},{type:"Average",description:"Repairing a badly damaged bot; delivering contraband; building a Blazer Sword."},{type:"Short",description:"Dismantling a rival's ship; hacking into a console; navigating an asteroid field."}]}]},dangerClocks:{title:"Danger Clocks",description:"Danger Clocks function much like Mission Tracks, but operate for the wider world against your Rebel. When something in the world presents itself that directly opposes your Rebel's existence, start a Danger Clock for it. Clocks are broken into 4, 6, 8, or 10 segments.",sections:[{heading:"Advance the Danger Clock When...",type:"danger",items:["Fail a Test related to the Clock (even if you use a Destiny Point to reroll).","Roll a Scene Shakeup or new Event.","Enter a new scene with an unresolved Danger Clock."]},{heading:"Resolving a Danger Clock",type:"danger",content:"When a Clock is filled, the result happens. Reserve Danger Clocks for events that will present very challenging situations.",items:["When a Clock is filled, the consequence occurs immediately.","When a Mission is completed and danger is avoided, remove the Danger Clock, regardless of how far along it has progressed."]},{heading:"Example Danger Clocks",type:"info",examples:[{segments:4,description:"Legionary reinforcements are on the way"},{segments:6,description:"The reactor core is overheating"},{segments:8,description:"The ion storm rages around your ship"},{segments:10,description:"An Elite Bounty Hunter is hunting you down"}]}]}};function QI({isOpen:t,onClose:e,initialTab:n="threatDie"}){const r=[{id:"threatDie",label:"Threat Die",icon:""},{id:"missionTracks",label:"Mission Tracks",icon:""},{id:"dangerClocks",label:"Danger Clocks",icon:""}],[a,i]=E.useState(n);if(E.useEffect(()=>{i(n)},[n]),E.useEffect(()=>{if(!t)return;const p=m=>{Qa()||m.key==="Escape"&&e()};return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[t,e]),E.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),!t)return null;const c=JI[a],u=p=>{switch(p){case"danger":return l.jsx(ar,{className:"w-5 h-5 text-accent-red"});case"success":return l.jsx(DN,{className:"w-5 h-5 text-accent-cyan"});default:return l.jsx(oO,{className:"w-5 h-5 text-accent-yellow"})}},h=p=>{switch(p){case"danger":return"border-accent-red";case"success":return"border-accent-cyan";default:return"border-accent-yellow"}};return l.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-end",children:[l.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:e}),l.jsxs("div",{className:"relative w-full max-w-[420px] h-full bg-bg-primary border-l-3 border-accent-cyan flex flex-col slide-in-right shadow-2xl",children:[l.jsx("div",{className:"absolute inset-0 pointer-events-none scanlines opacity-30"}),l.jsxs("div",{className:"relative z-10 flex items-center justify-between px-6 py-4 border-b-3 border-accent-cyan bg-bg-secondary",children:[l.jsx("h2",{className:"font-orbitron font-bold text-xl text-accent-cyan uppercase",children:"Game Help"}),l.jsx("button",{onClick:e,className:"p-2 hover:bg-accent-cyan hover:text-bg-primary transition-all duration-200 border-2 border-accent-cyan","aria-label":"Close help",children:l.jsx(Er,{className:"w-5 h-5"})})]}),l.jsx("div",{className:"relative z-10 flex border-b-3 border-accent-cyan bg-bg-secondary",children:r.map(p=>l.jsxs("button",{onClick:()=>i(p.id),className:`flex-1 px-3 py-3 font-orbitron text-xs uppercase transition-all duration-200 border-r-2 last:border-r-0 ${a===p.id?"bg-accent-cyan text-bg-primary font-bold":"bg-transparent text-text-primary hover:bg-accent-cyan/20 border-accent-cyan"}`,children:[l.jsx("span",{className:"block text-lg mb-1",children:p.icon}),l.jsx("span",{className:"block leading-tight",children:p.label})]},p.id))}),l.jsxs("div",{className:"relative z-10 flex-1 overflow-y-auto p-6 space-y-6",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"font-orbitron font-bold text-2xl text-accent-yellow mb-3",children:c.title}),l.jsx("p",{className:"text-text-primary leading-relaxed",children:c.description})]}),c.sections.map((p,m)=>l.jsxs("div",{className:`border-3 ${h(p.type)} p-4 space-y-3 bg-bg-secondary/50`,children:[l.jsxs("div",{className:"flex items-start gap-3",children:[u(p.type),l.jsx("h4",{className:"font-orbitron font-bold text-lg text-accent-cyan uppercase flex-1",children:p.heading})]}),p.content&&l.jsx("p",{className:"text-text-primary leading-relaxed pl-8",children:p.content}),p.items&&l.jsx("ul",{className:"space-y-2 pl-8",children:p.items.map((g,x)=>l.jsxs("li",{className:"text-text-primary leading-relaxed flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-yellow mt-1",children:""}),l.jsx("span",{className:"flex-1",children:g})]},x))}),p.examples&&l.jsx("div",{className:"space-y-3 pl-8",children:p.examples.map((g,x)=>l.jsxs("div",{className:"text-text-primary",children:[g.type&&l.jsxs("span",{className:"font-orbitron font-bold text-accent-yellow",children:[g.type,":"," "]}),g.segments&&l.jsxs("span",{className:"font-orbitron font-bold text-accent-red",children:[g.segments," Segments:"," "]}),l.jsx("span",{className:"text-gray-300",children:g.description})]},x))}),p.note&&l.jsx("div",{className:"pl-8 pt-2 border-t-2 border-accent-yellow/30 mt-3",children:l.jsx("p",{className:"text-accent-yellow italic text-sm leading-relaxed",children:p.note})})]},m))]}),l.jsx("div",{className:"relative z-10 px-6 py-3 border-t-3 border-accent-cyan bg-bg-secondary text-center",children:l.jsxs("p",{className:"text-gray-500 text-xs font-orbitron uppercase",children:["Press ",l.jsx("span",{className:"text-accent-cyan",children:"ESC"})," to close"]})})]})]})}const X2={functions:[{name:"Protocol",description:"Translate any language, parse customs. Know what to say on DR10 PRS test."},{name:"Porter",description:"Roll with advantage for lifting and hauling tasks."},{name:"Supervisor",description:"Oversee tiny rolling repair bot (rarely does what you ask). Flip coin. D4 HP, D2 damage."},{name:"Computer Interface",description:"Plug into terminals to negotiate with computer systems. PRS test. Feedback shock (D4) on blunder."},{name:"Power",description:"Walking battery backup. Power/recharge/jumpstart moderate devices. Super charge on DR14 KNW test."},{name:"Surveillance",description:"Float with weak antigrav. Survey and transmit with sensors. Disadvantage on STR tests."}],malfunctions:[{name:"Exterminate",description:"When you roll two blunders in a row, rush to attack a random individual within sight."},{name:"Warning Critical Error",description:"When you roll a blunder on a test of DR14 or higher, you freeze in place."},{name:"Bugged Audio",description:"When you roll a blunder on a PRS test, you can only repeat the last word of your previous sentence."},{name:"Archived Memories",description:"When you roll a blunder on a test that aligns with your Function, reroll for a new Function."},{name:"Trick Leg",description:"When you roll a blunder on an AGI test, your lower leg dislocates again."},{name:"Screw Loose",description:"Loose components squeak and rattle. Disadvantage on AGI tests for stealth."}],upgrades:["Retractable Bone Saw (D8 damage)","Smuggling Compartment (houses mind-altering snuff-dust)","Comm Scrambler (DR12 KNW test)","Legion Cypher (flip coin to see if codes work)","Trash Compactor Torso (crush handheld objects into cubes)","Self Destruct (D8 damage blast, only head survives with 2HP)"]},Wg={skills:[{name:"Rough Rider",description:"Ride any creature you can straddle. Roll PRS with advantage to tame wild beasts."},{name:"Escape Artist",description:"Been in and out of jail cells. Roll AGI with advantage to slip bonds and pick locks."},{name:"Deserter",description:"Know how Legion thinks and talks. Roll KNW with advantage when anticipating or impersonating Legionnaires."},{name:"Tracker",description:"With right tools, always tell if prey has been in area and where they went."},{name:"Bouncer",description:"Pain don't hurt. Roll STR with advantage when wrestling/shoving. D8 damage with bare hands."},{name:"Armorer",description:"Never take off helmet in front of anyone. Start with Quantum Armor (Tier 3, -D6 damage)."}],heirlooms:[{name:"Grapple Whip",description:"Climb and swing. Test Morale to bind creature. Rebels roll with advantage to defend against bound creatures."},{name:"Flamethrower",description:"D6 damage. If you roll 6 for damage, target is on fire for 1 more round."},{name:"Jetpack",description:"You can fly. Every use, roll D20. On blunder, out of fuel."},{name:"Ray Shielding",description:"Ignore first damage from blaster fire. Resets on rest."},{name:"Sawed Off Repeater",description:"2D4 damage. On blunder, jams and can only be fixed on rest."},{name:"Disintegration Rifle",description:"D12 damage. If you roll 8+ on damage, enemy makes Morale test. On blunder, rifle disintegrates."}],softSpots:["Helpless little creatures","Youthful whippersnappers","Simple folk making ends meet","Mistreated bots","Elderly curmudgeons","Wounded veterans"]},Kg={arts:[{name:"Mind Muddle",description:"Cloud brains of simple-minded creatures and issue simple hypnotic commands. (KNW test)"},{name:"Magi Hand",description:"Reach out with powers to push, pull, and grasp objects and people. (KNW test)"},{name:"Blaster Deflect",description:"Instead of defense roll, deflect blaster bolts with Blazer Sword. Make damage roll against enemy with their own weapon damage. (KNW test)"},{name:"Healing Touch",description:"Touch a creature of flesh and bone to restore D6 HP. (KNW test)"}],dragoonNemeses:["Tragen Foul the Beheader","Manus Giant the Strangler","Gigus Noldo the Ripper","X-66 the Bot","Lord Commander Vortex","Roll 2 Nemeses"],burnerIdentities:[{name:"Powder Miner",description:"Coughing fit when you fail AGI test."},{name:"Wasteland Scavenger",description:"Freeze for a moment when you fail PRS test."},{name:"Vapor Farmer",description:"Back seizes up when you fail STR test."},{name:"Vagabond",description:"Need help to get back to feet when you fail AGI test."},{name:"Reclusive Healer",description:"Must help everyone who asks, DR14 PRS test to resist."},{name:"Barfly",description:"Must answer slightest insult with your own, DR14 PRS test to resist."}]},XI={tricks:["Ceramic Knife (D4 damage, invisible to weapon scans)","Eyeball Blaster (hidden under eyepatch, one shot, D6 damage)","Psychogun (mechanical arm with bioelectrical cannon, D8 damage)","Monofilament Garrote (retractable wire, 2 STR tests to subdue)","Sonic Grenade (looks like comm unit, deafening stunning blast)","Vapor Tooth (bite down to fill room with thick fog)"],contraband:[{name:"Engineered Organs",description:"Blood is leaking out. D6 Containment Points."},{name:"Frozen Bone Crabs",description:"Will thaw and awaken. D6 Containment Points."},{name:"Particle Warheads",description:"Radioactive. D6 Containment Points."},{name:"Hyper Mushrooms",description:"Rotting smell and consciousness-altering gas. D6 Containment Points."},{name:"Gravity Magnet",description:"Nullification field deteriorating, will become black hole. D6 Containment Points."},{name:"Rogue Bot Mind",description:"Will eventually gain control of all machines in signal range. D6 Containment Points."}],crimeLords:["Don Crom","Jojo 'The Borg'","Moon Queen Zala","'Stumpy' Skadeen","'Meat Hook' Max","Shadow Master Vu"]},Z2={scratchBuilds:[{name:"Hyperspace Transporter Pack",description:"Roll KNW to teleport to visible location. Disadvantage if unclear. On blunder, pack and D6 items lost. (bulky, shoddy)"},{name:"Zero Blaster",description:"Cover surface in ice. Freeze target solid with sustained blast for 3 rounds. (bulky, shoddy)"},{name:"Gravity Disruptor",description:"Negate gravity for just a moment on single target you can touch. (bulky, shoddy)"},{name:"Cloaking Device",description:"Make person invisible or group mostly invisible (DR8 Hiding/Stealth, DR10 for small group). (bulky, shoddy)"},{name:"Machine Mind Dominator",description:"Test enemy Bot's Morale to turn them friendly. (bulky, shoddy)"},{name:"Devastator Fist",description:"Crush armor and tear bulkheads (D6 damage, ignores armor). Roll STR. On blunder, destroyed in energy blast (D8). (bulky, shoddy)"}],hyperFixations:["Hologram Emitters","Bot Optical Lenses","Space Suit Respirators","Hyperdrive Ignition Switches","High Explosives","Speeder Hood Ornaments"]},ZI={tragedies:["Freak mechanical explosion took out auntie and uncle while scavenging components.","Gamgam and grampy caught in random blaster fire exchange during academy exams.","PL-84 caretaker bot took deadly midnight tumble off bridge where you were discovered.","Circus troupe that raised you were trampled in zanthadon stampede during market day.","Wise old healer who took custody of you was beheaded by unknown assailant.","AI that ran derelict moonbase contracted terminal virus and opened outside hatch."],heirlooms:[{name:"Magi Blazer Sword Hilt",description:"Left by your parent. 2D6 damage. (See Dragoon Test p.8)"},{name:"Polished Breastplate",description:"Ancient armor set with family crest engraved. Tier 2, -D4 armor."},{name:"Pair of Blaster Pistols",description:"Badge your mamma once worn to protect galaxy. 2D4 damage."},{name:"Disintegrator Rifle",description:"Your uncle used as freedom fighter. D8 damage, takes round to reload."},{name:"Coded Research Notes",description:"Your parents were working on before they disappeared. Reveals weak points on Legion Superweapon when analyzed."},{name:"Signet Ring",description:"Of your once noble house. Can still grant favor when shown to right nostalgic fool."}],knacks:[{name:"Burdogs Body",description:"Used to being bossed around. Roll with your highest stat when following another Rebel's bossy instructions."},{name:"Busker",description:"Never go anywhere without techno-harp. DR10 PRS test to cause obnoxious musical distraction."},{name:"Bootshiner",description:"Look average and unimportant. DR10 PRS test to blend in with the help."},{name:"Cutpurse",description:"Have sticky fingers. DR10 AGI to swipe item off unsuspecting mark."},{name:"Tinkerer",description:"Make friends with bots easily. Understand their machine speech. Roll PRS with advantage when being friendly to non-hostile bots."},{name:"Mucker",description:"At home in garbage and gutters of galaxy. DR10 AGI test to search for trinket."}]},eC={bot:[{id:"thisMeansWar",name:"THIS MEANS WAR",description:"Roll a Heirloom Weapon from the Bounty Hunter Class.",type:"roll",effect:"Gain a random Bounty Hunter Heirloom Weapon",implementation:"roll_bounty_hunter_heirloom",repeatable:!0},{id:"portableBotMind",name:"PORTABLE BOT MIND",description:"You can insert your consciousness and memory into another bot body. The process destroys the circuits of the body you leave. No take backs.",type:"passive",effect:"Ability to transfer consciousness to other bot bodies (one-way)",implementation:"passive_ability",repeatable:!1},{id:"legionTransmission",name:"LEGION TRANSMISSION",description:"On your next mission, you intercept a Legion transmission that reveals critical info about your enemy.",type:"mission",effect:"Next mission: intercept critical Legion intelligence",implementation:"one_time_bonus",repeatable:!0}],bountyHunter:[{id:"inheritance",name:"INHERITANCE",description:"A fellow Bounty Hunter bought the vapor farm. A bot delivers their effects. Roll an additional Heirloom Weapon (reroll if you already have it).",type:"roll",effect:"Gain another Heirloom Weapon",implementation:"roll_bounty_hunter_heirloom",repeatable:!0},{id:"thisIsTheWay",name:"THIS IS THE WAY",description:"You adopt a foundling to train as a Bounty Hunter. (HP 8, Morale 7, Tier 1 Armor -D2, Zap Gun D4) The GM makes morale checks; if they fail, the foundling retreats.",type:"companion",effect:"Gain Foundling companion (HP 8, Morale 7, Armor T1, Zap Gun D4)",implementation:"add_companion",repeatable:!1,companionStats:{name:"Foundling",hp:8,morale:7,armor:1,weapon:"Zap Gun (D4 damage)"}},{id:"friendsInLowPlaces",name:"FRIENDS IN LOW PLACES",description:"You always know a guy in the system who owes you big. Tell the GM who it is and how you met. Roll PRS to make contact. On a blunder, they are a Legionary stooge that's already ratted on you.",type:"passive",effect:"Network of contacts in each system (PRS roll to activate)",implementation:"passive_ability",repeatable:!1}],magiKnight:[{id:"strikeMeDown",name:"STRIKE ME DOWN",description:"When you are struck down, bestow your Magi Arts upon a non-bot character in the group.",type:"passive",effect:"On death, transfer Magi Arts to another character",implementation:"passive_ability",repeatable:!1},{id:"foresight",name:"FORESIGHT",description:"Regain 1 Destiny Point if you correctly guess the number you will roll on your test.",type:"passive",effect:"Predict roll result to regain Destiny Point",implementation:"passive_ability",repeatable:!1},{id:"highGround",name:"HIGH GROUND",description:"When your Dragoon Nemesis finds you, you have advantage on the first Attack and Defense roll of the combat.",type:"passive",effect:"Advantage on first attack/defense vs Dragoon Nemesis",implementation:"passive_ability",repeatable:!1}],smuggler:[{id:"delusionsOfGrandeur",name:"DELUSIONS OF GRANDEUR",description:"Roll with advantage when you throw your name around or lie shamelessly about yourself.",type:"passive",effect:"Advantage on PRS tests when boasting or lying about yourself",implementation:"passive_ability",repeatable:!1},{id:"beBygones",name:"BE BYGONES",description:'An "old friend" or bounty hunter comes looking to bury the hatchet and work for you. HP:10 Morale: 8 Tier 1 Armor: -D2 Blaster: D6 damage.',type:"companion",effect:"Gain ally companion (HP 10, Morale 8, Armor T1, Blaster D6)",implementation:"add_companion",repeatable:!1,companionStats:{name:"Reformed Rival",hp:10,morale:8,armor:1,weapon:"Blaster (D6 damage)"}},{id:"alwaysShootsFirst",name:"ALWAYS SHOOTS FIRST",description:"Free attack at the start of a blaster fight.",type:"passive",effect:"Free attack at start of blaster combat",implementation:"passive_ability",repeatable:!1}],technician:[{id:"moreMachine",name:"MORE MACHINE",description:"Roll a Bot Function from the Bot class.",type:"roll",effect:"Gain a random Bot Function",implementation:"roll_bot_function",repeatable:!0},{id:"superweaponSavant",name:"SUPERWEAPON SAVANT",description:"Recreate a portable facsimile of a Legionary Superweapon that you've seen up close (has the bulky and shoddy equipment tags).",type:"craft",effect:"Create portable version of Legion Superweapon (bulky, shoddy)",implementation:"one_time_craft",repeatable:!0},{id:"alwaysCarryASpare",name:"ALWAYS CARRY A SPARE",description:"When tinkering with technology, you may reroll the first blunder on a KNW test.",type:"passive",effect:"Reroll first blunder on KNW tests when tinkering",implementation:"passive_ability",repeatable:!1}],youngster:[{id:"rebelRenown",name:"REBEL RENOWN",description:"Roll a Particular Set Of Skills from the Bounty Hunter Class. It replaces your Knack, if you still have one.",type:"roll",effect:"Gain Bounty Hunter skill (replaces Knack)",implementation:"roll_bounty_hunter_skill",repeatable:!1},{id:"awakening",name:"AWAKENING",description:"Learn one Magi Art and roll one Dragoon Nemesis from the Magi Knight Class to hunt you.",type:"roll",effect:"Gain Magi Art + Dragoon Nemesis",implementation:"roll_magi_awakening",repeatable:!1},{id:"prettyHandy",name:"PRETTY HANDY",description:"Roll a Scratch Build from the Technician Class. It replaces your Knack, if you still have one.",type:"roll",effect:"Gain Scratch Build (replaces Knack)",implementation:"roll_scratch_build",repeatable:!1}]};function eP(t,e=[]){return(eC[t]||[]).filter(r=>r.repeatable?!0:!e.includes(r.id))}function Gy(t,e){const n=t.galaxySavesClaimed||t.galaxy_saves_claimed||0;return Math.max(0,e-n)}function tP(t){return Object.entries(t).filter(([,e])=>e<6).map(([e])=>e)}function Ji(t){const e=Math.floor(Math.random()*t.length);return t[e]}function nP(t,e){const n=eC[e]?.find(a=>a.id===t);if(!n)return null;const r={advancement:n,rolledFeature:null,companion:null};switch(n.implementation){case"roll_bounty_hunter_heirloom":r.rolledFeature={type:"heirloom",...Ji(Wg.heirlooms)};break;case"roll_bounty_hunter_skill":r.rolledFeature={type:"skill",...Ji(Wg.skills)};break;case"roll_bot_function":r.rolledFeature={type:"function",...Ji(X2.functions)};break;case"roll_magi_awakening":r.rolledFeature={type:"magiAwakening",art:Ji(Kg.arts),nemesis:Ji(Kg.dragoonNemeses)};break;case"roll_scratch_build":r.rolledFeature={type:"scratchBuild",...Ji(Z2.scratchBuilds)};break;case"add_companion":r.companion=n.companionStats;break}return r}function Ne(t){return Math.floor(Math.random()*t)+1}function qy(t,e){let n=0;for(let r=0;r<t;r++)n+=Ne(e);return n}function tC(t,e,n=0){const r=qy(t,e)+n;return Math.max(1,r)}function rP(t){return t<=4?-3:t<=6?-2:t<=8?-1:t<=12?0:t<=14?1:t<=16?2:3}function Sr(t,e,n=0){const r=tC(t,e,n);return rP(r)}function bo(){return Ne(20)}function sP(){const t=bo(),e=bo();return Math.max(t,e)}function aP(){const t=bo(),e=bo();return Math.min(t,e)}function iP(t,e,n=!1,r=!1){let a;n?a=sP():r?a=aP():a=bo();const i=a+t,c=i>=e;return{roll:a,total:i,success:c,crit:a===20,blunder:a===1,dr:e}}function oP(t,e={count:1,sides:8,modifier:0}){const n=tC(e.count,e.sides,e.modifier);return e.ignoreSTR?Math.max(1,n):Math.max(1,n+t)}function lP(t={count:1,sides:2}){return qy(t.count,t.sides)}const Wy=t=>t>0?`+${t}`:t===0?"0":`${t}`,cP=t=>t>=2?"text-accent-green":t>=1?"text-accent-cyan":t===0?"text-text-primary":t>=-1?"text-accent-yellow":"text-accent-red",nC=E.memo(({roll:t,isFading:e})=>{const{d20Roll:n,modifier:r,total:a,isCrit:i,isBlunder:c}=t,u=()=>i?"text-accent-yellow text-glow-yellow":c?"text-accent-red text-glow-red":"text-accent-cyan",h=e?"stat-result-fade":"stat-result-reveal";return l.jsxs("div",{className:`flex flex-col items-center justify-center h-full ${h}`,children:[l.jsxs("div",{className:"text-[9px] font-mono text-text-secondary mb-0.5",children:["[",n,"]"]}),l.jsx("div",{className:`text-2xl font-orbitron font-bold leading-none ${u()}`,children:a}),l.jsx("div",{className:"text-[9px] font-mono text-text-secondary mt-0.5",children:Wy(r)})]})});nC.displayName="RollResultOverlay";const rC=E.memo(({statName:t,value:e})=>l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"text-[10px] font-mono text-text-secondary uppercase mb-0.5",children:t}),l.jsx("div",{className:`text-xl font-orbitron font-bold leading-none ${cP(e)}`,children:Wy(e)})]}));rC.displayName="StatDisplay";function dP({character:t}){const{user:e}=Ya(),{character:n}=as(),{gameState:r,addLog:a}=Ge(),[i,c]=E.useState(null),[u,h]=E.useState(!1),[p,m]=E.useState(!1),[g,x]=E.useState(t),v=E.useRef(g),w=E.useRef(null),N=E.useRef(null),S=E.useRef(null);E.useEffect(()=>{x(t),v.current=t},[t]),E.useEffect(()=>()=>{N.current&&clearTimeout(N.current),S.current&&clearTimeout(S.current)},[]);const j=e?.id===t.user_id,A=j&&n?n:g,$=r.ship?.galaxiesSaved||0,L=Gy(A,$),R=L>0,M=async(J,_)=>{try{const{data:V,error:F}=await Fe.from("characters").update({[J]:_}).eq("id",A.id).select().single();if(F)throw F;if(V){const O={...v.current,[J]:_};x(O),v.current=O}return V}catch(V){throw console.error("Error updating character field:",V),V}},D=A.hp_current/A.hp_max*100,I=async J=>{if(!j)return;const _=v.current,V=Math.max(0,Math.min(_.hp_max,_.hp_current+J));await M("hp_current",V)},W=async J=>{if(!j)return;const V=v.current.destiny_points||0,F=Math.max(0,V+J);await M("destiny_points",F)},ue=async J=>{if(!j)return;const _=v.current,V=Math.max(0,_.bits+J);await M("bits",V)},he=(J,_)=>{if(!j)return;N.current&&(clearTimeout(N.current),N.current=null),S.current&&(clearTimeout(S.current),S.current=null),m(!1);const V=bo(),F=V+_,O=V===20,K=V===1,Z=Date.now();w.current={statName:J,d20Roll:V,modifier:_,total:F,isCrit:O,isBlunder:K,timestamp:Z},c(J),setTimeout(()=>{c(null),h(!0),requestAnimationFrame(()=>{let X=`${J.toUpperCase()} Test: [${V}] ${Wy(_)} = ${F}`;O?X+="  CRITICAL ":K&&(X+="  FUMBLE "),a(X,O?"success":K?"danger":"roll")}),N.current=setTimeout(()=>{m(!0),S.current=setTimeout(()=>{h(!1),m(!1),w.current=null},300)},3e3)},400)};return l.jsxs("div",{className:`border rounded p-2 transition-all ${j?"bg-bg-primary border-accent-yellow shadow-lg shadow-accent-yellow/20":"bg-bg-primary/50 border-accent-cyan/30"}`,children:[l.jsx("div",{className:"flex items-center justify-between mb-2",children:l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center gap-1.5",children:[l.jsxs("h4",{className:`font-orbitron font-bold text-sm truncate ${j?"text-accent-yellow":"text-text-primary"}`,children:[A.name||"Unnamed Rebel",j&&l.jsx("span",{className:"ml-1 text-[9px] text-accent-yellow/60",children:"(YOU)"})]}),R&&l.jsxs("div",{className:"flex items-center gap-0.5 px-1 py-0.5 bg-purple-900/40 border border-purple-500 rounded animate-pulse flex-shrink-0",children:[l.jsx(pr,{className:"w-2.5 h-2.5 text-purple-400"}),l.jsx("span",{className:"text-[9px] font-orbitron font-bold text-purple-300",children:L})]})]}),l.jsxs("p",{className:"text-text-secondary text-[10px] font-mono capitalize",children:[A.class_name||A.class,"  ",A.species]})]})}),l.jsxs("div",{className:"bg-bg-primary border border-accent-red rounded p-1.5",children:[l.jsxs("div",{className:"flex items-center justify-between mb-1",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(aO,{className:"w-2.5 h-2.5 text-accent-red"}),l.jsx("span",{className:"text-[10px] font-mono text-text-secondary uppercase",children:"HP"})]}),l.jsxs("div",{className:"font-orbitron font-bold text-accent-red text-sm",children:[A.hp_current," / ",A.hp_max]})]}),l.jsx("div",{className:"relative h-1 bg-bg-secondary rounded-full overflow-hidden mb-1",children:l.jsx("div",{className:"absolute top-0 left-0 h-full bg-gradient-to-r from-accent-red to-accent-red/60 transition-all duration-300",style:{width:`${D}%`}})}),j&&l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("button",{onClick:()=>I(-5),disabled:A.hp_current===0,className:"flex-1 px-1 py-0.5 bg-accent-red/20 border border-accent-red text-accent-red text-[9px] font-orbitron hover:bg-accent-red hover:text-bg-primary transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:"-5"}),l.jsx("button",{onClick:()=>I(-1),disabled:A.hp_current===0,className:"flex-1 px-1 py-0.5 bg-accent-red/20 border border-accent-red text-accent-red text-[9px] font-orbitron hover:bg-accent-red hover:text-bg-primary transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:l.jsx(bc,{className:"w-2 h-2 mx-auto"})}),l.jsx("button",{onClick:()=>I(1),disabled:A.hp_current===A.hp_max,className:"flex-1 px-1 py-0.5 bg-accent-cyan/20 border border-accent-cyan text-accent-cyan text-[9px] font-orbitron hover:bg-accent-cyan hover:text-bg-primary transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:l.jsx(ir,{className:"w-2 h-2 mx-auto"})}),l.jsx("button",{onClick:()=>I(5),disabled:A.hp_current===A.hp_max,className:"flex-1 px-1 py-0.5 bg-accent-cyan/20 border border-accent-cyan text-accent-cyan text-[9px] font-orbitron hover:bg-accent-cyan hover:text-bg-primary transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:"+5"})]})]}),j&&l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"grid grid-cols-4 gap-1 mt-2",children:Object.entries(A.stats).map(([J,_])=>{const V=w.current,F=u&&V?.statName===J;let O="border-accent-cyan/30 hover:border-accent-cyan hover:shadow-[0_0_8px_rgba(0,240,255,0.3)]";return F&&V&&(V.isCrit?O="border-accent-yellow shadow-[0_0_12px_rgba(255,252,0,0.6)]":V.isBlunder?O="border-accent-red shadow-[0_0_12px_rgba(255,0,60,0.6)]":O="border-accent-cyan shadow-[0_0_8px_rgba(0,240,255,0.5)]"),l.jsx("button",{onClick:()=>he(J,_),disabled:i===J,className:`bg-bg-primary border ${O} transition-colors transition-shadow duration-200 p-1.5 text-center group disabled:animate-pulse`,children:F&&V?l.jsx(nC,{roll:V,isFading:p},V.timestamp):l.jsx(rC,{statName:J,value:_})},J)})}),l.jsxs("div",{className:"flex items-center gap-2 bg-bg-primary border border-accent-yellow/30 rounded p-1.5 mt-2",children:[l.jsxs("div",{className:"flex items-center gap-1.5 flex-1",children:[l.jsx(HN,{className:"w-3 h-3 text-accent-yellow flex-shrink-0"}),l.jsxs("div",{className:"flex items-center gap-1 flex-1",children:[l.jsx("span",{className:"text-[10px] font-mono text-text-secondary uppercase",children:"Destiny:"}),l.jsx("span",{className:"text-lg font-orbitron font-bold text-accent-yellow",children:A.destiny_points||0})]}),l.jsx("button",{onClick:()=>W(-1),disabled:!A.destiny_points||A.destiny_points===0,className:"px-1.5 py-0.5 bg-accent-red/20 border border-accent-red text-accent-red text-[8px] font-orbitron hover:bg-accent-red hover:text-bg-primary transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:"-1"}),l.jsx("button",{onClick:()=>W(1),className:"px-1.5 py-0.5 bg-accent-cyan/20 border border-accent-cyan text-accent-cyan text-[8px] font-orbitron hover:bg-accent-cyan hover:text-bg-primary transition-all",children:"+1"})]}),l.jsx("div",{className:"w-px h-6 bg-accent-cyan/30"}),l.jsxs("div",{className:"flex items-center gap-1.5 flex-1",children:[l.jsx(fg,{className:"w-3 h-3 text-accent-cyan flex-shrink-0"}),l.jsxs("div",{className:"flex items-center gap-1 flex-1",children:[l.jsx("span",{className:"text-[10px] font-mono text-text-secondary uppercase",children:"Bits:"}),l.jsx("span",{className:"text-lg font-orbitron font-bold text-accent-cyan",children:A.bits||0})]}),l.jsx("button",{onClick:()=>ue(-1),disabled:!A.bits||A.bits===0,className:"px-1.5 py-0.5 bg-accent-red/20 border border-accent-red text-accent-red text-[8px] font-orbitron hover:bg-accent-red hover:text-bg-primary transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:"-1"}),l.jsx("button",{onClick:()=>ue(1),className:"px-1.5 py-0.5 bg-accent-cyan/20 border border-accent-cyan text-accent-cyan text-[8px] font-orbitron hover:bg-accent-cyan hover:text-bg-primary transition-all",children:"+1"})]})]})]})]})}function uP(){const{gameState:t,updateGameState:e,addLog:n}=Ge(),{partyMembers:r}=Ja(),a=t.ship?.galaxiesSaved||0,i=r.filter(h=>Gy(h,a)>0).length,c=()=>{e(h=>({...h,ship:{...h.ship,galaxiesSaved:(h.ship?.galaxiesSaved||0)+1}})),n("Galaxy saved! Characters can now claim promotions.","success")},u=()=>{a>0&&(e(p=>({...p,ship:{...p.ship,galaxiesSaved:Math.max(0,(p.ship?.galaxiesSaved||0)-1)}})),n("Galaxy save count decreased.","info"))};return l.jsxs("div",{className:"bg-bg-secondary border-2 border-accent-yellow p-2",children:[l.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[l.jsxs("div",{className:"flex items-center gap-1.5",children:[l.jsx(mr,{className:"w-4 h-4 text-accent-yellow"}),l.jsx("h3",{className:"font-orbitron font-bold text-accent-yellow uppercase text-xs",children:"Galaxies Saved"})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("button",{onClick:u,disabled:a===0,className:"p-1 bg-accent-red/20 border border-accent-red text-accent-red hover:bg-accent-red hover:text-bg-primary transition-all disabled:opacity-30 disabled:cursor-not-allowed disabled:hover:bg-accent-red/20 disabled:hover:text-accent-red",title:"Decrease",children:l.jsx(bc,{className:"w-3 h-3"})}),l.jsx("div",{className:"text-2xl font-orbitron font-bold text-accent-yellow text-glow-yellow min-w-[2rem] text-center",children:a}),l.jsx("button",{onClick:c,className:"p-1 bg-accent-cyan/20 border border-accent-cyan text-accent-cyan hover:bg-accent-cyan hover:text-bg-primary transition-all",title:"Increase",children:l.jsx(ir,{className:"w-3 h-3"})})]})]}),i>0&&l.jsx("div",{className:"bg-purple-900/30 border border-purple-500 rounded px-2 py-1 flex items-center justify-between",children:l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(pr,{className:"w-3 h-3 text-purple-400 animate-pulse"}),l.jsxs("span",{className:"text-xs text-purple-300 font-orbitron font-bold",children:[i," ready to promote"]})]})})]})}function DS({onExpand:t}){const{partyMembers:e,loading:n}=Ja(),{user:r}=Ya();if(n)return l.jsxs("div",{className:"text-center text-text-secondary text-sm font-mono p-4 space-y-3",children:[l.jsxs("div",{className:"text-accent-cyan",children:[">"," Loading party members..."]}),l.jsxs("div",{className:"flex justify-center gap-1",children:[l.jsx("span",{className:"w-2 h-2 bg-accent-cyan rounded-full animate-pulse",style:{animationDelay:"0ms"}}),l.jsx("span",{className:"w-2 h-2 bg-accent-cyan rounded-full animate-pulse",style:{animationDelay:"150ms"}}),l.jsx("span",{className:"w-2 h-2 bg-accent-cyan rounded-full animate-pulse",style:{animationDelay:"300ms"}})]})]});if(!e||e.length===0)return l.jsxs("div",{className:"text-center text-text-secondary text-sm font-mono p-4",children:[">"," No party members in this room"]});const a=[...e].sort((i,c)=>i.user_id===r?.id?-1:c.user_id===r?.id?1:0);return l.jsxs("div",{className:"flex flex-col h-full",children:[l.jsx("div",{className:"shrink-0",children:l.jsx(uP,{})}),l.jsxs("div",{className:"flex items-center justify-between my-2 shrink-0",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(ry,{className:"w-4 h-4 text-accent-cyan"}),l.jsxs("h3",{className:"font-orbitron font-bold text-accent-cyan text-sm",children:["Party (",e.length,")"]})]}),t&&l.jsx("button",{onClick:t,className:"p-1 text-accent-cyan hover:text-accent-cyan/80 hover:bg-accent-cyan/10 transition-all rounded",title:"Expand character sheet",children:l.jsx(gO,{className:"w-3 h-3"})})]}),l.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 min-h-0",children:a.map(i=>l.jsx(dP,{character:i},i.id))})]})}const Kl={bot:{id:"bot",name:"Bot",description:"Curse the Maker! Your clanking body of servos and circuits can barely manage stairs.",hpDice:{count:3,sides:6,modifier:0,ignoreSTR:!0},destinyDice:{count:1,sides:2},statModifiers:{agi:{count:3,sides:6,modifier:-2}},special:"Bot Repair Rules: Must destroy mechanical equipment to benefit from rest",specialRules:[{name:"METAL",description:"Roll 3d6 for HP (no STR modifier)"},{name:"CLUMSY",description:"Roll 3d6-2 for AGI"},{name:"BOT REPAIR RULES",description:"Must destroy a piece of mechanical equipment to use its components to benefit from rest. Roll with advantage if a Technician helps."}]},bountyHunter:{id:"bountyHunter",name:"Bounty Hunter",description:"You've been to one end of the Galaxy to the next, caught a lot of bounties.",hpDice:{count:1,sides:8,modifier:0},destinyDice:{count:1,sides:2},statModifiers:{str:{count:3,sides:6,modifier:2}},special:"Has a soft spot for certain types of people",specialRules:[{name:"HARDENED",description:"Roll 3d6+2 for STR"},{name:"SOFT SPOT",description:"You have a soft spot for certain types. They remind you of happier times. Regain a Destiny Point if you help them (but look tough while doing it). Discard your Heirloom Weapon if you don't."}]},magiKnight:{id:"magiKnight",name:"Magi Knight",description:"For a thousand generations, the Magi Knights were the guardians of peace.",hpDice:{count:1,sides:8,modifier:0},destinyDice:{count:1,sides:2},statModifiers:{knw:{count:3,sides:6,modifier:2}},special:"Has Blazer Sword and Magi Arts, but risks Dragoon detection",specialRules:[{name:"WISE",description:"Roll 3d6+2 for KNW"},{name:"DRAGOON TEST",description:"Each time you use Magi Arts or ignite Blazer Sword, roll D20. If you roll equal to or below threshold (starts at 5), the Dragoons sense your presence. The threshold increases by 1 each time you use these powers."},{name:"BURNER IDENTITY",description:"You are in hiding. Your Burner Identity has a quirk that triggers on ability test failures. Roll with advantage when a Youngster is close by."},{name:"BLAZER SWORD",description:"Your Magi weapon - retractable beam of energy (2D6 damage)"}]},smuggler:{id:"smuggler",name:"Smuggler",description:"You look out for just one person in the galaxy, yourself.",hpDice:{count:1,sides:8,modifier:0},destinyDice:{count:1,sides:2},statModifiers:{prs:{count:3,sides:6,modifier:2}},special:"Owns a ramshackle ship and carries contraband",specialRules:[{name:"SWINDLER",description:"Roll 3d6+2 for PRS. Regain 1 Destiny Point when you lie your way out of a problem."},{name:"SCUM",description:'Roll D20 whenever you arrive at a new spaceport. On a blunder, you inconveniently run into an "old friend" who wants payback.'},{name:"HUNK OF JUNK",description:"You own a ramshackle but trustworthy ship."},{name:"CONTRABAND",description:"You are smuggling contraband with Containment Points. When you roll a blunder on any test, reduce Containment Points by 1. When it reaches 0, contraband is no longer salable or safe."}]},technician:{id:"technician",name:"Technician",description:"It's not your fault! The life support was repaired with gardening equipment!",hpDice:{count:1,sides:8,modifier:0},destinyDice:{count:1,sides:2},statModifiers:{knw:{count:3,sides:6,modifier:2},prs:{count:3,sides:6,modifier:-1}},special:"Can invent flimsy devices with Hack Job rules",specialRules:[{name:"HANDY",description:"Roll 3d6+2 for KNW"},{name:"SPACEY",description:"Roll 3d6-1 for PRS"},{name:"HACK JOB RULES",description:"Invent flimsy devices with bizarrely jerry-rigged components. To make a device that works for a single round, destroy two mechanical items and combine their components. Flip a coin: heads it works, tails it doesn't."},{name:"JUNK DRAWER",description:"You have D4 extra inventory slots for small broken machines to be sacrificed for Hack Job parts."}]},youngster:{id:"youngster",name:"Youngster",description:"You are meant for bigger things. You know that your family tree has greatness in it.",hpDice:{count:1,sides:8,modifier:0},destinyDice:{count:1,sides:4},statModifiers:{},special:"Has an heirloom item from their mysterious past",specialRules:[{name:"LUCKY",description:"Roll D4 for Destiny Points (instead of D2)"},{name:"MYSTERIOUS PAST",description:"Tragedy struck your guardians. You have an heirloom from your mysterious lineage."},{name:"KNACK",description:"You have a special knack or skill from your upbringing."}]}},xu=[{id:"baselineHuman",name:"Baseline Human",description:"Standard galactic citizen"},{id:"woolyAnthrosquatch",name:"Wooly Anthrosquatch",description:"Large, hairy bipedal creature"},{id:"fishEyedIchthyoid",name:"Fish-eyed Ichthyoid",description:"Aquatic humanoid with large eyes"},{id:"scaleyLacertian",name:"Scaley Lacertian",description:"Reptilian species with scales"},{id:"flatheadedTricladid",name:"Flatheaded Tricladid",description:"Creature with distinctive flat head"},{id:"runtishZinto",name:"Runtish Zinto",description:"Small but resilient species"},{id:"suckerLippedAnuran",name:"Sucker-lipped Anuran",description:"Amphibian-like with sucker lips"},{id:"flightlessMacrobat",name:"Flightless Macrobat",description:"Large bat-like creature that cannot fly"},{id:"lithePseudopoid",name:"Lithe Pseudopoid",description:"Flexible and agile species"},{id:"littleUrsanid",name:"Little Ursanid",description:"Small bear-like creature"}],Tl=({onClick:t,active:e,children:n,title:r,disabled:a})=>l.jsx("button",{onClick:t,title:r,disabled:a,className:oe("p-1.5 transition-all duration-200 border border-accent-yellow",a&&"opacity-50 cursor-not-allowed",e?"bg-accent-yellow text-bg-primary":"bg-bg-secondary text-accent-yellow hover:bg-accent-yellow hover:bg-opacity-20"),children:n});function hP({onFocus:t,onBlur:e,isLocked:n}){const{character:r,updateField:a}=as(),[i,c]=E.useState(r?.journal||""),u=Y2(i,2e3),h=v2({extensions:[W2.configure({heading:!1,code:!1,codeBlock:!1,blockquote:!1,horizontalRule:!1}),U2],content:r?.journal||"<p>>> PERSONAL LOG: Track your character's thoughts, goals, relationships, secrets, and discoveries...</p>",editable:!n,editorProps:{attributes:{class:"prose prose-invert max-w-none focus:outline-none min-h-0 h-full px-3 py-2 text-sm font-mono"}},onUpdate:({editor:m})=>{const g=m.getHTML();c(g)},onFocus:()=>{t&&t()},onBlur:()=>{e&&e()}});if(E.useEffect(()=>{h&&r?.journal!==i&&r?.journal!==u&&(h.commands.setContent(r?.journal||""),c(r?.journal||""))},[r?.journal,h]),E.useEffect(()=>{r&&u!==r.journal&&a("journal",u)},[u]),E.useEffect(()=>{h&&h.setEditable(!n)},[h,n]),!r||!h)return null;const p=i!==r.journal;return l.jsxs("div",{className:"flex flex-col gap-2 min-h-[200px]",children:[n&&l.jsxs("div",{className:"bg-accent-yellow/10 border-2 border-accent-yellow rounded p-2 text-xs font-mono text-accent-yellow flex items-center gap-2",children:[l.jsx(hg,{className:"w-4 h-4"}),l.jsxs("span",{children:[n.userName," is currently editing this journal. Please wait..."]})]}),l.jsxs("div",{className:"flex items-center gap-1 p-2 bg-bg-primary border-2 border-accent-yellow",children:[l.jsx(Tl,{onClick:()=>h.chain().focus().toggleBold().run(),active:h.isActive("bold"),title:"Bold",disabled:n,children:l.jsx(hg,{className:"w-4 h-4"})}),l.jsx(Tl,{onClick:()=>h.chain().focus().toggleItalic().run(),active:h.isActive("italic"),title:"Italic",disabled:n,children:l.jsx(BN,{className:"w-4 h-4"})}),l.jsx(Tl,{onClick:()=>h.chain().focus().toggleUnderline().run(),active:h.isActive("underline"),title:"Underline",disabled:n,children:l.jsx(FN,{className:"w-4 h-4"})}),l.jsx(Tl,{onClick:()=>h.chain().focus().toggleStrike().run(),active:h.isActive("strike"),title:"Strikethrough",disabled:n,children:l.jsx(VN,{className:"w-4 h-4"})}),l.jsx("div",{className:"w-px h-6 bg-accent-yellow opacity-30 mx-1"}),l.jsx(Tl,{onClick:()=>h.chain().focus().toggleBulletList().run(),active:h.isActive("bulletList"),title:"Bullet List",disabled:n,children:l.jsx(IN,{className:"w-4 h-4"})})]}),l.jsx("div",{className:"flex-1 min-h-[180px] bg-bg-primary border-2 border-accent-yellow text-text-primary focus-within:border-accent-cyan focus-within:shadow-[0_0_15px_rgba(0,240,255,0.4)] transition-all duration-300 overflow-auto",children:l.jsx(x2,{editor:h,className:"h-full"})}),l.jsx("div",{className:"text-xs text-gray-500 font-orbitron",children:p?l.jsx("span",{className:"text-accent-yellow animate-pulse",children:" Saving..."}):l.jsx("span",{className:"text-accent-cyan",children:" Synced"})})]})}function fP({isOpen:t,onClose:e}){const{character:n,claimPromotion:r}=as(),{refreshPartyMembers:a}=Ja(),{addLog:i}=Ge(),[c,u]=E.useState(1),[h,p]=E.useState(null),[m,g]=E.useState(!1),[x,v]=E.useState([]),[w,N]=E.useState(null),[S,j]=E.useState(null),[A,$]=E.useState(!1),[L,R]=E.useState(!1);if(E.useEffect(()=>{t&&(u(1),p(null),g(!1),v([]),N(null),j(null),$(!1),R(!1))},[t]),!t||!n)return null;const M=(n.advancementOptions||[]).map(O=>O.id),D=eP(n.class,M),I=tP(n.stats),W=()=>{g(!0);let O=0;const K=setInterval(()=>{if(p(Math.floor(Math.random()*6)+1),O++,O>10){clearInterval(K);const Z=Ne(6);p(Z),g(!1),setTimeout(()=>{u(2)},1500)}},100)},ue=O=>{x.includes(O)?v(x.filter(K=>K!==O)):x.length<2&&v([...x,O])},he=()=>{x.length===2&&u(3)},J=O=>{N(O);const K=nP(O,n.class);j(K)},_=()=>{w&&u(4)},V=async()=>{try{$(!0),await r({hpIncrease:h,statIncreases:x,advancementId:w,advancementResult:S}),a();const O=x.map(K=>K.toUpperCase()).join(" and ");i(`${n.name} claimed promotion: +${h} HP, +1 ${O}, gained ${S.advancement.name}`,"success"),R(!0),setTimeout(()=>{e()},2e3)}catch(O){console.error("Failed to claim promotion:",O),alert("Failed to claim promotion. Please try again."),$(!1)}},F=O=>O>0?`+${O}`:O===0?"0":`${O}`;return l.jsx("div",{className:"fixed inset-0 bg-black/90 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:l.jsxs("div",{className:"bg-bg-secondary border-3 border-purple-500 max-w-3xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[l.jsx("div",{className:"border-b-3 border-purple-500/30 p-4 bg-purple-900/30",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx(pr,{className:"w-8 h-8 text-purple-400 animate-pulse"}),l.jsxs("div",{children:[l.jsx("h2",{className:"font-orbitron font-bold text-purple-300 text-2xl",children:"REBEL PROMOTION"}),l.jsxs("p",{className:"text-sm text-gray-400 font-orbitron",children:[n.name," - ",n.className]})]})]}),l.jsx("button",{onClick:e,disabled:A,className:"p-2 text-gray-400 hover:text-accent-red transition-colors disabled:opacity-50",children:l.jsx(Er,{className:"w-6 h-6"})})]})}),l.jsxs("div",{className:"p-4 bg-bg-primary border-b-2 border-gray-700",children:[l.jsx("div",{className:"flex items-center justify-center gap-2",children:[1,2,3,4].map(O=>l.jsxs("div",{className:"flex items-center",children:[l.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-orbitron font-bold text-sm border-2 transition-all ${c>O?"bg-purple-500 border-purple-500 text-white":c===O?"bg-purple-600 border-purple-500 text-white animate-pulse":"bg-transparent border-gray-600 text-gray-600"}`,children:c>O?l.jsx(Ks,{className:"w-4 h-4"}):O}),O<4&&l.jsx("div",{className:`w-8 h-0.5 mx-1 transition-all ${c>O?"bg-purple-500":"bg-gray-600"}`})]},O))}),l.jsxs("div",{className:"text-center text-xs text-gray-400 font-mono mt-2",children:[c===1&&"Roll HP Increase",c===2&&"Select Stat Increases",c===3&&"Choose Advancement",c===4&&"Confirm Promotion"]})]}),l.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[c===1&&l.jsxs("div",{className:"text-center space-y-6",children:[l.jsxs("div",{children:[l.jsx("h3",{className:"text-xl font-orbitron font-bold text-accent-cyan mb-2",children:"Roll for HP Increase"}),l.jsx("p",{className:"text-sm text-gray-400",children:"Roll D6 to increase your maximum HP"})]}),l.jsxs("div",{className:"flex flex-col items-center gap-4",children:[h!==null?l.jsx("div",{className:`text-8xl font-orbitron font-bold ${m?"text-gray-400":"text-accent-yellow text-glow-yellow"}`,children:h}):l.jsx(tr,{className:"w-24 h-24 text-gray-600"}),!m&&h===null&&l.jsxs(ge,{onClick:W,variant:"primary",className:"px-8 py-3 text-lg glow-pulse-cyan",children:[l.jsx(tr,{className:"w-6 h-6 mr-2"}),"ROLL D6"]}),!m&&h!==null&&l.jsxs("div",{className:"text-purple-400 font-orbitron",children:["HP: ",n.hp_max,"  ",n.hp_max+h]})]})]}),c===2&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("h3",{className:"text-xl font-orbitron font-bold text-accent-cyan mb-2",children:"Select Two Ability Scores to Increase"}),l.jsx("p",{className:"text-sm text-gray-400",children:"Choose 2 stats to increase by +1 (max +6)"})]}),l.jsx("div",{className:"grid grid-cols-2 gap-4",children:Object.entries(n.stats).map(([O,K])=>{const Z=x.includes(O),X=K>=6||!Z&&x.length>=2;return l.jsxs("button",{onClick:()=>ue(O),disabled:X,className:`p-4 border-3 transition-all ${Z?"border-accent-cyan bg-accent-cyan/20 scale-105":X?"border-gray-700 bg-gray-900/50 opacity-50 cursor-not-allowed":"border-gray-700 hover:border-accent-cyan/50 hover:bg-accent-cyan/5"}`,children:[l.jsx("div",{className:"text-xs font-mono text-gray-400 uppercase mb-2",children:O}),l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx("span",{className:"text-2xl font-orbitron font-bold text-text-primary",children:F(K)}),!X&&l.jsxs(l.Fragment,{children:[l.jsx(WO,{className:"w-5 h-5 text-accent-cyan"}),l.jsx("span",{className:"text-2xl font-orbitron font-bold text-accent-cyan",children:F(K+1)})]})]}),K>=6&&l.jsx("div",{className:"text-xs text-accent-yellow mt-2",children:"MAX"}),Z&&l.jsx("div",{className:"mt-2",children:l.jsx(Ks,{className:"w-5 h-5 text-accent-cyan mx-auto"})})]},O)})}),I.length<2&&l.jsxs("div",{className:"bg-purple-900/30 border-2 border-purple-500 p-3 rounded flex items-start gap-2",children:[l.jsx(zM,{className:"w-5 h-5 text-purple-400 flex-shrink-0 mt-0.5"}),l.jsx("p",{className:"text-sm text-purple-300",children:"Some stats are already at maximum (+6). Select any available stats."})]}),l.jsx("div",{className:"text-center",children:l.jsx(ge,{onClick:he,disabled:x.length!==2,variant:"primary",className:"px-8",children:"Continue "})})]}),c===3&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("h3",{className:"text-xl font-orbitron font-bold text-accent-cyan mb-2",children:"Choose Class Advancement"}),l.jsxs("p",{className:"text-sm text-gray-400",children:["Select one advancement option for your ",n.className]})]}),D.length===0?l.jsxs("div",{className:"text-center py-8",children:[l.jsx(mr,{className:"w-16 h-16 mx-auto mb-4 text-gray-600"}),l.jsx("p",{className:"text-gray-400",children:"No advancements available"})]}):l.jsx("div",{className:"space-y-3",children:D.map(O=>{const K=w===O.id;return l.jsxs("button",{onClick:()=>J(O.id),className:`w-full border-3 p-4 text-left transition-all ${K?"border-purple-500 bg-purple-900/30 scale-105":"border-gray-700 hover:border-purple-500/50 hover:bg-purple-900/20"}`,children:[l.jsxs("div",{className:"flex items-start justify-between mb-2",children:[l.jsx("h4",{className:"font-orbitron font-bold text-text-primary",children:O.name}),K&&l.jsx(mr,{className:"w-5 h-5 text-purple-400 fill-purple-400"})]}),l.jsx("p",{className:"text-sm text-gray-400 mb-2",children:O.description}),l.jsx("div",{className:"flex items-center gap-2 text-xs",children:l.jsx("span",{className:"text-accent-cyan font-orbitron",children:O.effect})}),K&&S?.rolledFeature&&l.jsxs("div",{className:"mt-3 pt-3 border-t border-purple-500/30",children:[l.jsx("div",{className:"text-xs text-purple-400 uppercase mb-1",children:"Rolled Result:"}),l.jsx("div",{className:"text-sm text-purple-300 font-bold",children:S.rolledFeature.name}),S.rolledFeature.description&&l.jsx("div",{className:"text-xs text-gray-400 mt-1",children:S.rolledFeature.description})]}),K&&S?.companion&&l.jsxs("div",{className:"mt-3 pt-3 border-t border-purple-500/30",children:[l.jsx("div",{className:"text-xs text-purple-400 uppercase mb-1",children:"Companion Gained:"}),l.jsx("div",{className:"text-sm text-purple-300 font-bold",children:S.companion.name}),l.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["HP: ",S.companion.hp," | Morale: ",S.companion.morale," | Armor: Tier ",S.companion.armor," | ",S.companion.weapon]})]})]},O.id)})}),l.jsx("div",{className:"text-center",children:l.jsx(ge,{onClick:_,disabled:!w,variant:"primary",className:"px-8",children:"Continue "})})]}),c===4&&l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("h3",{className:"text-xl font-orbitron font-bold text-accent-cyan mb-2",children:"Confirm Promotion"}),l.jsx("p",{className:"text-sm text-gray-400",children:"Review your choices before claiming"})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"bg-accent-red/10 border-2 border-accent-red p-4",children:[l.jsx("div",{className:"text-xs font-mono text-accent-red uppercase mb-2",children:"Hit Points"}),l.jsxs("div",{className:"text-2xl font-orbitron font-bold text-accent-red",children:[n.hp_max,"  ",n.hp_max+h," (+",h,")"]})]}),l.jsxs("div",{className:"bg-accent-cyan/10 border-2 border-accent-cyan p-4",children:[l.jsx("div",{className:"text-xs font-mono text-accent-cyan uppercase mb-2",children:"Ability Scores"}),l.jsx("div",{className:"grid grid-cols-2 gap-2",children:x.map(O=>l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:"text-sm font-mono text-gray-400 uppercase",children:[O,":"]}),l.jsxs("span",{className:"font-orbitron font-bold text-accent-cyan",children:[F(n.stats[O]),"  ",F(n.stats[O]+1)]})]},O))})]}),l.jsxs("div",{className:"bg-purple-900/30 border-2 border-purple-500 p-4",children:[l.jsx("div",{className:"text-xs font-mono text-purple-400 uppercase mb-2",children:"Class Advancement"}),l.jsx("div",{className:"font-orbitron font-bold text-purple-300 mb-1",children:S?.advancement.name}),l.jsx("div",{className:"text-sm text-gray-400",children:S?.advancement.description})]})]}),l.jsx("div",{className:"text-center pt-4",children:L?l.jsxs("div",{className:"text-2xl font-orbitron font-bold text-purple-300 animate-pulse",children:[l.jsx(Ks,{className:"w-8 h-8 inline-block mr-2"}),"PROMOTION CLAIMED!"]}):l.jsx(ge,{onClick:V,disabled:A,variant:"primary",className:"px-12 py-3 text-lg bg-purple-600 hover:bg-purple-500 border-purple-500 text-white shadow-lg shadow-purple-500/50",children:A?l.jsxs(l.Fragment,{children:[l.jsx(tr,{className:"w-6 h-6 mr-2 animate-spin"}),"Claiming..."]}):l.jsxs(l.Fragment,{children:[l.jsx(pr,{className:"w-6 h-6 mr-2"}),"CLAIM PROMOTION"]})})})]})]})]})})}function LS({isOpen:t,onClose:e,roomCode:n}){const{character:r,updateField:a,deleteCharacter:i,respecCharacter:c}=as(),{gameState:u}=Ge(),{session:h}=Ya(),{trackEditing:p,stopEditing:m,getFieldEditor:g}=K2(n,h?.user?.id,r?.name||"Anonymous"),[x,v]=E.useState(null),[w,N]=E.useState(!1),[S,j]=E.useState(!1),[A,$]=E.useState(!1),[L,R]=E.useState(!1);if(E.useEffect(()=>{r&&v({...r})},[r]),E.useEffect(()=>{const X=te=>{t&&(Qa()||te.key==="Escape"&&e())};return window.addEventListener("keydown",X),()=>window.removeEventListener("keydown",X)},[t,e]),!t||!x)return null;const M=u.ship?.galaxiesSaved||0,D=Gy(x,M),I=D>0,W=X=>X>0?`+${X}`:X===0?"0":`${X}`,ue=X=>X>=2?"text-accent-green":X>=1?"text-accent-cyan":X===0?"text-text-primary":X>=-1?"text-accent-yellow":"text-accent-red",he=async(X,te)=>{v(T=>({...T,[X]:te}));try{await a(X,te)}catch(T){console.error("Failed to update field:",T)}},J=async(X,te)=>{const T=x.stats[X],z=Math.max(-3,Math.min(3,T+te)),H={...x.stats,[X]:z};v(Q=>({...Q,stats:H}));try{await a("stats",H)}catch(Q){console.error("Failed to update stats:",Q)}},_=async()=>{const X=[...x.equipment||[],"New Item"];v(te=>({...te,equipment:X}));try{await a("equipment",X)}catch(te){console.error("Failed to add equipment:",te)}},V=async(X,te)=>{const T=[...x.equipment];T[X]=te,v(z=>({...z,equipment:T}));try{await a("equipment",T)}catch(z){console.error("Failed to update equipment:",z)}},F=async X=>{const te=x.equipment.filter((T,z)=>z!==X);v(T=>({...T,equipment:te}));try{await a("equipment",te)}catch(T){console.error("Failed to remove equipment:",T)}},O=async()=>{try{$(!0),await i(),N(!1),e()}catch(X){console.error("Failed to delete character:",X),alert("Failed to delete character. Please try again.")}finally{$(!1)}},K=async()=>{try{$(!0),await c(),j(!1),alert("Character has been reset to base values! You can now claim promotions if galaxy saves are available.")}catch(X){console.error("Failed to respec character:",X),alert("Failed to respec character. Please try again.")}finally{$(!1)}},Z=l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 bg-black/70 z-40 animate-fade-in",onClick:e}),l.jsxs("div",{className:"fixed top-0 right-0 h-full w-full md:w-[600px] lg:w-[700px] bg-bg-primary border-l-4 border-accent-cyan shadow-2xl z-50 slide-in-right overflow-hidden flex flex-col",children:[l.jsxs("div",{className:"bg-bg-secondary border-b-3 border-accent-cyan p-4 flex items-center justify-between shrink-0",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("h2",{className:"text-2xl font-orbitron font-bold text-accent-cyan text-glow-cyan",children:"CHARACTER SHEET"}),I&&l.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-purple-900/40 border-2 border-purple-500 rounded animate-pulse",children:[l.jsx(pr,{className:"w-4 h-4 text-purple-400"}),l.jsx("span",{className:"text-xs font-orbitron font-bold text-purple-300",children:D})]})]}),l.jsx("button",{onClick:e,className:"p-2 text-accent-cyan hover:text-accent-red hover:bg-accent-red/10 transition-all rounded",children:l.jsx(Er,{className:"w-6 h-6"})})]}),l.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[I&&l.jsxs("div",{className:"bg-purple-900/30 border-3 border-purple-500 p-4 space-y-3",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(pr,{className:"w-6 h-6 text-purple-400 animate-pulse"}),l.jsxs("div",{children:[l.jsx("h3",{className:"font-orbitron font-bold text-purple-300 text-lg",children:"PROMOTION AVAILABLE!"}),l.jsxs("p",{className:"text-sm text-text-secondary font-mono",children:["You have ",D," unclaimed promotion",D!==1?"s":""]})]})]}),l.jsxs(ge,{onClick:()=>R(!0),variant:"primary",className:"w-full bg-purple-600 hover:bg-purple-500 border-purple-500 text-white shadow-lg shadow-purple-500/50",children:[l.jsx(pr,{className:"w-5 h-5 mr-2"}),"CLAIM PROMOTION"]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-orbitron font-bold text-accent-yellow uppercase border-b border-accent-yellow/30 pb-2",children:"Basic Information"}),l.jsxs("div",{children:[l.jsxs("label",{className:"block text-xs font-mono text-text-secondary mb-1 uppercase flex items-center gap-2",children:["Character Name",g("name")&&l.jsxs("span",{className:"text-accent-yellow text-xs flex items-center gap-1",children:[l.jsx(Fs,{className:"w-3 h-3"}),g("name").userName," is editing"]})]}),l.jsx("input",{type:"text",value:x.name||"",onChange:X=>he("name",X.target.value),onFocus:()=>p("name"),onBlur:()=>m("name"),placeholder:"Enter rebel name...",className:"w-full bg-bg-secondary border-2 border-accent-cyan/30 rounded px-3 py-2 text-text-primary font-mono focus:outline-none focus:border-accent-cyan focus:shadow-[0_0_10px_rgba(0,240,255,0.4)] transition-all"})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs font-mono text-text-secondary mb-1 uppercase",children:"Class"}),l.jsx("div",{className:"bg-bg-secondary border-2 border-accent-cyan/30 rounded px-3 py-2 text-text-primary font-mono capitalize",children:x.className||x.class})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs font-mono text-text-secondary mb-1 uppercase",children:"Species"}),l.jsx("select",{value:x.species||"",onChange:X=>he("species",X.target.value),className:"w-full bg-bg-secondary border-2 border-accent-cyan/30 rounded px-3 py-2 text-text-primary font-mono focus:outline-none focus:border-accent-cyan [&>option]:bg-bg-secondary [&>option]:text-text-primary",children:x.class==="bot"?l.jsx("option",{value:"Bot",children:"Bot"}):xu.map(X=>l.jsx("option",{value:X.name,children:X.name},X.id))})]})]}),x.motivation&&l.jsxs("div",{className:"mt-4",children:[l.jsxs("label",{className:"block text-xs font-mono text-text-secondary mb-1 uppercase flex items-center gap-2",children:["Rebel Motivation",g("motivation")&&l.jsxs("span",{className:"text-accent-yellow text-xs flex items-center gap-1",children:[l.jsx(Fs,{className:"w-3 h-3"}),g("motivation").userName," is editing"]})]}),l.jsx("textarea",{value:x.motivation||"",onChange:X=>he("motivation",X.target.value),onFocus:()=>p("motivation"),onBlur:()=>m("motivation"),className:"w-full bg-bg-secondary border-2 border-accent-yellow/30 rounded px-3 py-2 text-text-primary font-mono text-sm focus:outline-none focus:border-accent-cyan focus:shadow-[0_0_10px_rgba(0,240,255,0.4)] transition-all",rows:"2"})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-orbitron font-bold text-accent-yellow uppercase border-b border-accent-yellow/30 pb-2",children:"Ability Scores"}),l.jsx("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(x.stats).map(([X,te])=>l.jsxs("div",{className:"bg-bg-secondary border-2 border-accent-cyan/30 rounded p-3",children:[l.jsx("div",{className:"flex items-center justify-between mb-2",children:l.jsx("span",{className:"text-xs font-mono text-text-secondary uppercase",children:X})}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("button",{onClick:()=>J(X,-1),className:"px-2 py-1 bg-accent-red/20 border border-accent-red text-accent-red font-bold hover:bg-accent-red hover:text-bg-primary transition-all",children:"-"}),l.jsx("div",{className:`flex-1 text-center text-2xl font-orbitron font-bold ${ue(te)}`,children:W(te)}),l.jsx("button",{onClick:()=>J(X,1),className:"px-2 py-1 bg-accent-cyan/20 border border-accent-cyan text-accent-cyan font-bold hover:bg-accent-cyan hover:text-bg-primary transition-all",children:"+"})]})]},X))})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center justify-between border-b border-accent-yellow/30 pb-2",children:[l.jsx("h3",{className:"text-lg font-orbitron font-bold text-accent-yellow uppercase",children:"Vitals"}),x.galaxySavesClaimed>0&&l.jsxs("div",{className:"flex items-center gap-1 text-xs text-purple-400 font-mono",children:[l.jsx(mr,{className:"w-4 h-4"}),l.jsxs("span",{children:["Promotions: ",x.galaxySavesClaimed]})]})]}),l.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[l.jsxs("div",{className:"bg-bg-secondary border-2 border-accent-red rounded p-3",children:[l.jsxs("label",{className:"block text-xs font-mono text-text-secondary mb-1 uppercase flex items-center gap-1",children:["HP Current",g("hp_current")&&l.jsx(Fs,{className:"w-3 h-3 text-accent-yellow",title:`${g("hp_current").userName} is editing`})]}),l.jsx("input",{type:"number",value:x.hp_current,onChange:X=>he("hp_current",Math.max(0,parseInt(X.target.value)||0)),onFocus:()=>p("hp_current"),onBlur:()=>m("hp_current"),min:"0",className:"w-full text-2xl font-orbitron font-bold text-accent-red bg-transparent border-0 focus:outline-none"})]}),l.jsxs("div",{className:"bg-bg-secondary border-2 border-accent-red rounded p-3",children:[l.jsx("label",{className:"block text-xs font-mono text-text-secondary mb-1 uppercase",children:"HP Max"}),l.jsx("input",{type:"number",value:x.hp_max,onChange:X=>he("hp_max",Math.max(1,parseInt(X.target.value)||1)),min:"1",className:"w-full text-2xl font-orbitron font-bold text-accent-red bg-transparent border-0 focus:outline-none"})]}),l.jsxs("div",{className:"bg-bg-secondary border-2 border-accent-yellow rounded p-3",children:[l.jsx("label",{className:"block text-xs font-mono text-text-secondary mb-1 uppercase",children:"Destiny"}),l.jsx("input",{type:"number",value:x.destiny_points||0,onChange:X=>he("destiny_points",Math.max(0,parseInt(X.target.value)||0)),min:"0",className:"w-full text-2xl font-orbitron font-bold text-accent-yellow bg-transparent border-0 focus:outline-none"})]})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-orbitron font-bold text-accent-yellow uppercase border-b border-accent-yellow/30 pb-2",children:"Currency"}),l.jsxs("div",{className:"bg-bg-secondary border-2 border-accent-cyan rounded p-3",children:[l.jsx("label",{className:"block text-xs font-mono text-text-secondary mb-1 uppercase",children:"Bits "}),l.jsx("input",{type:"number",value:x.bits||0,onChange:X=>he("bits",Math.max(0,parseInt(X.target.value)||0)),min:"0",className:"w-full text-xl font-orbitron font-bold text-accent-cyan bg-transparent border-0 focus:outline-none"})]})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"flex items-center justify-between border-b border-accent-yellow/30 pb-2",children:[l.jsx("h3",{className:"text-lg font-orbitron font-bold text-accent-yellow uppercase",children:"Equipment"}),l.jsx("button",{onClick:_,className:"text-accent-cyan hover:text-accent-cyan/80 transition-colors",title:"Add item",children:l.jsx(ir,{className:"w-5 h-5"})})]}),l.jsx("div",{className:"space-y-2",children:!x.equipment||x.equipment.length===0?l.jsxs("p",{className:"text-text-secondary text-sm font-mono text-center py-4",children:[">"," No equipment yet"]}):x.equipment.map((X,te)=>l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("button",{onClick:()=>F(te),className:"text-accent-red hover:text-accent-red/80 transition-colors shrink-0",children:l.jsx(rs,{className:"w-4 h-4"})}),l.jsx("input",{type:"text",value:X,onChange:T=>V(te,T.target.value),className:"flex-1 bg-bg-secondary border-2 border-accent-cyan/30 rounded px-3 py-2 text-text-primary font-mono text-sm focus:outline-none focus:border-accent-cyan"})]},te))})]}),x.advancementOptions&&x.advancementOptions.length>0&&l.jsxs("div",{className:"space-y-4",children:[l.jsxs("h3",{className:"text-lg font-orbitron font-bold text-purple-400 uppercase border-b border-purple-500/30 pb-2 flex items-center gap-2",children:[l.jsx(mr,{className:"w-5 h-5"}),"Advancement Abilities"]}),l.jsx("div",{className:"space-y-3",children:x.advancementOptions.map((X,te)=>l.jsx("div",{className:"bg-purple-900/30 border-2 border-purple-500/30 rounded p-3",children:l.jsxs("div",{className:"flex items-start justify-between",children:[l.jsxs("div",{className:"flex-1",children:[l.jsx("div",{className:"text-sm font-orbitron font-bold text-purple-300",children:X.id.replace(/([A-Z])/g," $1").trim().toUpperCase()}),X.result?.advancement&&l.jsx("div",{className:"text-xs text-text-secondary mt-1",children:X.result.advancement.description}),X.result?.rolledFeature&&l.jsxs("div",{className:"text-xs text-purple-400 mt-2",children:[l.jsx("span",{className:"font-bold",children:X.result.rolledFeature.name}),X.result.rolledFeature.description&&l.jsxs("span",{className:"text-text-secondary",children:[" - ",X.result.rolledFeature.description]})]}),X.result?.companion&&l.jsxs("div",{className:"text-xs text-purple-400 mt-2",children:[l.jsxs("span",{className:"font-bold",children:["Companion: ",X.result.companion.name]}),l.jsxs("div",{className:"text-text-secondary",children:["HP ",X.result.companion.hp,", Morale ",X.result.companion.morale,", Tier ",X.result.companion.armor," Armor, ",X.result.companion.weapon]})]})]}),l.jsx(mr,{className:"w-4 h-4 text-purple-400 flex-shrink-0 ml-2"})]})},te))})]}),x.classFeatures&&Object.keys(x.classFeatures).length>0&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-orbitron font-bold text-accent-yellow uppercase border-b border-accent-yellow/30 pb-2",children:"Class Features"}),l.jsx("div",{className:"space-y-3",children:Object.entries(x.classFeatures).map(([X,te])=>typeof te=="number"||typeof te=="boolean"?null:l.jsxs("div",{className:"bg-bg-secondary border-2 border-accent-yellow/30 rounded p-3",children:[l.jsxs("div",{className:"text-xs font-mono text-accent-yellow uppercase mb-1",children:[X.replace(/([A-Z])/g," $1").trim(),te.roll&&` [${te.roll}]`]}),l.jsx("div",{className:"text-text-primary text-sm font-mono",children:te.name?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"font-bold text-accent-yellow",children:te.name}),l.jsx("div",{className:"text-text-secondary text-xs mt-1",children:te.description})]}):l.jsx("div",{className:"text-text-secondary text-xs",children:te.result||te})})]},X))}),x.classFeatures.containmentPoints&&l.jsxs("div",{className:"bg-accent-yellow/10 border-2 border-accent-yellow/30 rounded p-3",children:[l.jsx("div",{className:"text-xs font-mono text-accent-yellow uppercase mb-1",children:"Containment Points"}),l.jsxs("div",{className:"text-text-secondary text-xs",children:["Current: ",x.classFeatures.containmentPoints," / 6",l.jsx("br",{}),l.jsx("span",{className:"text-accent-red",children:"Reduces by 1 on each blunder"})]})]}),x.classFeatures.junkDrawerSlots&&l.jsxs("div",{className:"bg-accent-cyan/10 border-2 border-accent-cyan/30 rounded p-3",children:[l.jsx("div",{className:"text-xs font-mono text-accent-cyan uppercase mb-1",children:"Junk Drawer"}),l.jsxs("div",{className:"text-text-secondary text-xs",children:["Extra Inventory Slots: +",x.classFeatures.junkDrawerSlots,l.jsx("br",{}),l.jsx("span",{className:"text-text-secondary",children:"For small broken machines (Hack Job parts)"})]})]}),x.classFeatures.ownsShip&&l.jsxs("div",{className:"bg-accent-cyan/10 border-2 border-accent-cyan/30 rounded p-3",children:[l.jsx("div",{className:"text-xs font-mono text-accent-cyan uppercase mb-1",children:"Hunk of Junk"}),l.jsx("div",{className:"text-text-secondary text-xs",children:"You own a ramshackle but trustworthy ship"})]})]}),Kl[x.class]?.specialRules&&l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-orbitron font-bold text-accent-cyan uppercase border-b border-accent-cyan/30 pb-2",children:"Class Special Rules"}),l.jsx("div",{className:"space-y-2",children:Kl[x.class].specialRules.map((X,te)=>l.jsxs("div",{className:"bg-bg-secondary border-2 border-accent-cyan/30 rounded p-3",children:[l.jsx("div",{className:"text-xs font-mono text-accent-cyan uppercase mb-1",children:X.name}),l.jsx("div",{className:"text-text-secondary text-xs",children:X.description})]},te))})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("h3",{className:"text-lg font-orbitron font-bold text-accent-yellow uppercase border-b border-accent-yellow/30 pb-2 flex items-center gap-2",children:["Personal Journal",g("journal")&&l.jsxs("span",{className:"text-accent-yellow text-xs flex items-center gap-1 font-mono normal-case",children:[l.jsx(Fs,{className:"w-4 h-4"}),g("journal").userName," is editing"]})]}),l.jsx(hP,{onFocus:()=>p("journal"),onBlur:()=>m("journal"),isLocked:g("journal")})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("h3",{className:"text-lg font-orbitron font-bold text-accent-red uppercase border-b border-accent-red/30 pb-2",children:"Danger Zone"}),S?l.jsxs("div",{className:"bg-orange-900/20 border-2 border-orange-500 rounded p-4",children:[l.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[l.jsx(ar,{className:"w-5 h-5 text-orange-400 flex-shrink-0 mt-0.5"}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-orbitron font-bold text-orange-400 uppercase text-sm mb-1",children:"Confirm Respec"}),l.jsxs("p",{className:"text-text-primary text-sm mb-2",children:["This will reset ",l.jsx("span",{className:"text-accent-yellow font-bold",children:x.name})," to base values:"]}),l.jsxs("ul",{className:"text-text-secondary text-xs space-y-1 mb-2",children:[l.jsx("li",{children:" Stats will reset to original rolled values"}),l.jsx("li",{children:" HP will reset to starting HP"}),l.jsx("li",{children:" All advancement abilities will be removed"}),l.jsxs("li",{children:[" Promotions claimed: ",x.galaxySavesClaimed||0,"  0"]})]}),l.jsxs("p",{className:"text-accent-cyan text-xs",children:[" Galaxy saves available: ",M,M>0&&" (you can re-promote after respec)"]})]})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(ge,{onClick:K,variant:"secondary",className:"flex-1 bg-orange-600 hover:bg-orange-500 border-orange-500 text-white",disabled:A,children:A?"RESPECCING...":"YES, RESPEC"}),l.jsx(ge,{onClick:()=>j(!1),variant:"ghost",className:"flex-1",children:"CANCEL"})]})]}):l.jsxs(ge,{onClick:()=>j(!0),variant:"secondary",className:"w-full bg-orange-600/20 border-orange-500 text-orange-400 hover:bg-orange-600 hover:text-white",children:[l.jsx(mg,{className:"w-4 h-4 mr-2"}),"RESPEC CHARACTER"]}),w?l.jsxs("div",{className:"bg-accent-red/10 border-2 border-accent-red rounded p-4",children:[l.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[l.jsx(ar,{className:"w-5 h-5 text-accent-red flex-shrink-0 mt-0.5"}),l.jsxs("div",{children:[l.jsx("h4",{className:"font-orbitron font-bold text-accent-red uppercase text-sm mb-1",children:"Confirm Deletion"}),l.jsxs("p",{className:"text-text-primary text-sm",children:["This will permanently delete ",l.jsx("span",{className:"text-accent-yellow font-bold",children:x.name}),". This action cannot be undone."]})]})]}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(ge,{onClick:O,variant:"danger",className:"flex-1",disabled:A,children:A?"DELETING...":"YES, DELETE"}),l.jsx(ge,{onClick:()=>N(!1),variant:"ghost",className:"flex-1",children:"CANCEL"})]})]}):l.jsxs(ge,{onClick:()=>N(!0),variant:"danger",className:"w-full",children:[l.jsx(rs,{className:"w-4 h-4 mr-2"}),"DELETE CHARACTER"]})]})]})]}),l.jsx(fP,{isOpen:L,onClose:()=>R(!1)})]});return ko.createPortal(Z,document.body)}const pP={laserFire:"/star-dashborg/sounds/laser-fire-short.mp3",torpedoFire:"/star-dashborg/sounds/torpedo-fire.mp3",shieldHit:"/star-dashborg/sounds/shield-hit.mp3",hyperdriveCharge:"/star-dashborg/sounds/hyperdrive-charge.mp3",alarmCritical:"/star-dashborg/sounds/alarm-critical.mp3",evade:"/star-dashborg/sounds/evade.mp3",targetLock:"/star-dashborg/sounds/target-lock.mp3",jamming:"/star-dashborg/sounds/jamming.mp3",repairShield:"/star-dashborg/sounds/repair-shield.mp3",loadTorpedo:"/star-dashborg/sounds/load-torpedo.mp3",deflectors:"/star-dashborg/sounds/deflectors.mp3",steady:"/star-dashborg/sounds/steady.mp3",shieldPowerUp:"/star-dashborg/sounds/shield-power-up.mp3",enemyAttack:"/star-dashborg/sounds/tie-fighter-laser.mp3",enemyFlee:"/star-dashborg/sounds/tie-fighter-roar.mp3",enemySpawn:"/star-dashborg/sounds/enemy-spawn.mp3",particleBeamAttack:"/star-dashborg/sounds/particle-beam-attack.mp3",turboCannonAttack:"/star-dashborg/sounds/turbo-cannon-attack.mp3",dreadnoughtSpawn:"/star-dashborg/sounds/dreadnought-spawn.mp3"};function Cc(){const t=E.useRef({}),e=E.useRef(!1);E.useEffect(()=>{Object.entries(pP).forEach(([c,u])=>{const h=new Audio(u);h.preload="auto",t.current[c]=h}),localStorage.getItem("spaceCombatSoundsMuted")==="true"&&(e.current=!0)},[]);const n=E.useCallback((i,c=.5)=>{if(e.current)return;const u=t.current[i];if(u){const h=u.cloneNode();h.volume=c,h.play().catch(p=>{console.warn("Sound playback failed:",p)})}},[]),r=E.useCallback(()=>(e.current=!e.current,localStorage.setItem("spaceCombatSoundsMuted",e.current.toString()),e.current),[]),a=E.useCallback(()=>e.current,[]);return{play:n,toggleMute:r,getMutedState:a}}const Dh={pilot:{id:"pilot",name:"Pilot",maxAssignments:1,description:"Controls ship movement and evasion",actions:["steady","fixedBeamCannon","evade"]},copilot:{id:"copilot",name:"Co-Pilot",maxAssignments:1,description:"Targeting systems and torpedoes",actions:["targetLock","fireTorpedo","jamming"]},engineer1:{id:"engineer1",name:"Engineer",maxAssignments:1,description:"Ship systems and repairs",actions:["repairShield","loadTorpedo","hyperdriveJump","deflectors"]},engineer2:{id:"engineer2",name:"Engineer",maxAssignments:1,description:"Ship systems and repairs",actions:["repairShield","loadTorpedo","hyperdriveJump","deflectors"]},gunner1:{id:"gunner1",name:"Gunner 1",maxAssignments:1,description:"Laser turret operations",actions:["fireLaserTurret","deflectors"]},gunner2:{id:"gunner2",name:"Gunner 2",maxAssignments:1,description:"Laser turret operations",actions:["fireLaserTurret","deflectors"]}},$S={steady:{id:"steady",name:"Steady",type:"support",ability:"KNW",dr:12,description:"Test KNW to grant advantage to the next attack test against an enemy",effect:"Next ally attack has advantage"},fixedBeamCannon:{id:"fixedBeamCannon",name:"Fixed Beam Cannon",type:"attack",ability:"PRS",dr:12,damage:"1d4",description:"Test PRS to fire the fixed beam cannon",effect:"Deal D4 damage on success"},evade:{id:"evade",name:"Evade",type:"defense",ability:"AGI",dr:12,description:"Test AGI to negate incoming enemy attack",effect:"Negate one incoming attack on success"},targetLock:{id:"targetLock",name:"Target Lock",type:"support",ability:"AGI",dr:12,description:"Test AGI. Reduce a single enemy's armor by 1 tier until end of round",effect:"Reduce enemy armor by 1 tier"},fireTorpedo:{id:"fireTorpedo",name:"Fire Particle Torpedo",type:"attack",ability:"KNW",dr:12,damage:"1d8",description:"If a particle torpedo is loaded, test KNW to fire",effect:"Deal D8 damage on success (requires loaded torpedo)",requiresTorpedo:!0},jamming:{id:"jamming",name:"Jamming",type:"defense",ability:"PRS",dr:12,description:"Test PRS to negate incoming enemy attack",effect:"Negate one incoming attack on success"},repairShield:{id:"repairShield",name:"Repair Shield",type:"support",ability:"KNW",dr:12,description:"Test KNW to increase Ship Armor by 1 tier (max 2)",effect:"Restore 1 armor tier (max Tier 2)"},loadTorpedo:{id:"loadTorpedo",name:"Load Particle Torpedo",type:"support",ability:"STR",dr:12,description:"Test STR to load D2 torpedoes to fire",effect:"Load 1-2 torpedoes on success"},hyperdriveJump:{id:"hyperdriveJump",name:"Charge Hyperdrive",type:"instant",description:"Charting, charging, and engaging takes 3 rounds. Dangerous in combat",effect:"Charge hyperdrive by 1 pip (3 pips to jump)",warning:"Jumping in combat with 4+ enemies destroys the ship!"},deflectors:{id:"deflectors",name:"Deflectors",type:"defense",ability:"PRS",dr:12,description:"Test PRS to negate incoming enemy attack",effect:"Negate one incoming attack on success"},fireLaserTurret:{id:"fireLaserTurret",name:"Fire Laser Turret",type:"attack",ability:"AGI",dr:12,damage:"1d6",description:"Test AGI to fire the laser turret",effect:"Deal D6 damage on success"}},mP=[{tier:0,name:"No Armor",damage:0,description:"No damage negation",color:"red"},{tier:1,name:"Tier 1",damage:2,description:"-D2 damage",color:"yellow"},{tier:2,name:"Tier 2",damage:4,description:"-D4 damage",color:"cyan"},{tier:3,name:"Tier 3",damage:6,description:"-D6 damage (max)",color:"cyan"}],BS={boosterRockets:{id:"boosterRockets",name:"Booster Rockets",description:"The Steady action affects the next D2 attacks against enemies",effect:"steady_multi"},torpedoWinch:{id:"torpedoWinch",name:"Particle Torpedo Winch",description:"Any station can Load Particle Torpedoes with a KNW test",effect:"load_any_station"},overchargeShields:{id:"overchargeShields",name:"Overcharge Shields",description:"At start shields are Tier 2, but can be moved up to Tier 3 by repairing",effect:"max_tier_3"},turboLasers:{id:"turboLasers",name:"Turbo Laser Turrets",description:"Choose a Gunner Station to deal D8 damage instead of D6",effect:"gunner_d8"}},vo={standard:{id:"standard",name:"Standard Particle Torpedo",damage:"1d8",description:"Standard issue particle torpedo",effect:"Deal D8 damage on hit",cost:0,category:"torpedo"},cluster:{id:"cluster",name:"Cluster Torpedo",damage:"1d4",description:"Up to 3 targets, roll to hit and for damage once for each target",effect:"Hit up to 3 different targets with D4 damage each",cost:2,category:"torpedo",special:"multi_target"},hunterKiller:{id:"hunterKiller",name:"Hunter-Killer Torpedo",damage:"1d8",description:"Advanced targeting system rolls with advantage to hit and damage",effect:"Roll with advantage for both hit and damage",cost:2,category:"torpedo",special:"advantage"},chaff:{id:"chaff",name:"Chaff Torpedo",damage:"0",description:"All rebels make defensive tests with advantage, attack tests with disadvantage for a full round",effect:"Defensive screen - advantage on defense, disadvantage on attacks",cost:1,category:"torpedo",special:"defensive"},ion:{id:"ion",name:"Ion Torpedo",damage:"1d8",description:"Permanently reduces a target's shield tier by 1",effect:"D8 damage + permanently reduces enemy armor by 1 tier",cost:2,category:"torpedo",special:"armor_reduction"}},sC={gravityCatapult:{id:"gravityCatapult",name:"Gravity Catapult",damage:"1d10",description:'Requires the engineer to load an object with the "bulky" tag into the chamber. Add this to 1 gunner station.',effect:"D10 damage but requires bulky items as ammo",cost:2,category:"turret",special:"requires_ammo"},hyperRailgun:{id:"hyperRailgun",name:"Hyper Railgun",damage:"1d6",description:"High-velocity projectiles that ignore all armor",effect:"D6 damage that ignores enemy armor completely",cost:2,category:"turret",special:"ignore_armor"}},aC={smugglingCompartments:{id:"smugglingCompartments",name:"Smuggling Compartments",description:"Hide from sight and sensors if captured or boarded",effect:"Rebels can hide in secret compartments during capture/boarding",cost:1,category:"misc",special:"stealth"},asteroidMiningDrill:{id:"asteroidMiningDrill",name:"Asteroid Mining Drill",damage:"1d8",description:"Bore a tunnel through solid rock at slow speed. Pilot can attack with PRS test, but their next defense test is at disadvantage",effect:"D8 damage attack but next defense has disadvantage",cost:1,category:"misc",special:"drilling"},harpoonTowCable:{id:"harpoonTowCable",name:"Harpoon and Tow Cable",description:"Copilot can attach magnetic harpoon to object of equal or lesser mass. If target is a piloted ship, test AGI",effect:"Grapple and tow objects or enemy ships",cost:1,category:"misc",special:"grapple"},hyperspaceDestabilizer:{id:"hyperspaceDestabilizer",name:"Hyperspace Destabilizer",description:"Makes jumping to Hyperspace impossible in a wide area while active",effect:"Prevent all hyperspace jumps in combat zone",cost:1,category:"misc",special:"anti_hyperspace"}},gP={...vo,...sC,...aC},IS=[{id:"galaxyRewards",name:"Galaxy Rewards",description:"Heroic upgrades earned by saving the galaxy - cannot be purchased",items:[],isHeroic:!0},{id:"torpedoes",name:"Torpedoes",description:"Advanced munitions for devastating attacks",items:Object.keys(vo).filter(t=>t!=="standard")},{id:"turrets",name:"Turret Upgrades",description:"Weapon system enhancements",items:Object.keys(sC)},{id:"misc",name:"Miscellaneous",description:"Utility systems and specialized equipment",items:Object.keys(aC)}];function PS(t){return gP[t]}function yP({isOpen:t,onClose:e}){const{gameState:n,updateGameState:r,addLog:a}=Ge(),{character:i,updateField:c}=as(),[u,h]=E.useState("galaxyRewards"),[p,m]=E.useState(null),[g,x]=E.useState(null),[v,w]=E.useState(!1);if(E.useEffect(()=>{const D=I=>{I.key==="Escape"&&t&&e()};return document.addEventListener("keydown",D),()=>document.removeEventListener("keydown",D)},[t,e]),E.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[t]),!t)return null;const N=i?.bits||0,S=n.ship||{},j=gN(S),A=async D=>{const I=PS(D);if(!i){a("No active character to purchase from","error");return}if(!Ew(N,I.cost)){a(`Not enough Bits to purchase ${I.name}`,"error");return}try{await c("bits",N-I.cost)}catch(W){console.error("Failed to deduct bits:",W),a("Failed to complete purchase","error");return}r(W=>{const ue={...W.ship};return I.category==="torpedo"?ue.torpedoInventory={...ue.torpedoInventory,[D]:(ue.torpedoInventory[D]||0)+1}:ue.purchasedUpgrades.includes(D)||(ue.purchasedUpgrades=[...ue.purchasedUpgrades,D]),{...W,ship:ue}}),a(`Purchased ${I.name} for ${I.cost} Bits`,"info"),m(D),setTimeout(()=>m(null),2e3)},$=IS.find(D=>D.id===u),L=u==="galaxyRewards",R=()=>{if(!g||j===0)return;r(I=>{const W={...I.ship,heroicUpgrades:[...I.ship.heroicUpgrades,g]};return{...I,ship:W}});const D=BS[g].name;a(`Heroic upgrade installed: ${D}!`,"success"),w(!0),setTimeout(()=>{w(!1),x(null)},2e3)},M=l.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4 md:p-12 lg:p-16 animate-fadeIn",onClick:e,children:l.jsxs("div",{className:`bg-bg-secondary/95 backdrop-blur-md border-3 w-full h-full max-w-[1000px] max-h-[82vh] overflow-hidden flex flex-col shadow-2xl ${L?"border-violet-400 shadow-violet-400/30":"border-accent-cyan shadow-accent-cyan/30"}`,onClick:D=>D.stopPropagation(),children:[l.jsxs("div",{className:`border-b-3 p-6 flex items-center justify-between flex-shrink-0 ${L?"border-violet-400/30 bg-gradient-to-r from-violet-500/10 to-transparent":"border-accent-cyan/30 bg-gradient-to-r from-accent-cyan/5 to-transparent"}`,children:[l.jsxs("div",{className:"flex items-center gap-4",children:[L?l.jsx(pr,{className:"w-8 h-8 text-violet-400 drop-shadow-glow"}):l.jsx(gg,{className:"w-8 h-8 text-accent-cyan"}),l.jsxs("div",{children:[l.jsx("h2",{className:`font-orbitron font-black text-2xl md:text-3xl tracking-wider ${L?"text-violet-400":"text-accent-cyan text-glow-cyan"}`,children:L?"GALAXY REWARDS":"UPGRADE SHOP"}),l.jsx("p",{className:"text-sm text-gray-400 font-orbitron mt-1",children:L?"Heroic Upgrades for Saving the Galaxy":'"What A Piece Of Junk!"'})]})]}),l.jsxs("div",{className:"flex items-center gap-4",children:[!L&&l.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 border-3 border-accent-yellow bg-accent-yellow/15 shadow-lg shadow-accent-yellow/20",children:[l.jsx(fg,{className:"w-5 h-5 text-accent-yellow"}),l.jsxs("span",{className:"font-orbitron text-accent-yellow font-bold text-lg",children:[N," Bits"]})]}),L&&l.jsxs("div",{className:"flex items-center gap-3 px-4 py-2 border-3 border-violet-400 bg-violet-500/15 shadow-lg shadow-violet-500/20",children:[l.jsx(mr,{className:"w-5 h-5 text-violet-400"}),l.jsxs("span",{className:"font-orbitron text-violet-400 font-bold text-lg",children:[j," Available"]})]}),l.jsx("button",{onClick:e,className:"p-3 text-gray-400 hover:text-accent-red hover:bg-accent-red/10 border-2 border-transparent hover:border-accent-red transition-all rounded",title:"Close (ESC)",children:l.jsx(Er,{className:"w-6 h-6"})})]})]}),l.jsx("div",{className:"border-b-2 border-gray-700 flex bg-bg-primary/30 flex-shrink-0",children:IS.map(D=>{const I=u===D.id,W=D.id==="galaxyRewards",he=(()=>{switch(D.id){case"galaxyRewards":return pr;case"torpedoes":return In;case"turrets":return Va;case"misc":return ic;default:return gg}})();return l.jsxs("button",{onClick:()=>h(D.id),className:`flex-1 px-4 py-4 font-orbitron text-sm transition-all duration-200 relative group ${I?W?"bg-violet-500/20 text-violet-400 border-b-3 border-violet-400":"bg-accent-cyan/20 text-accent-cyan border-b-3 border-accent-cyan":"text-gray-400 hover:text-text-primary hover:bg-white/5"}`,children:[l.jsxs("div",{className:"flex items-center justify-center gap-2",children:[l.jsx(he,{className:`w-4 h-4 transition-transform group-hover:scale-110 ${I?"animate-pulse":""}`}),l.jsx("span",{className:"hidden sm:inline",children:D.name})]}),I&&l.jsx("div",{className:`absolute bottom-0 left-0 right-0 h-1 ${W?"bg-violet-400":"bg-accent-cyan"} shadow-lg ${W?"shadow-violet-500/50":"shadow-accent-cyan/50"}`})]},D.id)})}),l.jsx("div",{className:`px-6 py-4 border-b-2 border-gray-700 flex-shrink-0 ${L?"bg-gradient-to-r from-violet-500/10 to-transparent":"bg-bg-primary/50"}`,children:l.jsx("p",{className:"text-base text-gray-300 font-orbitron",children:$.description})}),l.jsx("div",{className:"flex-1 overflow-y-auto p-8 custom-scrollbar",children:l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:L?Object.entries(BS).map(([D,I])=>{const W=sn(S,D),ue=j>0&&!W,he=g===D;return l.jsxs("button",{onClick:()=>ue&&x(D),disabled:!ue||v,className:`border-3 p-5 transition-all duration-300 flex flex-col group relative overflow-hidden text-left ${W?"border-violet-400 bg-gradient-to-br from-violet-500/15 to-violet-500/5 cursor-default":he?"border-violet-400 bg-violet-500/20 scale-105 shadow-lg shadow-violet-500/30 cursor-pointer":ue?"border-gray-700 bg-gray-900/50 hover:border-violet-400/50 hover:bg-violet-500/5 cursor-pointer":"border-gray-700 bg-gray-900/50 cursor-not-allowed opacity-75"} ${v?"opacity-50":""}`,children:[W&&l.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-violet-500/10 transform rotate-45 translate-x-8 -translate-y-8"}),he&&l.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-violet-500/20 transform rotate-45 translate-x-8 -translate-y-8"}),l.jsxs("div",{className:"flex items-start justify-between mb-4 relative z-10",children:[l.jsx("div",{className:"flex-1 min-w-0",children:l.jsx("h3",{className:"font-orbitron font-bold text-base mb-1 flex items-center gap-2",children:l.jsx("span",{className:W?"text-violet-400":he?"text-violet-300":"text-gray-300",children:I.name})})}),W?l.jsx(mr,{className:"w-5 h-5 text-violet-400 fill-violet-400 flex-shrink-0 ml-2"}):he?l.jsx(mr,{className:"w-5 h-5 text-violet-400 flex-shrink-0 ml-2"}):l.jsx(Iw,{className:"w-5 h-5 text-gray-500 flex-shrink-0 ml-2"})]}),l.jsx("p",{className:`text-sm mb-4 flex-1 leading-relaxed ${W?"text-gray-300":"text-gray-500"}`,children:I.description}),l.jsx("div",{className:`text-center py-3 px-4 rounded transition-all ${W?"bg-violet-500/25 text-violet-400 border-2 border-violet-400/70 shadow-lg shadow-violet-500/20":he?"bg-violet-500/30 text-violet-300 border-2 border-violet-400 shadow-lg shadow-violet-500/30":ue?"bg-gray-800/50 text-gray-400 border-2 border-gray-700/50 group-hover:border-violet-400/30":"bg-gray-800/50 text-gray-500 border-2 border-gray-700/50"}`,children:l.jsx("p",{className:"text-sm font-orbitron font-bold uppercase tracking-wide",children:W?l.jsxs("span",{className:"flex items-center justify-center gap-2",children:[l.jsx(Ks,{className:"w-5 h-5"}),"Installed"]}):he?l.jsxs("span",{className:"flex items-center justify-center gap-2",children:[l.jsx(mr,{className:"w-5 h-5"}),"Selected"]}):ue?l.jsxs("span",{className:"flex items-center justify-center gap-2",children:[l.jsx(pr,{className:"w-5 h-5"}),"Click to Select"]}):l.jsxs("span",{className:"flex items-center justify-center gap-2",children:[l.jsx(Iw,{className:"w-5 h-5"}),"Save Galaxy to Unlock"]})})})]},D)}):$.items.map(D=>{const I=PS(D),W=n.ship.purchasedUpgrades.includes(D)||(n.ship.torpedoInventory[D]||0)>0,ue=n.ship.torpedoInventory[D]||0,he=Ew(N,I.cost),J=p===D;return l.jsxs("div",{className:`border-3 p-5 transition-all duration-300 flex flex-col relative overflow-hidden group ${J?"border-accent-yellow bg-accent-yellow/20 scale-105 shadow-lg shadow-accent-yellow/30":W?"border-accent-cyan/50 bg-accent-cyan/5":"border-gray-700 hover:border-accent-cyan/50 hover:shadow-lg hover:shadow-accent-cyan/10 card-hover"}`,children:[l.jsxs("div",{className:"absolute top-3 right-3 z-10",children:[I.category==="torpedo"&&l.jsxs("div",{className:"px-2 py-1 bg-accent-red/20 border border-accent-red/40 rounded text-xs font-orbitron text-accent-red flex items-center gap-1",children:[l.jsx(In,{className:"w-3 h-3"}),"Torpedo"]}),I.category==="turret"&&l.jsxs("div",{className:"px-2 py-1 bg-accent-cyan/20 border border-accent-cyan/40 rounded text-xs font-orbitron text-accent-cyan flex items-center gap-1",children:[l.jsx(Va,{className:"w-3 h-3"}),"Turret"]}),I.category==="misc"&&l.jsxs("div",{className:"px-2 py-1 bg-gray-600/20 border border-gray-500/40 rounded text-xs font-orbitron text-gray-400 flex items-center gap-1",children:[l.jsx(ic,{className:"w-3 h-3"}),"Misc"]})]}),l.jsx("div",{className:"mb-3 pr-20",children:l.jsx("h3",{className:"font-orbitron font-bold text-text-primary text-base",children:I.name})}),l.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[I.damage&&l.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 text-sm text-accent-red font-orbitron bg-accent-red/15 border border-accent-red/40 rounded shadow-sm",children:[l.jsx(In,{className:"w-3 h-3"}),I.damage]}),I.category==="torpedo"&&ue>0&&l.jsxs("span",{className:"inline-flex items-center gap-1 px-3 py-1 text-sm text-accent-cyan font-orbitron bg-accent-cyan/15 border border-accent-cyan/40 rounded shadow-sm",children:["Owned: ",ue]})]}),l.jsx("p",{className:"text-sm text-gray-300 mb-4 flex-1 leading-relaxed",children:I.description}),I.effect&&l.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-700/50",children:[l.jsx("p",{className:"text-xs mb-1 font-orbitron text-gray-500 uppercase tracking-wider",children:"Effect"}),l.jsx("p",{className:"text-sm text-accent-cyan font-orbitron",children:I.effect})]}),l.jsxs("div",{className:"flex items-center justify-between gap-3 mt-auto",children:[l.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-accent-yellow/10 border border-accent-yellow/30 rounded",children:[l.jsx(fg,{className:"w-4 h-4 text-accent-yellow"}),l.jsxs("span",{className:"font-orbitron font-bold text-accent-yellow",children:[I.cost," Bits"]})]}),l.jsx(ge,{variant:he&&i?"primary":"ghost",onClick:()=>A(D),disabled:!he||J||!i,className:`flex-1 px-4 py-2 text-sm ${J?"bg-accent-yellow border-accent-yellow text-bg-primary":""}`,children:J?l.jsxs("span",{className:"flex items-center justify-center gap-2",children:[l.jsx(Ks,{className:"w-4 h-4"}),"Purchased!"]}):i?he?"Purchase":"Too Expensive":"No Character"})]})]},D)})})}),L&&g&&j>0?l.jsxs("div",{className:"border-t-3 border-violet-400/30 p-4 bg-violet-500/10 flex-shrink-0 flex items-center justify-between",children:[l.jsx("p",{className:"text-sm text-gray-400 font-orbitron",children:v?"Heroic upgrade installed!":"Confirm your selection to install the upgrade"}),l.jsx(ge,{variant:"primary",onClick:R,disabled:v,className:`flex items-center gap-2 px-6 ${v?"bg-violet-500 border-violet-500":"border-violet-400 text-violet-400 bg-violet-500/20 hover:bg-violet-500/30 glow-pulse"}`,children:v?l.jsxs(l.Fragment,{children:[l.jsx(Ks,{className:"w-5 h-5"}),"Installed!"]}):l.jsxs(l.Fragment,{children:[l.jsx(pr,{className:"w-5 h-5"}),"Claim Reward"]})})]}):l.jsxs("div",{className:"border-t-3 border-gray-700 p-4 bg-bg-primary/50 flex-shrink-0 flex items-center justify-between",children:[l.jsx("p",{className:"text-sm text-gray-500 font-orbitron",children:L?j>0?"Select an upgrade above to claim your reward":"Save the galaxy to earn heroic upgrades!":"Prices are for black market goods - no refunds!"}),l.jsxs("p",{className:"text-xs text-gray-600 font-orbitron",children:["Press ",l.jsx("kbd",{className:"px-2 py-1 bg-gray-800 border border-gray-700 rounded",children:"ESC"})," to close"]})]})]})});return ko.createPortal(M,document.body)}function xP(){const{spaceCombat:t,modifyArmor:e,chargeHyperdrive:n,decrementHyperdrive:r}=pn(),{gameState:a,updateGameState:i}=Ge(),{partyMembers:c}=Ja(),{play:u}=Cc(),{shipArmor:h,hyperdriveCharge:p}=t,m=a.ship||{name:"The Rebel Corvette",heroicUpgrades:[],purchasedUpgrades:[],turboLaserStation:null},g=E.useRef(h),x=E.useRef(null),[v,w]=E.useState(!1),[N,S]=E.useState(""),[j,A]=E.useState(!1),$=mP.find(_=>_.tier===h),L=gN(m);E.useEffect(()=>{h===0&&g.current>0?(x.current||(x.current=new Audio(Q2("sounds/alarm-critical.mp3")),x.current.loop=!0,x.current.volume=.4),x.current.play().catch(()=>{})):h>0&&x.current&&(x.current.pause(),x.current.currentTime=0),g.current=h},[h]),E.useEffect(()=>()=>{x.current&&(x.current.pause(),x.current=null)},[]);const R=()=>{const _=MD();i(V=>({...V,ship:{...V.ship,name:_}}))},M=()=>{S(m.name),w(!0)},D=()=>{N.trim()&&i(_=>({..._,ship:{..._.ship,name:N.trim()}})),w(!1)},I=()=>{w(!1),S("")},W=_=>{_.key==="Enter"?D():_.key==="Escape"&&I()},ue=h===0?MO:h===1?AO:vc,he=()=>h===0?"text-accent-red":h===1?"text-accent-yellow":"text-accent-cyan",J=()=>h===0?"glow-pulse-red":h===1?"glow-pulse-yellow":"glow-pulse-cyan";return l.jsxs("div",{className:"bg-bg-secondary/80 backdrop-blur-sm border-3 border-accent-cyan p-4 xl:p-5 space-y-4",children:[l.jsxs("div",{className:"flex items-center justify-between gap-2",children:[l.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[l.jsx(zN,{className:"w-5 h-5 xl:w-6 xl:h-6 text-accent-cyan flex-shrink-0"}),v?l.jsx("input",{type:"text",value:N,onChange:_=>S(_.target.value),onBlur:D,onKeyDown:W,autoFocus:!0,className:"flex-1 min-w-0 bg-bg-primary border-2 border-accent-cyan text-accent-cyan font-orbitron font-bold text-base xl:text-lg px-2 py-1 focus:outline-none focus:border-accent-yellow uppercase"}):l.jsx("h2",{onClick:M,className:"font-orbitron font-bold text-accent-cyan text-base xl:text-lg uppercase cursor-pointer hover:text-accent-yellow transition-colors truncate",title:"Click to edit ship name",children:m.name})]}),l.jsxs("div",{className:"flex items-center gap-1 flex-shrink-0",children:[l.jsx("button",{onClick:R,className:"p-1.5 text-accent-cyan hover:text-accent-yellow hover:bg-accent-cyan/10 transition-all border-2 border-transparent hover:border-accent-cyan rounded",title:"Generate new ship name",children:l.jsx(tr,{className:"w-4 h-4"})}),l.jsxs("button",{onClick:()=>A(!0),className:"relative p-1.5 text-accent-cyan hover:text-accent-yellow hover:bg-accent-cyan/10 transition-all border-2 border-transparent hover:border-accent-cyan rounded",title:"Open upgrade shop",children:[l.jsx(gg,{className:"w-4 h-4"}),L>0&&l.jsx("span",{className:"absolute -top-1 -right-1 bg-violet-500 text-white text-[10px] px-1 rounded-full font-bold shadow-lg shadow-violet-500/50 animate-pulse leading-none",children:L})]})]})]}),l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"flex items-center justify-center gap-4",children:[l.jsxs("div",{className:"relative flex items-center justify-center",children:[l.jsx("div",{className:`absolute inset-0 flex items-center justify-center ${h>0?"shield-active":""}`,children:l.jsx("div",{className:`w-20 h-20 rounded-full border-2 ${h===3?"border-accent-cyan":h===2?"border-accent-cyan/60":h===1?"border-accent-yellow/60":"border-accent-red/60"} ${h>0?"shield-pulse":""}`})}),l.jsx(ue,{className:`w-16 h-16 ${he()} ${h>0?J():""} relative z-10`})]}),l.jsxs("div",{className:"flex-1 space-y-1",children:[l.jsxs("div",{className:"flex items-baseline gap-3",children:[l.jsxs("span",{className:`text-2xl font-orbitron font-bold ${he()}`,children:["Tier ",h]}),l.jsx("span",{className:`text-lg font-orbitron font-bold ${he()}`,children:$.damage>0?`-D${$.damage}`:"-D0"})]}),l.jsxs("div",{className:"text-xs text-gray-500 font-orbitron",children:["MAX: Tier ",io(m),io(m)===3&&l.jsx("span",{className:"ml-1 text-accent-yellow",children:"(Overcharged)"})]})]})]}),l.jsx("div",{className:"space-y-1",children:l.jsx("div",{className:"flex gap-1",children:Array.from({length:io(m)},(_,V)=>V).map(_=>l.jsx("div",{className:`flex-1 h-2 border-2 transition-all rounded-sm ${_<h?h===1||h===3?"bg-accent-yellow border-accent-yellow":"bg-accent-cyan border-accent-cyan":"border-gray-600 bg-transparent"}`},_))})}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("button",{onClick:()=>e(-1),disabled:h===0,className:"flex-1 px-3 py-1.5 bg-accent-red/20 border-2 border-accent-red text-accent-red font-orbitron text-xs hover:bg-accent-red hover:text-bg-primary transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:"- Tier"}),l.jsx("button",{onClick:()=>e(1),disabled:h>=io(m),className:"flex-1 px-3 py-1.5 bg-accent-cyan/20 border-2 border-accent-cyan text-accent-cyan font-orbitron text-xs hover:bg-accent-cyan hover:text-bg-primary transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:"+ Tier"})]}),h===0&&l.jsx("div",{className:"border-2 border-accent-red bg-accent-red/10 p-2 inline-alert-pulse",children:l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx(ar,{className:"w-4 h-4 text-accent-red flex-shrink-0 mt-0.5"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-accent-red text-xs font-orbitron font-bold uppercase",children:"SHIELDS DOWN"}),l.jsx("p",{className:"text-text-primary text-xs",children:"No damage reduction! Repair immediately!"})]})]})})]}),(sn(m,"overchargeShields")||sn(m,"boosterRockets")||sn(m,"torpedoWinch")||sn(m,"turboLasers"))&&l.jsxs("div",{className:"border-2 border-accent-yellow/40 bg-accent-yellow/5 p-3 space-y-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(mr,{className:"w-4 h-4 text-accent-yellow"}),l.jsx("p",{className:"text-xs font-orbitron font-bold uppercase text-accent-yellow",children:"Active Upgrades"})]}),l.jsxs("div",{className:"space-y-1.5",children:[sn(m,"overchargeShields")&&l.jsxs("div",{className:"text-xs text-gray-300 font-mono flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-cyan",children:""}),l.jsx("span",{children:"Overcharge Shields: Max Tier 3"})]}),sn(m,"boosterRockets")&&l.jsxs("div",{className:"text-xs text-gray-300 font-mono flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-cyan",children:""}),l.jsx("span",{children:"Booster Rockets: Steady affects D2 attacks"})]}),sn(m,"torpedoWinch")&&l.jsxs("div",{className:"text-xs text-gray-300 font-mono flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-cyan",children:""}),l.jsx("span",{children:"Torpedo Winch: Any station can load"})]}),sn(m,"turboLasers")&&l.jsxs("div",{className:"space-y-2",children:[l.jsxs("div",{className:"text-xs text-gray-300 font-mono flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-cyan",children:""}),l.jsxs("span",{children:["Turbo Lasers: ",m.turboLaserStation?`${m.turboLaserStation==="gunner1"?"Gunner 1":"Gunner 2"} deals D8`:"Not configured"]})]}),!m.turboLaserStation&&l.jsxs("div",{className:"ml-4 flex gap-2",children:[l.jsx(ge,{size:"sm",onClick:()=>{i(_=>({..._,ship:{..._.ship,turboLaserStation:"gunner1"}}))},className:"flex-1 text-xs px-2 py-1 border-accent-red text-accent-red hover:bg-accent-red hover:text-bg-primary",children:"Gunner 1"}),l.jsx(ge,{size:"sm",onClick:()=>{i(_=>({..._,ship:{..._.ship,turboLaserStation:"gunner2"}}))},className:"flex-1 text-xs px-2 py-1 border-accent-red text-accent-red hover:bg-accent-red hover:text-bg-primary",children:"Gunner 2"})]}),m.turboLaserStation&&l.jsx("div",{className:"ml-4",children:l.jsx("button",{onClick:()=>{i(_=>({..._,ship:{..._.ship,turboLaserStation:null}}))},className:"text-[10px] text-gray-400 hover:text-accent-yellow transition-colors underline",children:"Reconfigure"})})]})]})]}),l.jsxs("div",{className:`border-2 p-3 transition-all ${p===3?"border-accent-yellow bg-accent-yellow/10":p>0?"border-accent-yellow/60 bg-accent-yellow/5":"border-gray-600 bg-gray-900/30"}`,children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(ac,{className:`w-4 h-4 ${p===3?"text-accent-yellow":p>0?"text-accent-yellow/80":"text-gray-500"}`}),l.jsxs("p",{className:`text-xs font-orbitron font-bold uppercase ${p===3?"text-accent-yellow":p>0?"text-accent-yellow/80":"text-gray-500"}`,children:["Hyperdrive ",p===3?"Ready":p>0?"Charging":"Idle"]})]}),l.jsxs("span",{className:`font-orbitron text-sm ${p===3?"text-accent-yellow":p>0?"text-accent-yellow/80":"text-gray-500"}`,children:[p,"/3"]})]}),l.jsx("div",{className:"flex gap-1 mb-2",children:[1,2,3].map(_=>l.jsx("div",{className:`flex-1 h-2 border-2 transition-all rounded-sm ${_<=p?p===3?"bg-accent-yellow border-accent-yellow hyperdrive-charge-pulse":"bg-accent-yellow/80 border-accent-yellow/80":"border-gray-600 bg-transparent"}`},_))}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("button",{onClick:()=>r(),disabled:p===0,className:"flex-1 px-3 py-1.5 bg-accent-red/20 border-2 border-accent-red text-accent-red font-orbitron text-xs hover:bg-accent-red hover:text-bg-primary transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:"- Charge"}),l.jsx("button",{onClick:()=>{n(),u("hyperdriveCharge",.5)},disabled:p>=3,className:"flex-1 px-3 py-1.5 bg-accent-yellow/20 border-2 border-accent-yellow text-accent-yellow font-orbitron text-xs hover:bg-accent-yellow hover:text-bg-primary transition-all disabled:opacity-30 disabled:cursor-not-allowed",children:"+ Charge"})]}),p===3&&l.jsxs(l.Fragment,{children:[l.jsx("p",{className:"text-accent-yellow text-xs mt-2 font-orbitron text-center animate-pulse",children:" READY TO JUMP! "}),l.jsx("p",{className:"text-accent-red text-xs mt-1 font-orbitron text-center",children:" 4+ enemies = ship destroyed"})]})]}),l.jsx("div",{className:"border-t border-gray-700 pt-3",children:l.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2 text-xs text-gray-400 font-orbitron",children:[l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"text-accent-cyan",children:""}),"Crew: ",c?.length||0," Rebel",(c?.length||0)!==1?"s":""]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"text-accent-cyan",children:""}),"Stations: ",Object.values(t.stationAssignments||{}).filter(Boolean).length,"/6"]}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"text-accent-cyan",children:""}),"Torpedoes: ",t.torpedoesLoaded||0]})]})}),l.jsx(yP,{isOpen:j,onClose:()=>A(!1)})]})}function Lh({station:t,assignedCharacterId:e,onAssign:n,onUnassign:r,children:a}){const{partyMembers:i}=Ja(),{spaceCombat:c}=pn(),{gameState:u}=Ge(),h=u.ship||{heroicUpgrades:[],purchasedUpgrades:[],turboLaserStation:null},p=i.find(x=>x.id===e),m=!!p,g=i.filter(x=>!Object.values(c.stationAssignments).includes(x.id));return l.jsxs("div",{className:`bg-bg-secondary/90 backdrop-blur-sm border-3 p-3 transition-all ${m?"border-accent-cyan glow-cyan":"border-gray-600 hover:border-accent-yellow/50"}`,children:[l.jsxs("div",{className:"flex items-center justify-between mb-3 pb-2 border-b-2 border-gray-700",children:[l.jsxs("div",{className:"flex-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("h3",{className:`font-orbitron font-bold text-sm uppercase ${m?"text-accent-cyan":"text-gray-400"}`,children:t.name}),t.id==="pilot"&&sn(h,"boosterRockets")&&l.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 text-[10px] font-orbitron font-bold uppercase bg-accent-yellow/20 border border-accent-yellow/50 text-accent-yellow rounded",title:"Booster Rockets: Steady affects D2 attacks",children:[l.jsx(ac,{className:"w-2.5 h-2.5"}),"Boosters"]}),(t.id==="gunner1"||t.id==="gunner2")&&sn(h,"turboLasers")&&h.turboLaserStation===t.id&&l.jsxs("span",{className:"inline-flex items-center gap-1 px-1.5 py-0.5 text-[10px] font-orbitron font-bold uppercase bg-accent-red/20 border border-accent-red/50 text-accent-red rounded animate-pulse",title:"Turbo Lasers: Deals D8 damage",children:[l.jsx(In,{className:"w-2.5 h-2.5"}),"Turbo"]})]}),l.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:t.description})]}),l.jsx("div",{className:"flex items-center gap-2",children:m?l.jsx(Fs,{className:"w-4 h-4 text-accent-cyan"}):l.jsx(ZO,{className:"w-4 h-4 text-gray-600"})})]}),l.jsx("div",{className:"mb-3",children:m?l.jsxs("div",{className:"flex items-center justify-between p-2 bg-accent-cyan/10 border-2 border-accent-cyan/30 rounded",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-orbitron text-accent-cyan font-bold",children:p.name}),l.jsx("p",{className:"text-xs text-gray-400",children:p.class?p.class.charAt(0).toUpperCase()+p.class.slice(1):"Rebel"})]}),l.jsx("button",{onClick:()=>r(t.id),className:"px-2 py-1 text-xs font-orbitron text-accent-red border-2 border-accent-red/30 hover:bg-accent-red hover:text-bg-primary transition-all",children:"UNASSIGN"})]}):l.jsxs("div",{className:"space-y-2",children:[l.jsx("p",{className:"text-xs text-gray-500 font-orbitron uppercase",children:"Station Unmanned"}),g.length>0?l.jsx("div",{className:"space-y-1 max-h-24 overflow-y-auto",children:g.map(x=>l.jsxs("button",{onClick:()=>n(t.id,x.id),className:"w-full px-2 py-1 text-xs font-orbitron text-left text-accent-yellow border-2 border-accent-yellow/30 hover:bg-accent-yellow hover:text-bg-primary transition-all",children:["Assign: ",x.name]},x.id))}):l.jsx("p",{className:"text-xs text-gray-600 italic",children:"All rebels assigned"})]})}),l.jsx("div",{className:`${m?"":"opacity-40 pointer-events-none"}`,children:a})]})}function bP({onSelect:t,selectedType:e="standard"}){const{gameState:n}=Ge(),[r,a]=E.useState(!1),i=k_(n.ship),c=[{type:"standard",count:""},...i.filter(p=>p.type!=="standard")];if(c.length===1)return null;const u=vo[e],h=p=>{t(p),a(!1)};return l.jsxs("div",{className:"relative",children:[l.jsxs("button",{onClick:()=>a(!r),className:"w-full px-3 py-2 bg-bg-primary border-2 border-accent-yellow/30 hover:border-accent-yellow transition-all flex items-center justify-between group",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx(In,{className:"w-4 h-4 text-accent-yellow"}),l.jsxs("div",{className:"text-left",children:[l.jsx("p",{className:"text-xs font-orbitron text-accent-yellow",children:u.name}),l.jsx("p",{className:"text-[10px] text-gray-400",children:u.damage||"Defensive"})]})]}),l.jsx(No,{className:`w-4 h-4 text-gray-400 group-hover:text-accent-yellow transition-all ${r?"rotate-180":""}`})]}),r&&l.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-bg-secondary border-3 border-accent-yellow z-50 max-h-64 overflow-y-auto",children:c.map(({type:p,count:m})=>{const g=vo[p],x=p===e;return l.jsxs("button",{onClick:()=>h(p),className:`w-full px-3 py-2 text-left border-b border-gray-700 last:border-0 transition-all ${x?"bg-accent-yellow/20 border-l-4 border-l-accent-yellow":"hover:bg-accent-yellow/10"}`,children:[l.jsxs("div",{className:"flex items-center justify-between mb-1",children:[l.jsx("p",{className:"text-sm font-orbitron text-text-primary",children:g.name}),l.jsxs("span",{className:"text-xs font-orbitron text-accent-cyan flex items-center gap-1",children:[l.jsx(In,{className:"w-3 h-3"}),m]})]}),l.jsx("p",{className:"text-xs text-gray-400 mb-1",children:g.description}),l.jsxs("div",{className:"flex items-center justify-between",children:[g.damage&&l.jsx("span",{className:"text-xs text-accent-red font-orbitron",children:g.damage}),g.special&&l.jsx("span",{className:"text-[10px] text-accent-yellow",children:g.special.replace("_"," ").toUpperCase()})]})]},p)})})]})}const vP={attack:In,defense:vc,support:GN,special:Va};function $h({stationId:t,actionIds:e,assignedCharacterId:n}){const{addCombatLog:r,spaceCombat:a,fireTorpedo:i,modifyArmor:c,loadTorpedoes:u,chargeHyperdrive:h}=pn(),{partyMembers:p}=Ja(),{gameState:m,updateGameState:g}=Ge(),{play:x}=Cc(),[v,w]=E.useState(null),[N,S]=E.useState("standard"),[j,A]=E.useState({}),[$,L]=E.useState(null),R=p.find(_=>_.id===n),M=m.ship||{heroicUpgrades:[],purchasedUpgrades:[],turboLaserStation:null};let D=e.map(_=>{const V={...$S[_]};return!V||!V.id?(console.error(`Action not found for id: ${_}`),null):(V.id==="fireLaserTurret"&&(V.damage=N_(M,t),sn(M,"turboLasers")&&M.turboLaserStation===t&&(V.upgradeBadge={text:"D8",color:"accent-red",icon:"zap"})),V.id==="steady"&&sn(M,"boosterRockets")&&(V.description="Test KNW to grant advantage to the next D2 attacks against enemies",V.effect="Next D2 ally attacks have advantage",V.upgradeBadge={text:"D2 Targets",color:"accent-yellow",icon:"rocket"}),V.id==="loadTorpedo"&&Rw(M),V)}).filter(Boolean);if(Rw(M)&&!e.includes("loadTorpedo")){const _={...$S.loadTorpedo};_.upgradeBadge={text:"Winch",color:"accent-cyan",icon:"wrench"},D.push(_)}const I=_=>!R||!R.stats?0:R.stats[_.toLowerCase()]||0,W=_=>j[_]||{rollMode:"normal",drAdjust:0},ue=(_,V)=>{A(F=>({...F,[_]:{...W(_),...V}}))},he=_=>{L(V=>V===_?null:_)},J=async _=>{if(!R)return;if(_.requiresTorpedo&&a.torpedoesLoaded===0){r(`${_.name} failed: No torpedoes loaded!`,"damage");return}w(_.id);const V={fireLaserTurret:"laserFire",fixedBeamCannon:"laserFire",fireTorpedo:"torpedoFire",hyperdriveJump:"hyperdriveCharge",evade:"evade",targetLock:"targetLock",jamming:"jamming",repairShield:"repairShield",loadTorpedo:"loadTorpedo",deflectors:"deflectors",steady:"steady"};if(V[_.id]&&x(V[_.id],.5),_.type==="instant"){await new Promise(we=>setTimeout(we,300));let ae=`${R.name} - ${_.name}: `;_.id==="hyperdriveJump"&&(h(),ae+=`Hyperdrive charged (${a.hyperdriveCharge+1}/3)!`),r(ae,_.type),w(null);return}await new Promise(ae=>setTimeout(ae,600));const F=W(_.id),O=_.dr+F.drAdjust,K=I(_.ability),Z=iP(K,O,F.rollMode==="advantage",F.rollMode==="disadvantage"),{roll:X,total:te,success:T,crit:z,blunder:H}=Z;let Q=`${R.name} - ${_.name}: `,de=_.type,fe={rollMode:F.rollMode,drAdjust:F.drAdjust,baseDR:_.dr,effectiveDR:O};if(z)Q+=`CRITICAL! (20 + ${K} = ${te})`,de="attack";else if(H)Q+=`BLUNDER! (1 + ${K} = ${te})`,de="damage",_.type==="defense"&&(c(-1),Q+=" - Shield degraded!");else{let ae="";F.rollMode==="advantage"||F.rollMode==="disadvantage"?ae=`[ADV/DIS: ${X}]`:ae=`${X}`;let we=`DR${O}`;F.drAdjust!==0&&(we+=` (base ${_.dr} ${F.drAdjust>0?"+":""}${F.drAdjust})`),Q+=`${T?"SUCCESS":"FAIL"} (${ae} + ${K} = ${te} vs ${we})`}if(_.requiresTorpedo&&(i(),N!=="standard")){g(we=>{const me={...we.ship};return me.torpedoInventory={...me.torpedoInventory,[N]:Math.max(0,(me.torpedoInventory[N]||0)-1)},{...we,ship:me}});const ae=vo[N].name;Q+=` - Used ${ae}!`}if(T&&_.damage){let ae=_.damage;if(_.id==="fireTorpedo"&&N){const we=vo[N];we&&we.damage&&we.damage!=="0"&&(ae=we.damage)}if(ae&&ae!=="0"){const we=ae.match(/(\d+)d(\d+)/);if(we){const[,me,tt]=we,mt=qy(parseInt(me),parseInt(tt));Q+=` - Dealt ${mt} damage!`}}else _.id==="fireTorpedo"&&N==="chaff"&&(Q+=" - Defensive screen deployed!")}if(T){if(_.id==="repairShield"){const ae=io(M);c(1),Q+=` - Shield repaired! (Max tier: ${ae})`}else if(_.id==="loadTorpedo"){const ae=Ne(2);u(ae),Q+=` - Loaded ${ae} torpedo${ae>1?"es":""}!`}}r(Q,de,fe),w(null)};return l.jsxs("div",{className:"space-y-2",children:[l.jsx("p",{className:"text-xs text-gray-400 font-orbitron uppercase mb-2",children:"Available Actions:"}),D.some(_=>_.id==="fireTorpedo")&&a.torpedoesLoaded>0&&l.jsxs("div",{className:"mb-3",children:[l.jsx("p",{className:"text-xs text-gray-400 font-orbitron uppercase mb-1",children:"Select Torpedo:"}),l.jsx(bP,{selectedType:N,onSelect:S})]}),D.map((_,V)=>{const F=vP[_.type]||tr,O=v===_.id,K=_.requiresTorpedo&&a.torpedoesLoaded===0,Z=W(_.id),X=$===_.id,te=_.dr+Z.drAdjust;return l.jsxs("div",{className:"space-y-1",children:[l.jsxs("div",{className:`w-full p-2 border-2 transition-all ${O?"border-accent-yellow bg-accent-yellow/20":K?"border-gray-700 bg-gray-900/50 opacity-50":Z.rollMode==="advantage"?"border-accent-yellow/50 bg-accent-yellow/5":Z.rollMode==="disadvantage"?"border-accent-red/50 bg-accent-red/5":_.type==="attack"?"border-accent-red/30 hover:border-accent-red hover:bg-accent-red/10":_.type==="defense"?"border-accent-cyan/30 hover:border-accent-cyan hover:bg-accent-cyan/10":"border-accent-yellow/30 hover:border-accent-yellow hover:bg-accent-yellow/10"}`,children:[l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx(F,{className:`w-4 h-4 flex-shrink-0 mt-0.5 ${O?"animate-spin":""} ${_.type==="attack"?"text-accent-red":_.type==="defense"?"text-accent-cyan":"text-accent-yellow"}`}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center justify-between gap-2 mb-1",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("p",{className:"text-xs font-orbitron font-bold text-text-primary",children:_.name}),_.upgradeBadge&&l.jsxs("span",{className:`inline-flex items-center gap-1 px-1.5 py-0.5 text-[10px] font-orbitron font-bold uppercase bg-${_.upgradeBadge.color}/20 border border-${_.upgradeBadge.color}/50 text-${_.upgradeBadge.color} rounded`,children:[_.upgradeBadge.icon==="zap"&&l.jsx(In,{className:"w-2.5 h-2.5"}),_.upgradeBadge.icon==="rocket"&&l.jsx(ac,{className:"w-2.5 h-2.5"}),_.upgradeBadge.icon==="wrench"&&l.jsx(GN,{className:"w-2.5 h-2.5"}),_.upgradeBadge.text]})]}),_.type!=="instant"&&l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsxs("span",{className:"text-xs font-orbitron text-gray-400",children:[_.ability," DR",te,Z.drAdjust!==0&&l.jsxs("span",{className:"text-accent-yellow ml-1",children:["(",Z.drAdjust>0?"+":"",Z.drAdjust,")"]})]}),l.jsx("button",{onClick:T=>{T.stopPropagation(),he(_.id)},className:"p-0.5 text-gray-500 hover:text-accent-cyan transition-colors",title:"Toggle modifiers",children:X?l.jsx(ON,{className:"w-3 h-3"}):l.jsx(No,{className:"w-3 h-3"})})]})]}),l.jsx("p",{className:"text-xs text-gray-400",children:_.description}),_.damage&&l.jsxs("p",{className:"text-xs text-accent-red font-orbitron mt-1",children:["Damage: ",_.damage]}),K&&l.jsx("p",{className:"text-xs text-accent-red font-orbitron mt-1",children:"No torpedoes loaded!"}),_.warning&&l.jsxs("p",{className:"text-xs text-accent-yellow font-orbitron mt-1",children:[" ",_.warning]})]})]}),l.jsx("button",{onClick:()=>J(_),disabled:O||K||!R,className:`w-full mt-2 px-2 py-1 text-xs font-orbitron font-bold uppercase border transition-all ${O||K||!R?"opacity-50 cursor-not-allowed":"hover:bg-accent-cyan hover:text-bg-primary"} ${_.type==="attack"?"border-accent-red text-accent-red hover:bg-accent-red":_.type==="defense"?"border-accent-cyan text-accent-cyan":"border-accent-yellow text-accent-yellow hover:bg-accent-yellow"}`,children:O?_.type==="instant"?"Executing...":"Rolling...":_.type==="instant"?"Execute Action":"Roll Action"})]}),X&&_.type!=="instant"&&l.jsxs("div",{className:"bg-bg-secondary/50 border border-accent-cyan/20 p-2 space-y-2",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-gray-500 font-orbitron uppercase mb-1",children:"Roll Mode:"}),l.jsxs("div",{className:"flex gap-1",children:[l.jsx("button",{onClick:()=>ue(_.id,{rollMode:"normal"}),className:`flex-1 px-2 py-1 font-orbitron font-bold uppercase text-xs border transition-all ${Z.rollMode==="normal"?"bg-accent-cyan text-bg-primary border-accent-cyan":"bg-transparent text-accent-cyan border-accent-cyan hover:bg-accent-cyan/20"}`,children:"Normal"}),l.jsx("button",{onClick:()=>ue(_.id,{rollMode:"advantage"}),className:`flex-1 px-2 py-1 font-orbitron font-bold uppercase text-xs border transition-all ${Z.rollMode==="advantage"?"bg-accent-yellow text-bg-primary border-accent-yellow":"bg-transparent text-accent-yellow border-accent-yellow hover:bg-accent-yellow/20"}`,children:"ADV"}),l.jsx("button",{onClick:()=>ue(_.id,{rollMode:"disadvantage"}),className:`flex-1 px-2 py-1 font-orbitron font-bold uppercase text-xs border transition-all ${Z.rollMode==="disadvantage"?"bg-accent-red text-bg-primary border-accent-red":"bg-transparent text-accent-red border-accent-red hover:bg-accent-red/20"}`,children:"DIS"})]})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-xs text-gray-500 font-orbitron uppercase mb-1",children:"DR Adjustment:"}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("button",{onClick:()=>ue(_.id,{drAdjust:Math.max(-4,Z.drAdjust-1)}),disabled:Z.drAdjust<=-4,className:"px-2 py-1 border border-accent-cyan text-accent-cyan hover:bg-accent-cyan hover:text-bg-primary disabled:opacity-30 disabled:cursor-not-allowed transition-all",children:l.jsx(bc,{className:"w-3 h-3"})}),l.jsxs("div",{className:"flex-1 text-center",children:[l.jsxs("div",{className:"text-sm font-orbitron font-bold text-accent-cyan",children:["DR ",te]}),l.jsxs("div",{className:"text-xs text-gray-500 font-orbitron",children:["(Base: ",_.dr,")"]})]}),l.jsx("button",{onClick:()=>ue(_.id,{drAdjust:Math.min(4,Z.drAdjust+1)}),disabled:Z.drAdjust>=4,className:"px-2 py-1 border border-accent-cyan text-accent-cyan hover:bg-accent-cyan hover:text-bg-primary disabled:opacity-30 disabled:cursor-not-allowed transition-all",children:l.jsx(ir,{className:"w-3 h-3"})})]}),Z.drAdjust!==0&&l.jsx("button",{onClick:()=>ue(_.id,{drAdjust:0}),className:"w-full mt-1 px-2 py-1 text-xs font-orbitron text-gray-400 border border-gray-600 hover:border-accent-cyan hover:text-accent-cyan transition-all",children:"Reset to Base DR"})]})]})]},`${t}-${_.id}-${V}`)})]})}function wP(){const{spaceCombat:t,assignStation:e,unassignStation:n}=pn(),r=Dh.pilot,a=t.stationAssignments.pilot;return l.jsx(Lh,{station:r,assignedCharacterId:a,onAssign:e,onUnassign:n,children:l.jsx($h,{stationId:r.id,actionIds:r.actions,assignedCharacterId:a})})}function SP(){const{spaceCombat:t,assignStation:e,unassignStation:n}=pn(),r=Dh.copilot,a=t.stationAssignments.copilot;return l.jsx(Lh,{station:r,assignedCharacterId:a,onAssign:e,onUnassign:n,children:l.jsx($h,{stationId:r.id,actionIds:r.actions,assignedCharacterId:a})})}function zS({stationNumber:t=1}){const{spaceCombat:e,assignStation:n,unassignStation:r}=pn(),a=`engineer${t}`,i=Dh[a],c=e.stationAssignments[a];return l.jsx(Lh,{station:{...i,name:`Engineer ${t}`},assignedCharacterId:c,onAssign:n,onUnassign:r,children:l.jsx($h,{stationId:a,actionIds:i.actions,assignedCharacterId:c})})}function US({stationNumber:t=1}){const{spaceCombat:e,assignStation:n,unassignStation:r}=pn(),a=`gunner${t}`,i=Dh[a],c=e.stationAssignments[a];return l.jsx(Lh,{station:{...i,name:`Gunner ${t}`},assignedCharacterId:c,onAssign:n,onUnassign:r,children:l.jsx($h,{stationId:a,actionIds:i.actions,assignedCharacterId:c})})}function NP(){return l.jsxs("div",{className:"space-y-4 xl:space-y-6",children:[l.jsx("h2",{className:"font-orbitron font-bold text-accent-cyan text-lg xl:text-xl uppercase text-center mb-4",children:"Ship Stations"}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("p",{className:"text-xs xl:text-sm text-accent-cyan font-orbitron uppercase text-center mb-2",children:" Command Deck "}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 xl:gap-5",children:[l.jsx(wP,{}),l.jsx(SP,{})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("p",{className:"text-xs xl:text-sm text-accent-red font-orbitron uppercase text-center mb-2",children:" Weapons Deck "}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 xl:gap-5",children:[l.jsx(US,{stationNumber:1}),l.jsx(US,{stationNumber:2})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("p",{className:"text-xs xl:text-sm text-accent-yellow font-orbitron uppercase text-center mb-2",children:" Engineering Bay "}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 xl:gap-5",children:[l.jsx(zS,{stationNumber:1}),l.jsx(zS,{stationNumber:2})]})]})]})}const HS={attack:In,defense:vc,support:Va,damage:ar,info:Uw,combat:Uw};function kP(){const{spaceCombat:t,updateSpaceCombat:e}=pn(),n=E.useRef(null),r=E.useRef(null);E.useEffect(()=>{if(r.current){const u=r.current;u.scrollHeight-u.scrollTop<=u.clientHeight+100&&(u.scrollTop=u.scrollHeight)}},[t.combatLog]);const a=()=>{confirm("Clear combat log?")&&e(u=>({...u,combatLog:[]}))},i=u=>{switch(u){case"attack":return"text-accent-red border-accent-red/30";case"defense":return"text-accent-cyan border-accent-cyan/30";case"support":return"text-accent-yellow border-accent-yellow/30";case"damage":return"text-accent-red border-accent-red/30";case"info":return"text-accent-cyan border-accent-cyan/30";default:return"text-text-primary border-gray-700"}},c=u=>new Date(u).toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"});return l.jsxs("div",{className:"bg-bg-secondary/80 backdrop-blur-sm border-3 border-accent-cyan h-full flex flex-col",children:[l.jsxs("div",{className:"flex items-center justify-between p-3 border-b-2 border-accent-cyan/30",children:[l.jsx("h2",{className:"font-orbitron font-bold text-accent-cyan text-sm uppercase",children:"Combat Log"}),t.combatLog.length>0&&l.jsx(ge,{variant:"ghost",onClick:a,className:"px-2 py-1 text-xs",children:l.jsx(rs,{className:"w-3 h-3"})})]}),l.jsx("div",{ref:r,className:"flex-1 overflow-y-auto p-3 space-y-2 min-h-[300px] max-h-[600px] xl:max-h-[800px]",children:t.combatLog.length===0?l.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 text-sm font-orbitron",children:l.jsx("p",{children:"No combat events yet..."})}):l.jsxs(l.Fragment,{children:[t.combatLog.map((u,h)=>{const p=HS[u.type]||HS.info,m=h<3,g=u.data&&(u.data.rollMode!=="normal"||u.data.drAdjust!==0);return l.jsx("div",{className:`border-l-3 pl-3 py-2 ${i(u.type)} ${m?"log-entry-slide":""}`,children:l.jsxs("div",{className:"flex items-start gap-2",children:[l.jsx(p,{className:"w-4 h-4 flex-shrink-0 mt-0.5 opacity-70"}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("p",{className:"text-xs text-text-primary break-words",children:u.message}),g&&l.jsxs("div",{className:"flex gap-1 mt-1",children:[u.data.rollMode==="advantage"&&l.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 text-[9px] font-orbitron font-bold uppercase bg-accent-yellow/20 text-accent-yellow border border-accent-yellow/30",children:"ADV"}),u.data.rollMode==="disadvantage"&&l.jsx("span",{className:"inline-flex items-center px-1.5 py-0.5 text-[9px] font-orbitron font-bold uppercase bg-accent-red/20 text-accent-red border border-accent-red/30",children:"DIS"}),u.data.drAdjust!==0&&l.jsxs("span",{className:"inline-flex items-center px-1.5 py-0.5 text-[9px] font-orbitron font-bold bg-accent-cyan/20 text-accent-cyan border border-accent-cyan/30",children:["DR ",u.data.drAdjust>0?"+":"",u.data.drAdjust]})]}),l.jsx("p",{className:"text-[10px] text-gray-500 mt-1 font-mono",children:c(u.timestamp)})]})]})},u.id)}),l.jsx("div",{ref:n})]})}),l.jsx("div",{className:"border-t-2 border-accent-cyan/30 p-2 bg-bg-primary/50",children:l.jsxs("p",{className:"text-xs text-gray-400 font-orbitron text-center",children:[t.combatLog.length," event",t.combatLog.length!==1?"s":""," logged"]})})]})}function jP({status:t,size:e="w-3 h-3"}){switch(t){case"destroyed":return l.jsx(UN,{className:`${e} text-accent-red`});case"fleeing":return l.jsx(ty,{className:`${e} text-accent-yellow`});case"surrendered":return l.jsx($N,{className:`${e} text-gray-400`});default:return l.jsx(sc,{className:`${e} text-accent-cyan`})}}function CP({enemy:t,onAdjustHp:e}){const n=t.hp.max===null||t.hp.max===void 0,r=n?100:t.hp.max?t.hp.current/t.hp.max*100:0,a=t.status!=="active",i=!a&&!n,c=()=>t.status==="destroyed"?"bg-gray-600":n?"bg-purple-500":r>66?"bg-accent-cyan":r>33?"bg-accent-yellow":"bg-accent-red";return l.jsxs("div",{className:`grid grid-cols-[auto_1fr_auto] items-center gap-2 py-1.5 px-2 border-b border-gray-700/50 last:border-b-0 transition-opacity ${a?"opacity-50":""}`,children:[l.jsx(jP,{status:t.status}),l.jsx("span",{className:`text-xs font-mono truncate min-w-0 ${a?"text-gray-500 line-through":"text-text-primary"}`,title:t.name,children:t.name}),l.jsxs("div",{className:"flex items-center gap-1.5",children:[l.jsx("div",{className:"w-14 h-2 bg-gray-800 rounded-sm overflow-hidden flex-shrink-0",children:l.jsx("div",{className:`h-full transition-all duration-300 ${c()}`,style:{width:`${r}%`}})}),l.jsx("span",{className:`text-[10px] font-mono w-11 text-right flex-shrink-0 ${a?"text-gray-600":n?"text-purple-400":"text-gray-400"}`,children:n?"":`${t.hp.current}/${t.hp.max}`}),l.jsx("div",{className:"flex gap-0.5 w-9 flex-shrink-0 justify-end",children:i?l.jsxs(l.Fragment,{children:[l.jsx("button",{onClick:u=>{u.stopPropagation(),e(t.id,-1)},className:"p-0.5 text-accent-red hover:bg-accent-red/20 rounded transition-colors",title:"Decrease HP",children:l.jsx(bc,{className:"w-3 h-3"})}),l.jsx("button",{onClick:u=>{u.stopPropagation(),e(t.id,1)},className:"p-0.5 text-accent-cyan hover:bg-accent-cyan/20 rounded transition-colors",title:"Increase HP",children:l.jsx(ir,{className:"w-3 h-3"})})]}):null})]})]})}function TP({enemies:t,onExpandGroup:e}){const n=t.filter(c=>c.status==="active").length,r=t.reduce((c,u)=>c+u.hp.current,0),a=t.reduce((c,u)=>c+u.hp.max,0),i=a?r/a*100:0;return l.jsxs("button",{onClick:e,className:"w-full grid grid-cols-[auto_1fr_auto] items-center gap-2 py-1.5 px-2 border-b border-gray-700/50 last:border-b-0 hover:bg-gray-700/30 transition-colors text-left",children:[l.jsx(sc,{className:"w-3 h-3 text-accent-cyan flex-shrink-0"}),l.jsxs("span",{className:"text-xs font-mono truncate text-text-primary min-w-0",children:[t[0]?.name?.replace(/\s[-]$/,"")," ",t.length]}),l.jsxs("div",{className:"flex items-center gap-1.5",children:[l.jsxs("span",{className:"text-[10px] text-gray-400 font-mono w-11 text-right flex-shrink-0",children:[n," active"]}),l.jsx("div",{className:"w-14 h-2 bg-gray-800 rounded-sm overflow-hidden flex-shrink-0",children:l.jsx("div",{className:`h-full transition-all duration-300 ${i>66?"bg-accent-cyan":i>33?"bg-accent-yellow":"bg-accent-red"}`,style:{width:`${i}%`}})}),l.jsx("div",{className:"w-9 flex-shrink-0"})]})]})}function EP({onOpenDrawer:t}){const{spaceCombat:e,adjustEnemyHp:n,getActiveEnemyCount:r}=pn(),a=e.enemies||[],[i,c]=E.useState(new Set),u=r(),h=a.reduce((v,w)=>(v[w.type]||(v[w.type]=[]),v[w.type].push(w),v),{}),p=v=>h[v]?.length>=4&&!i.has(v),m=v=>{c(w=>{const N=new Set(w);return N.has(v)?N.delete(v):N.add(v),N})},g=[],x=new Set;return a.forEach(v=>{x.has(v.type)||(p(v.type)?(g.push({type:"group",enemyType:v.type,enemies:h[v.type]}),x.add(v.type)):(h[v.type].forEach(w=>{g.push({type:"enemy",enemy:w})}),x.add(v.type)))}),l.jsxs("div",{className:`bg-bg-secondary/80 backdrop-blur-sm border-3 ${a.length>0?"border-accent-red":"border-gray-700"} transition-colors`,children:[l.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-gray-700",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[a.length>0&&l.jsx(ar,{className:"w-4 h-4 text-accent-red"}),l.jsx("span",{className:"text-xs font-orbitron font-bold uppercase text-accent-red",children:"Enemy Forces"}),a.length>0&&l.jsxs("span",{className:"text-xs font-mono text-gray-400",children:["(",u," active)"]})]}),l.jsx("button",{onClick:t,className:"p-1 text-gray-400 hover:text-accent-cyan transition-colors rounded border border-transparent hover:border-accent-cyan",title:"Manage enemies",children:l.jsx(ic,{className:"w-4 h-4"})})]}),a.length===0?l.jsxs("div",{className:"px-3 py-4 text-center",children:[l.jsx("p",{className:"text-xs text-gray-500 mb-2",children:"No enemies"}),l.jsxs("button",{onClick:t,className:"text-xs text-accent-cyan hover:underline flex items-center justify-center gap-1",children:[l.jsx(ir,{className:"w-3 h-3"}),"Spawn enemies"]})]}):l.jsx("div",{className:"max-h-48 overflow-y-auto",children:g.map(v=>v.type==="group"?l.jsx(TP,{type:v.enemyType,enemies:v.enemies,onExpandGroup:()=>m(v.enemyType)},`group-${v.enemyType}`):l.jsx(CP,{enemy:v.enemy,onAdjustHp:n},v.enemy.id))}),u>=4&&l.jsx("div",{className:"px-3 py-2 bg-accent-red/10 border-t border-accent-red/30",children:l.jsx("p",{className:"text-[10px] text-accent-red font-orbitron text-center",children:" 4+ enemies - Hyperdrive jump will destroy ship!"})})]})}function RP({status:t}){const e=Su[t]||Su.active,n={active:"bg-accent-cyan/20 text-accent-cyan border-accent-cyan",fleeing:"bg-accent-yellow/20 text-accent-yellow border-accent-yellow",surrendered:"bg-gray-500/20 text-gray-400 border-gray-500",destroyed:"bg-accent-red/20 text-accent-red border-accent-red"},a={active:sc,fleeing:ty,surrendered:$N,destroyed:UN}[t]||sc;return l.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 text-[10px] font-orbitron uppercase border rounded ${n[t]}`,children:[l.jsx(a,{className:"w-3 h-3"}),e.label]})}function AP({enemy:t,onRemove:e}){const[n,r]=E.useState(!1),[a,i]=E.useState(null),[c,u]=E.useState(null),{updateEnemy:h,rollEnemyAttack:p,rollEnemyMorale:m,adjustEnemyHp:g}=pn(),{play:x}=Cc(),v=t.hp.max===null||t.hp.max===void 0,w=v?100:t.hp.max?t.hp.current/t.hp.max*100:0,N=t.status!=="active",S=Nu[t.armor]||Nu[0],j=t.build?yh[t.build]:null,A=()=>t.status==="destroyed"?"bg-gray-600":v?"bg-purple-500":w>66?"bg-accent-cyan":w>33?"bg-accent-yellow":"bg-accent-red",$=()=>{const M=p(t.id);M&&(i(M),t.type==="dreadnought"?x("turboCannonAttack",.6):t.type==="predatorLeader"?x("particleBeamAttack",.5):x("enemyAttack",.5),setTimeout(()=>i(null),3e3))},L=()=>{const M=m(t.id);M&&(u(M),M.demoralized&&(M.outcome==="flees"?x("enemyFlee",.5):x("alarmCritical",.3)),setTimeout(()=>u(null),4e3))},R=M=>{h(t.id,{status:M})};return l.jsxs("div",{className:`border-2 rounded transition-all ${t.status==="destroyed"?"border-gray-700 bg-gray-900/50 opacity-60":t.status==="fleeing"?"border-accent-yellow/50 bg-accent-yellow/5":t.status==="surrendered"?"border-gray-600 bg-gray-800/30":"border-accent-red/50 bg-bg-secondary/80"}`,children:[l.jsxs("div",{className:"flex items-center gap-2 p-3 cursor-pointer",onClick:()=>r(!n),children:[l.jsx("button",{className:"text-gray-400",children:n?l.jsx(ON,{className:"w-4 h-4"}):l.jsx(No,{className:"w-4 h-4"})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsx("h4",{className:`font-orbitron font-bold text-sm truncate ${N?"text-gray-500":"text-text-primary"}`,children:t.name}),j&&l.jsx("p",{className:"text-[10px] text-accent-yellow font-mono truncate",children:j.name})]}),l.jsx(RP,{status:t.status}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-20 h-3 bg-gray-800 rounded overflow-hidden",children:l.jsx("div",{className:`h-full transition-all duration-300 ${A()}`,style:{width:`${w}%`}})}),l.jsx("span",{className:`text-xs font-mono w-12 text-right ${v?"text-purple-400":"text-gray-400"}`,children:v?"":`${t.hp.current}/${t.hp.max}`})]})]}),n&&l.jsxs("div",{className:"border-t border-gray-700 p-3 space-y-3",children:[l.jsxs("div",{className:"flex flex-wrap gap-3 text-xs",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(vc,{className:"w-3 h-3 text-accent-cyan"}),l.jsx("span",{className:"text-gray-400",children:"Armor:"}),l.jsx("span",{className:"text-text-primary font-mono",children:S.label})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(In,{className:"w-3 h-3 text-accent-yellow"}),l.jsx("span",{className:"text-gray-400",children:"Weapon:"}),l.jsxs("span",{className:"text-text-primary font-mono",children:[t.weapon.name," (",t.weapon.damage,")"]})]}),t.morale!==null&&l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(pg,{className:"w-3 h-3 text-accent-red"}),l.jsx("span",{className:"text-gray-400",children:"MRL:"}),l.jsx("span",{className:"text-text-primary font-mono",children:t.morale})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"text-gray-400",children:"DR:"}),l.jsx("span",{className:`font-mono ${t.dr===14?"text-accent-red":"text-text-primary"}`,children:t.dr})]})]}),t.traits&&t.traits.length>0&&l.jsx("div",{className:"flex flex-wrap gap-1",children:t.traits.map((M,D)=>l.jsx("span",{className:"px-2 py-0.5 text-[10px] font-mono bg-gray-800 text-gray-300 rounded",children:M},D))}),j&&l.jsxs("div",{className:"text-xs text-accent-yellow bg-accent-yellow/10 p-2 rounded border border-accent-yellow/30",children:[l.jsxs("span",{className:"font-bold",children:[j.name,":"]})," ",j.effect]}),v?l.jsx("div",{className:"flex items-center gap-2 bg-purple-500/10 border border-purple-500/30 p-2 rounded",children:l.jsx("span",{className:"text-xs text-purple-400 font-mono",children:" IMPERVIOUS - Cannot be damaged by conventional weapons"})}):l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"text-xs text-gray-400",children:"HP:"}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx("button",{onClick:()=>g(t.id,-5),className:"px-2 py-1 text-xs bg-accent-red/20 text-accent-red border border-accent-red rounded hover:bg-accent-red hover:text-bg-primary transition-colors",children:"-5"}),l.jsx("button",{onClick:()=>g(t.id,-1),className:"px-2 py-1 text-xs bg-accent-red/20 text-accent-red border border-accent-red rounded hover:bg-accent-red hover:text-bg-primary transition-colors",children:"-1"}),l.jsx("span",{className:"px-3 py-1 text-sm font-mono bg-gray-800 rounded min-w-[60px] text-center",children:t.hp.current}),l.jsx("button",{onClick:()=>g(t.id,1),className:"px-2 py-1 text-xs bg-accent-cyan/20 text-accent-cyan border border-accent-cyan rounded hover:bg-accent-cyan hover:text-bg-primary transition-colors",children:"+1"}),l.jsx("button",{onClick:()=>g(t.id,5),className:"px-2 py-1 text-xs bg-accent-cyan/20 text-accent-cyan border border-accent-cyan rounded hover:bg-accent-cyan hover:text-bg-primary transition-colors",children:"+5"})]})]}),!N&&l.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.jsxs("button",{onClick:$,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-orbitron bg-accent-red/20 text-accent-red border border-accent-red rounded hover:bg-accent-red hover:text-bg-primary transition-colors",children:[l.jsx(VO,{className:"w-3 h-3"}),"Attack"]}),t.morale!==null&&l.jsxs("button",{onClick:L,className:"flex items-center gap-1 px-3 py-1.5 text-xs font-orbitron bg-accent-yellow/20 text-accent-yellow border border-accent-yellow rounded hover:bg-accent-yellow hover:text-bg-primary transition-colors",children:[l.jsx(pg,{className:"w-3 h-3"}),"Morale"]})]}),a&&l.jsx("div",{className:"bg-accent-red/10 border border-accent-red/30 p-2 rounded",children:l.jsxs("p",{className:"text-xs text-accent-red font-mono",children:[l.jsxs("span",{className:"font-bold",children:[t.weapon.name,":"]})," ",a.advantage?`[${a.rolls.map(M=>`${M.roll1}/${M.roll2}${M.best}`).join(", ")}]`:`[${a.rolls.join(", ")}]`," = ",l.jsx("span",{className:"text-lg font-bold",children:a.total})," damage"]})}),c&&l.jsx("div",{className:`p-2 rounded border ${c.demoralized?"bg-accent-yellow/10 border-accent-yellow/30":"bg-accent-cyan/10 border-accent-cyan/30"}`,children:l.jsxs("p",{className:`text-xs font-mono ${c.demoralized?"text-accent-yellow":"text-accent-cyan"}`,children:["Morale: [",c.dice.join(", "),"] = ",c.total," vs MRL ",c.morale,c.demoralized?l.jsx("span",{className:"font-bold ml-2",children:c.outcome==="flees"?" FLEES!":" SURRENDERS!"}):l.jsx("span",{className:"ml-2",children:" Holds!"})]})}),l.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t border-gray-700",children:[l.jsx("span",{className:"text-xs text-gray-400",children:"Set Status:"}),l.jsx("div",{className:"flex gap-1",children:Object.keys(Su).map(M=>l.jsx("button",{onClick:()=>R(M),className:`px-2 py-1 text-[10px] rounded border transition-colors ${t.status===M?"bg-gray-600 text-white border-gray-500":"bg-transparent text-gray-400 border-gray-600 hover:border-gray-500"}`,children:Su[M].label},M))})]}),l.jsx("div",{className:"pt-2 border-t border-gray-700",children:l.jsxs("button",{onClick:()=>e(t.id),className:"flex items-center gap-1 px-3 py-1 text-xs text-gray-500 hover:text-accent-red transition-colors",children:[l.jsx(rs,{className:"w-3 h-3"}),"Remove"]})})]})]})}function _P({ship:t,isSelected:e,onClick:n}){return l.jsxs("button",{onClick:n,className:`p-3 text-left border-2 rounded transition-all ${e?"border-accent-cyan bg-accent-cyan/10":"border-gray-700 hover:border-gray-600 bg-gray-800/50"}`,children:[l.jsx("h4",{className:"font-orbitron text-sm font-bold text-text-primary",children:t.name}),l.jsxs("div",{className:"flex gap-3 mt-1 text-[10px] font-mono text-gray-400",children:[l.jsxs("span",{children:["HP: ",t.hp||""]}),l.jsxs("span",{children:["MRL: ",t.morale||"-"]}),l.jsxs("span",{children:["ARM: ",t.armor||0]})]}),l.jsx("p",{className:"text-[10px] text-gray-500 mt-1 line-clamp-1",children:t.description})]})}function MP({build:t,isSelected:e,onClick:n}){return l.jsxs("button",{onClick:n,className:`p-2 text-left border rounded transition-all ${e?"border-accent-yellow bg-accent-yellow/10":"border-gray-700 hover:border-gray-600"}`,children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("span",{className:"text-accent-yellow font-mono text-xs",children:["d6=",t.roll]}),l.jsx("span",{className:"font-orbitron text-xs font-bold text-text-primary",children:t.name})]}),l.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:t.effect})]})}function OP(){const{addEnemy:t,addEnemies:e}=pn(),{play:n}=Cc(),[r,a]=E.useState(null),[i,c]=E.useState(null),[u,h]=E.useState(1),[p,m]=E.useState(null),[g,x]=E.useState(!1),[v,w]=E.useState(null),N=Object.values(nc),S=R=>{const M=Al(R);t(M),R==="dreadnought"?n("dreadnoughtSpawn",.7):n("enemySpawn",.6)},j=()=>{if(r){if(u===1){const R=Al(r,{build:i});t(R)}else{const R=Aw(r,u,{build:i});e(R)}r==="dreadnought"?n("dreadnoughtSpawn",.7):n("enemySpawn",.6),a(null),c(null),h(1),m(null)}},A=()=>{if(g)return;x(!0),m(null);let R=0;const M=12,D=setInterval(()=>{const I=Bl[Math.floor(Math.random()*Bl.length)];if(w(I),R++,R>=M){clearInterval(D);const W=gm();w(null),c(W.id),m(W),x(!1),n("targetLock",.4)}},80)},$=()=>{const R=gm(),M=Al("hunterFighter",{build:R.id});t(M),n("enemySpawn",.6),m(R),setTimeout(()=>m(null),2e3)},L=()=>{const R={hunterFighter:50,predatorLeader:25,pirateMarauder:20,dreadnought:5},M=Object.values(R).reduce((he,J)=>he+J,0);let D=Math.floor(Math.random()*M),I="hunterFighter";for(const[he,J]of Object.entries(R))if(D-=J,D<=0){I=he;break}const W=I==="hunterFighter"&&Math.random()>.5?gm().id:null,ue=I==="hunterFighter"?Math.floor(Math.random()*3)+1:1;if(ue===1){const he=Al(I,{build:W});t(he)}else{const he=Aw(I,ue,{build:W});e(he)}I==="dreadnought"?n("dreadnoughtSpawn",.7):n("enemySpawn",.6)};return l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx("h3",{className:"text-xs font-orbitron text-gray-400 uppercase",children:"Quick Actions"}),l.jsxs("div",{className:"flex flex-wrap gap-2",children:[l.jsxs("button",{onClick:L,className:"flex items-center gap-1 px-3 py-2 text-xs font-orbitron bg-accent-cyan/20 text-accent-cyan border border-accent-cyan rounded hover:bg-accent-cyan hover:text-bg-primary transition-colors",children:[l.jsx(BO,{className:"w-4 h-4"}),"Random Enemy"]}),l.jsxs("button",{onClick:$,className:"flex items-center gap-1 px-3 py-2 text-xs font-orbitron bg-accent-yellow/20 text-accent-yellow border border-accent-yellow rounded hover:bg-accent-yellow hover:text-bg-primary transition-colors",children:[l.jsx(HN,{className:"w-4 h-4"}),"Fighter + Build"]}),N.slice(0,2).map(R=>l.jsxs("button",{onClick:()=>S(R.id),className:"flex items-center gap-1 px-3 py-2 text-xs font-orbitron bg-gray-700 text-gray-300 border border-gray-600 rounded hover:bg-gray-600 transition-colors",children:[l.jsx(ir,{className:"w-3 h-3"}),R.name]},R.id))]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("h3",{className:"text-xs font-orbitron text-gray-400 uppercase",children:"Select Ship Type"}),l.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:N.map(R=>l.jsx(_P,{ship:R,isSelected:r===R.id,onClick:()=>a(R.id)},R.id))})]}),r==="hunterFighter"&&l.jsxs("div",{className:"space-y-3",children:[l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("h3",{className:"text-xs font-orbitron text-gray-400 uppercase",children:"Fighter Build Oracle"})}),l.jsxs("button",{onClick:A,disabled:g,className:`w-full flex items-center justify-center gap-3 p-4 border-2 rounded transition-all ${g?"border-accent-yellow bg-accent-yellow/20 animate-pulse":"border-accent-yellow/50 bg-accent-yellow/10 hover:border-accent-yellow hover:bg-accent-yellow/20"}`,children:[l.jsx(tr,{className:`w-8 h-8 text-accent-yellow ${g?"animate-spin":""}`}),l.jsxs("div",{className:"text-left",children:[l.jsx("p",{className:"font-orbitron font-bold text-accent-yellow",children:g?"Rolling...":"Roll d6 for Build"}),l.jsx("p",{className:"text-[10px] text-gray-400",children:v?v.name:"Click to randomly determine fighter variant"})]})]}),p&&!g&&l.jsxs("div",{className:"bg-accent-yellow/20 border-2 border-accent-yellow p-3 rounded animate-pulse",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[l.jsxs("span",{className:"text-2xl font-orbitron font-bold text-accent-yellow",children:["[",p.roll,"]"]}),l.jsx("span",{className:"font-orbitron font-bold text-text-primary text-lg",children:p.name})]}),l.jsx("p",{className:"text-xs text-gray-300",children:p.effect})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx("p",{className:"text-[10px] text-gray-500 uppercase",children:"Or select manually:"}),l.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 max-h-40 overflow-y-auto",children:[l.jsxs("button",{onClick:()=>{c(null),m(null)},className:`p-2 text-left border rounded transition-all ${i===null&&!p?"border-gray-500 bg-gray-700/50":"border-gray-700 hover:border-gray-600"}`,children:[l.jsx("span",{className:"font-orbitron text-xs text-gray-400",children:"No Build"}),l.jsx("p",{className:"text-[10px] text-gray-500",children:"Standard Fighter"})]}),Bl.map(R=>l.jsx(MP,{build:R,isSelected:i===R.id,onClick:()=>{c(R.id),m(R)}},R.id))]})]})]}),r&&l.jsxs("div",{className:"space-y-2",children:[l.jsx("h3",{className:"text-xs font-orbitron text-gray-400 uppercase",children:"Quantity"}),l.jsx("div",{className:"flex items-center gap-2",children:[1,2,3,4,5,6].map(R=>l.jsx("button",{onClick:()=>h(R),className:`w-10 h-10 text-sm font-orbitron rounded border transition-all ${u===R?"bg-accent-cyan text-bg-primary border-accent-cyan":"bg-gray-800 text-gray-400 border-gray-700 hover:border-gray-600"}`,children:R},R))}),u>1&&l.jsxs("p",{className:"text-[10px] text-gray-500",children:["Will spawn: ",dg.slice(0,u).join(", ")," variants"]})]}),r&&l.jsxs("button",{onClick:j,className:"w-full flex items-center justify-center gap-2 px-4 py-3 font-orbitron font-bold bg-accent-red text-white border-2 border-accent-red rounded hover:bg-accent-red/80 transition-colors",children:[l.jsx(zN,{className:"w-5 h-5"}),"Spawn ",u>1?`${u} `:"",nc[r]?.name,i&&` (${yh[i]?.name})`]}),l.jsxs("div",{className:"border-t border-gray-700 pt-4 mt-4",children:[l.jsx("h3",{className:"text-xs font-orbitron text-gray-400 uppercase mb-2",children:"Quick Reference"}),l.jsxs("div",{className:"text-[10px] text-gray-500 space-y-1",children:[l.jsxs("p",{children:[l.jsx("span",{className:"text-accent-cyan",children:"Fodder:"})," One hit always destroys (Hunter Fighter)"]}),l.jsxs("p",{children:[l.jsx("span",{className:"text-accent-yellow",children:"Squadthink:"})," 4+ fighters = MRL 8 instead of 7"]}),l.jsxs("p",{children:[l.jsx("span",{className:"text-accent-red",children:"Elite:"})," DR14 to defend (Predator Leader)"]})]})]})]})}function Qi({title:t,icon:e,children:n,defaultOpen:r=!1}){const[a,i]=E.useState(r);return l.jsxs("div",{className:"border border-gray-700 rounded",children:[l.jsxs("button",{onClick:()=>i(!a),className:"w-full flex items-center gap-2 p-3 text-left hover:bg-gray-800/50 transition-colors",children:[a?l.jsx(No,{className:"w-4 h-4 text-gray-400"}):l.jsx(ny,{className:"w-4 h-4 text-gray-400"}),l.jsx(e,{className:"w-4 h-4 text-accent-cyan"}),l.jsx("span",{className:"font-orbitron text-sm text-text-primary",children:t})]}),a&&l.jsx("div",{className:"px-4 pb-4 text-xs text-gray-300 space-y-2",children:n})]})}function DP(){return l.jsxs("div",{className:"space-y-3",children:[l.jsx(Qi,{title:"Morale Rules",icon:pg,defaultOpen:!0,children:l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{children:[l.jsx("p",{className:"font-bold text-accent-yellow mb-1",children:"When to Test Morale:"}),l.jsx("ul",{className:"list-disc list-inside space-y-0.5 text-gray-400",children:Yd.triggers.map((t,e)=>l.jsx("li",{children:t},e))})]}),l.jsxs("div",{children:[l.jsx("p",{className:"font-bold text-accent-cyan mb-1",children:"How to Check:"}),l.jsx("p",{className:"text-gray-400",children:Yd.check})]}),l.jsxs("div",{children:[l.jsx("p",{className:"font-bold text-accent-red mb-1",children:"If Demoralized (roll d6):"}),l.jsx("ul",{className:"space-y-0.5 text-gray-400",children:Yd.outcomes.map((t,e)=>l.jsxs("li",{children:[l.jsxs("span",{className:"font-mono text-accent-cyan",children:[t.roll,":"]})," ",t.result]},e))})]}),l.jsx("div",{className:"bg-accent-yellow/10 border border-accent-yellow/30 p-2 rounded",children:l.jsxs("p",{className:"text-accent-yellow",children:[l.jsx("span",{className:"font-bold",children:"Squadthink:"})," ",Yd.squadthink]})})]})}),l.jsx(Qi,{title:"Armor Tiers",icon:vc,children:l.jsx("div",{className:"space-y-2",children:Object.values(Nu).map(t=>l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("span",{className:`w-16 font-mono ${t.tier===0?"text-gray-500":"text-accent-cyan"}`,children:t.label}),l.jsx("span",{className:"text-gray-400",children:t.reduction>0?`Reduces damage by 1-${t.reduction} (roll ${t.dice})`:"No damage reduction"})]},t.tier))})}),l.jsx(Qi,{title:"Fighter Builds (d6)",icon:In,children:l.jsx("div",{className:"space-y-2",children:Bl.map(t=>l.jsxs("div",{className:"border-l-2 border-accent-yellow pl-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("span",{className:"font-mono text-accent-yellow text-[10px]",children:t.roll}),l.jsx("span",{className:"font-bold text-text-primary",children:t.name})]}),l.jsx("p",{className:"text-gray-400 text-[10px]",children:t.effect})]},t.id))})}),l.jsx(Qi,{title:"Enemy Ship Stats",icon:rc,children:l.jsx("div",{className:"space-y-3",children:Object.values(nc).map(t=>l.jsxs("div",{className:"border border-gray-700 p-2 rounded",children:[l.jsx("h4",{className:"font-orbitron font-bold text-text-primary text-sm",children:t.name}),l.jsxs("div",{className:"grid grid-cols-4 gap-2 mt-1 text-[10px]",children:[l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-500",children:"HP:"})," ",l.jsx("span",{className:"text-accent-cyan font-mono",children:t.hp||""})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-500",children:"MRL:"})," ",l.jsx("span",{className:"text-accent-yellow font-mono",children:t.morale||"-"})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-500",children:"ARM:"})," ",l.jsx("span",{className:"text-accent-cyan font-mono",children:t.armor||0})]}),l.jsxs("div",{children:[l.jsx("span",{className:"text-gray-500",children:"DR:"})," ",l.jsx("span",{className:`font-mono ${t.dr===14?"text-accent-red":"text-text-primary"}`,children:t.dr})]})]}),l.jsxs("div",{className:"mt-1 text-[10px]",children:[l.jsx("span",{className:"text-gray-500",children:"Weapon:"})," ",l.jsxs("span",{className:"text-text-primary",children:[t.weapon.name," (",t.weapon.damage,")"]})]}),t.traits.length>0&&l.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:t.traits.map((e,n)=>l.jsx("span",{className:"px-1 py-0.5 bg-gray-800 text-gray-400 text-[9px] rounded",children:e},n))})]},t.id))})}),l.jsx(Qi,{title:"Special Rules",icon:ar,children:l.jsx("div",{className:"space-y-3",children:Object.values(j_).map(t=>l.jsxs("div",{children:[l.jsx("p",{className:"font-bold text-accent-red",children:t.title}),l.jsx("p",{className:"text-gray-400",children:t.description})]},t.title))})}),l.jsx(Qi,{title:"Difficulty Ratings (DR)",icon:rc,children:l.jsxs("div",{className:"space-y-1",children:[l.jsxs("p",{children:[l.jsx("span",{className:"font-mono text-accent-cyan",children:"DR 12:"})," Normal enemies"]}),l.jsxs("p",{children:[l.jsx("span",{className:"font-mono text-accent-red",children:"DR 14:"})," Elite enemies (Predator Leader, Dragoon, Bounty Hunter)"]}),l.jsxs("div",{className:"mt-2 text-gray-500 text-[10px]",children:[l.jsx("p",{children:"Players roll D20 + Ability  DR to succeed."}),l.jsx("p",{children:"Defense typically uses AGI."})]})]})})]})}const LP=[{id:"units",label:"Units",icon:ry},{id:"generate",label:"Generate",icon:ir},{id:"rules",label:"Rules",icon:rc}];function $P({isOpen:t,onClose:e}){const[n,r]=E.useState("units"),{spaceCombat:a,removeEnemy:i,clearAllEnemies:c,getActiveEnemyCount:u}=pn(),h=a.enemies||[],p=u();E.useEffect(()=>{const g=x=>{x.key==="Escape"&&t&&e()};return document.addEventListener("keydown",g),()=>document.removeEventListener("keydown",g)},[t,e]),E.useEffect(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]);const m=()=>{h.length!==0&&window.confirm(`Clear all ${h.length} enemies?`)&&c()};return t?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"fixed inset-0 bg-black/60 z-40 backdrop-blur-sm",onClick:e}),l.jsxs("div",{className:`fixed inset-y-0 left-0 z-50 w-full sm:w-[400px] md:w-[450px] bg-bg-primary border-r-3 border-accent-red flex flex-col transition-transform duration-300 ${t?"translate-x-0":"-translate-x-full"}`,children:[l.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700 bg-bg-secondary",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-3 h-3 bg-accent-red rounded-full glow-pulse-red"}),l.jsxs("div",{children:[l.jsx("h2",{className:"font-orbitron font-bold text-lg text-accent-red",children:"ENEMY FORCES"}),l.jsxs("p",{className:"text-xs text-gray-400 font-mono",children:[h.length," total  ",p," active"]})]})]}),l.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-accent-red transition-colors rounded border border-transparent hover:border-accent-red",children:l.jsx(Er,{className:"w-5 h-5"})})]}),l.jsx("div",{className:"flex border-b border-gray-700",children:LP.map(g=>{const x=g.icon,v=n===g.id;return l.jsxs("button",{onClick:()=>r(g.id),className:`flex-1 flex items-center justify-center gap-2 px-4 py-3 text-sm font-orbitron transition-colors ${v?"text-accent-cyan border-b-2 border-accent-cyan bg-accent-cyan/5":"text-gray-400 hover:text-gray-300 hover:bg-gray-800/50"}`,children:[l.jsx(x,{className:"w-4 h-4"}),l.jsx("span",{className:"hidden sm:inline",children:g.label}),g.id==="units"&&h.length>0&&l.jsx("span",{className:"px-1.5 py-0.5 text-[10px] bg-accent-red text-white rounded-full",children:h.length})]},g.id)})}),l.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[n==="units"&&l.jsx("div",{className:"space-y-3",children:h.length===0?l.jsxs("div",{className:"text-center py-8",children:[l.jsx(ry,{className:"w-12 h-12 text-gray-600 mx-auto mb-3"}),l.jsx("p",{className:"text-gray-500 mb-4",children:"No enemies spawned"}),l.jsx("button",{onClick:()=>r("generate"),className:"px-4 py-2 text-sm font-orbitron text-accent-cyan border border-accent-cyan rounded hover:bg-accent-cyan hover:text-bg-primary transition-colors",children:"Generate Enemies"})]}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"flex justify-end",children:l.jsxs("button",{onClick:m,className:"flex items-center gap-1 px-3 py-1 text-xs text-gray-500 hover:text-accent-red transition-colors",children:[l.jsx(rs,{className:"w-3 h-3"}),"Clear All"]})}),h.map(g=>l.jsx(AP,{enemy:g,onRemove:i},g.id))]})}),n==="generate"&&l.jsx(OP,{}),n==="rules"&&l.jsx(DP,{})]}),l.jsx("div",{className:"border-t border-gray-700 p-3 bg-bg-secondary",children:l.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[l.jsx("span",{children:"Press ESC to close"}),l.jsx("span",{children:"Swipe right to close on mobile"})]})})]})]}):null}function BP(){const{exitCombatView:t,getActiveEnemyCount:e}=pn(),{toggleMute:n,getMutedState:r}=Cc(),[a,i]=E.useState(!1),[c,u]=E.useState(r()),[h,p]=E.useState(!1),m=e(),g=E.useCallback(()=>{i(!0),setTimeout(()=>{t(),i(!1)},300)},[t]);E.useEffect(()=>{const v=w=>{Qa()||w.key==="Escape"&&!a&&g()};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[a,g]);const x=()=>{const v=n();u(v)};return l.jsxs("div",{className:`min-h-screen bg-space-background relative overflow-hidden ${a?"fade-out":"fade-in"}`,children:[l.jsx("div",{className:"stars-layer-1"}),l.jsx("div",{className:"stars-layer-2"}),l.jsx("div",{className:"stars-layer-3"}),l.jsx("div",{className:"scanlines-combat"}),l.jsxs("div",{className:"relative z-10 min-h-screen flex flex-col",children:[l.jsx("header",{className:"border-b-3 border-accent-red bg-bg-secondary/90 backdrop-blur-sm p-3 md:p-4",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center gap-3",children:[l.jsx("div",{className:"w-3 h-3 bg-accent-red rounded-full glow-pulse-red"}),l.jsxs("div",{children:[l.jsx("h1",{className:"font-orbitron font-black text-xl md:text-3xl text-accent-red text-glow-red tracking-wider",children:"SPACE COMBAT"}),l.jsx("p",{className:"text-accent-cyan text-xs md:text-sm font-orbitron",children:"BATTLE STATIONS ACTIVE"})]})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs("button",{onClick:()=>p(!0),className:`relative p-2 transition-colors rounded border-2 ${m>0?"text-accent-red hover:text-white border-accent-red/50 hover:border-accent-red hover:bg-accent-red/20":"text-gray-400 hover:text-accent-cyan border-transparent hover:border-accent-cyan"}`,title:"Manage enemy forces",children:[l.jsx(sc,{className:"w-4 h-4"}),m>0&&l.jsx("span",{className:"absolute -top-1 -right-1 w-4 h-4 text-[10px] font-bold bg-accent-red text-white rounded-full flex items-center justify-center",children:m>9?"9+":m})]}),l.jsx("button",{onClick:x,className:"p-2 text-gray-400 hover:text-accent-cyan transition-colors rounded border-2 border-transparent hover:border-accent-cyan",title:c?"Unmute sounds":"Mute sounds",children:c?l.jsx(aD,{className:"w-4 h-4"}):l.jsx(rD,{className:"w-4 h-4"})}),l.jsxs(ge,{variant:"ghost",onClick:g,className:"flex items-center gap-2",children:[l.jsx(Er,{className:"w-4 h-4"}),l.jsx("span",{className:"hidden sm:inline",children:"Exit View"})]})]})]})}),l.jsx("div",{className:"flex-1 p-4 lg:p-6 xl:p-8",children:l.jsx("div",{className:"max-w-[1920px] mx-auto",children:l.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-4 lg:gap-6 xl:gap-8",children:[l.jsxs("div",{className:"lg:col-span-4 xl:col-span-3 space-y-4",children:[l.jsx(xP,{}),l.jsx(EP,{onOpenDrawer:()=>p(!0)}),l.jsxs("div",{className:"bg-bg-secondary/80 backdrop-blur-sm border-3 border-gray-700 p-4",children:[l.jsx("p",{className:"text-xs text-gray-400 font-orbitron uppercase mb-3",children:"Combat Notes:"}),l.jsxs("ul",{className:"space-y-2 text-xs text-gray-400",children:[l.jsxs("li",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-cyan",children:""}),l.jsx("span",{children:"Solo rebels can make 2 actions per turn"})]}),l.jsxs("li",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-cyan",children:""}),l.jsx("span",{children:"Changing stations takes 1 round"})]}),l.jsxs("li",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-cyan",children:""}),l.jsx("span",{children:"Failed defense rolls degrade ship armor by 1 tier"})]}),l.jsxs("li",{className:"flex items-start gap-2",children:[l.jsx("span",{className:"text-accent-yellow",children:""}),l.jsx("span",{children:"Hyperdrive takes 3 rounds to charge - dangerous with 4+ enemies!"})]})]})]})]}),l.jsx("div",{className:"lg:col-span-5 xl:col-span-6",children:l.jsx(NP,{})}),l.jsx("div",{className:"lg:col-span-3 xl:col-span-3",children:l.jsx(kP,{})})]})})}),l.jsx("footer",{className:"border-t-3 border-accent-cyan bg-bg-secondary/90 backdrop-blur-sm p-2 md:p-3",children:l.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-3 text-xs md:text-sm text-gray-400 font-orbitron",children:[l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"text-accent-cyan",children:""}),"Ship starts at Tier 2 armor"]}),l.jsx("span",{className:"hidden md:inline",children:"|"}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"text-accent-cyan",children:""}),"Armor reduces 1 tier per failed defense"]}),l.jsx("span",{className:"hidden lg:inline",children:"|"}),l.jsxs("span",{className:"flex items-center gap-1",children:[l.jsx("span",{className:"text-accent-cyan",children:""}),"Press ESC to exit"]})]})})]}),l.jsx($P,{isOpen:h,onClose:()=>p(!1)})]})}function Yl({message:t="LOADING",details:e=null}){const[n,r]=E.useState(!1);return E.useEffect(()=>{const a=setTimeout(()=>r(!0),100);return()=>clearTimeout(a)},[]),n?l.jsx("div",{className:"min-h-screen bg-bg-primary flex items-center justify-center scanlines",children:l.jsxs("div",{className:"text-center space-y-4",children:[l.jsx("div",{className:"text-accent-cyan text-3xl font-orbitron text-glow-cyan typewriter",children:t}),l.jsxs("div",{className:"flex justify-center gap-1",children:[l.jsx("span",{className:"w-2 h-2 bg-accent-cyan rounded-full animate-pulse",style:{animationDelay:"0ms"}}),l.jsx("span",{className:"w-2 h-2 bg-accent-cyan rounded-full animate-pulse",style:{animationDelay:"150ms"}}),l.jsx("span",{className:"w-2 h-2 bg-accent-cyan rounded-full animate-pulse",style:{animationDelay:"300ms"}})]}),e&&l.jsx("div",{className:"text-accent-yellow/50 text-sm font-mono mt-6",children:e.map((a,i)=>l.jsxs("div",{children:[">"," ",a]},i))})]})}):l.jsx("div",{className:"min-h-screen bg-bg-primary flex items-center justify-center opacity-0",children:l.jsx("div",{className:"text-center space-y-4",children:l.jsx("div",{className:"text-accent-cyan text-3xl font-orbitron text-glow-cyan",children:t})})})}const Xm="star-dashborg-panel-order",VS="star-dashborg-panel-version",FS="star-dashborg-mobile-collapsed",GS="4",El=[{id:"threat-die",component:"ThreatDie",title:"Threat Die",variant:"red",mobileCollapsedDefault:!1},{id:"dice-roller",component:"DiceRoller",title:"Dice Roller",variant:"yellow",mobileCollapsedDefault:!1},{id:"oracle-compendium",component:"OraclePanel",title:"Oracle Compendium",variant:"cyan",mobileCollapsedDefault:!1},{id:"ship-log",component:"DiceLog",title:"Ship Log",variant:"cyan",mobileCollapsedDefault:!0,mobileMaxHeight:"30vh"},{id:"party-panel",component:"PartyPanel",title:"Party",variant:"red",mobileCollapsedDefault:!1},{id:"danger-clocks",component:"DangerClock",title:"Danger Clocks",variant:"red",mobileCollapsedDefault:!0},{id:"mission-tracks",component:"MissionTrack",title:"Mission Tracks",variant:"cyan",mobileCollapsedDefault:!0},{id:"session-journal",component:"SessionJournal",title:"Session Journal",variant:"yellow",mobileCollapsedDefault:!1}];function IP({roomCode:t}){const{refreshPartyMembers:e}=Ja(),{viewingCombat:n}=pn(),{loading:r}=Ge(),[a,i]=E.useState(()=>{if(localStorage.getItem(VS)!==GS)return localStorage.removeItem(Xm),localStorage.setItem(VS,GS),El;const T=localStorage.getItem(Xm);if(T){const z=JSON.parse(T),H=new Map(El.map(we=>[we.id,we])),Q=z.map(we=>we.id==="character-panel"?H.get("party-panel"):we),de=Q.map(we=>{const me=H.get(we.id);return me?{...me}:null}).filter(Boolean),fe=new Set(Q.map(we=>we.id));return[...El.filter(we=>!fe.has(we.id)),...de]}return El}),[c,u]=E.useState(null),[h,p]=E.useState(null),[m,g]=E.useState(!1),[x,v]=E.useState("threatDie"),[w,N]=E.useState(!1),[S,j]=E.useState(null),[A,$]=E.useState(null),L=E.useRef({}),R=E.useRef({panelId:null,startY:0,reorderInProgress:!1}),M=E.useRef(null),[D,I]=E.useState(()=>{const te=localStorage.getItem(FS);if(te)return JSON.parse(te);const T={};return El.forEach(z=>{T[z.id]=z.mobileCollapsedDefault}),T});E.useEffect(()=>{localStorage.setItem(Xm,JSON.stringify(a))},[a]),E.useEffect(()=>{localStorage.setItem(FS,JSON.stringify(D))},[D]),E.useEffect(()=>{const te=T=>{(T.key==="h"||T.key==="H"||T.key==="?")&&!Qa()&&(T.preventDefault(),g(!0))};return document.addEventListener("keydown",te),()=>document.removeEventListener("keydown",te)},[]),E.useEffect(()=>{e()},[e]);const W=(te,T)=>{u(T),te.dataTransfer.effectAllowed="move",te.dataTransfer.setData("text/plain",T)},ue=(te,T)=>{te.preventDefault(),c!==T&&p(T)},he=(te,T)=>{if(te.preventDefault(),c===T){u(null),p(null);return}const z=a.findIndex(fe=>fe.id===c),H=a.findIndex(fe=>fe.id===T),Q=[...a],de=Q[z];Q[z]=Q[H],Q[H]=de,i(Q),u(null),p(null)},J=()=>{u(null),p(null)},_=te=>{v(te),g(!0)},V=(te,T)=>{I(z=>({...z,[te]:T}))};E.useEffect(()=>{const te=H=>{const Q=H.target.closest("[data-panel-header]");if(!Q)return;const de=Q.dataset.panelId;if(!de)return;const fe=H.touches[0],ae=Q.getBoundingClientRect();fe.clientX-ae.left>70||(H.preventDefault(),R.current={panelId:de,startY:fe.clientY,reorderInProgress:!1},j(de))},T=H=>{if(!R.current.panelId)return;H.preventDefault();const Q=H.touches[0];for(const[de,fe]of Object.entries(L.current))if(fe&&de!==R.current.panelId){const ae=fe.getBoundingClientRect();if(Q.clientY>=ae.top&&Q.clientY<=ae.bottom){M.current=de,$(de);return}}M.current=null,$(null)},z=H=>{const Q=R.current.panelId;if(!Q||R.current.reorderInProgress)return;R.current.reorderInProgress=!0,H.preventDefault();const de=M.current;j(null),$(null),M.current=null,de&&de!==Q&&i(fe=>{const ae=fe.findIndex(me=>me.id===Q),we=fe.findIndex(me=>me.id===de);if(ae!==-1&&we!==-1&&ae!==we){const me=[...fe],[tt]=me.splice(ae,1);return me.splice(we,0,tt),me}return fe}),R.current={panelId:null,startY:0,reorderInProgress:!1}};return document.addEventListener("touchstart",te,{passive:!1}),document.addEventListener("touchmove",T,{passive:!1}),document.addEventListener("touchend",z,{passive:!1}),()=>{document.removeEventListener("touchstart",te),document.removeEventListener("touchmove",T),document.removeEventListener("touchend",z)}},[]);const F=[{id:"slot-1",gridRow:"1",gridCol:"1 / 3"},{id:"slot-2",gridRow:"1",gridCol:"3 / 7"},{id:"slot-3",gridRow:"1 / 3",gridCol:"7 / 13"},{id:"slot-4",gridRow:"2",gridCol:"1 / 4"},{id:"slot-5",gridRow:"2",gridCol:"4 / 7"},{id:"slot-6",gridRow:"3",gridCol:"1 / 4"},{id:"slot-7",gridRow:"3",gridCol:"4 / 7"},{id:"slot-8",gridRow:"3",gridCol:"7 / 13"}],O=()=>a.map((te,T)=>({...te,gridRow:F[T].gridRow,gridCol:F[T].gridCol})),K=te=>{const T={PartyPanel:l.jsx(DS,{onExpand:()=>N(!0)}),ThreatDie:l.jsx(Ww,{}),MissionTrack:l.jsx(Kw,{}),DangerClock:l.jsx(Yw,{}),DiceRoller:l.jsx(MS,{}),DiceLog:l.jsx(Xw,{}),OraclePanel:l.jsx(OS,{}),SessionJournal:l.jsx(AS,{roomCode:t})};if(!T[te.component])return null;const z=S===te.id,H=A===te.id;return l.jsx("div",{ref:Q=>{L.current[te.id]=Q},className:`relative transition-all duration-150 ${z?"z-50 opacity-50":""} ${H?"ring-1 ring-accent-cyan/60 rounded":""}`,children:l.jsx(qw,{title:te.title,variant:te.variant,onHelpClick:te.id==="threat-die"?()=>_("threatDie"):te.id==="mission-tracks"?()=>_("missionTracks"):te.id==="danger-clocks"?()=>_("dangerClocks"):void 0,collapsible:!0,collapsed:D[te.id]||!1,onCollapsedChange:Q=>V(te.id,Q),mobileMaxHeight:te.mobileMaxHeight,touchDraggable:!0,panelId:te.id,isDragging:z,isDropTarget:H,children:T[te.component]})},te.id)},Z=te=>{const T={PartyPanel:l.jsx(DS,{onExpand:()=>N(!0)}),ThreatDie:l.jsx(Ww,{}),MissionTrack:l.jsx(Kw,{}),DangerClock:l.jsx(Yw,{}),DiceRoller:l.jsx(MS,{}),DiceLog:l.jsx(Xw,{}),OraclePanel:l.jsx(OS,{}),SessionJournal:l.jsx(AS,{roomCode:t})};if(!T[te.component])return null;const z=c===te.id,H=h===te.id;return l.jsxs("div",{style:{gridRow:te.gridRow,gridColumn:te.gridCol},className:"relative transition-all duration-300",children:[H&&l.jsx("div",{className:"absolute inset-0 border-2 border-accent-cyan bg-accent-cyan/10 rounded z-50 pointer-events-none animate-pulse"}),l.jsx("div",{onDragOver:Q=>ue(Q,te.id),onDrop:Q=>he(Q,te.id),className:`h-full transition-all duration-200 ${z?"opacity-40 scale-95":""}`,style:{pointerEvents:"auto"},children:l.jsx(qw,{title:te.title,variant:te.variant,onHelpClick:te.id==="threat-die"?()=>_("threatDie"):te.id==="mission-tracks"?()=>_("missionTracks"):te.id==="danger-clocks"?()=>_("dangerClocks"):void 0,draggable:!0,onDragStart:Q=>W(Q,te.id),onDragEnd:J,children:T[te.component]})})]},te.id)};if(r)return l.jsx(Yl,{message:"LOADING GAME STATE",details:["Retrieving session data...","Syncing ship systems...","Restoring battle stations..."]});if(n)return l.jsxs(l.Fragment,{children:[l.jsx(BP,{roomCode:t}),l.jsx(LS,{isOpen:w,onClose:()=>N(!1),roomCode:t})]});const X=O();return l.jsxs("div",{className:"min-h-screen bg-bg-primary scanlines flex flex-col",children:[l.jsx(PD,{roomCode:t,onOpenCharacterSheet:()=>N(!0)}),l.jsx("div",{className:"flex-1 p-4 space-y-4 lg:hidden",children:a.map(K)}),l.jsx("div",{className:"hidden lg:grid dashboard-grid p-4 gap-4",children:X.map(Z)}),l.jsx(QI,{isOpen:m,onClose:()=>g(!1),initialTab:x}),l.jsx(LS,{isOpen:w,onClose:()=>N(!1),roomCode:t})]})}function PP(){const[t,e]=E.useState(!1),[n,r]=E.useState(""),[a,i]=E.useState(""),[c,u]=E.useState(!1),[h,p]=E.useState(null),[m,g]=E.useState(null),x=async w=>{w.preventDefault(),e(!0),p(null),g(null);try{if(c){const{error:N}=await Fe.auth.signUp({email:n,password:a,options:{emailRedirectTo:`${window.location.origin}/`}});if(N)throw N;g("Account created! Check your email to confirm, then wait for admin approval.")}else{const{error:N}=await Fe.auth.signInWithPassword({email:n,password:a});if(N)throw N}}catch(N){p(N.message)}finally{e(!1)}},v=async w=>{w.preventDefault(),e(!0),p(null),g(null);try{const{error:N}=await Fe.auth.signInWithOtp({email:n,options:{emailRedirectTo:`${window.location.origin}/`}});if(N)throw N;g("Check your email for the magic link!")}catch(N){p(N.message)}finally{e(!1)}};return l.jsx("div",{className:"min-h-screen bg-bg-primary flex items-center justify-center scanlines p-4",children:l.jsxs("div",{className:"max-w-md w-full space-y-8",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("h1",{className:"text-4xl font-orbitron font-bold text-accent-cyan text-glow-cyan mb-2",children:"STAR DASHBORG"}),l.jsxs("p",{className:"text-accent-yellow/70 text-sm font-mono",children:[">"," SECURE ACCESS REQUIRED"]})]}),l.jsx("div",{className:"bg-panel-bg border border-accent-cyan/30 rounded-lg p-6 shadow-lg shadow-accent-cyan/10",children:l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"flex gap-2",children:[l.jsx("button",{onClick:()=>u(!1),className:`flex-1 py-2 px-4 font-mono text-sm rounded transition-all ${c?"bg-transparent text-accent-cyan border border-accent-cyan/30 hover:border-accent-cyan/60":"bg-accent-cyan text-bg-primary"}`,children:"SIGN IN"}),l.jsx("button",{onClick:()=>u(!0),className:`flex-1 py-2 px-4 font-mono text-sm rounded transition-all ${c?"bg-accent-cyan text-bg-primary":"bg-transparent text-accent-cyan border border-accent-cyan/30 hover:border-accent-cyan/60"}`,children:"SIGN UP"})]}),l.jsxs("form",{onSubmit:x,className:"space-y-4",children:[l.jsxs("div",{children:[l.jsx("label",{htmlFor:"email",className:"block text-sm font-mono text-text-secondary mb-2",children:"EMAIL"}),l.jsx("input",{id:"email",type:"email",placeholder:"rebel@resistance.net",value:n,onChange:w=>r(w.target.value),required:!0,className:"w-full px-4 py-2 bg-bg-secondary border border-accent-cyan/30 rounded text-text-primary font-mono focus:outline-none focus:border-accent-cyan transition-colors"})]}),l.jsxs("div",{children:[l.jsx("label",{htmlFor:"password",className:"block text-sm font-mono text-text-secondary mb-2",children:"PASSWORD"}),l.jsx("input",{id:"password",type:"password",placeholder:"",value:a,onChange:w=>i(w.target.value),required:!0,className:"w-full px-4 py-2 bg-bg-secondary border border-accent-cyan/30 rounded text-text-primary font-mono focus:outline-none focus:border-accent-cyan transition-colors"})]}),l.jsx(ge,{type:"submit",disabled:t,className:"w-full",children:t?"PROCESSING...":c?"CREATE ACCOUNT":"SIGN IN"})]}),l.jsxs("div",{className:"relative",children:[l.jsx("div",{className:"absolute inset-0 flex items-center",children:l.jsx("div",{className:"w-full border-t border-accent-cyan/20"})}),l.jsx("div",{className:"relative flex justify-center text-sm",children:l.jsx("span",{className:"px-2 bg-panel-bg text-text-secondary font-mono",children:"OR"})})]}),l.jsx("form",{onSubmit:v,children:l.jsx(ge,{type:"submit",disabled:t||!n,variant:"outline",className:"w-full",children:t?"SENDING...":"SEND MAGIC LINK"})}),h&&l.jsx("div",{className:"p-3 bg-accent-red/10 border border-accent-red/30 rounded",children:l.jsx("p",{className:"text-accent-red text-sm font-mono",children:h})}),m&&l.jsx("div",{className:"p-3 bg-accent-green/10 border border-accent-green/30 rounded",children:l.jsx("p",{className:"text-accent-green text-sm font-mono",children:m})})]})}),l.jsxs("p",{className:"text-center text-text-secondary text-xs font-mono",children:[">"," Encrypted connection established"]})]})})}function zP(){const{signOut:t,user:e}=Ya();return l.jsx("div",{className:"min-h-screen bg-bg-primary flex items-center justify-center scanlines p-4",children:l.jsxs("div",{className:"max-w-md w-full space-y-8",children:[l.jsxs("div",{className:"text-center",children:[l.jsx("h1",{className:"text-4xl font-orbitron font-bold text-accent-yellow text-glow-yellow mb-2",children:"AWAITING APPROVAL"}),l.jsxs("p",{className:"text-accent-cyan/70 text-sm font-mono",children:[">"," ACCESS PENDING"]})]}),l.jsx("div",{className:"bg-panel-bg border border-accent-yellow/30 rounded-lg p-6 shadow-lg shadow-accent-yellow/10",children:l.jsxs("div",{className:"space-y-6",children:[l.jsx("div",{className:"flex justify-center",children:l.jsx("div",{className:"w-16 h-16 border-4 border-accent-yellow rounded-full flex items-center justify-center",children:l.jsx("svg",{className:"w-8 h-8 text-accent-yellow",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})})}),l.jsxs("div",{className:"text-center space-y-3",children:[l.jsx("p",{className:"text-text-primary font-mono text-sm",children:"Your account has been created successfully."}),l.jsx("p",{className:"text-text-secondary font-mono text-xs",children:"An administrator must approve your account before you can access the system."}),l.jsx("div",{className:"bg-bg-secondary border border-accent-cyan/20 rounded p-3 mt-4",children:l.jsxs("p",{className:"text-accent-cyan font-mono text-xs",children:[l.jsx("span",{className:"text-text-secondary",children:"Email:"})," ",e?.email]})})]}),l.jsx("div",{className:"bg-bg-secondary/50 border border-accent-yellow/20 rounded p-4",children:l.jsxs("p",{className:"text-text-secondary font-mono text-xs leading-relaxed",children:[">"," You will receive an email notification once approved.",l.jsx("br",{}),">"," Please check your inbox regularly.",l.jsx("br",{}),">"," Contact the administrator if you're waiting too long."]})}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(ge,{onClick:()=>window.location.reload(),variant:"ghost",className:"w-full",children:"CHECK STATUS"}),l.jsx(ge,{onClick:t,variant:"ghost",className:"w-full text-xs",children:"SIGN OUT"})]})]})}),l.jsxs("p",{className:"text-center text-text-secondary text-xs font-mono",children:[">"," Secure rebel network access control active"]})]})})}const qS={bot:X2,bountyHunter:Wg,magiKnight:Kg,smuggler:XI,technician:Z2,youngster:ZI};function UP({onSave:t,onCancel:e}){const{saveCharacter:n}=as(),{gameState:r}=Ge(),[a,i]=E.useState(1),[c,u]=E.useState(null),[h,p]=E.useState(!1),[m,g]=E.useState(!1),x=J=>J>0?`+${J}`:`${J}`,v=J=>{i(2),setTimeout(()=>{const _=Kl[J],V=J==="bot",F={agi:_.statModifiers?.agi?Sr(_.statModifiers.agi.count,_.statModifiers.agi.sides,_.statModifiers.agi.modifier):Sr(3,6,0),knw:_.statModifiers?.knw?Sr(_.statModifiers.knw.count,_.statModifiers.knw.sides,_.statModifiers.knw.modifier):Sr(3,6,0),prs:_.statModifiers?.prs?Sr(_.statModifiers.prs.count,_.statModifiers.prs.sides,_.statModifiers.prs.modifier):Sr(3,6,0),str:_.statModifiers?.str?Sr(_.statModifiers.str.count,_.statModifiers.str.sides,_.statModifiers.str.modifier):Sr(3,6,0)},O=oP(F.str,_.hpDice),K=lP(_.destinyDice),Z=V?"Bot":xu[Ne(10)-1].name,X=Ne(10),te=Us.rebelMotivations[X-1],z=Ne(6)>=4?1:0,H=[Us.bobsWeapons[Ne(6)-1],Us.bobsArmor[Ne(6)-1],Us.bobsGear[Ne(6)-1]];J==="magiKnight"&&H.unshift("Blazer Sword (2D6 damage)");const Q=w(J),de={name:"",class:J,className:_.name,species:Z,motivation:te,stats:F,base_stats:{...F},hp_max:O,hp_current:O,base_hp_max:O,destiny_points:K,bits:z,equipment:H,classFeatures:Q};u(de),i(3)},1500)},w=J=>{const _=qS[J],V={};switch(J){case"bot":{const F=Ne(6),O=Ne(6),K=Ne(6);V.function={roll:F,..._.functions[F-1]},V.malfunction={roll:O,..._.malfunctions[O-1]},V.upgrade={roll:K,result:_.upgrades[K-1]};break}case"bountyHunter":{const F=Ne(6),O=Ne(6),K=Ne(6);V.skill={roll:F,..._.skills[F-1]},V.heirloom={roll:O,..._.heirlooms[O-1]},V.softSpot={roll:K,result:_.softSpots[K-1]};break}case"magiKnight":{const F=Ne(4),O=Ne(6),K=Ne(6);if(V.art={roll:F,..._.arts[F-1]},O===6){const Z=Ne(5);let X=Ne(5);for(;X===Z;)X=Ne(5);const te=_.dragoonNemeses[Z-1],T=_.dragoonNemeses[X-1];V.nemesis={roll:O,result:`${te} & ${T}`,multiple:!0,nemeses:[te,T]}}else V.nemesis={roll:O,result:_.dragoonNemeses[O-1]};V.identity={roll:K,..._.burnerIdentities[K-1]},V.dragoonThreshold=5;break}case"smuggler":{const F=Ne(6),O=Ne(6),K=Ne(6),Z=Ne(6);V.trick={roll:F,result:_.tricks[F-1]},V.contraband={roll:O,..._.contraband[O-1]},V.containmentPoints=Z,V.crimeLord={roll:K,result:_.crimeLords[K-1]},V.ownsShip=!0;break}case"technician":{const F=Ne(6),O=Ne(6),K=Ne(4);V.scratchBuild={roll:F,..._.scratchBuilds[F-1]},V.hyperFixation={roll:O,result:_.hyperFixations[O-1]},V.junkDrawerSlots=K;break}case"youngster":{const F=Ne(6),O=Ne(6),K=Ne(6);V.tragedy={roll:F,result:_.tragedies[F-1]},V.heirloom={roll:O,..._.heirlooms[O-1]},V.knack={roll:K,..._.knacks[K-1]};break}}return V},N=J=>{v(J)},S=()=>{i(1),u(null),p(!1)},j=async()=>{if(c)try{g(!0),await n(c),t&&t(c)}catch(J){console.error("Failed to save character:",J),alert("Failed to save character. Please try again.")}finally{g(!1)}},A=(J,_)=>{u(V=>({...V,[J]:_}))},$=(J,_)=>{const V=Math.max(-3,Math.min(3,parseInt(_)||0));u(F=>({...F,stats:{...F.stats,[J]:V}}))},L=()=>{let J="";if(c.class==="bot"){const _=ut.botNamePrefixes[Ne(10)-1],V=ut.botNameSuffixes[Ne(10)-1];J=`${_}-${V}`}else if(r.includePVOracles&&Ne(2)===2)J=ak().fullName;else{const _=ut.baselineFirst[Ne(10)-1],V=ut.familyNames[Ne(10)-1];J=`${_} ${V}`}A("name",J)},R=J=>{const V=Kl[c.class].statModifiers?.[J],F=V?Sr(V.count,V.sides,V.modifier):Sr(3,6,0);$(J,F)},M=()=>{if(c.class==="bot")return;const J=xu[Ne(10)-1].name;A("species",J)},D=()=>{const J=Us.rebelMotivations[Ne(10)-1];A("motivation",J)},I=()=>{u(J=>({...J,equipment:[...J.equipment,"New Item"]}))},W=J=>{u(_=>({..._,equipment:_.equipment.filter((V,F)=>F!==J)}))},ue=(J,_)=>{u(V=>({...V,equipment:V.equipment.map((F,O)=>O===J?_:F)}))},he=J=>{const _=qS[c.class];let V,F;switch(J){case"function":F=Ne(6),V={roll:F,..._.functions[F-1]};break;case"malfunction":F=Ne(6),V={roll:F,..._.malfunctions[F-1]};break;case"upgrade":F=Ne(6),V={roll:F,result:_.upgrades[F-1]};break;case"skill":F=Ne(6),V={roll:F,..._.skills[F-1]};break;case"heirloom":F=Ne(6),V={roll:F,..._.heirlooms[F-1]};break;case"softSpot":F=Ne(6),V={roll:F,result:_.softSpots[F-1]};break;case"art":F=Ne(4),V={roll:F,..._.arts[F-1]};break;case"nemesis":{if(F=Ne(6),F===6){const O=Ne(5);let K=Ne(5);for(;K===O;)K=Ne(5);const Z=_.dragoonNemeses[O-1],X=_.dragoonNemeses[K-1];V={roll:F,result:`${Z} & ${X}`,multiple:!0,nemeses:[Z,X]}}else V={roll:F,result:_.dragoonNemeses[F-1]};break}case"identity":F=Ne(6),V={roll:F,..._.burnerIdentities[F-1]};break;case"trick":F=Ne(6),V={roll:F,result:_.tricks[F-1]};break;case"contraband":F=Ne(6),V={roll:F,..._.contraband[F-1]};break;case"crimeLord":F=Ne(6),V={roll:F,result:_.crimeLords[F-1]};break;case"scratchBuild":F=Ne(6),V={roll:F,..._.scratchBuilds[F-1]};break;case"hyperFixation":F=Ne(6),V={roll:F,result:_.hyperFixations[F-1]};break;case"tragedy":F=Ne(6),V={roll:F,result:_.tragedies[F-1]};break;case"knack":F=Ne(6),V={roll:F,..._.knacks[F-1]};break}u(O=>({...O,classFeatures:{...O.classFeatures,[J]:V}}))};return a===1?l.jsxs("div",{className:"space-y-6",children:[l.jsxs("div",{className:"text-center space-y-2",children:[l.jsx("h2",{className:"text-3xl font-orbitron font-bold text-accent-cyan text-glow-cyan",children:"CREATE REBEL CHARACTER"}),l.jsxs("p",{className:"text-text-secondary font-mono text-sm",children:[">"," SELECT YOUR CLASS"]})]}),l.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(Kl).map(([J,_])=>l.jsxs("button",{onClick:()=>N(J),className:"bg-bg-secondary border-2 border-accent-cyan/30 p-4 rounded hover:border-accent-cyan hover:shadow-[0_0_20px_rgba(0,240,255,0.4)] transition-all duration-200 text-left group",children:[l.jsx("h3",{className:"font-orbitron font-bold text-accent-yellow text-lg mb-2 group-hover:text-glow-yellow",children:_.name}),l.jsx("p",{className:"text-text-secondary text-xs font-mono mb-3 line-clamp-3",children:_.description}),l.jsxs("div",{className:"text-accent-cyan text-xs font-mono space-y-1",children:[Object.entries(_.statModifiers||{}).map(([V,F])=>l.jsxs("div",{children:[V.toUpperCase(),": ",F.count,"d",F.sides,F.modifier!==0&&(F.modifier>0?`+${F.modifier}`:F.modifier)]},V)),l.jsxs("div",{className:"text-text-secondary",children:["HP: ",_.hpDice.count,"d",_.hpDice.sides,_.hpDice.modifier!==0&&`+${_.hpDice.modifier}`,J!=="bot"&&" + STR"]})]})]},J))}),e&&l.jsx("div",{className:"text-center",children:l.jsx(ge,{onClick:e,variant:"ghost",children:"CANCEL"})})]}):a===2?l.jsx("div",{className:"min-h-[400px] flex items-center justify-center",children:l.jsxs("div",{className:"text-center space-y-4",children:[l.jsx(tr,{className:"w-16 h-16 text-accent-cyan mx-auto dice-rolling"}),l.jsx("div",{className:"text-2xl font-orbitron text-accent-cyan text-glow-cyan typewriter",children:"GENERATING CHARACTER"}),l.jsxs("div",{className:"flex justify-center gap-1",children:[l.jsx("span",{className:"w-2 h-2 bg-accent-cyan rounded-full animate-pulse",style:{animationDelay:"0ms"}}),l.jsx("span",{className:"w-2 h-2 bg-accent-cyan rounded-full animate-pulse",style:{animationDelay:"150ms"}}),l.jsx("span",{className:"w-2 h-2 bg-accent-cyan rounded-full animate-pulse",style:{animationDelay:"300ms"}})]})]})}):a===3&&c?l.jsxs("div",{className:"space-y-6 fade-in",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("h2",{className:"text-2xl font-orbitron font-bold text-accent-yellow text-glow-yellow",children:c.className||"CHARACTER"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx(ge,{onClick:()=>p(!h),variant:h?"secondary":"ghost",className:"text-xs",children:h?"DONE EDITING":"EDIT MODE"}),l.jsx(ge,{onClick:S,variant:"ghost",className:"text-xs",children:l.jsx(mg,{className:"w-4 h-4"})})]})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs font-mono text-text-secondary mb-1",children:"NAME"}),l.jsxs("div",{className:"flex gap-2",children:[l.jsx("input",{type:"text",value:c.name,onChange:J=>A("name",J.target.value),placeholder:"Enter rebel name...",className:"flex-1 bg-bg-secondary border border-accent-cyan/30 rounded px-3 py-2 text-text-primary font-mono focus:outline-none focus:border-accent-cyan focus:shadow-[0_0_10px_rgba(0,240,255,0.4)] transition-all"}),l.jsxs("button",{onClick:L,className:"px-3 py-2 bg-transparent border-2 border-accent-yellow text-accent-yellow hover:bg-accent-yellow hover:text-bg-primary transition-all font-orbitron text-xs uppercase flex items-center gap-1",title:"Generate random name",children:[l.jsx(tr,{className:"w-4 h-4"}),"Gen"]})]})]}),l.jsxs("div",{children:[l.jsx("div",{className:"flex items-center justify-between mb-2",children:l.jsx("h3",{className:"text-sm font-orbitron text-accent-cyan uppercase",children:"Ability Scores"})}),l.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:Object.entries(c.stats).map(([J,_])=>l.jsxs("div",{className:"bg-bg-secondary border border-accent-cyan/30 rounded p-3",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("span",{className:"text-xs font-mono text-text-secondary uppercase",children:J}),l.jsx("button",{onClick:()=>R(J),className:"text-accent-yellow hover:text-accent-yellow/80 transition-colors",title:"Reroll",children:l.jsx(tr,{className:"w-3 h-3"})})]}),l.jsxs("div",{className:"flex items-center gap-2",children:[h&&l.jsx("button",{onClick:()=>$(J,_-1),className:"text-accent-cyan hover:text-accent-cyan/80 text-lg font-bold",children:"-"}),h?l.jsx("input",{type:"number",value:_,onChange:V=>$(J,V.target.value),min:"-3",max:"3",className:`w-full text-center text-xl font-orbitron font-bold ${_>=2?"text-accent-green":_>=1?"text-accent-cyan":_===0?"text-text-primary":_>=-1?"text-accent-yellow":"text-accent-red"} bg-transparent border-0 focus:outline-none cursor-text`}):l.jsx("div",{className:`w-full text-center text-xl font-orbitron font-bold ${_>=2?"text-accent-green":_>=1?"text-accent-cyan":_===0?"text-text-primary":_>=-1?"text-accent-yellow":"text-accent-red"}`,children:x(_)}),h&&l.jsx("button",{onClick:()=>$(J,_+1),className:"text-accent-cyan hover:text-accent-cyan/80 text-lg font-bold",children:"+"})]})]},J))})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[l.jsxs("div",{className:"bg-bg-secondary border border-accent-cyan/30 rounded p-3",children:[l.jsx("label",{className:"block text-xs font-mono text-text-secondary mb-1",children:"HP MAX"}),l.jsx("input",{type:"number",value:c.hp_max,onChange:J=>A("hp_max",Math.max(1,parseInt(J.target.value)||1)),readOnly:!h,min:"1",className:"w-full text-2xl font-orbitron font-bold text-accent-red bg-transparent border-0 focus:outline-none"})]}),l.jsxs("div",{className:"bg-bg-secondary border border-accent-cyan/30 rounded p-3",children:[l.jsx("label",{className:"block text-xs font-mono text-text-secondary mb-1",children:"HP CURRENT"}),l.jsx("input",{type:"number",value:c.hp_current,onChange:J=>A("hp_current",Math.max(0,parseInt(J.target.value)||0)),readOnly:!h,min:"0",className:"w-full text-2xl font-orbitron font-bold text-accent-red bg-transparent border-0 focus:outline-none"})]}),l.jsxs("div",{className:"bg-bg-secondary border border-accent-cyan/30 rounded p-3",children:[l.jsx("label",{className:"block text-xs font-mono text-text-secondary mb-1",children:"DESTINY POINTS"}),l.jsx("input",{type:"number",value:c.destiny_points,onChange:J=>A("destiny_points",Math.max(0,parseInt(J.target.value)||0)),readOnly:!h,min:"0",className:"w-full text-2xl font-orbitron font-bold text-accent-yellow bg-transparent border-0 focus:outline-none"})]})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between mb-1",children:[l.jsx("label",{className:"text-xs font-mono text-text-secondary",children:"SPECIES"}),!h&&c.class!=="bot"&&l.jsx("button",{onClick:M,className:"text-accent-yellow hover:text-accent-yellow/80 transition-colors",title:"Reroll species",children:l.jsx(tr,{className:"w-3 h-3"})})]}),h?l.jsx("select",{value:c.species,onChange:J=>A("species",J.target.value),className:"w-full bg-bg-secondary border border-accent-cyan/30 rounded px-3 py-2 text-text-primary font-mono focus:outline-none focus:border-accent-cyan [&>option]:bg-bg-secondary [&>option]:text-text-primary",children:c.class==="bot"?l.jsx("option",{value:"Bot",className:"bg-bg-secondary text-text-primary",children:"Bot"}):xu.map(J=>l.jsx("option",{value:J.name,className:"bg-bg-secondary text-text-primary",children:J.name},J.id))}):l.jsx("div",{className:"bg-bg-secondary border border-accent-cyan/30 rounded px-3 py-2 text-text-primary font-mono",children:c.species})]}),l.jsxs("div",{children:[l.jsx("label",{className:"block text-xs font-mono text-text-secondary mb-1",children:"BITS "}),l.jsx("input",{type:"number",value:c.bits,onChange:J=>A("bits",Math.max(0,parseInt(J.target.value)||0)),readOnly:!h,min:"0",className:"w-full bg-bg-secondary border border-accent-cyan/30 rounded px-3 py-2 text-text-primary font-mono focus:outline-none focus:border-accent-cyan"})]})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between mb-1",children:[l.jsx("label",{className:"text-xs font-mono text-text-secondary",children:"REBEL MOTIVATION"}),!h&&l.jsx("button",{onClick:D,className:"text-accent-yellow hover:text-accent-yellow/80 transition-colors",title:"Reroll motivation",children:l.jsx(tr,{className:"w-3 h-3"})})]}),l.jsx("div",{className:"bg-bg-secondary border border-accent-yellow/30 rounded px-3 py-2 text-text-primary font-mono text-sm",children:c.motivation})]}),l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsx("h3",{className:"text-sm font-orbitron text-accent-cyan uppercase",children:"Equipment"}),h&&l.jsx("button",{onClick:I,className:"text-accent-yellow hover:text-accent-yellow/80 transition-colors",children:l.jsx(ir,{className:"w-4 h-4"})})]}),l.jsx("div",{className:"space-y-2",children:c.equipment.map((J,_)=>l.jsxs("div",{className:"flex items-center gap-2",children:[h&&l.jsx("button",{onClick:()=>W(_),className:"text-accent-red hover:text-accent-red/80 transition-colors",children:l.jsx(rs,{className:"w-4 h-4"})}),l.jsx("input",{type:"text",value:J,onChange:V=>ue(_,V.target.value),readOnly:!h,className:`flex-1 bg-bg-secondary border ${h?"border-accent-cyan/50 border-dashed":"border-accent-cyan/30"} rounded px-3 py-2 text-text-primary font-mono text-sm focus:outline-none focus:border-accent-cyan`})]},_))})]}),c.classFeatures&&l.jsxs("div",{children:[l.jsx("h3",{className:"text-sm font-orbitron text-accent-cyan uppercase mb-2",children:"Class Features"}),l.jsx("div",{className:"space-y-3",children:Object.entries(c.classFeatures).map(([J,_])=>typeof _=="number"||typeof _=="boolean"?null:l.jsxs("div",{className:"bg-bg-secondary border border-accent-yellow/30 rounded p-3",children:[l.jsxs("div",{className:"flex items-center justify-between mb-1",children:[l.jsxs("span",{className:"text-xs font-mono text-accent-yellow uppercase",children:[J.replace(/([A-Z])/g," $1").trim(),_.roll&&` [${_.roll}]`]}),l.jsx("button",{onClick:()=>he(J),className:"text-accent-cyan hover:text-accent-cyan/80 transition-colors",title:"Reroll",children:l.jsx(tr,{className:"w-3 h-3"})})]}),l.jsx("div",{className:"text-text-primary text-sm font-mono",children:_.name?l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"font-bold text-accent-yellow",children:_.name}),l.jsx("div",{className:"text-text-secondary text-xs mt-1",children:_.description})]}):l.jsx("div",{className:"text-text-secondary text-xs",children:_.result||_})})]},J))}),c.classFeatures.dragoonThreshold&&l.jsxs("div",{className:"bg-accent-red/10 border border-accent-red/30 rounded p-3 mt-3",children:[l.jsx("div",{className:"text-xs font-mono text-accent-red uppercase mb-1",children:"Dragoon Detection"}),l.jsxs("div",{className:"text-text-secondary text-xs",children:["Current Threshold: ",c.classFeatures.dragoonThreshold," or lower",l.jsx("br",{}),l.jsx("span",{className:"text-accent-yellow",children:" Roll D20 when using Magi Arts or Blazer Sword"})]})]}),c.classFeatures.containmentPoints&&l.jsxs("div",{className:"bg-accent-yellow/10 border border-accent-yellow/30 rounded p-3 mt-3",children:[l.jsx("div",{className:"text-xs font-mono text-accent-yellow uppercase mb-1",children:"Containment Points"}),l.jsxs("div",{className:"text-text-secondary text-xs",children:["Current: ",c.classFeatures.containmentPoints," / 6",l.jsx("br",{}),l.jsx("span",{className:"text-accent-red",children:"Reduces by 1 on each blunder"})]})]}),c.classFeatures.junkDrawerSlots&&l.jsxs("div",{className:"bg-accent-cyan/10 border border-accent-cyan/30 rounded p-3 mt-3",children:[l.jsx("div",{className:"text-xs font-mono text-accent-cyan uppercase mb-1",children:"Junk Drawer"}),l.jsxs("div",{className:"text-text-secondary text-xs",children:["Extra Inventory Slots: +",c.classFeatures.junkDrawerSlots,l.jsx("br",{}),l.jsx("span",{className:"text-text-secondary",children:"For small broken machines (Hack Job parts)"})]})]}),c.classFeatures.ownsShip&&l.jsxs("div",{className:"bg-accent-cyan/10 border border-accent-cyan/30 rounded p-3 mt-3",children:[l.jsx("div",{className:"text-xs font-mono text-accent-cyan uppercase mb-1",children:"Hunk of Junk"}),l.jsx("div",{className:"text-text-secondary text-xs",children:"You own a ramshackle but trustworthy ship"})]})]}),l.jsxs("div",{className:"flex gap-3 pt-4 border-t border-accent-cyan/20",children:[l.jsxs(ge,{onClick:S,variant:"ghost",className:"flex-1",disabled:m,children:[l.jsx(mg,{className:"w-4 h-4 mr-2"}),"REROLL ALL"]}),l.jsxs(ge,{onClick:j,variant:"primary",className:"flex-1",disabled:m||!c?.name,children:[l.jsx(kO,{className:"w-4 h-4 mr-2"}),m?"SAVING...":"KEEP CHARACTER"]})]}),c&&!c.name&&l.jsxs("div",{className:"text-accent-yellow text-xs font-mono text-center mt-2",children:[">"," Enter a name to save character"]})]}):null}function HP(){const{session:t,loading:e,approved:n,checkingApproval:r}=Ya(),[a,i]=E.useState(null),[c,u]=E.useState(!0),[h,p]=E.useState(null);return E.useEffect(()=>{if(!t){u(!1);return}async function m(){try{let x=wM();if(x){const{error:v}=await Fe.from("sessions").select("room_code").eq("room_code",x).single();if(v&&v.code==="PGRST116")await g(x);else if(v)throw v;i(x)}else x=_N(),await g(x),SM(x),i(x)}catch(x){console.error("Error initializing room:",x),p(x.message)}finally{u(!1)}}async function g(x){const{error:v}=await Fe.from("rooms").insert({code:x,gm_id:t.user.id});if(v&&v.code!=="23505")throw v;const{error:w}=await Fe.from("sessions").insert({room_code:x,game_state:{threatDie:1,missions:[],dangerClocks:[],journal:"",log:[]}});if(w&&w.code!=="23505")throw w}m()},[t]),e?l.jsx(Yl,{message:"AUTHENTICATING"}):t?r?l.jsx(Yl,{message:"CHECKING ACCESS"}):n?c?l.jsx(Yl,{message:"INITIALIZING SESSION",details:["Establishing secure connection...","Loading rebel systems...","Syncing mission data..."]}):h?l.jsx("div",{className:"min-h-screen bg-bg-primary flex items-center justify-center",children:l.jsxs("div",{className:"text-accent-red text-2xl font-orbitron text-glow-red",children:["ERROR: ",h]})}):l.jsx(b_,{userId:t.user.id,roomCode:a,children:l.jsx(v_,{roomCode:a,children:l.jsx(VP,{roomCode:a})})}):l.jsx(zP,{}):l.jsx(PP,{})}function VP({roomCode:t}){const{character:e,loading:n}=as();return n?l.jsx(Yl,{message:"LOADING CHARACTER"}):l.jsx(S_,{roomCode:t,children:!n&&e===null?l.jsx("div",{className:"min-h-screen bg-bg-primary p-4 md:p-8 scanlines",children:l.jsx("div",{className:"max-w-6xl mx-auto",children:l.jsx(UP,{})})}):l.jsx(__,{roomCode:t,children:l.jsx(IP,{roomCode:t})})})}BE.createRoot(document.getElementById("root")).render(l.jsx(E.StrictMode,{children:l.jsx(x_,{children:l.jsx(HP,{})})}));
